
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../fragment/visuals/">
      
      
        <link rel="next" href="../sequence/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>model - symdesign Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/code_select.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#structure.model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="symdesign Documentation" class="md-header__button md-logo" aria-label="symdesign Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            symdesign Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              model
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="green"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/kylemeador/symdesign" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../user_guide/" class="md-tabs__link">
        
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  API reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="symdesign Documentation" class="md-nav__button md-logo" aria-label="symdesign Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    symdesign Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kylemeador/symdesign" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    symdesign
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../flags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../metrics/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    metrics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            metrics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metrics/pose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pose
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../protocols/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    protocols
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            protocols
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protocols/align/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    align
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protocols/cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protocols/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protocols/fragdock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fragdock
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protocols/pose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protocols/select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    select
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protocols/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../resources/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    resources
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/distribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    distribute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/ml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ml
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/monomer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    monomer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/multimer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    multimer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../resources/query/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    query
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5_8" id="__nav_3_5_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_8">
            <span class="md-nav__icon md-icon"></span>
            query
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/query/pdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pdb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/query/uniprot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    uniprot
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sql
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/structure_db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    structure_db
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/wrapapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wrapapi
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../sequence/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    sequence
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            sequence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sequence/constants/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    constants
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sequence/expression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    expression
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    structure
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            structure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../coordinates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    coordinates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../fragment/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    fragment
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_7_3" id="__nav_3_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7_3">
            <span class="md-nav__icon md-icon"></span>
            fragment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fragment/db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    db
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fragment/info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fragment/metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fragment/visuals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    visuals
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    model
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    model
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#structure.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin" class="md-nav__link">
    <span class="md-ellipsis">
      MetricsMixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetricsMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin.df" class="md-nav__link">
    <span class="md-ellipsis">
      df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin.calculate_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin.clear_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      clear_metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin" class="md-nav__link">
    <span class="md-ellipsis">
      ParseStructureMixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ParseStructureMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin.from_file" class="md-nav__link">
    <span class="md-ellipsis">
      from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin.from_pdb" class="md-nav__link">
    <span class="md-ellipsis">
      from_pdb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin.from_pdb_lines" class="md-nav__link">
    <span class="md-ellipsis">
      from_pdb_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin.from_mmcif" class="md-nav__link">
    <span class="md-ellipsis">
      from_mmcif
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity" class="md-nav__link">
    <span class="md-ellipsis">
      StructuredGeneEntity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StructuredGeneEntity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.fragment_map" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.uniprot_ids" class="md-nav__link">
    <span class="md-ellipsis">
      uniprot_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.reference_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      reference_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.offset_index" class="md-nav__link">
    <span class="md-ellipsis">
      offset_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.disorder" class="md-nav__link">
    <span class="md-ellipsis">
      disorder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.clear_api_data" class="md-nav__link">
    <span class="md-ellipsis">
      clear_api_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.retrieve_api_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      retrieve_api_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.add_fragments_to_profile" class="md-nav__link">
    <span class="md-ellipsis">
      add_fragments_to_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.simplify_fragment_profile" class="md-nav__link">
    <span class="md-ellipsis">
      simplify_fragment_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.calculate_profile" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.format_missing_loops_for_design" class="md-nav__link">
    <span class="md-ellipsis">
      format_missing_loops_for_design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.make_loop_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_loop_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.make_blueprint_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_blueprint_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Structure" class="md-nav__link">
    <span class="md-ellipsis">
      Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures" class="md-nav__link">
    <span class="md-ellipsis">
      ContainsStructures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContainsStructures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.biological_assembly" class="md-nav__link">
    <span class="md-ellipsis">
      biological_assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.file_path" class="md-nav__link">
    <span class="md-ellipsis">
      file_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.resolution" class="md-nav__link">
    <span class="md-ellipsis">
      resolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.reset_and_reindex_structures" class="md-nav__link">
    <span class="md-ellipsis">
      reset_and_reindex_structures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.fragment_db" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.format_header" class="md-nav__link">
    <span class="md-ellipsis">
      format_header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.mutate_residue" class="md-nav__link">
    <span class="md-ellipsis">
      mutate_residue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.delete_residues" class="md-nav__link">
    <span class="md-ellipsis">
      delete_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.insert_residue_type" class="md-nav__link">
    <span class="md-ellipsis">
      insert_residue_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.insert_residues" class="md-nav__link">
    <span class="md-ellipsis">
      insert_residues
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.ContainsChains" class="md-nav__link">
    <span class="md-ellipsis">
      ContainsChains
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContainsChains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.chains" class="md-nav__link">
    <span class="md-ellipsis">
      chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.number_of_chains" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.chain_breaks" class="md-nav__link">
    <span class="md-ellipsis">
      chain_breaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.from_chains" class="md-nav__link">
    <span class="md-ellipsis">
      from_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.has_dependent_chains" class="md-nav__link">
    <span class="md-ellipsis">
      has_dependent_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.is_parsed_multimodel" class="md-nav__link">
    <span class="md-ellipsis">
      is_parsed_multimodel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.are_chain_ids_pdb_compatible" class="md-nav__link">
    <span class="md-ellipsis">
      are_chain_ids_pdb_compatible
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.rename_chains" class="md-nav__link">
    <span class="md-ellipsis">
      rename_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.renumber_residues_by_chain" class="md-nav__link">
    <span class="md-ellipsis">
      renumber_residues_by_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.get_chain" class="md-nav__link">
    <span class="md-ellipsis">
      get_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.set_reference_sequence_from_seqres" class="md-nav__link">
    <span class="md-ellipsis">
      set_reference_sequence_from_seqres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.chain_id_generator" class="md-nav__link">
    <span class="md-ellipsis">
      chain_id_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.orient" class="md-nav__link">
    <span class="md-ellipsis">
      orient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities" class="md-nav__link">
    <span class="md-ellipsis">
      ContainsEntities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContainsEntities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.entity_info" class="md-nav__link">
    <span class="md-ellipsis">
      entity_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.entities" class="md-nav__link">
    <span class="md-ellipsis">
      entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.number_of_entities" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.entity_breaks" class="md-nav__link">
    <span class="md-ellipsis">
      entity_breaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.sequence" class="md-nav__link">
    <span class="md-ellipsis">
      sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.reference_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      reference_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.atom_indices_per_entity" class="md-nav__link">
    <span class="md-ellipsis">
      atom_indices_per_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.from_entities" class="md-nav__link">
    <span class="md-ellipsis">
      from_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.format_header" class="md-nav__link">
    <span class="md-ellipsis">
      format_header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.retrieve_metadata_from_pdb" class="md-nav__link">
    <span class="md-ellipsis">
      retrieve_metadata_from_pdb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.get_entity" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.entity_from_chain" class="md-nav__link">
    <span class="md-ellipsis">
      entity_from_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.match_entity_by_seq" class="md-nav__link">
    <span class="md-ellipsis">
      match_entity_by_seq
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin" class="md-nav__link">
    <span class="md-ellipsis">
      SymmetryOpsMixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SymmetryOpsMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.sym_entry" class="md-nav__link">
    <span class="md-ellipsis">
      sym_entry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.point_group_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      point_group_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.dimension" class="md-nav__link">
    <span class="md-ellipsis">
      dimension
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.uc_dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      uc_dimensions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.cryst_record" class="md-nav__link">
    <span class="md-ellipsis">
      cryst_record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.expand_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      expand_matrices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.expand_translations" class="md-nav__link">
    <span class="md-ellipsis">
      expand_translations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.chain_transforms" class="md-nav__link">
    <span class="md-ellipsis">
      chain_transforms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.number_of_symmetric_residues" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_symmetric_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.number_of_symmetry_mates" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_symmetry_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.number_of_uc_symmetry_mates" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_uc_symmetry_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.asu_model_index" class="md-nav__link">
    <span class="md-ellipsis">
      asu_model_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.asu_indices" class="md-nav__link">
    <span class="md-ellipsis">
      asu_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.symmetric_coords" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.symmetric_coords_split" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_coords_split
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.center_of_mass_symmetric" class="md-nav__link">
    <span class="md-ellipsis">
      center_of_mass_symmetric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.center_of_mass_symmetric_models" class="md-nav__link">
    <span class="md-ellipsis">
      center_of_mass_symmetric_models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.format_biomt" class="md-nav__link">
    <span class="md-ellipsis">
      format_biomt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.format_header" class="md-nav__link">
    <span class="md-ellipsis">
      format_header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.set_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      set_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.reset_mates" class="md-nav__link">
    <span class="md-ellipsis">
      reset_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.is_surrounding_uc" class="md-nav__link">
    <span class="md-ellipsis">
      is_surrounding_uc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.make_indices_symmetric" class="md-nav__link">
    <span class="md-ellipsis">
      make_indices_symmetric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.return_symmetric_copies" class="md-nav__link">
    <span class="md-ellipsis">
      return_symmetric_copies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.generate_symmetric_coords" class="md-nav__link">
    <span class="md-ellipsis">
      generate_symmetric_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.cart_to_frac" class="md-nav__link">
    <span class="md-ellipsis">
      cart_to_frac
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.frac_to_cart" class="md-nav__link">
    <span class="md-ellipsis">
      frac_to_cart
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.return_symmetric_coords" class="md-nav__link">
    <span class="md-ellipsis">
      return_symmetric_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.return_unit_cell_coords" class="md-nav__link">
    <span class="md-ellipsis">
      return_unit_cell_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.find_contacting_asu" class="md-nav__link">
    <span class="md-ellipsis">
      find_contacting_asu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.get_contacting_asu" class="md-nav__link">
    <span class="md-ellipsis">
      get_contacting_asu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.set_contacting_asu" class="md-nav__link">
    <span class="md-ellipsis">
      set_contacting_asu
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Chain" class="md-nav__link">
    <span class="md-ellipsis">
      Chain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.chain_id" class="md-nav__link">
    <span class="md-ellipsis">
      chain_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.entity" class="md-nav__link">
    <span class="md-ellipsis">
      entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.entity_id" class="md-nav__link">
    <span class="md-ellipsis">
      entity_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.reference_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      reference_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.calculate_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Entity" class="md-nav__link">
    <span class="md-ellipsis">
      Entity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Entity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.mate_rotation_axes" class="md-nav__link">
    <span class="md-ellipsis">
      mate_rotation_axes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.entity_id" class="md-nav__link">
    <span class="md-ellipsis">
      entity_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.number_of_entities" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.entities" class="md-nav__link">
    <span class="md-ellipsis">
      entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.chains" class="md-nav__link">
    <span class="md-ellipsis">
      chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.assembly" class="md-nav__link">
    <span class="md-ellipsis">
      assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.max_symmetry_chain_idx" class="md-nav__link">
    <span class="md-ellipsis">
      max_symmetry_chain_idx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.max_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      max_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.from_chains" class="md-nav__link">
    <span class="md-ellipsis">
      from_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.coords" class="md-nav__link">
    <span class="md-ellipsis">
      coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.is_captain" class="md-nav__link">
    <span class="md-ellipsis">
      is_captain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.is_mate" class="md-nav__link">
    <span class="md-ellipsis">
      is_mate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.has_mates" class="md-nav__link">
    <span class="md-ellipsis">
      has_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.remove_mate_chains" class="md-nav__link">
    <span class="md-ellipsis">
      remove_mate_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.make_oligomer" class="md-nav__link">
    <span class="md-ellipsis">
      make_oligomer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.get_transformed_mate" class="md-nav__link">
    <span class="md-ellipsis">
      get_transformed_mate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.calculate_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.calculate_spatial_orientation_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_spatial_orientation_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.get_alphafold_features" class="md-nav__link">
    <span class="md-ellipsis">
      get_alphafold_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.find_chain_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      find_chain_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.is_cyclic" class="md-nav__link">
    <span class="md-ellipsis">
      is_cyclic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.is_dihedral" class="md-nav__link">
    <span class="md-ellipsis">
      is_dihedral
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.find_dihedral_chain" class="md-nav__link">
    <span class="md-ellipsis">
      find_dihedral_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.make_sdf" class="md-nav__link">
    <span class="md-ellipsis">
      make_sdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.format_sdf" class="md-nav__link">
    <span class="md-ellipsis">
      format_sdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.reset_mates" class="md-nav__link">
    <span class="md-ellipsis">
      reset_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.fragment_db" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_db
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Model" class="md-nav__link">
    <span class="md-ellipsis">
      Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Models" class="md-nav__link">
    <span class="md-ellipsis">
      Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Models.number_of_models" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Models.from_models" class="md-nav__link">
    <span class="md-ellipsis">
      from_models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Models.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel" class="md-nav__link">
    <span class="md-ellipsis">
      SymmetricModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SymmetricModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.symmetric_coords_split_by_entity" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_coords_split_by_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.symmetric_coords_by_entity" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_coords_by_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.center_of_mass_symmetric_entities" class="md-nav__link">
    <span class="md-ellipsis">
      center_of_mass_symmetric_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.assembly" class="md-nav__link">
    <span class="md-ellipsis">
      assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.assembly_minimally_contacting" class="md-nav__link">
    <span class="md-ellipsis">
      assembly_minimally_contacting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.entity_transformations" class="md-nav__link">
    <span class="md-ellipsis">
      entity_transformations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.assembly_tree" class="md-nav__link">
    <span class="md-ellipsis">
      assembly_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.from_assembly" class="md-nav__link">
    <span class="md-ellipsis">
      from_assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.set_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      set_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.get_asu_interaction_model_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_asu_interaction_model_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.get_asu_atom_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_asu_atom_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.get_oligomeric_atom_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_oligomeric_atom_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.get_asu_interaction_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_asu_interaction_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.make_oligomers" class="md-nav__link">
    <span class="md-ellipsis">
      make_oligomers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.symmetric_assembly_is_clash" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_assembly_is_clash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Pose" class="md-nav__link">
    <span class="md-ellipsis">
      Pose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.split_interface_ss_elements" class="md-nav__link">
    <span class="md-ellipsis">
      split_interface_ss_elements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.ss_sequence_indices" class="md-nav__link">
    <span class="md-ellipsis">
      ss_sequence_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.ss_type_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      ss_type_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.active_entities" class="md-nav__link">
    <span class="md-ellipsis">
      active_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_residues" class="md-nav__link">
    <span class="md-ellipsis">
      interface_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_residues_by_entity_pair" class="md-nav__link">
    <span class="md-ellipsis">
      interface_residues_by_entity_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_neighbor_residues" class="md-nav__link">
    <span class="md-ellipsis">
      interface_neighbor_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.design_residues" class="md-nav__link">
    <span class="md-ellipsis">
      design_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.required_residues" class="md-nav__link">
    <span class="md-ellipsis">
      required_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.core_residues" class="md-nav__link">
    <span class="md-ellipsis">
      core_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.rim_residues" class="md-nav__link">
    <span class="md-ellipsis">
      rim_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.support_residues" class="md-nav__link">
    <span class="md-ellipsis">
      support_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.fragment_info_by_entity_pair" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_info_by_entity_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_fragment_residue_indices" class="md-nav__link">
    <span class="md-ellipsis">
      interface_fragment_residue_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_residues_by_interface_unique" class="md-nav__link">
    <span class="md-ellipsis">
      interface_residues_by_interface_unique
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_residues_by_interface" class="md-nav__link">
    <span class="md-ellipsis">
      interface_residues_by_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.fragment_metrics_by_entity_pair" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_metrics_by_entity_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.calculate_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.apply_design_selector" class="md-nav__link">
    <span class="md-ellipsis">
      apply_design_selector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_alphafold_features" class="md-nav__link">
    <span class="md-ellipsis">
      get_alphafold_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_proteinmpnn_params" class="md-nav__link">
    <span class="md-ellipsis">
      get_proteinmpnn_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.generate_proteinmpnn_decode_order" class="md-nav__link">
    <span class="md-ellipsis">
      generate_proteinmpnn_decode_order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_proteinmpnn_unbound_coords" class="md-nav__link">
    <span class="md-ellipsis">
      get_proteinmpnn_unbound_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.score_sequences" class="md-nav__link">
    <span class="md-ellipsis">
      score_sequences
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.design_sequences" class="md-nav__link">
    <span class="md-ellipsis">
      design_sequences
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_termini_accessibility" class="md-nav__link">
    <span class="md-ellipsis">
      get_termini_accessibility
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_contact_order" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_contact_order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_folding_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      get_folding_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      interface_metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interface_metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_radius_ratio_v" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_radius_ratio_#v#',
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_min_radius_ratio_v" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_min_radius_ratio_#v#',
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_max_radius_ratio_v" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_max_radius_ratio_#v#',
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_number_of_residues_ratio_v" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_number_of_residues_ratio_#v#',
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_number_of_residues_average_deviation" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_number_of_residues_average_deviation,
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_errat" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_errat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_interface_surface_area" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_interface_surface_area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_relative_surface_area" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_relative_surface_area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_buried_surface_area" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_buried_surface_area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_spatial_aggregation_propensity" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_spatial_aggregation_propensity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_interface_residues" class="md-nav__link">
    <span class="md-ellipsis">
      get_interface_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.local_density_interface" class="md-nav__link">
    <span class="md-ellipsis">
      local_density_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.query_entity_pair_for_fragments" class="md-nav__link">
    <span class="md-ellipsis">
      query_entity_pair_for_fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.find_and_split_interface" class="md-nav__link">
    <span class="md-ellipsis">
      find_and_split_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.check_interface_topology" class="md-nav__link">
    <span class="md-ellipsis">
      check_interface_topology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.calculate_secondary_structure" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_secondary_structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.calculate_fragment_profile" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_fragment_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_fragment_observations" class="md-nav__link">
    <span class="md-ellipsis">
      get_fragment_observations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_fragment_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      get_fragment_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.residue_processing" class="md-nav__link">
    <span class="md-ellipsis">
      residue_processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.process_rosetta_residue_scores" class="md-nav__link">
    <span class="md-ellipsis">
      process_rosetta_residue_scores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.rosetta_hbond_processing" class="md-nav__link">
    <span class="md-ellipsis">
      rosetta_hbond_processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.generate_interface_fragments" class="md-nav__link">
    <span class="md-ellipsis">
      generate_interface_fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.generate_fragments" class="md-nav__link">
    <span class="md-ellipsis">
      generate_fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.write_fragment_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      write_fragment_pairs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.debug_pose" class="md-nav__link">
    <span class="md-ellipsis">
      debug_pose
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.softmax" class="md-nav__link">
    <span class="md-ellipsis">
      softmax
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.split_residue_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      split_residue_pairs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.split_number_pairs_and_sort" class="md-nav__link">
    <span class="md-ellipsis">
      split_number_pairs_and_sort
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.parse_cryst_record" class="md-nav__link">
    <span class="md-ellipsis">
      parse_cryst_record
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sequence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sequence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    tools
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/BenchmarkCollapseHydrophobicityScale/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BenchmarkCollapseHydrophobicityScale
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/ConcatenatePDBFiles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ConcatenatePDBFiles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/ProfileScripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ProfileScripts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/SlurmControl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SlurmControl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/distribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    distribute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/fetch_commands_from_slurm_output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fetch_commands_from_slurm_output
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/format_commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    format_commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/format_pose_ids/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    format_pose_ids
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/generate_reference_docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    generate_reference_docs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/get_array_numbers_from_identifiers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    get_array_numbers_from_identifiers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/list_files_in_directory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    list_files_in_directory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/list_overlap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    list_overlap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/models_to_multimodel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models_to_multimodel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/profile_gpu_nodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    profile_gpu_nodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/retrieve_oligomers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    retrieve_oligomers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/retrieve_pdbs_by_advanced_query/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    retrieve_pdbs_by_advanced_query
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/write_indices_for_C1_docking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    write_indices_for_C1_docking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../utils/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    utils
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/SymEntry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SymEntry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/nanohedra_parsing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nanohedra_parsing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/path/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    path
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/query/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    query
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/rosetta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rosetta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/symmetry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    symmetry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    types
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../visualization/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    visualization
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            visualization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/SymmetryMates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SymmetryMates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/VisualizeUtils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VisualizeUtils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/shapes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shapes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#structure.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin" class="md-nav__link">
    <span class="md-ellipsis">
      MetricsMixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetricsMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin.df" class="md-nav__link">
    <span class="md-ellipsis">
      df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin.calculate_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.MetricsMixin.clear_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      clear_metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin" class="md-nav__link">
    <span class="md-ellipsis">
      ParseStructureMixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ParseStructureMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin.from_file" class="md-nav__link">
    <span class="md-ellipsis">
      from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin.from_pdb" class="md-nav__link">
    <span class="md-ellipsis">
      from_pdb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin.from_pdb_lines" class="md-nav__link">
    <span class="md-ellipsis">
      from_pdb_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ParseStructureMixin.from_mmcif" class="md-nav__link">
    <span class="md-ellipsis">
      from_mmcif
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity" class="md-nav__link">
    <span class="md-ellipsis">
      StructuredGeneEntity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StructuredGeneEntity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.fragment_map" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.uniprot_ids" class="md-nav__link">
    <span class="md-ellipsis">
      uniprot_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.reference_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      reference_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.offset_index" class="md-nav__link">
    <span class="md-ellipsis">
      offset_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.disorder" class="md-nav__link">
    <span class="md-ellipsis">
      disorder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.clear_api_data" class="md-nav__link">
    <span class="md-ellipsis">
      clear_api_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.retrieve_api_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      retrieve_api_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.add_fragments_to_profile" class="md-nav__link">
    <span class="md-ellipsis">
      add_fragments_to_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.simplify_fragment_profile" class="md-nav__link">
    <span class="md-ellipsis">
      simplify_fragment_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.calculate_profile" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.format_missing_loops_for_design" class="md-nav__link">
    <span class="md-ellipsis">
      format_missing_loops_for_design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.make_loop_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_loop_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.StructuredGeneEntity.make_blueprint_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_blueprint_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Structure" class="md-nav__link">
    <span class="md-ellipsis">
      Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures" class="md-nav__link">
    <span class="md-ellipsis">
      ContainsStructures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContainsStructures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.biological_assembly" class="md-nav__link">
    <span class="md-ellipsis">
      biological_assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.file_path" class="md-nav__link">
    <span class="md-ellipsis">
      file_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.resolution" class="md-nav__link">
    <span class="md-ellipsis">
      resolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.reset_and_reindex_structures" class="md-nav__link">
    <span class="md-ellipsis">
      reset_and_reindex_structures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.fragment_db" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.format_header" class="md-nav__link">
    <span class="md-ellipsis">
      format_header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.mutate_residue" class="md-nav__link">
    <span class="md-ellipsis">
      mutate_residue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.delete_residues" class="md-nav__link">
    <span class="md-ellipsis">
      delete_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.insert_residue_type" class="md-nav__link">
    <span class="md-ellipsis">
      insert_residue_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsStructures.insert_residues" class="md-nav__link">
    <span class="md-ellipsis">
      insert_residues
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.ContainsChains" class="md-nav__link">
    <span class="md-ellipsis">
      ContainsChains
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContainsChains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.chains" class="md-nav__link">
    <span class="md-ellipsis">
      chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.number_of_chains" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.chain_breaks" class="md-nav__link">
    <span class="md-ellipsis">
      chain_breaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.from_chains" class="md-nav__link">
    <span class="md-ellipsis">
      from_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.has_dependent_chains" class="md-nav__link">
    <span class="md-ellipsis">
      has_dependent_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.is_parsed_multimodel" class="md-nav__link">
    <span class="md-ellipsis">
      is_parsed_multimodel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.are_chain_ids_pdb_compatible" class="md-nav__link">
    <span class="md-ellipsis">
      are_chain_ids_pdb_compatible
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.rename_chains" class="md-nav__link">
    <span class="md-ellipsis">
      rename_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.renumber_residues_by_chain" class="md-nav__link">
    <span class="md-ellipsis">
      renumber_residues_by_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.get_chain" class="md-nav__link">
    <span class="md-ellipsis">
      get_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.set_reference_sequence_from_seqres" class="md-nav__link">
    <span class="md-ellipsis">
      set_reference_sequence_from_seqres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.chain_id_generator" class="md-nav__link">
    <span class="md-ellipsis">
      chain_id_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsChains.orient" class="md-nav__link">
    <span class="md-ellipsis">
      orient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities" class="md-nav__link">
    <span class="md-ellipsis">
      ContainsEntities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContainsEntities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.entity_info" class="md-nav__link">
    <span class="md-ellipsis">
      entity_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.entities" class="md-nav__link">
    <span class="md-ellipsis">
      entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.number_of_entities" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.entity_breaks" class="md-nav__link">
    <span class="md-ellipsis">
      entity_breaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.sequence" class="md-nav__link">
    <span class="md-ellipsis">
      sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.reference_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      reference_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.atom_indices_per_entity" class="md-nav__link">
    <span class="md-ellipsis">
      atom_indices_per_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.from_entities" class="md-nav__link">
    <span class="md-ellipsis">
      from_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.format_header" class="md-nav__link">
    <span class="md-ellipsis">
      format_header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.retrieve_metadata_from_pdb" class="md-nav__link">
    <span class="md-ellipsis">
      retrieve_metadata_from_pdb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.get_entity" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.entity_from_chain" class="md-nav__link">
    <span class="md-ellipsis">
      entity_from_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.ContainsEntities.match_entity_by_seq" class="md-nav__link">
    <span class="md-ellipsis">
      match_entity_by_seq
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin" class="md-nav__link">
    <span class="md-ellipsis">
      SymmetryOpsMixin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SymmetryOpsMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.sym_entry" class="md-nav__link">
    <span class="md-ellipsis">
      sym_entry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.point_group_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      point_group_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.dimension" class="md-nav__link">
    <span class="md-ellipsis">
      dimension
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.uc_dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      uc_dimensions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.cryst_record" class="md-nav__link">
    <span class="md-ellipsis">
      cryst_record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.expand_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      expand_matrices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.expand_translations" class="md-nav__link">
    <span class="md-ellipsis">
      expand_translations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.chain_transforms" class="md-nav__link">
    <span class="md-ellipsis">
      chain_transforms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.number_of_symmetric_residues" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_symmetric_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.number_of_symmetry_mates" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_symmetry_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.number_of_uc_symmetry_mates" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_uc_symmetry_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.asu_model_index" class="md-nav__link">
    <span class="md-ellipsis">
      asu_model_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.asu_indices" class="md-nav__link">
    <span class="md-ellipsis">
      asu_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.symmetric_coords" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.symmetric_coords_split" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_coords_split
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.center_of_mass_symmetric" class="md-nav__link">
    <span class="md-ellipsis">
      center_of_mass_symmetric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.center_of_mass_symmetric_models" class="md-nav__link">
    <span class="md-ellipsis">
      center_of_mass_symmetric_models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.format_biomt" class="md-nav__link">
    <span class="md-ellipsis">
      format_biomt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.format_header" class="md-nav__link">
    <span class="md-ellipsis">
      format_header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.set_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      set_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.reset_mates" class="md-nav__link">
    <span class="md-ellipsis">
      reset_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.is_surrounding_uc" class="md-nav__link">
    <span class="md-ellipsis">
      is_surrounding_uc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.make_indices_symmetric" class="md-nav__link">
    <span class="md-ellipsis">
      make_indices_symmetric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.return_symmetric_copies" class="md-nav__link">
    <span class="md-ellipsis">
      return_symmetric_copies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.generate_symmetric_coords" class="md-nav__link">
    <span class="md-ellipsis">
      generate_symmetric_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.cart_to_frac" class="md-nav__link">
    <span class="md-ellipsis">
      cart_to_frac
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.frac_to_cart" class="md-nav__link">
    <span class="md-ellipsis">
      frac_to_cart
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.return_symmetric_coords" class="md-nav__link">
    <span class="md-ellipsis">
      return_symmetric_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.return_unit_cell_coords" class="md-nav__link">
    <span class="md-ellipsis">
      return_unit_cell_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.find_contacting_asu" class="md-nav__link">
    <span class="md-ellipsis">
      find_contacting_asu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.get_contacting_asu" class="md-nav__link">
    <span class="md-ellipsis">
      get_contacting_asu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetryOpsMixin.set_contacting_asu" class="md-nav__link">
    <span class="md-ellipsis">
      set_contacting_asu
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Chain" class="md-nav__link">
    <span class="md-ellipsis">
      Chain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.chain_id" class="md-nav__link">
    <span class="md-ellipsis">
      chain_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.entity" class="md-nav__link">
    <span class="md-ellipsis">
      entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.entity_id" class="md-nav__link">
    <span class="md-ellipsis">
      entity_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.reference_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      reference_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Chain.calculate_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Entity" class="md-nav__link">
    <span class="md-ellipsis">
      Entity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Entity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.mate_rotation_axes" class="md-nav__link">
    <span class="md-ellipsis">
      mate_rotation_axes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.entity_id" class="md-nav__link">
    <span class="md-ellipsis">
      entity_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.number_of_entities" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.entities" class="md-nav__link">
    <span class="md-ellipsis">
      entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.chains" class="md-nav__link">
    <span class="md-ellipsis">
      chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.assembly" class="md-nav__link">
    <span class="md-ellipsis">
      assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.max_symmetry_chain_idx" class="md-nav__link">
    <span class="md-ellipsis">
      max_symmetry_chain_idx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.max_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      max_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.from_chains" class="md-nav__link">
    <span class="md-ellipsis">
      from_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.coords" class="md-nav__link">
    <span class="md-ellipsis">
      coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.is_captain" class="md-nav__link">
    <span class="md-ellipsis">
      is_captain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.is_mate" class="md-nav__link">
    <span class="md-ellipsis">
      is_mate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.has_mates" class="md-nav__link">
    <span class="md-ellipsis">
      has_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.remove_mate_chains" class="md-nav__link">
    <span class="md-ellipsis">
      remove_mate_chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.make_oligomer" class="md-nav__link">
    <span class="md-ellipsis">
      make_oligomer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.get_transformed_mate" class="md-nav__link">
    <span class="md-ellipsis">
      get_transformed_mate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.calculate_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.calculate_spatial_orientation_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_spatial_orientation_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.get_alphafold_features" class="md-nav__link">
    <span class="md-ellipsis">
      get_alphafold_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.find_chain_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      find_chain_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.is_cyclic" class="md-nav__link">
    <span class="md-ellipsis">
      is_cyclic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.is_dihedral" class="md-nav__link">
    <span class="md-ellipsis">
      is_dihedral
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.find_dihedral_chain" class="md-nav__link">
    <span class="md-ellipsis">
      find_dihedral_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.make_sdf" class="md-nav__link">
    <span class="md-ellipsis">
      make_sdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.format_sdf" class="md-nav__link">
    <span class="md-ellipsis">
      format_sdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.reset_mates" class="md-nav__link">
    <span class="md-ellipsis">
      reset_mates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Entity.fragment_db" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_db
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Model" class="md-nav__link">
    <span class="md-ellipsis">
      Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Models" class="md-nav__link">
    <span class="md-ellipsis">
      Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Models.number_of_models" class="md-nav__link">
    <span class="md-ellipsis">
      number_of_models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Models.from_models" class="md-nav__link">
    <span class="md-ellipsis">
      from_models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Models.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel" class="md-nav__link">
    <span class="md-ellipsis">
      SymmetricModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SymmetricModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.symmetric_coords_split_by_entity" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_coords_split_by_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.symmetric_coords_by_entity" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_coords_by_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.center_of_mass_symmetric_entities" class="md-nav__link">
    <span class="md-ellipsis">
      center_of_mass_symmetric_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.assembly" class="md-nav__link">
    <span class="md-ellipsis">
      assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.assembly_minimally_contacting" class="md-nav__link">
    <span class="md-ellipsis">
      assembly_minimally_contacting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.entity_transformations" class="md-nav__link">
    <span class="md-ellipsis">
      entity_transformations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.assembly_tree" class="md-nav__link">
    <span class="md-ellipsis">
      assembly_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.from_assembly" class="md-nav__link">
    <span class="md-ellipsis">
      from_assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.set_symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      set_symmetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.get_asu_interaction_model_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_asu_interaction_model_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.get_asu_atom_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_asu_atom_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.get_oligomeric_atom_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_oligomeric_atom_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.get_asu_interaction_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_asu_interaction_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.make_oligomers" class="md-nav__link">
    <span class="md-ellipsis">
      make_oligomers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.symmetric_assembly_is_clash" class="md-nav__link">
    <span class="md-ellipsis">
      symmetric_assembly_is_clash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.SymmetricModel.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.Pose" class="md-nav__link">
    <span class="md-ellipsis">
      Pose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.split_interface_ss_elements" class="md-nav__link">
    <span class="md-ellipsis">
      split_interface_ss_elements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.ss_sequence_indices" class="md-nav__link">
    <span class="md-ellipsis">
      ss_sequence_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.ss_type_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      ss_type_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.active_entities" class="md-nav__link">
    <span class="md-ellipsis">
      active_entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_residues" class="md-nav__link">
    <span class="md-ellipsis">
      interface_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_residues_by_entity_pair" class="md-nav__link">
    <span class="md-ellipsis">
      interface_residues_by_entity_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_neighbor_residues" class="md-nav__link">
    <span class="md-ellipsis">
      interface_neighbor_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.design_residues" class="md-nav__link">
    <span class="md-ellipsis">
      design_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.required_residues" class="md-nav__link">
    <span class="md-ellipsis">
      required_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.core_residues" class="md-nav__link">
    <span class="md-ellipsis">
      core_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.rim_residues" class="md-nav__link">
    <span class="md-ellipsis">
      rim_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.support_residues" class="md-nav__link">
    <span class="md-ellipsis">
      support_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.fragment_info_by_entity_pair" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_info_by_entity_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_fragment_residue_indices" class="md-nav__link">
    <span class="md-ellipsis">
      interface_fragment_residue_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_residues_by_interface_unique" class="md-nav__link">
    <span class="md-ellipsis">
      interface_residues_by_interface_unique
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_residues_by_interface" class="md-nav__link">
    <span class="md-ellipsis">
      interface_residues_by_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.fragment_metrics_by_entity_pair" class="md-nav__link">
    <span class="md-ellipsis">
      fragment_metrics_by_entity_pair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.calculate_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.apply_design_selector" class="md-nav__link">
    <span class="md-ellipsis">
      apply_design_selector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_alphafold_features" class="md-nav__link">
    <span class="md-ellipsis">
      get_alphafold_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_proteinmpnn_params" class="md-nav__link">
    <span class="md-ellipsis">
      get_proteinmpnn_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.generate_proteinmpnn_decode_order" class="md-nav__link">
    <span class="md-ellipsis">
      generate_proteinmpnn_decode_order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_proteinmpnn_unbound_coords" class="md-nav__link">
    <span class="md-ellipsis">
      get_proteinmpnn_unbound_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.score_sequences" class="md-nav__link">
    <span class="md-ellipsis">
      score_sequences
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.design_sequences" class="md-nav__link">
    <span class="md-ellipsis">
      design_sequences
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_termini_accessibility" class="md-nav__link">
    <span class="md-ellipsis">
      get_termini_accessibility
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_contact_order" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_contact_order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_folding_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      get_folding_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      interface_metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interface_metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_radius_ratio_v" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_radius_ratio_#v#',
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_min_radius_ratio_v" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_min_radius_ratio_#v#',
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_max_radius_ratio_v" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_max_radius_ratio_#v#',
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_number_of_residues_ratio_v" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_number_of_residues_ratio_#v#',
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.interface_metrics--entity_number_of_residues_average_deviation" class="md-nav__link">
    <span class="md-ellipsis">
      'entity_number_of_residues_average_deviation,
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_errat" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_errat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_interface_surface_area" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_interface_surface_area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_relative_surface_area" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_relative_surface_area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_buried_surface_area" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_buried_surface_area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.per_residue_spatial_aggregation_propensity" class="md-nav__link">
    <span class="md-ellipsis">
      per_residue_spatial_aggregation_propensity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_interface_residues" class="md-nav__link">
    <span class="md-ellipsis">
      get_interface_residues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.local_density_interface" class="md-nav__link">
    <span class="md-ellipsis">
      local_density_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.query_entity_pair_for_fragments" class="md-nav__link">
    <span class="md-ellipsis">
      query_entity_pair_for_fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.find_and_split_interface" class="md-nav__link">
    <span class="md-ellipsis">
      find_and_split_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.check_interface_topology" class="md-nav__link">
    <span class="md-ellipsis">
      check_interface_topology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.calculate_secondary_structure" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_secondary_structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.calculate_fragment_profile" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_fragment_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_fragment_observations" class="md-nav__link">
    <span class="md-ellipsis">
      get_fragment_observations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.get_fragment_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      get_fragment_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.residue_processing" class="md-nav__link">
    <span class="md-ellipsis">
      residue_processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.process_rosetta_residue_scores" class="md-nav__link">
    <span class="md-ellipsis">
      process_rosetta_residue_scores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.rosetta_hbond_processing" class="md-nav__link">
    <span class="md-ellipsis">
      rosetta_hbond_processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.generate_interface_fragments" class="md-nav__link">
    <span class="md-ellipsis">
      generate_interface_fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.generate_fragments" class="md-nav__link">
    <span class="md-ellipsis">
      generate_fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.write_fragment_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      write_fragment_pairs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure.model.Pose.debug_pose" class="md-nav__link">
    <span class="md-ellipsis">
      debug_pose
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.softmax" class="md-nav__link">
    <span class="md-ellipsis">
      softmax
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.split_residue_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      split_residue_pairs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.split_number_pairs_and_sort" class="md-nav__link">
    <span class="md-ellipsis">
      split_number_pairs_and_sort
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure.model.parse_cryst_record" class="md-nav__link">
    <span class="md-ellipsis">
      parse_cryst_record
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>model</h1>

<div class="doc doc-object doc-module">



<a id="structure.model"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="structure.model.MetricsMixin" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">MetricsMixin</span>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Perform Metric evaluation for derived classes</p>
<p>Subclasses of Metrics must implement _metrics_table property and calculate_metrics() method</p>


  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.MetricsMixin.metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">metrics</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">metrics</span><span class="p">:</span> <span class="n"><span title="structure.model.MetricsMixin._metrics_table">_metrics_table</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Metrics as sqlalchemy Mapped class. <strong>init</strong>: Retrieves all metrics, loads sqlalchemy Mapped class</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.MetricsMixin.df" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">df</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">df</span><span class="p">:</span> <span class="n"><span title="pandas.Series">Series</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Metrics as a Series. <strong>init</strong>: Retrieves all metrics, loads pd.Series</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.MetricsMixin.calculate_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">calculate_metrics</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Perform Metric calculation for the Entity in question</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform Metric calculation for the Entity in question&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.MetricsMixin.clear_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">clear_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">clear_metrics</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Clear all Metrics.state_attributes for the Entity in question</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all Metrics.state_attributes for the Entity in question&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">MetricsMixin</span><span class="o">.</span><span class="n">state_attributes</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">continue</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.ParseStructureMixin" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">ParseStructureMixin</span>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="abc.ABC">ABC</span></code></p>



  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="structure.model.ParseStructureMixin.from_file" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_file</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_file</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Create a new Structure from a file with Atom records</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">AnyStr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Structure from a file with Atom records&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;.pdb&#39;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_pdb</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;.cif&#39;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_mmcif</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: The file type </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> isn&#39;t supported for parsing. Please use &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;the supported types &#39;.pdb&#39; or &#39;.cif&#39;. Alternatively use those constructors instead (ex: from_pdb(), &quot;</span>
            <span class="s1">&#39;from_mmcif()) if the file extension is nonsense, but the file format is respected.&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ParseStructureMixin.from_pdb" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_pdb</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_pdb</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Create a new Structure from a .pdb formatted file</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_pdb</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">AnyStr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Structure from a .pdb formatted file&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">read_pdb_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_finish</span><span class="p">(</span><span class="bp">cls</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ParseStructureMixin.from_pdb_lines" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_pdb_lines</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_pdb_lines</span><span class="p">(</span><span class="n">pdb_lines</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Create a new Structure from already parsed .pdb file lines</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_pdb_lines</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pdb_lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Structure from already parsed .pdb file lines&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">read_pdb_file</span><span class="p">(</span><span class="n">pdb_lines</span><span class="o">=</span><span class="n">pdb_lines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_finish</span><span class="p">(</span><span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ParseStructureMixin.from_mmcif" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_mmcif</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_mmcif</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Create a new Structure from a .cif formatted file</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_mmcif</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">AnyStr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Structure from a .cif formatted file&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">read_mmcif_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_finish</span><span class="p">(</span><span class="bp">cls</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.StructuredGeneEntity" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">StructuredGeneEntity</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">StructuredGeneEntity</span><span class="p">(</span><span class="n">metadata</span><span class="p">:</span> <span class="n"><span title="symdesign.resources.sql.ProteinMetadata">ProteinMetadata</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uniprot_ids</span><span class="p">:</span> <span class="n">tuple</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thermophilicity</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reference_sequence</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.base.ContainsResidues" href="../base/#structure.base.ContainsResidues">ContainsResidues</a></code>, <code><a class="autorefs autorefs-internal" title="structure.sequence.GeneEntity" href="../sequence/#structure.sequence.GeneEntity">GeneEntity</a></code></p>

  
      <p>Implements methods to map a Structure to a GeneEntity</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>metadata</code></b>
            (<code><span title="symdesign.resources.sql.ProteinMetadata">ProteinMetadata</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Unique database references</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>uniprot_ids</code></b>
            (<code>tuple[str, ...]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The UniProtID(s) that describe this protein sequence</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>thermophilicity</code></b>
            (<code>bool</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The extent to which the sequence is deemed thermophilic</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>reference_sequence</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The reference sequence (according to expression sequence or reference database)</p>
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">sql</span><span class="o">.</span><span class="n">ProteinMetadata</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uniprot_ids</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">thermophilicity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reference_sequence</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        metadata: Unique database references</span>
<span class="sd">        uniprot_ids: The UniProtID(s) that describe this protein sequence</span>
<span class="sd">        thermophilicity: The extent to which the sequence is deemed thermophilic</span>
<span class="sd">        reference_sequence: The reference sequence (according to expression sequence or reference database)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># StructuredGeneEntity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">default_fragment_contribution</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_map</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_profile</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># fragment specific scoring matrix</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_api_data</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># {chain: {&#39;accession&#39;: &#39;Q96DC8&#39;, &#39;db&#39;: &#39;UniProt&#39;}, ...}</span>

    <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">reference_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference_sequence</span> <span class="o">=</span> <span class="n">reference_sequence</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thermophilicity</span> <span class="o">=</span> <span class="n">thermophilicity</span>
        <span class="k">if</span> <span class="n">uniprot_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_ids</span> <span class="o">=</span> <span class="n">uniprot_ids</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">reference_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference_sequence</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">reference_sequence</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thermophilicity</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">thermophilicity</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">uniprot_entities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_ids</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">uniprot_ids</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.StructuredGeneEntity.fragment_map" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">fragment_map</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">fragment_map</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">dict</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">set</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.fragment.db.FragmentObservation" href="../fragment/db/#structure.fragment.db.FragmentObservation">FragmentObservation</a></span><span class="p">]]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>{1: {-2: {FragObservation(), ...}, 
        -1: {}, ...},
    2: {}, ...}
Where the outer list indices match Residue.index, and each dictionary holds the various fragment indices
    (with fragment_length length) for that residue, where each index in the inner set can have multiple
    observations</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.StructuredGeneEntity.uniprot_ids" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">uniprot_ids</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">uniprot_ids</span><span class="p">:</span> <span class="n">tuple</span><span class="p">[</span><span class="n">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The UniProtID(s) used for accessing external protein level features</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.StructuredGeneEntity.reference_sequence" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">reference_sequence</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">reference_sequence</span><span class="p">:</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the entire sequence, constituting all described residues, not just structurally modeled ones</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>str</code>
        
        <div class="doc-md-description">
          <p>The sequence according to the Entity reference, or the Structure sequence if no reference available</p>
      </div>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.StructuredGeneEntity.offset_index" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">offset_index</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">offset_index</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The starting Residue index for the instance. Zero-indexed</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.StructuredGeneEntity.disorder" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">disorder</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">disorder</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">str</span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the Residue number keys where disordered residues are found by comparison of the reference sequence
with the structure sequence</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[int, dict[str, str]]</code>
        
        <div class="doc-md-description">
          <p>Mutation index to mutations in the format of {1: {'from': 'A', 'to': 'K'}, ...}</p>
      </div>
      </li>
  </ul>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.StructuredGeneEntity.clear_api_data" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">clear_api_data</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">clear_api_data</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Removes any state information from the PDB API</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear_api_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes any state information from the PDB API&quot;&quot;&quot;</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference_sequence</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_ids</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thermophilicity</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.StructuredGeneEntity.retrieve_api_metadata" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">retrieve_api_metadata</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">retrieve_api_metadata</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Try to set attributes from PDB API</p>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self._api_data: dict[str, Any]
    {'chains': [],
     'dbref': {'accession': ('Q96DC8',), 'db': 'UniProt'},
     'reference_sequence': 'MSLEHHHHHH...',
     'thermophilicity': True
self._uniprot_id: str | None
self._reference_sequence: str
self.thermophilicity: bool</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">retrieve_api_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Try to set attributes from PDB API</span>

<span class="sd">    Sets:</span>
<span class="sd">        self._api_data: dict[str, Any]</span>
<span class="sd">            {&#39;chains&#39;: [],</span>
<span class="sd">             &#39;dbref&#39;: {&#39;accession&#39;: (&#39;Q96DC8&#39;,), &#39;db&#39;: &#39;UniProt&#39;},</span>
<span class="sd">             &#39;reference_sequence&#39;: &#39;MSLEHHHHHH...&#39;,</span>
<span class="sd">             &#39;thermophilicity&#39;: True</span>
<span class="sd">        self._uniprot_id: str | None</span>
<span class="sd">        self._reference_sequence: str</span>
<span class="sd">        self.thermophilicity: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entity_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_id</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">retrieve_api_info</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="n">wrapapi</span><span class="o">.</span><span class="n">api_database_factory</span><span class="p">()</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">retrieve_data</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">retrieve_api_info</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">query_pdb_by</span>
    <span class="n">api_return</span> <span class="o">=</span> <span class="n">retrieve_api_info</span><span class="p">(</span><span class="n">entity_id</span><span class="o">=</span><span class="n">entity_id</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the data on it&#39;s own since retrieve_api_info returns</span>
<span class="sd">    {&#39;EntityID&#39;:</span>
<span class="sd">       {&#39;chains&#39;: [&#39;A&#39;, &#39;B&#39;, ...],</span>
<span class="sd">        &#39;dbref&#39;: {&#39;accession&#39;: (&#39;Q96DC8&#39;,), &#39;db&#39;: &#39;UniProt&#39;},</span>
<span class="sd">        &#39;reference_sequence&#39;: &#39;MSLEHHHHHH...&#39;,</span>
<span class="sd">        &#39;thermophilicity&#39;: 1.0},</span>
<span class="sd">    ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">api_return</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entity_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">api_return</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">=</span> <span class="n">entity_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_api_data</span> <span class="o">=</span> <span class="n">api_return</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># self.log.debug(&#39;Retrieving UNP ID for {self.name}\nAPI DATA for chain {chain}:\n{api_data}&#39;)</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;reference_sequence&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reference_sequence</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;thermophilicity&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thermophilicity</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;dbref&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">query</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">UKB</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_ids</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;accession&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">: No information found from PDB API&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.StructuredGeneEntity.add_fragments_to_profile" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">add_fragments_to_profile</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">add_fragments_to_profile</span><span class="p">(</span><span class="n">fragments</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n"><span title="structure.fragment.db.FragmentInfo">FragmentInfo</span></span><span class="p">],</span> <span class="n">alignment_type</span><span class="p">:</span> <span class="n"><span title="structure.fragment.db.alignment_types_literal">alignment_types_literal</span></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Distribute fragment information to self.fragment_map. Zero-indexed residue array</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>fragments</code></b>
            (<code><span title="collections.abc.Iterable">Iterable</span>[<span title="structure.fragment.db.FragmentInfo">FragmentInfo</span>]</code>)
        
        <div class="doc-md-description">
          <p>The fragment list to assign to the sequence profile with format
[{'mapped': residue_index1 (int), 'paired': residue_index2 (int), 'cluster': tuple(int, int, int),
  'match': match_score (float)}]</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>alignment_type</code></b>
            (<code><span title="structure.fragment.db.alignment_types_literal">alignment_types_literal</span></code>)
        
        <div class="doc-md-description">
          <p>Either 'mapped' or 'paired' indicating how the fragment observation was generated relative
to this GeneEntity. Are the fragments mapped to the ContainsResidues or was it paired to it?</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.fragment_map (list[list[dict[str, str | float]]]):
    [{-2: {FragObservation(), ...},
      -1: {}, ...},
     {}, ...]
    Where the outer list indices match Residue.index, and each dictionary holds the various fragment indices
    (with fragment_length length) for that residue, where each index in the inner set can have multiple
    observations</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_fragments_to_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fragments</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">FragmentInfo</span><span class="p">],</span>
                             <span class="n">alignment_type</span><span class="p">:</span> <span class="n">alignment_types_literal</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Distribute fragment information to self.fragment_map. Zero-indexed residue array</span>

<span class="sd">    Args:</span>
<span class="sd">        fragments: The fragment list to assign to the sequence profile with format</span>
<span class="sd">            [{&#39;mapped&#39;: residue_index1 (int), &#39;paired&#39;: residue_index2 (int), &#39;cluster&#39;: tuple(int, int, int),</span>
<span class="sd">              &#39;match&#39;: match_score (float)}]</span>
<span class="sd">        alignment_type: Either &#39;mapped&#39; or &#39;paired&#39; indicating how the fragment observation was generated relative</span>
<span class="sd">            to this GeneEntity. Are the fragments mapped to the ContainsResidues or was it paired to it?</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.fragment_map (list[list[dict[str, str | float]]]):</span>
<span class="sd">            [{-2: {FragObservation(), ...},</span>
<span class="sd">              -1: {}, ...},</span>
<span class="sd">             {}, ...]</span>
<span class="sd">            Where the outer list indices match Residue.index, and each dictionary holds the various fragment indices</span>
<span class="sd">            (with fragment_length length) for that residue, where each index in the inner set can have multiple</span>
<span class="sd">            observations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">alignment_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alignment_types</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Argument &#39;alignment_type&#39; must be one of &#39;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alignment_types</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; not </span><span class="si">{</span><span class="n">alignment_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">fragment_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_db</span>
    <span class="n">fragment_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_map</span>
    <span class="k">if</span> <span class="n">fragment_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Create empty fragment_map to store information about each fragment observation in the profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fragment_map</span> <span class="o">=</span> <span class="n">fragment_map</span> <span class="o">=</span> <span class="p">[</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">)]</span>

    <span class="c1"># Add frequency information to the fragment profile using parsed cluster information. Frequency information is</span>
    <span class="c1"># added in a fragment index dependent manner. If multiple fragment indices are present in a single residue, a</span>
    <span class="c1"># new observation is created for that fragment index.</span>
    <span class="k">for</span> <span class="n">fragment</span> <span class="ow">in</span> <span class="n">fragments</span><span class="p">:</span>
        <span class="c1"># Offset the specified fragment index to the overall index in the ContainsStructures</span>
        <span class="n">fragment_index</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fragment</span><span class="p">,</span> <span class="n">alignment_type</span><span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">fragment</span><span class="o">.</span><span class="n">cluster</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">fragment</span><span class="o">.</span><span class="n">match</span>
        <span class="n">residue_index</span> <span class="o">=</span> <span class="n">fragment_index</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_index</span>
        <span class="c1"># Retrieve the amino acid frequencies for this fragment cluster, for this alignment side</span>
        <span class="n">aa_freq</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fragment_db</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">cluster</span><span class="p">],</span> <span class="n">alignment_type</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">frag_idx</span><span class="p">,</span> <span class="n">frequencies</span> <span class="ow">in</span> <span class="n">aa_freq</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c1"># (lower_bound - upper_bound), [freqs]</span>
            <span class="n">_frequencies</span> <span class="o">=</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">_frag_info</span> <span class="o">=</span> <span class="n">FragmentObservation</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">alignment_type</span><span class="p">,</span> <span class="n">cluster</span><span class="o">=</span><span class="n">cluster</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span>
                                             <span class="n">weight</span><span class="o">=</span><span class="n">_frequencies</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">),</span> <span class="n">frequencies</span><span class="o">=</span><span class="n">_frequencies</span><span class="p">)</span>
            <span class="n">fragment_map</span><span class="p">[</span><span class="n">residue_index</span> <span class="o">+</span> <span class="n">frag_idx</span><span class="p">][</span><span class="n">frag_idx</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_frag_info</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.StructuredGeneEntity.simplify_fragment_profile" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">simplify_fragment_profile</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">simplify_fragment_profile</span><span class="p">(</span><span class="n">evo_fill</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Take a multi-indexed, a multi-observation fragment_profile and flatten to single frequency for each residue.</p>
<p>Weight the frequency of each observation by the fragment indexed, average observation weight, proportionally
scaled by the match score between the fragment database and the observed fragment overlap</p>
<p>From the self.fragment_map data, create a fragment profile and add to the GeneEntity</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>evo_fill</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to fill missing positions with evolutionary profile values</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>alpha</code></b>
        
        <div class="doc-md-description">
          <p>float = 0.5 - The maximum contribution of the fragment profile to use, bounded between (0, 1].
0 means no use of fragments in the .profile, while 1 means only use fragments</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.fragment_profile (Profile)
    [{'A': 0.23, 'C': 0.01, ..., stats': (1, 0.37)}, {...}, ...]
    list of profile_entry that combines all fragment information at a single residue using a weighted
    average. 'count' is number of fragment observations at each residue, and 'weight' is the total
    fragment weight over the entire residue</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">simplify_fragment_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evo_fill</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take a multi-indexed, a multi-observation fragment_profile and flatten to single frequency for each residue.</span>

<span class="sd">    Weight the frequency of each observation by the fragment indexed, average observation weight, proportionally</span>
<span class="sd">    scaled by the match score between the fragment database and the observed fragment overlap</span>

<span class="sd">    From the self.fragment_map data, create a fragment profile and add to the GeneEntity</span>

<span class="sd">    Args:</span>
<span class="sd">        evo_fill: Whether to fill missing positions with evolutionary profile values</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        alpha: float = 0.5 - The maximum contribution of the fragment profile to use, bounded between (0, 1].</span>
<span class="sd">            0 means no use of fragments in the .profile, while 1 means only use fragments</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.fragment_profile (Profile)</span>
<span class="sd">            [{&#39;A&#39;: 0.23, &#39;C&#39;: 0.01, ..., stats&#39;: (1, 0.37)}, {...}, ...]</span>
<span class="sd">            list of profile_entry that combines all fragment information at a single residue using a weighted</span>
<span class="sd">            average. &#39;count&#39; is number of fragment observations at each residue, and &#39;weight&#39; is the total</span>
<span class="sd">            fragment weight over the entire residue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># keep_extras: Whether to keep values for all positions that are missing data</span>
    <span class="n">fragment_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_db</span>
    <span class="n">fragment_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_map</span>
    <span class="k">if</span> <span class="n">fragment_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Need this for _calculate_alpha()</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Must </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">add_fragments_to_profile</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">() before &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">simplify_fragment_profile</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(). No fragments were set&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">fragment_db</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">simplify_fragment_profile</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: No &#39;.fragment_db&#39;. Can&#39;t calculate &quot;</span>
            <span class="s1">&#39;fragment contribution without one&#39;</span><span class="p">)</span>

    <span class="n">database_bkgnd_aa_freq</span> <span class="o">=</span> <span class="n">fragment_db</span><span class="o">.</span><span class="n">aa_frequencies</span>
    <span class="c1"># Fragment profile is correct size for indexing all STRUCTURAL residues</span>
    <span class="c1">#  self.reference_sequence is not used for this. Instead, self.sequence is used in place since the use</span>
    <span class="c1">#  of a disorder indicator that removes any disordered residues from input evolutionary profiles is calculated</span>
    <span class="c1">#  on the full reference sequence. This ensures that the profile is the right length of the structure and</span>
    <span class="c1">#  captures disorder specific evolutionary signals that could be important in the calculation of profiles</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
    <span class="n">no_design</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fragment_profile</span> <span class="o">=</span> <span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fragment_db</span><span class="o">.</span><span class="n">fragment_length</span><span class="p">)]</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">)]</span>
    <span class="n">indexed_observations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="n">FragmentObservation</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">residue_index</span><span class="p">,</span> <span class="n">indexed_observations</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fragment_map</span><span class="p">):</span>
        <span class="n">total_fragment_observations</span> <span class="o">=</span> <span class="n">total_fragment_weight_x_match</span> <span class="o">=</span> <span class="n">total_fragment_weight</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Sum the weight for each fragment observation</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">observations</span> <span class="ow">in</span> <span class="n">indexed_observations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">observation</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">:</span>
                <span class="n">total_fragment_observations</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">observation_weight</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">weight</span>
                <span class="n">total_fragment_weight</span> <span class="o">+=</span> <span class="n">observation_weight</span>
                <span class="n">total_fragment_weight_x_match</span> <span class="o">+=</span> <span class="n">observation_weight</span> <span class="o">*</span> <span class="n">observation</span><span class="o">.</span><span class="n">match</span>

        <span class="c1"># New style, consolidated</span>
        <span class="n">residue_frequencies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">total_fragment_observations</span><span class="p">,</span>
                               <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">total_fragment_weight</span><span class="p">,</span>
                               <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">sequence</span><span class="p">[</span><span class="n">residue_index</span><span class="p">],</span>
                               <span class="p">}</span>
        <span class="k">if</span> <span class="n">total_fragment_weight_x_match</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Combine all amino acid frequency distributions for all observations at each index</span>
            <span class="n">residue_frequencies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">aa_counts_alph3</span><span class="p">)</span>  <span class="c1"># {&#39;A&#39;: 0, &#39;R&#39;: 0, ...}</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">observations</span> <span class="ow">in</span> <span class="n">indexed_observations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">observation</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">:</span>
                    <span class="c1"># Multiply weight associated with observations by the match of the observation, then</span>
                    <span class="c1"># scale the observation weight by the total. If no weight, side chain isn&#39;t significant.</span>
                    <span class="n">scaled_frag_weight</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">weight</span> <span class="o">*</span> <span class="n">observation</span><span class="o">.</span><span class="n">match</span> <span class="o">/</span> <span class="n">total_fragment_weight_x_match</span>
                    <span class="c1"># Add all occurrences to summed frequencies list</span>
                    <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="n">observation</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">residue_frequencies</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="o">+=</span> <span class="n">frequency</span> <span class="o">*</span> <span class="n">scaled_frag_weight</span>

            <span class="n">residue_frequencies</span><span class="p">[</span><span class="s1">&#39;lod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_lod</span><span class="p">(</span><span class="n">residue_frequencies</span><span class="p">,</span> <span class="n">database_bkgnd_aa_freq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Add to list for removal from the profile</span>
            <span class="n">no_design</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">residue_index</span><span class="p">)</span>
            <span class="c1"># {&#39;A&#39;: 0, &#39;R&#39;: 0, ...}</span>
            <span class="n">residue_frequencies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lod</span><span class="o">=</span><span class="n">aa_nan_counts_alph3</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="o">**</span><span class="n">aa_nan_counts_alph3</span><span class="p">)</span>

        <span class="c1"># Add results to final fragment_profile residue position</span>
        <span class="n">fragment_profile</span><span class="p">[</span><span class="n">residue_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">residue_frequencies</span>
        <span class="c1"># Since self.evolutionary_profile is copied or removed, an empty dictionary is fine here</span>
        <span class="c1"># If this changes, maybe the == 0 condition needs an aa_counts_alph3.copy() instead of {}</span>

    <span class="k">if</span> <span class="n">evo_fill</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">evolutionary_profile</span><span class="p">:</span>
        <span class="c1"># If not an empty dictionary, add the corresponding value from evolution</span>
        <span class="c1"># For Rosetta, the packer palette is subtractive so the use of an overlapping evolution and</span>
        <span class="c1"># null fragment would result in nothing allowed during design...</span>
        <span class="n">evolutionary_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evolutionary_profile</span>
        <span class="k">for</span> <span class="n">residue_index</span> <span class="ow">in</span> <span class="n">no_design</span><span class="p">:</span>
            <span class="n">fragment_profile</span><span class="p">[</span><span class="n">residue_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">evolutionary_profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">residue_index</span> <span class="o">+</span> <span class="n">ZERO_OFFSET</span><span class="p">)</span>

    <span class="c1"># Format into fragment_profile Profile object</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span><span class="n">fragment_profile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;fragment&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_alpha</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.StructuredGeneEntity.calculate_profile" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">calculate_profile</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">calculate_profile</span><span class="p">(</span><span class="n">favor_fragments</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">boltzmann</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Combine weights for profile PSSM and fragment SSM using fragment significance value to determine overlap</p>
<p>Using self.evolutionary_profile
    (ProfileDict): HHblits - {1: {'A': 0.04, 'C': 0.12, ..., 'lod': {'A': -5, 'C': -9, ...},
                                         'type': 'W', 'info': 0.00, 'weight': 0.00}, {...}}
                   PSIBLAST - {1: {'A': 0.13, 'R': 0.12, ..., 'lod': {'A': -5, 'R': 2, ...},
                                   'type': 'W', 'info': 3.20, 'weight': 0.73}, {...}}
self.fragment_profile
    (dict[int, dict[str, float | list[float]]]):
        {48: {'A': 0.167, 'D': 0.028, 'E': 0.056, ..., 'count': 4, 'weight': 0.274}, 50: {...}, ...}
self.alpha
    (list[float]): [0., 0., 0., 0.5, 0.321, ...]</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>favor_fragments</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to favor fragment profile in the lod score of the resulting profile
Currently this routine is only used for Rosetta designs where the fragments should be favored by a
particular weighting scheme. By default, the boltzmann weighting scheme is applied</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>boltzmann</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether to weight the fragment profile by a Boltzmann probability scaling using the formula
lods = exp(lods[i]/kT)/Z, where Z = sum(exp(lods[i]/kT)), and kT is 1 by default.
If False, residues are weighted by the residue local maximum lod score in a linear fashion
All lods are scaled to a maximum provided in the Rosetta REF2015 per residue reference weight.</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.profile: (ProfileDict)
    {1: {'A': 0.04, 'C': 0.12, ..., 'lod': {'A': -5, 'C': -9, ...},
         'type': 'W', 'info': 0.00, 'weight': 0.00}, ...}, ...}</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">favor_fragments</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">boltzmann</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine weights for profile PSSM and fragment SSM using fragment significance value to determine overlap</span>

<span class="sd">    Using self.evolutionary_profile</span>
<span class="sd">        (ProfileDict): HHblits - {1: {&#39;A&#39;: 0.04, &#39;C&#39;: 0.12, ..., &#39;lod&#39;: {&#39;A&#39;: -5, &#39;C&#39;: -9, ...},</span>
<span class="sd">                                             &#39;type&#39;: &#39;W&#39;, &#39;info&#39;: 0.00, &#39;weight&#39;: 0.00}, {...}}</span>
<span class="sd">                       PSIBLAST - {1: {&#39;A&#39;: 0.13, &#39;R&#39;: 0.12, ..., &#39;lod&#39;: {&#39;A&#39;: -5, &#39;R&#39;: 2, ...},</span>
<span class="sd">                                       &#39;type&#39;: &#39;W&#39;, &#39;info&#39;: 3.20, &#39;weight&#39;: 0.73}, {...}}</span>
<span class="sd">    self.fragment_profile</span>
<span class="sd">        (dict[int, dict[str, float | list[float]]]):</span>
<span class="sd">            {48: {&#39;A&#39;: 0.167, &#39;D&#39;: 0.028, &#39;E&#39;: 0.056, ..., &#39;count&#39;: 4, &#39;weight&#39;: 0.274}, 50: {...}, ...}</span>
<span class="sd">    self.alpha</span>
<span class="sd">        (list[float]): [0., 0., 0., 0.5, 0.321, ...]</span>

<span class="sd">    Args:</span>
<span class="sd">        favor_fragments: Whether to favor fragment profile in the lod score of the resulting profile</span>
<span class="sd">            Currently this routine is only used for Rosetta designs where the fragments should be favored by a</span>
<span class="sd">            particular weighting scheme. By default, the boltzmann weighting scheme is applied</span>
<span class="sd">        boltzmann: Whether to weight the fragment profile by a Boltzmann probability scaling using the formula</span>
<span class="sd">            lods = exp(lods[i]/kT)/Z, where Z = sum(exp(lods[i]/kT)), and kT is 1 by default.</span>
<span class="sd">            If False, residues are weighted by the residue local maximum lod score in a linear fashion</span>
<span class="sd">            All lods are scaled to a maximum provided in the Rosetta REF2015 per residue reference weight.</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.profile: (ProfileDict)</span>
<span class="sd">            {1: {&#39;A&#39;: 0.04, &#39;C&#39;: 0.12, ..., &#39;lod&#39;: {&#39;A&#39;: -5, &#39;C&#39;: -9, ...},</span>
<span class="sd">                 &#39;type&#39;: &#39;W&#39;, &#39;info&#39;: 0.00, &#39;weight&#39;: 0.00}, ...}, ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Round up to avoid division error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_profile</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">: _alpha set with 1e-5 tolerance due to 0 value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="mf">0.000001</span>

    <span class="c1"># Copy the evolutionary profile to self.profile (structure specific scoring matrix)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evolutionary_profile</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># No fragments to combine</span>
        <span class="k">return</span>

    <span class="c1"># Combine fragment and evolutionary probability profile according to alpha parameter</span>
    <span class="n">fragment_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_profile</span>
    <span class="c1"># log_string = []</span>
    <span class="k">for</span> <span class="n">entry_idx</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">):</span>
        <span class="c1"># Weight will be 0 if the fragment_profile is empty</span>
        <span class="k">if</span> <span class="n">weight</span><span class="p">:</span>
            <span class="c1"># log_string.append(f&#39;Residue {entry + 1:5d}: {weight * 100:.0f}% fragment weight&#39;)</span>
            <span class="n">frag_profile_entry</span> <span class="o">=</span> <span class="n">fragment_profile</span><span class="p">[</span><span class="n">entry_idx</span><span class="p">]</span>
            <span class="n">inverse_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">weight</span>
            <span class="n">_profile_entry</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="n">entry_idx</span> <span class="o">+</span> <span class="n">ZERO_OFFSET</span><span class="p">]</span>
            <span class="n">_profile_entry</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">aa</span><span class="p">:</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">frag_profile_entry</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="o">+</span> <span class="n">inverse_weight</span> <span class="o">*</span> <span class="n">_profile_entry</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
                                   <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">protein_letters_alph3</span><span class="p">})</span>
    <span class="c1"># if log_string:</span>
    <span class="c1">#     # self.log.info(f&#39;At {self.name}, combined evolutionary and fragment profiles into Design Profile with:&#39;</span>
    <span class="c1">#     #               f&#39;\n\t%s&#39; % &#39;\n\t&#39;.join(log_string))</span>
    <span class="c1">#     pass</span>

    <span class="k">if</span> <span class="n">favor_fragments</span><span class="p">:</span>
        <span class="n">fragment_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_db</span>
        <span class="n">boltzman_energy</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">favor_seqprofile_score_modifier</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">utils</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">reference_average_residue_weight</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fragment_db</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_profile</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: No fragment database connected. Can&#39;t &#39;favor_fragments&#39; &quot;</span>
                <span class="s1">&#39;without one&#39;</span><span class="p">)</span>
        <span class="n">database_bkgnd_aa_freq</span> <span class="o">=</span> <span class="n">fragment_db</span><span class="o">.</span><span class="n">aa_frequencies</span>

        <span class="n">null_residue</span> <span class="o">=</span> <span class="n">get_lod</span><span class="p">(</span><span class="n">database_bkgnd_aa_freq</span><span class="p">,</span> <span class="n">database_bkgnd_aa_freq</span><span class="p">,</span> <span class="n">as_int</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># This was needed in the case of domain errors with lod</span>
        <span class="c1"># null_residue = {aa: float(frequency) for aa, frequency in null_residue.items()}</span>

        <span class="c1"># Set all profile entries to a null entry first</span>
        <span class="k">for</span> <span class="n">entry</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">null_residue</span>  <span class="c1"># Caution, all reference same object</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
        <span class="k">for</span> <span class="n">entry</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_lod</span><span class="p">(</span><span class="n">fragment_profile</span><span class="p">[</span><span class="n">entry</span> <span class="o">-</span> <span class="n">ZERO_OFFSET</span><span class="p">],</span> <span class="n">database_bkgnd_aa_freq</span><span class="p">,</span> <span class="n">as_int</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Adjust scores with particular weighting scheme</span>
            <span class="n">partition</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lod&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">boltzmann</span><span class="p">:</span>  <span class="c1"># Boltzmann scaling, sum for the partition function</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="n">boltzman_energy</span><span class="p">)</span>
                    <span class="n">partition</span> <span class="o">+=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># if value &lt; 0:</span>
                    <span class="c1"># With linear scaling, remove any lod penalty</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lod&#39;</span><span class="p">][</span><span class="n">aa</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Find the maximum/residue (local) lod score</span>
            <span class="n">max_lod</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lod&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="c1"># Takes the percent of max alpha for each entry multiplied by the standard residue scaling factor</span>
            <span class="n">modified_entry_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">entry</span> <span class="o">-</span> <span class="n">ZERO_OFFSET</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">favor_seqprofile_score_modifier</span>
            <span class="k">if</span> <span class="n">boltzmann</span><span class="p">:</span>
                <span class="c1"># lods = e ** odds[i]/Z, Z = sum(exp(odds[i]/kT))</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="n">partition</span>
                <span class="n">modified_entry_alpha</span> <span class="o">/=</span> <span class="p">(</span><span class="n">max_lod</span> <span class="o">/</span> <span class="n">partition</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="n">max_lod</span>

            <span class="c1"># Weight the final lod score by the modifier and the scaling factor for the chosen method</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">aa</span><span class="p">:</span> <span class="n">value</span> <span class="o">/</span> <span class="n">modifier</span> <span class="o">*</span> <span class="n">modified_entry_alpha</span> <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lod&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.StructuredGeneEntity.format_missing_loops_for_design" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">format_missing_loops_for_design</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">format_missing_loops_for_design</span><span class="p">(</span><span class="n">max_loop_length</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">exclude_n_term</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ignore_termini</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tuple</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">tuple</span><span class="p">],</span> <span class="n">dict</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">int</span><span class="p">],</span> <span class="n">int</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Process missing residue information to prepare for loop modeling files. Assumes residues in pose numbering!</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>max_loop_length</code></b>
            (<code>int</code>, default:
                <code>12</code>
)
        
        <div class="doc-md-description">
          <p>The max length for loop modeling.
12 is the max for accurate KIC as of benchmarks from T. Kortemme, 2014</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>exclude_n_term</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether to exclude the N-termini from modeling due to Remodel Bug</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>ignore_termini</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to ignore terminal loops in the loop file</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>tuple[list[tuple], dict[int, int], int]</code>
        
        <div class="doc-md-description">
          <p>Pairs of indices where each loop starts and ends, adjacent indices (not all indices are disordered) mapped
to their disordered residue indices, and the n-terminal residue index</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_missing_loops_for_design</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">max_loop_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">exclude_n_term</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ignore_termini</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process missing residue information to prepare for loop modeling files. Assumes residues in pose numbering!</span>

<span class="sd">    Args:</span>
<span class="sd">        max_loop_length: The max length for loop modeling.</span>
<span class="sd">            12 is the max for accurate KIC as of benchmarks from T. Kortemme, 2014</span>
<span class="sd">        exclude_n_term: Whether to exclude the N-termini from modeling due to Remodel Bug</span>
<span class="sd">        ignore_termini: Whether to ignore terminal loops in the loop file</span>

<span class="sd">    Returns:</span>
<span class="sd">        Pairs of indices where each loop starts and ends, adjacent indices (not all indices are disordered) mapped</span>
<span class="sd">            to their disordered residue indices, and the n-terminal residue index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">disordered_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disorder</span>
    <span class="c1"># Formatted as {residue_number: {&#39;from&#39;: aa, &#39;to&#39;: aa}, ...}</span>
    <span class="n">reference_sequence_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_sequence</span><span class="p">)</span>
    <span class="n">loop_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">loop_to_disorder_indices</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Holds the indices that should be inserted into the total residues to be modeled</span>
    <span class="n">n_terminal_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Initialize as an impossible value</span>
    <span class="n">excluded_disorder_len</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Total residues excluded from loop modeling. Needed for pose numbering translation</span>
    <span class="n">segment_length</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Iterate each missing residue</span>
    <span class="n">n_term</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">loop_start</span> <span class="o">=</span> <span class="n">loop_end</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">residue_number</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disordered_residues</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">segment_length</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">residue_number</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disordered_residues</span><span class="p">:</span>  <span class="c1"># indicate that this residue_number starts disorder</span>
            <span class="c1"># print(&#39;Residue number -1 not in loops&#39;, residue_number)</span>
            <span class="n">loop_start</span> <span class="o">=</span> <span class="n">residue_number</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">excluded_disorder_len</span>  <span class="c1"># - 1 as loop modeling needs existing residue</span>
            <span class="k">if</span> <span class="n">loop_start</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">n_term</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">residue_number</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disordered_residues</span><span class="p">:</span>
            <span class="c1"># The segment has ended</span>
            <span class="k">if</span> <span class="n">residue_number</span> <span class="o">!=</span> <span class="n">reference_sequence_length</span><span class="p">:</span>
                <span class="c1"># Not the c-terminus</span>
                <span class="c1"># logger.debug(&#39;f{residue_number=} +1 not in loops. Adding loop with {segment_length=}&#39;)</span>
                <span class="k">if</span> <span class="n">segment_length</span> <span class="o">&lt;=</span> <span class="n">max_loop_length</span><span class="p">:</span>
                    <span class="c1"># Modeling useful, add to loop_indices</span>
                    <span class="k">if</span> <span class="n">n_term</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ignore_termini</span> <span class="ow">or</span> <span class="n">exclude_n_term</span><span class="p">):</span>
                        <span class="c1"># The n-terminus should be included</span>
                        <span class="n">excluded_disorder_len</span> <span class="o">+=</span> <span class="n">segment_length</span>
                        <span class="n">n_term</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># No more n_term considerations</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Include the segment in the disorder_indices</span>
                        <span class="n">loop_end</span> <span class="o">=</span> <span class="n">residue_number</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">excluded_disorder_len</span>
                        <span class="n">loop_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_end</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="n">residue_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">loop_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loop_end</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">loop_to_disorder_indices</span><span class="p">[</span><span class="n">residue_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">residue_number</span> <span class="o">-</span> <span class="p">(</span><span class="n">segment_length</span> <span class="o">-</span> <span class="n">it</span><span class="p">)</span>
                        <span class="c1"># Set the start and end indices as out of bounds numbers</span>
                        <span class="n">loop_to_disorder_indices</span><span class="p">[</span><span class="n">loop_start</span><span class="p">],</span> <span class="n">loop_to_disorder_indices</span><span class="p">[</span><span class="n">loop_end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="k">if</span> <span class="n">n_term</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># If this is the n-termini and not start Met</span>
                            <span class="n">n_terminal_idx</span> <span class="o">=</span> <span class="n">loop_end</span>  <span class="c1"># Save idx of last n-term insertion</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Modeling not useful, sum the exclusion length</span>
                    <span class="n">excluded_disorder_len</span> <span class="o">+=</span> <span class="n">segment_length</span>

                <span class="c1"># After handling disordered segment, reset increment and loop indices</span>
                <span class="n">segment_length</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">loop_start</span> <span class="o">=</span> <span class="n">loop_end</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Residue number is the c-terminal residue</span>
            <span class="k">elif</span> <span class="n">ignore_termini</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">segment_length</span> <span class="o">&lt;=</span> <span class="n">max_loop_length</span><span class="p">:</span>
                    <span class="c1"># loop_end = loop_start + 1 + segment_length  # - excluded_disorder</span>
                    <span class="n">loop_end</span> <span class="o">=</span> <span class="n">residue_number</span> <span class="o">-</span> <span class="n">excluded_disorder_len</span>
                    <span class="n">loop_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_end</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="n">residue_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">loop_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loop_end</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">loop_to_disorder_indices</span><span class="p">[</span><span class="n">residue_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">residue_number</span> <span class="o">-</span> <span class="p">(</span><span class="n">segment_length</span> <span class="o">-</span> <span class="n">it</span><span class="p">)</span>
                    <span class="c1"># Don&#39;t include start index in the loop_to_disorder map since c-terminal doesn&#39;t have attachment</span>
                    <span class="n">loop_to_disorder_indices</span><span class="p">[</span><span class="n">loop_end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">loop_indices</span><span class="p">,</span> <span class="n">loop_to_disorder_indices</span><span class="p">,</span> <span class="n">n_terminal_idx</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.StructuredGeneEntity.make_loop_file" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">make_loop_file</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">make_loop_file</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Format a loops file according to Rosetta specifications. Assumes residues in pose numbering!</p>
<p>The loop file format consists of one line for each specified loop with the format:</p>
<p>LOOP 779 784 0 0 1</p>
<p>Where LOOP specifies a loop line, start idx, end idx, cut site (0 lets Rosetta choose), skip rate, and extended</p>
<p>All indices should refer to existing locations in the structure file so if a loop should be inserted into
missing density, the density needs to be modeled first before the loop file would work to be modeled. You
can't therefore specify that a loop should be between 779 and 780 if the loop is 12 residues long since there is
 no specification about how to insert those residues. This type of task requires a blueprint file.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>out_path</code></b>
            (<code><span title="typing.AnyStr">AnyStr</span></code>, default:
                <code><span title="os.getcwd">getcwd</span>()</code>
)
        
        <div class="doc-md-description">
          <p>The location the file should be written</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>max_loop_length=12</code></b>
            (<code>int</code>)
        
        <div class="doc-md-description">
          <p>The max length for loop modeling.
12 is the max for accurate KIC as of benchmarks from T. Kortemme, 2014</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>exclude_n_term=True</code></b>
            (<code>bool</code>)
        
        <div class="doc-md-description">
          <p>Whether to exclude the N-termini from modeling due to Remodel Bug</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>ignore_termini=False</code></b>
            (<code>bool</code>)
        
        <div class="doc-md-description">
          <p>Whether to ignore terminal loops in the loop file</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.AnyStr">AnyStr</span> | None</code>
        
        <div class="doc-md-description">
          <p>The path of the file if one was written</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_loop_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">AnyStr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format a loops file according to Rosetta specifications. Assumes residues in pose numbering!</span>

<span class="sd">    The loop file format consists of one line for each specified loop with the format:</span>

<span class="sd">    LOOP 779 784 0 0 1</span>

<span class="sd">    Where LOOP specifies a loop line, start idx, end idx, cut site (0 lets Rosetta choose), skip rate, and extended</span>

<span class="sd">    All indices should refer to existing locations in the structure file so if a loop should be inserted into</span>
<span class="sd">    missing density, the density needs to be modeled first before the loop file would work to be modeled. You</span>
<span class="sd">    can&#39;t therefore specify that a loop should be between 779 and 780 if the loop is 12 residues long since there is</span>
<span class="sd">     no specification about how to insert those residues. This type of task requires a blueprint file.</span>

<span class="sd">    Args:</span>
<span class="sd">        out_path: The location the file should be written</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        max_loop_length=12 (int): The max length for loop modeling.</span>
<span class="sd">            12 is the max for accurate KIC as of benchmarks from T. Kortemme, 2014</span>
<span class="sd">        exclude_n_term=True (bool): Whether to exclude the N-termini from modeling due to Remodel Bug</span>
<span class="sd">        ignore_termini=False (bool): Whether to ignore terminal loops in the loop file</span>

<span class="sd">    Returns:</span>
<span class="sd">        The path of the file if one was written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loop_indices</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_missing_loops_for_design</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">loop_indices</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">loop_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.loops&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">loop_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LOOP </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">stop</span><span class="si">}</span><span class="s1"> 0 0 1&#39;</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">loop_indices</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">loop_file</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.StructuredGeneEntity.make_blueprint_file" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">make_blueprint_file</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">make_blueprint_file</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Format a blueprint file according to Rosetta specifications. Assumes residues in pose numbering!</p>

<details class="the-blueprint-file-format-is-described-nicely-here" open>
  <summary>The blueprint file format is described nicely here</summary>
  <p>https://www.rosettacommons.org/docs/latest/application_documentation/design/rosettaremodel</p>
</details>      <p>In a gist, a blueprint file consists of entries describing the type of design available at each position.</p>

<details class="ex" open>
  <summary>Ex</summary>
  <p>1 x L PIKAA M   &lt;- Extension</p>
<p>1 x L PIKAA V   &lt;- Extension</p>
<p>1 V L PIKAA V   &lt;- Attachment point</p>
<p>2 D .</p>
<p>3 K .</p>
<p>4 I .</p>
<p>5 L N PIKAA N   &lt;- Attachment point</p>
<p>0 x I NATAA     &lt;- Insertion</p>
<p>0 x I NATAA     &lt;- Insertion</p>
<p>6 N A PIKAA A   &lt;- Attachment point</p>
<p>7 G .</p>
<p>0 X L PIKAA Y   &lt;- Extension</p>
<p>0 X L PIKAA P   &lt;- Extension</p>
</details>      <p>All structural indices must be specified in "pose numbering", i.e. starting with 1 ending with the last residue.
If you have missing density in the middle, you should not specify those residues that are missing, but keep
continuous numbering. You can specify an inclusion by specifying the entry index as 0 followed by the blueprint
directive. For missing density at the n- or c-termini, the file should still start 1, however, the n-termini
should be extended by prepending extra entries to the structurally defined n-termini entry 1. These blueprint
entries should also have 1 as the residue index. For c-termini, extra entries should be appended with the
indices as 0 like in insertions. For all unmodeled entries for which design should be performed, there should
be flanking attachment points that are also capable of design. Designable entries are seen above with the PIKAA
directive. Other directives are available. The only location this isn't required is at the c-terminal attachment
point</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>out_path</code></b>
            (<code><span title="typing.AnyStr">AnyStr</span></code>, default:
                <code><span title="os.getcwd">getcwd</span>()</code>
)
        
        <div class="doc-md-description">
          <p>The location the file should be written</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>max_loop_length=12</code></b>
            (<code>int</code>)
        
        <div class="doc-md-description">
          <p>The max length for loop modeling.
12 is the max for accurate KIC as of benchmarks from T. Kortemme, 2014</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>exclude_n_term=True</code></b>
            (<code>bool</code>)
        
        <div class="doc-md-description">
          <p>Whether to exclude the N-termini from modeling due to Remodel Bug</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>ignore_termini=False</code></b>
            (<code>bool</code>)
        
        <div class="doc-md-description">
          <p>Whether to ignore terminal loops in the loop file</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.AnyStr">AnyStr</span> | None</code>
        
        <div class="doc-md-description">
          <p>The path of the file if one was written</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_blueprint_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">AnyStr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format a blueprint file according to Rosetta specifications. Assumes residues in pose numbering!</span>

<span class="sd">    The blueprint file format is described nicely here:</span>
<span class="sd">        https://www.rosettacommons.org/docs/latest/application_documentation/design/rosettaremodel</span>

<span class="sd">    In a gist, a blueprint file consists of entries describing the type of design available at each position.</span>

<span class="sd">    Ex:</span>
<span class="sd">        1 x L PIKAA M   &lt;- Extension</span>

<span class="sd">        1 x L PIKAA V   &lt;- Extension</span>

<span class="sd">        1 V L PIKAA V   &lt;- Attachment point</span>

<span class="sd">        2 D .</span>

<span class="sd">        3 K .</span>

<span class="sd">        4 I .</span>

<span class="sd">        5 L N PIKAA N   &lt;- Attachment point</span>

<span class="sd">        0 x I NATAA     &lt;- Insertion</span>

<span class="sd">        0 x I NATAA     &lt;- Insertion</span>

<span class="sd">        6 N A PIKAA A   &lt;- Attachment point</span>

<span class="sd">        7 G .</span>

<span class="sd">        0 X L PIKAA Y   &lt;- Extension</span>

<span class="sd">        0 X L PIKAA P   &lt;- Extension</span>

<span class="sd">    All structural indices must be specified in &quot;pose numbering&quot;, i.e. starting with 1 ending with the last residue.</span>
<span class="sd">    If you have missing density in the middle, you should not specify those residues that are missing, but keep</span>
<span class="sd">    continuous numbering. You can specify an inclusion by specifying the entry index as 0 followed by the blueprint</span>
<span class="sd">    directive. For missing density at the n- or c-termini, the file should still start 1, however, the n-termini</span>
<span class="sd">    should be extended by prepending extra entries to the structurally defined n-termini entry 1. These blueprint</span>
<span class="sd">    entries should also have 1 as the residue index. For c-termini, extra entries should be appended with the</span>
<span class="sd">    indices as 0 like in insertions. For all unmodeled entries for which design should be performed, there should</span>
<span class="sd">    be flanking attachment points that are also capable of design. Designable entries are seen above with the PIKAA</span>
<span class="sd">    directive. Other directives are available. The only location this isn&#39;t required is at the c-terminal attachment</span>
<span class="sd">    point</span>

<span class="sd">    Args:</span>
<span class="sd">        out_path: The location the file should be written</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        max_loop_length=12 (int): The max length for loop modeling.</span>
<span class="sd">            12 is the max for accurate KIC as of benchmarks from T. Kortemme, 2014</span>
<span class="sd">        exclude_n_term=True (bool): Whether to exclude the N-termini from modeling due to Remodel Bug</span>
<span class="sd">        ignore_termini=False (bool): Whether to ignore terminal loops in the loop file</span>

<span class="sd">    Returns:</span>
<span class="sd">        The path of the file if one was written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">disordered_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disorder</span>
    <span class="c1"># Formatted as {residue_number: {&#39;from&#39;: aa, &#39;to&#39;: aa}, ...}</span>
    <span class="c1"># trying to remove tags at this stage runs into a serious indexing problem where tags need to be deleted from</span>
    <span class="c1"># disordered_residues and then all subsequent indices adjusted.</span>

    <span class="c1"># # look for existing tag to remove from sequence and save identity</span>
    <span class="c1"># available_tags = find_expression_tags(self.reference_sequence)</span>
    <span class="c1"># if available_tags:</span>
    <span class="c1">#     loop_sequences = &#39;&#39;.join(mutation[&#39;from&#39;] for mutation in disordered_residues)</span>
    <span class="c1">#     remove_loop_pairs = []</span>
    <span class="c1">#     for tag in available_tags:</span>
    <span class="c1">#         tag_location = loop_sequences.find(tag[&#39;sequences&#39;])</span>
    <span class="c1">#         if tag_location != -1:</span>
    <span class="c1">#             remove_loop_pairs.append((tag_location, len(tag[&#39;sequences&#39;])))</span>
    <span class="c1">#     for tag_start, tag_length in remove_loop_pairs:</span>
    <span class="c1">#         for</span>
    <span class="c1">#</span>
    <span class="c1">#     # untagged_seq = remove_terminal_tags(loop_sequences, [tag[&#39;sequence&#39;] for tag in available_tags])</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">disorder_indices</span><span class="p">,</span> <span class="n">start_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_missing_loops_for_design</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">disorder_indices</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span>
    <span class="c1"># for residue_number in sorted(disorder_indices):  # ensure ascending order, insert dependent on prior inserts</span>
    <span class="k">for</span> <span class="n">residue_index</span><span class="p">,</span> <span class="n">disordered_residue</span> <span class="ow">in</span> <span class="n">disorder_indices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mutation</span> <span class="o">=</span> <span class="n">disordered_residues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">disordered_residue</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mutation</span><span class="p">:</span>  <span class="c1"># add disordered residue to residues list if they exist</span>
            <span class="n">residues</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">residue_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mutation</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">])</span>  <span class="c1"># offset to match residues zero-index</span>

    <span class="c1">#                 index AA SS Choice AA</span>
    <span class="c1"># structure_str   = &#39;%d %s %s&#39;</span>
    <span class="c1"># loop_str        = &#39;%d X %s PIKAA %s&#39;</span>
    <span class="n">blueprint_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">residue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">residues</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">Residue</span><span class="p">):</span>  <span class="c1"># use structure_str template</span>
            <span class="n">residue_type</span> <span class="o">=</span> <span class="n">protein_letters_3to1_extended</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">residue</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">blueprint_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">residue_type</span><span class="si">}</span><span class="s1"> &#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;L PIKAA </span><span class="si">{</span><span class="n">residue_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">disorder_indices</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># residue is the residue type from above insertion, use loop_str template</span>
            <span class="n">blueprint_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">start_idx</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="si">}</span><span class="s1"> X </span><span class="si">{</span><span class="s2">&quot;L&quot;</span><span class="si">}</span><span class="s1"> PIKAA </span><span class="si">{</span><span class="n">residue</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">blueprint_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.blueprint&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">blueprint_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">blueprint_lines</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">blueprint_file</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.Structure" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Structure</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">Structure</span><span class="p">(</span><span class="n">metadata</span><span class="p">:</span> <span class="n"><span title="symdesign.resources.sql.ProteinMetadata">ProteinMetadata</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uniprot_ids</span><span class="p">:</span> <span class="n">tuple</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thermophilicity</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reference_sequence</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.StructuredGeneEntity" href="#structure.model.StructuredGeneEntity">StructuredGeneEntity</a></code>, <code><a class="autorefs autorefs-internal" title="structure.model.ParseStructureMixin" href="#structure.model.ParseStructureMixin">ParseStructureMixin</a></code></p>

  
      <p>The base class to handle structural manipulation of groups of Residue instances</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>metadata</code></b>
            (<code><span title="symdesign.resources.sql.ProteinMetadata">ProteinMetadata</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Unique database references</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>uniprot_ids</code></b>
            (<code>tuple[str, ...]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The UniProtID(s) that describe this protein sequence</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>thermophilicity</code></b>
            (<code>bool</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The extent to which the sequence is deemed thermophilic</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>reference_sequence</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The reference sequence (according to expression sequence or reference database)</p>
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">sql</span><span class="o">.</span><span class="n">ProteinMetadata</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uniprot_ids</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">thermophilicity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reference_sequence</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        metadata: Unique database references</span>
<span class="sd">        uniprot_ids: The UniProtID(s) that describe this protein sequence</span>
<span class="sd">        thermophilicity: The extent to which the sequence is deemed thermophilic</span>
<span class="sd">        reference_sequence: The reference sequence (according to expression sequence or reference database)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># StructuredGeneEntity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">default_fragment_contribution</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_map</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_profile</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># fragment specific scoring matrix</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_api_data</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># {chain: {&#39;accession&#39;: &#39;Q96DC8&#39;, &#39;db&#39;: &#39;UniProt&#39;}, ...}</span>

    <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">reference_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference_sequence</span> <span class="o">=</span> <span class="n">reference_sequence</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thermophilicity</span> <span class="o">=</span> <span class="n">thermophilicity</span>
        <span class="k">if</span> <span class="n">uniprot_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_ids</span> <span class="o">=</span> <span class="n">uniprot_ids</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">reference_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference_sequence</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">reference_sequence</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thermophilicity</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">thermophilicity</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">uniprot_entities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_ids</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">uniprot_ids</span>
</code></pre></div></td></tr></table></div>
                </details>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.ContainsStructures" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">ContainsStructures</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ContainsStructures</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.Structure" href="#structure.model.Structure">Structure</a></code></p>

  
      <p>Implements methods to interact with a Structure which contains other Structure instances</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>**kwargs</code></b>
        
        <div class="doc-md-description">
          
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># ContainsStructures</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsStructures.biological_assembly" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">biological_assembly</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">biological_assembly</span><span class="p">:</span> <span class="n">str</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The integer which maps the structure to an assembly state from the PDB</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsStructures.file_path" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">file_path</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">file_path</span><span class="p">:</span> <span class="n">str</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The integer which maps the structure to an assembly state from the PDB</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsStructures.resolution" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">resolution</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">resolution</span><span class="p">:</span> <span class="n">float</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The integer which maps the structure to an assembly state from the PDB</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsStructures.reset_and_reindex_structures" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">reset_and_reindex_structures</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">reset_and_reindex_structures</span><span class="p">(</span><span class="n">structs</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.ContainsResidues" href="../base/#structure.base.ContainsResidues">ContainsResidues</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.base.Structures" href="../base/#structure.base.Structures">Structures</a></span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Given ContainsResidues instances, reset the states and renumber indices in the order passed</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">reset_and_reindex_structures</span><span class="p">(</span><span class="n">structs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ContainsResidues</span><span class="p">]</span> <span class="o">|</span> <span class="n">Structures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given ContainsResidues instances, reset the states and renumber indices in the order passed&quot;&quot;&quot;</span>
    <span class="n">struct</span><span class="p">:</span> <span class="n">ContainsResidues</span>
    <span class="n">other_structs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ContainsResidues</span><span class="p">]</span>

    <span class="n">struct</span><span class="p">,</span> <span class="o">*</span><span class="n">other_structs</span> <span class="o">=</span> <span class="n">structs</span>
    <span class="n">struct</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>
    <span class="n">struct</span><span class="o">.</span><span class="n">_start_indices</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
    <span class="n">struct</span><span class="o">.</span><span class="n">_start_indices</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
    <span class="n">prior_struct</span> <span class="o">=</span> <span class="n">struct</span>
    <span class="k">for</span> <span class="n">struct</span> <span class="ow">in</span> <span class="n">other_structs</span><span class="p">:</span>
        <span class="n">struct</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>
        <span class="n">struct</span><span class="o">.</span><span class="n">_start_indices</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">prior_struct</span><span class="o">.</span><span class="n">end_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
        <span class="n">struct</span><span class="o">.</span><span class="n">_start_indices</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">prior_struct</span><span class="o">.</span><span class="n">residue_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
        <span class="n">prior_struct</span> <span class="o">=</span> <span class="n">struct</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsStructures.fragment_db" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">fragment_db</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">fragment_db</span><span class="p">(</span><span class="n">fragment_db</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.fragment.db.FragmentDatabase" href="../fragment/db/#structure.fragment.db.FragmentDatabase">FragmentDatabase</a></span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Set the Structure FragmentDatabase to assist with Fragment creation, manipulation, and profiles.
Sets .fragment_db for each dependent Structure in 'structure_containers'</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@ContainsResidues</span><span class="o">.</span><span class="n">fragment_db</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">fragment_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fragment_db</span><span class="p">:</span> <span class="n">FragmentDatabase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the Structure FragmentDatabase to assist with Fragment creation, manipulation, and profiles.</span>
<span class="sd">    Sets .fragment_db for each dependent Structure in &#39;structure_containers&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set this instance then set all dependents</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">)</span><span class="o">.</span><span class="n">fragment_db</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fragment_db</span><span class="p">)</span>
    <span class="n">_fragment_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fragment_db</span>
    <span class="k">if</span> <span class="n">_fragment_db</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">structure_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">structure_type</span><span class="p">):</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">fragment_db</span> <span class="o">=</span> <span class="n">_fragment_db</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># This is likely the RELOAD_DB token. Just return.</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsStructures.format_header" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">format_header</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">format_header</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns any super().format_header() along with the SEQRES records</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>str</code>
        
        <div class="doc-md-description">
          <p>The .pdb file header string</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns any super().format_header() along with the SEQRES records</span>

<span class="sd">    Returns:</span>
<span class="sd">        The .pdb file header string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_parent</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">cryst_record</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">cryst_record</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">format_header</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_seqres</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="n">_header</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsStructures.mutate_residue" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">mutate_residue</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">mutate_residue</span><span class="p">(</span><span class="n">residue</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">list</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Mutate a specific Residue to a new residue type. Type can be 1 or 3 letter format</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>residue</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A Residue instance to mutate</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>index</code></b>
            (<code>int</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A Residue index to select the Residue instance of interest</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>number</code></b>
            (<code>int</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A Residue number to select the Residue instance of interest</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>to</code></b>
            (<code>str</code>, default:
                <code>&#39;A&#39;</code>
)
        
        <div class="doc-md-description">
          <p>The type of amino acid to mutate to</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[int] | list</code>
        
        <div class="doc-md-description">
          <p>The indices of the Atoms being removed from the Structure</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mutate_residue</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">residue</span><span class="p">:</span> <span class="n">Residue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mutate a specific Residue to a new residue type. Type can be 1 or 3 letter format</span>

<span class="sd">    Args:</span>
<span class="sd">        residue: A Residue instance to mutate</span>
<span class="sd">        index: A Residue index to select the Residue instance of interest</span>
<span class="sd">        number: A Residue number to select the Residue instance of interest</span>
<span class="sd">        to: The type of amino acid to mutate to</span>

<span class="sd">    Returns:</span>
<span class="sd">        The indices of the Atoms being removed from the Structure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">delete_indices</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mutate_residue</span><span class="p">(</span><span class="n">residue</span><span class="o">=</span><span class="n">residue</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dependent</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">delete_indices</span><span class="p">:</span>  <span class="c1"># Probably an empty list, there are no indices to delete</span>
        <span class="k">return</span> <span class="n">delete_indices</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span>

    <span class="c1"># Remove delete_indices from each Structure _atom_indices</span>
    <span class="c1"># If subsequent structures, update their _atom_indices accordingly</span>
    <span class="n">delete_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">delete_indices</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">structure_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="p">:</span>
        <span class="n">residue_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Iterate over each Structure in each structure_container</span>
        <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">structure_type</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">residue_found</span><span class="p">:</span>  <span class="c1"># The Structure the Residue belongs to is already accounted for, just offset</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">_offset_indices</span><span class="p">(</span><span class="n">start_at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="n">delete_length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">structure_atom_indices</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">atom_indices</span>
                    <span class="n">atom_delete_index</span> <span class="o">=</span> <span class="n">structure_atom_indices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">delete_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># When delete_indices[0] isn&#39;t in structure_atom_indices</span>
                    <span class="k">continue</span>  <span class="c1"># Haven&#39;t reached the correct Structure yet</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">delete_indices</span><span class="p">):</span>
                            <span class="n">structure_atom_indices</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">atom_delete_index</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>  <span class="c1"># When atom_delete_index isn&#39;t in structure_atom_indices</span>
                        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mutate_residue</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: The index </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2"> isn&#39;t in the </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="c1"># structure._offset_indices(start_at=0, offset=-delete_indices.index(idx), dtype=&#39;atom&#39;)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">structure</span><span class="o">.</span><span class="n">_offset_indices</span><span class="p">(</span><span class="n">start_at</span><span class="o">=</span><span class="n">atom_delete_index</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="n">delete_length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
                        <span class="n">residue_found</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">structure</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">delete_indices</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsStructures.delete_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">delete_residues</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">delete_residues</span><span class="p">(</span><span class="n">residues</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">numbers</span><span class="p">:</span> <span class="n"><span title="collections.abc.Container">Container</span></span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span> <span class="o">|</span> <span class="n">list</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Deletes Residue instances from the Structure</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>residues</code></b>
            (<code><span title="collections.abc.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>] | None</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Residue instances to delete</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>indices</code></b>
            (<code><span title="collections.abc.Iterable">Iterable</span>[int] | None</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Residue indices to select the Residue instances of interest</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>numbers</code></b>
            (<code><span title="collections.abc.Container">Container</span>[int] | None</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Residue numbers to select the Residue instances of interest</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>] | list</code>
        
        <div class="doc-md-description">
          <p>Each deleted Residue</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_residues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">residues</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Residue</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">numbers</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Residue</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deletes Residue instances from the Structure</span>

<span class="sd">    Args:</span>
<span class="sd">        residues: Residue instances to delete</span>
<span class="sd">        indices: Residue indices to select the Residue instances of interest</span>
<span class="sd">        numbers: Residue numbers to select the Residue instances of interest</span>

<span class="sd">    Returns:</span>
<span class="sd">        Each deleted Residue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">residues</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete_residues</span><span class="p">(</span><span class="n">residues</span><span class="o">=</span><span class="n">residues</span><span class="p">,</span> <span class="n">numbers</span><span class="o">=</span><span class="n">numbers</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dependent</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">residues</span><span class="p">:</span>  <span class="c1"># There are no Residue instances to delete</span>
        <span class="k">return</span> <span class="n">residues</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span>

    <span class="c1"># The routine below assumes the Residue instances are sorted in ascending order</span>
    <span class="n">atom_index_offset_amount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">residue_idx</span><span class="p">,</span> <span class="n">residue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">residues</span><span class="p">):</span>
        <span class="c1"># Find the Residue, Atom indices to delete</span>
        <span class="c1"># Offset these indices if prior indices have already been removed</span>
        <span class="n">atom_delete_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="n">atom_index_offset_amount</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">residue</span><span class="o">.</span><span class="n">atom_indices</span><span class="p">]</span>
        <span class="n">delete_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom_delete_indices</span><span class="p">)</span>
        <span class="n">residue_index</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="n">residue_idx</span>
        <span class="c1"># Offset the next Residue Atom indices by the incrementing amount</span>
        <span class="n">atom_index_offset_amount</span> <span class="o">+=</span> <span class="n">delete_length</span>
        <span class="k">for</span> <span class="n">structure_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="p">:</span>
            <span class="n">residue_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Iterate over each Structure in each structure_container</span>
            <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">structure_type</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">residue_found</span><span class="p">:</span>
                    <span class="c1"># The Structure the Residue belongs to is already accounted for, just offset the indices</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">_offset_indices</span><span class="p">(</span><span class="n">start_at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="n">delete_length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">_offset_indices</span><span class="p">(</span><span class="n">start_at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
                <span class="c1"># try:  # Remove atom_delete_indices, residue_indices from Structure</span>
                <span class="k">elif</span> <span class="n">residue_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">_residue_indices</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># This structure is not the one of interest</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Remove atom_delete_indices, residue_index from Structure</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">_delete_indices</span><span class="p">(</span><span class="n">atom_delete_indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">_delete_indices</span><span class="p">([</span><span class="n">residue_index</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
                    <span class="n">residue_found</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">structure</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">residues</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsStructures.insert_residue_type" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">insert_residue_type</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">insert_residue_type</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">int</span><span class="p">,</span> <span class="n">residue_type</span><span class="p">:</span> <span class="n">str</span><span class="p">,</span> <span class="n">chain_id</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Insert a standard Residue type into the Structure based on Pose numbering (1 to N) at the origin.
No structural alignment is performed.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>index</code></b>
            (<code>int</code>)
        
        <div class="doc-md-description">
          <p>The pose numbered location which a new Residue should be inserted into the Structure</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>residue_type</code></b>
            (<code>str</code>)
        
        <div class="doc-md-description">
          <p>Either the 1 or 3 letter amino acid code for the residue in question</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>chain_id</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The chain identifier to associate the new Residue with</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert_residue_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">residue_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chain_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Residue</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert a standard Residue type into the Structure based on Pose numbering (1 to N) at the origin.</span>
<span class="sd">    No structural alignment is performed.</span>

<span class="sd">    Args:</span>
<span class="sd">        index: The pose numbered location which a new Residue should be inserted into the Structure</span>
<span class="sd">        residue_type: Either the 1 or 3 letter amino acid code for the residue in question</span>
<span class="sd">        chain_id: The chain identifier to associate the new Residue with</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_residue</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">insert_residue_type</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">residue_type</span><span class="p">,</span> <span class="n">chain_id</span><span class="o">=</span><span class="n">chain_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dependent</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">new_residue</span>

    <span class="n">new_residue_atom_indices</span> <span class="o">=</span> <span class="n">new_residue</span><span class="o">.</span><span class="n">atom_indices</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span>

    <span class="c1"># Must update other Structures indices</span>
    <span class="k">for</span> <span class="n">structure_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="p">:</span>
        <span class="n">structures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">structure_type</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Iterate over Structures in each structure_container</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">structure</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># Update each Structure _residue_indices and _atom_indices with additional indices</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">_insert_indices</span><span class="p">(</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">residue_indices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">_insert_indices</span><span class="p">(</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">atom_indices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_residue</span><span class="o">.</span><span class="n">start_index</span><span class="p">),</span> <span class="n">new_residue_atom_indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="c1"># This should happen if the index isn&#39;t in the StructureBase.*_indices of interest</span>
                <span class="c1"># Edge case where the index is being appended to the c-terminus</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">structure</span><span class="o">.</span><span class="n">residue_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">new_residue</span><span class="o">.</span><span class="n">chain_id</span> <span class="o">==</span> <span class="n">structure</span><span class="o">.</span><span class="n">chain_id</span><span class="p">:</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">_insert_indices</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">,</span> <span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">_insert_indices</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">,</span> <span class="n">new_residue_atom_indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c1"># This was the Structure with insertion and insert_indices proceeded successfully</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># No matching structure found. The structure_type container should be empty...</span>
            <span class="k">continue</span>
        <span class="c1"># For each subsequent structure in the structure container, update the indices with the last index from</span>
        <span class="c1"># the prior structure</span>
        <span class="n">prior_structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">structures</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">_start_indices</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">prior_structure</span><span class="o">.</span><span class="n">atom_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">_start_indices</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">prior_structure</span><span class="o">.</span><span class="n">residue_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>
            <span class="n">prior_structure</span> <span class="o">=</span> <span class="n">structure</span>

    <span class="k">return</span> <span class="n">new_residue</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsStructures.insert_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">insert_residues</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">insert_residues</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">int</span><span class="p">,</span> <span class="n">new_residues</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">],</span> <span class="n">chain_id</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Insert Residue instances into the Structure at the origin. No structural alignment is performed!</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>index</code></b>
            (<code>int</code>)
        
        <div class="doc-md-description">
          <p>The index to perform the insertion at</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>new_residues</code></b>
            (<code><span title="collections.abc.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>]</code>)
        
        <div class="doc-md-description">
          <p>The Residue instances to insert</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>chain_id</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The chain identifier to associate the new Residue instances with</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>]</code>
        
        <div class="doc-md-description">
          <p>The newly inserted Residue instances</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert_residues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_residues</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Residue</span><span class="p">],</span> <span class="n">chain_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Residue</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert Residue instances into the Structure at the origin. No structural alignment is performed!</span>

<span class="sd">    Args:</span>
<span class="sd">        index: The index to perform the insertion at</span>
<span class="sd">        new_residues: The Residue instances to insert</span>
<span class="sd">        chain_id: The chain identifier to associate the new Residue instances with</span>

<span class="sd">    Returns:</span>
<span class="sd">        The newly inserted Residue instances</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_residues</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">insert_residues</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">new_residues</span><span class="p">,</span> <span class="n">chain_id</span><span class="o">=</span><span class="n">chain_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dependent</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">new_residues</span>

    <span class="n">number_new_residues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_residues</span><span class="p">)</span>
    <span class="n">first_new_residue</span> <span class="o">=</span> <span class="n">new_residues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_residues_chain_id</span> <span class="o">=</span> <span class="n">first_new_residue</span><span class="o">.</span><span class="n">chain_id</span>
    <span class="n">atom_start_index</span> <span class="o">=</span> <span class="n">first_new_residue</span><span class="o">.</span><span class="n">start_index</span>
    <span class="n">new_residue_atom_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">atom_start_index</span><span class="p">,</span> <span class="n">new_residues</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end_index</span><span class="p">))</span>
    <span class="n">new_residue_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="n">number_new_residues</span><span class="p">))</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span>
    <span class="n">structures</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Structure</span><span class="p">]</span>

    <span class="c1"># Must update other Structures indices</span>
    <span class="k">for</span> <span class="n">structure_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="p">:</span>
        <span class="n">structures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">structure_type</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Iterate over Structures in each structure_container</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">structure</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># Update each Structure _residue_indices and _atom_indices with additional indices</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">_insert_indices</span><span class="p">(</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">residue_indices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">_insert_indices</span><span class="p">(</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">atom_indices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">atom_start_index</span><span class="p">),</span> <span class="n">new_residue_atom_indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
                <span class="k">break</span>  <span class="c1"># Move to the next container to update the indices by a set increment</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="c1"># This should happen if the index isn&#39;t in the StructureBase.*_indices of interest</span>
                <span class="c1"># Edge case where the index is being appended to the c-terminus</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">structure</span><span class="o">.</span><span class="n">residue_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">new_residues_chain_id</span> <span class="o">==</span> <span class="n">structure</span><span class="o">.</span><span class="n">chain_id</span><span class="p">:</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">_insert_indices</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">,</span> <span class="n">new_residue_indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">_insert_indices</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">,</span> <span class="n">new_residue_atom_indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c1"># This was the Structure with insertion and insert_indices proceeded successfully</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># The target structure wasn&#39;t found</span>
            <span class="k">raise</span> <span class="n">DesignError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_residues</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: Couldn&#39;t locate the Structure to be modified by the inserted &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;residues&quot;</span><span class="p">)</span>
        <span class="c1"># For each subsequent structure in the structure container, update the indices with the last index from</span>
        <span class="c1"># the prior structure</span>
        <span class="n">prior_structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">structures</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">_start_indices</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">prior_structure</span><span class="o">.</span><span class="n">atom_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">_start_indices</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">prior_structure</span><span class="o">.</span><span class="n">residue_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>
            <span class="n">prior_structure</span> <span class="o">=</span> <span class="n">structure</span>

    <span class="c1"># self.log.debug(f&#39;Deleted {number_new_residues} Residue instances&#39;)</span>

    <span class="k">return</span> <span class="n">new_residues</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.ContainsChains" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">ContainsChains</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ContainsChains</span><span class="p">(</span><span class="n">chains</span><span class="p">:</span> <span class="n">bool</span> <span class="o">|</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">chain_ids</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rename_chains</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">as_mates</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.ContainsStructures" href="#structure.model.ContainsStructures">ContainsStructures</a></code></p>

  
      <p>Implements methods to interact with a Structure which contains Chain instances</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>chain_ids</code></b>
            (<code><span title="collections.abc.Iterable">Iterable</span>[str]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A list of identifiers to assign to each Chain instance</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>chains</code></b>
            (<code>bool | <span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a>]</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether to create Chain instances from passed Structure container instances, or existing Chain
instances to create the Model with</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rename_chains</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to name each chain an incrementally new Alphabetical character</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>as_mates</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether Chain instances should be controlled by a captain (True), or be dependents</p>
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chains</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Chain</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">chain_ids</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">rename_chains</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">as_mates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        chain_ids: A list of identifiers to assign to each Chain instance</span>
<span class="sd">        chains: Whether to create Chain instances from passed Structure container instances, or existing Chain</span>
<span class="sd">            instances to create the Model with</span>
<span class="sd">        rename_chains: Whether to name each chain an incrementally new Alphabetical character</span>
<span class="sd">        as_mates: Whether Chain instances should be controlled by a captain (True), or be dependents</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># ContainsChains</span>
    <span class="c1"># Use the same list as default to save parsed chain ids</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">original_chain_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">chains</span><span class="p">:</span>  <span class="c1"># Populate chains</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;_chains&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="c1"># Set the chains accordingly, copying them to remove prior relationships</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_structure_containers</span><span class="p">()</span>  <span class="c1"># Copy each Chain in chains</span>
            <span class="k">if</span> <span class="n">as_mates</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DesignError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t initialize </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.chains as it is missing &#39;.residues&#39; while &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">as_mates</span><span class="si">=}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Create the instance from existing chains</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assign_residues_from_structures</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span>
                <span class="c1"># Reindex all residue and atom indices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reset_and_reindex_structures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">)</span>
                <span class="c1"># Set the parent attribute for all containers</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_structure_container_attributes</span><span class="p">(</span><span class="n">_parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">chain_ids</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">id_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">,</span> <span class="n">chain_ids</span><span class="p">):</span>
                    <span class="n">chain</span><span class="o">.</span><span class="n">chain_id</span> <span class="o">=</span> <span class="n">id_</span>
            <span class="c1"># By using extend, self.original_chain_ids are set as well</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">chain</span><span class="o">.</span><span class="n">chain_id</span> <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Create Chain instances from Residues</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_chains</span><span class="p">(</span><span class="n">chain_ids</span><span class="o">=</span><span class="n">chain_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">as_mates</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
                    <span class="n">chain</span><span class="o">.</span><span class="n">make_parent</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">rename_chains</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_chain_ids_pdb_compatible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename_chains</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original chain_ids: </span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_chain_ids</span><span class="p">)</span><span class="si">}</span><span class="s1"> | &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;Loaded chain_ids: </span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_parent</span><span class="p">():</span>
        <span class="n">reference_sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">reference_sequence</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference_sequence</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># Was parsed from file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_reference_sequence_from_seqres</span><span class="p">(</span><span class="n">reference_sequence</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsChains.chains" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">chains</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">chains</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the Chain instances which are contained in the instance</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsChains.number_of_chains" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">number_of_chains</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">number_of_chains</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the number of Chain instances in the Structure</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsChains.chain_breaks" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">chain_breaks</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">chain_breaks</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the index where each of the Chain instances ends, i.e. at the c-terminal Residue</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.from_chains" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_chains</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_chains</span><span class="p">(</span><span class="n">chains</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a></span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Create an instance from a Sequence of Chain objects. Automatically renames all chains</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_chains</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">chains</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Chain</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an instance from a Sequence of Chain objects. Automatically renames all chains&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">,</span> <span class="n">rename_chains</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.has_dependent_chains" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">has_dependent_chains</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">has_dependent_chains</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns True if the .chains are dependents, otherwise Returns False if .chains are symmetry mates</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_dependent_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if the .chains are dependents, otherwise Returns False if .chains are symmetry mates&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;_chains&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.is_parsed_multimodel" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">is_parsed_multimodel</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_parsed_multimodel</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns True if parsing located multiple MODEL records, aka a 'multimodel' or multistate Structure</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_parsed_multimodel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if parsing located multiple MODEL records, aka a &#39;multimodel&#39; or multistate Structure&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_chain_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.are_chain_ids_pdb_compatible" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">are_chain_ids_pdb_compatible</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">are_chain_ids_pdb_compatible</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns True if the chain_ids are compatible with legacy PDB format</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">are_chain_ids_pdb_compatible</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if the chain_ids are compatible with legacy PDB format&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">chain_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.rename_chains" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">rename_chains</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">rename_chains</span><span class="p">(</span><span class="n">exclude_chains</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Renames each chain an incrementally new Alphabetical character using Structure.available_letters</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>exclude_chains</code></b>
            (<code><span title="collections.abc.Sequence">Sequence</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The chains which shouldn't be modified</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.chain_ids (list[str])</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rename_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_chains</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Renames each chain an incrementally new Alphabetical character using Structure.available_letters</span>

<span class="sd">    Args:</span>
<span class="sd">        exclude_chains: The chains which shouldn&#39;t be modified</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.chain_ids (list[str])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exclude_chains</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">exclude_chains</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Update chain_ids, then each chain</span>
    <span class="n">available_chain_ids</span> <span class="o">=</span> <span class="n">chain_id_generator</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
        <span class="n">chain_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">available_chain_ids</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">chain_id</span> <span class="ow">in</span> <span class="n">exclude_chains</span><span class="p">:</span>
            <span class="n">chain_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">available_chain_ids</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">chain_id</span> <span class="o">=</span> <span class="n">chain_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.renumber_residues_by_chain" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">renumber_residues_by_chain</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">renumber_residues_by_chain</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>For each Chain instance, renumber Residue objects sequentially starting with 1</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">renumber_residues_by_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For each Chain instance, renumber Residue objects sequentially starting with 1&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">renumber_residues</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.get_chain" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_chain</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_chain</span><span class="p">(</span><span class="n">chain_id</span><span class="p">:</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the Chain object specified by the passed ChainID from the Structure</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>chain_id</code></b>
            (<code>str</code>)
        
        <div class="doc-md-description">
          <p>The name of the Chain to query</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a> | None</code>
        
        <div class="doc-md-description">
          <p>The Chain if one was found</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Chain</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the Chain object specified by the passed ChainID from the Structure</span>

<span class="sd">    Args:</span>
<span class="sd">        chain_id: The name of the Chain to query</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Chain if one was found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">id_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">id_</span> <span class="o">==</span> <span class="n">chain_id</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;The number of chains in </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_chains</span><span class="si">}</span><span class="s1"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">)</span><span class="si">}</span><span class="s1">, &#39;</span>
                    <span class="s1">&#39;the number of .chain_ids&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.set_reference_sequence_from_seqres" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_reference_sequence_from_seqres</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">set_reference_sequence_from_seqres</span><span class="p">(</span><span class="n">reference_sequence</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">str</span><span class="p">])</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>If SEQRES was parsed, set the reference_sequence attribute from each parsed chain_id. Ensure that this is
called after self._create_chains()</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_reference_sequence_from_seqres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference_sequence</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If SEQRES was parsed, set the reference_sequence attribute from each parsed chain_id. Ensure that this is</span>
<span class="sd">    called after self._create_chains()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">original_chain</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_chain_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">_reference_sequence</span> <span class="o">=</span> <span class="n">reference_sequence</span><span class="p">[</span><span class="n">original_chain</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># original_chain not parsed in SEQRES</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.chain_id_generator" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">chain_id_generator</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">chain_id_generator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="collections.abc.Generator">Generator</span></span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Provide a generator which produces all combinations of chain ID strings</p>
<p>Returns
    The generator producing a maximum 2 character string where single characters are exhausted,
        first in uppercase, then in lowercase</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">chain_id_generator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide a generator which produces all combinations of chain ID strings</span>

<span class="sd">    Returns</span>
<span class="sd">        The generator producing a maximum 2 character string where single characters are exhausted,</span>
<span class="sd">            first in uppercase, then in lowercase</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">chain_id_generator</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsChains.orient" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">orient</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">orient</span><span class="p">(</span><span class="n">symmetry</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Orient a symmetric Structure at the origin with symmetry axis set on canonical axes defined by symmetry file</p>
<p>Sets the Structure with coordinates as described by a canonical orientation</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>symmetry</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The symmetry of the Structure</p>
        </div>
      </li>
  </ul>
      <p>Raises:
    SymmetryError: When the specified symmetry is incompatible with the Structure
    StructureException: When the orient program fails</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">orient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Orient a symmetric Structure at the origin with symmetry axis set on canonical axes defined by symmetry file</span>

<span class="sd">    Sets the Structure with coordinates as described by a canonical orientation</span>

<span class="sd">    Args:</span>
<span class="sd">        symmetry: The symmetry of the Structure</span>
<span class="sd">    Raises:</span>
<span class="sd">        SymmetryError: When the specified symmetry is incompatible with the Structure</span>
<span class="sd">        StructureException: When the orient program fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># These notes are obviated by the use of the below protocol with from_file() constructor</span>
    <span class="c1"># orient_oligomer.f program notes</span>
    <span class="c1"># C		Will not work in any of the infinite situations where a PDB file is f***ed up,</span>
    <span class="c1"># C		in ways such as but not limited to:</span>
    <span class="c1"># C     equivalent residues in different chains don&#39;t have the same numbering; different subunits</span>
    <span class="c1"># C		are all listed with the same chain ID (e.g. with incremental residue numbering) instead</span>
    <span class="c1"># C		of separate IDs; multiple conformations are written out for the same subunit structure</span>
    <span class="c1"># C		(as in an NMR ensemble), negative residue numbers, etc. etc.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subunit_number</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">valid_subunit_number</span><span class="p">[</span><span class="n">symmetry</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">orient</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: Symmetry </span><span class="si">{</span><span class="n">symmetry</span><span class="si">}</span><span class="s2"> isn&#39;t a valid symmetry. Please try one of: &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">valid_symmetries</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">number_of_subunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_chains</span>
    <span class="n">multicomponent</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">symmetry</span> <span class="o">==</span> <span class="s1">&#39;C1&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;C1 symmetry doesn&#39;t have a canonical orientation. Translating to the origin&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="n">number_of_subunits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number_of_subunits</span> <span class="o">!=</span> <span class="n">subunit_number</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_of_subunits</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">multicomponent_valid_subunit_number</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symmetry</span><span class="p">):</span>
                <span class="n">multicomponent</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> couldn&#39;t be oriented: It has </span><span class="si">{</span><span class="n">number_of_subunits</span><span class="si">}</span><span class="s2"> subunits while a multiple of &quot;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subunit_number</span><span class="si">}</span><span class="s1"> are expected for symmetry=</span><span class="si">{</span><span class="n">symmetry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Can&#39;t orient a Structure with only a single chain. No symmetry present&quot;</span><span class="p">)</span>

    <span class="n">orient_input</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">putils</span><span class="o">.</span><span class="n">orient_exe_dir</span><span class="p">,</span> <span class="s1">&#39;input.pdb&#39;</span><span class="p">)</span>
    <span class="n">orient_output</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">putils</span><span class="o">.</span><span class="n">orient_exe_dir</span><span class="p">,</span> <span class="s1">&#39;output.pdb&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean_orient_input_output</span><span class="p">():</span>
        <span class="n">orient_input</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">orient_output</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">clean_orient_input_output</span><span class="p">()</span>
    <span class="n">orient_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;out_path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">orient_input</span><span class="p">)}</span>
    <span class="k">if</span> <span class="n">multicomponent</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ContainsEntities</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">orient</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> as the symmetry is </span><span class="si">{</span><span class="n">multicomponent</span><span class="si">=}</span><span class="s2">, however, there&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; are no .entities in the class </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">assembly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">orient_kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">**</span><span class="n">orient_kwargs</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">putils</span><span class="o">.</span><span class="n">orient_exe_path</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                         <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">putils</span><span class="o">.</span><span class="n">orient_exe_dir</span><span class="p">)</span>
    <span class="n">in_symm_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">putils</span><span class="o">.</span><span class="n">orient_exe_dir</span><span class="p">,</span> <span class="s1">&#39;symm_files&#39;</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">in_symm_file</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="mi">28</span><span class="p">:])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span> <span class="k">if</span> <span class="n">stderr</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">orient_output</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="n">orient_output</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log_file</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;baseFilename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>  <span class="c1"># No handlers attached</span>
            <span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">log_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;. Check </span><span class="si">{</span><span class="n">log_file</span><span class="si">}</span><span class="s1"> for more information&#39;</span> <span class="k">if</span> <span class="n">log_file</span> <span class="k">else</span> \
            <span class="sa">f</span><span class="s1">&#39;: </span><span class="si">{</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">stderr</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">clean_orient_input_output</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">StructureException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">putils</span><span class="o">.</span><span class="n">orient_exe_path</span><span class="si">}</span><span class="s2"> couldn&#39;t orient </span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="n">log_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">oriented_pdb</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">orient_output</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
    <span class="n">orient_fixed_struct</span> <span class="o">=</span> <span class="n">oriented_pdb</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">multicomponent</span><span class="p">:</span>
        <span class="n">moving_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">moving_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">orient_fixed_seq</span> <span class="o">=</span> <span class="n">orient_fixed_struct</span><span class="o">.</span><span class="n">sequence</span>
    <span class="n">moving_seq</span> <span class="o">=</span> <span class="n">moving_struct</span><span class="o">.</span><span class="n">sequence</span>

    <span class="n">fixed_coords</span> <span class="o">=</span> <span class="n">orient_fixed_struct</span><span class="o">.</span><span class="n">ca_coords</span>
    <span class="n">moving_coords</span> <span class="o">=</span> <span class="n">moving_struct</span><span class="o">.</span><span class="n">ca_coords</span>
    <span class="k">if</span> <span class="n">orient_fixed_seq</span> <span class="o">!=</span> <span class="n">moving_seq</span><span class="p">:</span>
        <span class="c1"># Do an alignment, get selective indices, then follow with superposition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">orient</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(): existing Chain </span><span class="si">{</span><span class="n">moving_struct</span><span class="o">.</span><span class="n">chain_id</span><span class="si">}</span><span class="s1"> and &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;oriented Chain </span><span class="si">{</span><span class="n">orient_fixed_struct</span><span class="o">.</span><span class="n">chain_id</span><span class="si">}</span><span class="s1"> are being aligned for superposition&#39;</span><span class="p">)</span>
        <span class="n">fixed_indices</span><span class="p">,</span> <span class="n">moving_indices</span> <span class="o">=</span> <span class="n">get_equivalent_indices</span><span class="p">(</span><span class="n">orient_fixed_seq</span><span class="p">,</span> <span class="n">moving_seq</span><span class="p">)</span>
        <span class="n">fixed_coords</span> <span class="o">=</span> <span class="n">fixed_coords</span><span class="p">[</span><span class="n">fixed_indices</span><span class="p">]</span>
        <span class="n">moving_coords</span> <span class="o">=</span> <span class="n">moving_coords</span><span class="p">[</span><span class="n">moving_indices</span><span class="p">]</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">superposition3d</span><span class="p">(</span><span class="n">fixed_coords</span><span class="p">,</span> <span class="n">moving_coords</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">translation</span><span class="o">=</span><span class="n">tx</span><span class="p">)</span>
    <span class="n">clean_orient_input_output</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.ContainsEntities" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">ContainsEntities</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ContainsEntities</span><span class="p">(</span><span class="n">entities</span><span class="p">:</span> <span class="n">bool</span> <span class="o">|</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">entity_info</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">dict</span> <span class="o">|</span> <span class="n">list</span> <span class="o">|</span> <span class="n">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.ContainsChains" href="#structure.model.ContainsChains">ContainsChains</a></code></p>

  
      <p>Implements methods to interact with a Structure which contains Entity instances</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>entities</code></b>
            (<code>bool | <span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a>]</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Existing Entity instances used to construct the Structure, or evaluates False to skip creating
Entity instances from the existing '.chains' Chain instances</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>entity_info</code></b>
            (<code>dict[str, dict[dict | list | str]]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Metadata describing the Entity instances</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>**kwargs</code></b>
        
        <div class="doc-md-description">
          
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Entity</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">entity_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        entities: Existing Entity instances used to construct the Structure, or evaluates False to skip creating</span>
<span class="sd">            Entity instances from the existing &#39;.chains&#39; Chain instances</span>
<span class="sd">        entity_info: Metadata describing the Entity instances</span>
<span class="sd">        **kwargs:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># ContainsEntities</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">entity_info</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">entity_info</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">entity_info</span>

    <span class="k">if</span> <span class="n">entities</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;_entities&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="c1"># Create the instance from existing entities</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assign_residues_from_structures</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
            <span class="c1"># Set the entities accordingly, first copying, then resetting, and finally updating the parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entities</span> <span class="o">=</span> <span class="n">entities</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_structure_containers</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_and_reindex_structures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_structure_container_attributes</span><span class="p">(</span><span class="n">_parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">rename_chains</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rename_chains&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rename_chains</span><span class="p">:</span>  <span class="c1"># Set each successive Entity to have an incrementally higher chain id</span>
                <span class="n">available_chain_ids</span> <span class="o">=</span> <span class="n">chain_id_generator</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
                    <span class="n">entity</span><span class="o">.</span><span class="n">chain_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">available_chain_ids</span><span class="p">)</span>
                    <span class="c1"># If the full structure wanted contiguous chain_ids, this should be used</span>
                    <span class="c1"># for _ in range(entity.number_of_symmetry_mates):</span>
                    <span class="c1">#     # Discard ids</span>
                    <span class="c1">#     next(available_chain_ids)</span>
                    <span class="c1"># self.log.debug(f&#39;Entity {entity.name} new chain identifier {entity.chain_id}&#39;)</span>
                <span class="c1"># self.chain_ids.extend([entity.chain_id for entity in self.entities])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Provided as True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entities</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_entities</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">:</span>
            <span class="c1"># Set chain_ids according to self.entities as it wasn&#39;t set by self.chains (probably False)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">entity</span><span class="o">.</span><span class="n">chain_id</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entities</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># If any of the entities are symmetric, ensure the new Model is aware they are</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_dependents</span> <span class="o">=</span> <span class="s1">&#39;_entities&#39;</span>
            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsEntities.entity_info" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">entity_info</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entity_info</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">dict</span> <span class="o">|</span> <span class="n">list</span> <span class="o">|</span> <span class="n">str</span><span class="p">]]</span> <span class="o">|</span> <span class="n">dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.ContainsEntities.entity_info" href="#structure.model.ContainsEntities.entity_info">entity_info</a></span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.ContainsEntities.entity_info" href="#structure.model.ContainsEntities.entity_info">entity_info</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Mapping of the Entity name to Metadata describing the Entity instance</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsEntities.entities" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">entities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entities</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns each of the Entity instances in the Structure</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsEntities.number_of_entities" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">number_of_entities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">number_of_entities</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the number of Entity instances in the Structure</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsEntities.entity_breaks" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">entity_breaks</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entity_breaks</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the index where each of the Entity instances ends, i.e. at the c-terminal Residue</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsEntities.sequence" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">sequence</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">sequence</span><span class="p">:</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the sequence of structurally modeled residues for every Entity instance</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>str</code>
        
        <div class="doc-md-description">
          <p>The concatenated sequence for all Entity instances combined</p>
      </div>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsEntities.reference_sequence" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">reference_sequence</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">reference_sequence</span><span class="p">:</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the sequence for every Entity instance, constituting all Residues, not just structurally modeled ones</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>str</code>
        
        <div class="doc-md-description">
          <p>The concatenated reference sequences for all Entity instances combined</p>
      </div>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.ContainsEntities.atom_indices_per_entity" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">atom_indices_per_entity</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">atom_indices_per_entity</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the atom indices for each Entity</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsEntities.from_entities" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_entities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_entities</span><span class="p">(</span><span class="n">entities</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.base.Structures" href="../base/#structure.base.Structures">Structures</a></span><span class="p">,</span> <span class="n">rename_chains</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Construct a Structure instance from a container of Entity objects</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_entities</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">entities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Entity</span><span class="p">]</span> <span class="o">|</span> <span class="n">Structures</span><span class="p">,</span> <span class="n">rename_chains</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a Structure instance from a container of Entity objects&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Structures</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">from_entities</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">() constructor received &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;entities&#39;=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. Expected list[Entity]&quot;</span>  <span class="c1"># or Structures</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">entities</span><span class="o">=</span><span class="n">entities</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rename_chains</span><span class="o">=</span><span class="n">rename_chains</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsEntities.format_header" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">format_header</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">format_header</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return any super().format_header()</p>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>assembly</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to write header details for the assembly</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>str</code>
        
        <div class="doc-md-description">
          <p>The .pdb file header string</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return any super().format_header()</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        assembly: bool = False - Whether to write header details for the assembly</span>

<span class="sd">    Returns:</span>
<span class="sd">        The .pdb file header string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">format_header</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsEntities.retrieve_metadata_from_pdb" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">retrieve_metadata_from_pdb</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">retrieve_metadata_from_pdb</span><span class="p">(</span><span class="n">biological_assembly</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="n">dict</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Query the PDB API for information on the PDB code found at the Model.name attribute</p>
<p>For each new instance, makes one call to the PDB API, plus an additional call for each Entity, and one more
if biological_assembly is passed. If this has been loaded before, it uses the persistent wrapapi.APIDatabase</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>biological_assembly</code></b>
            (<code>int</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The number of the biological assembly that is associated with this structural state</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.api_entry (dict[str, dict[Any] | float] | dict):
    {'assembly': [['A', 'B'], ...],
     'entity': {'EntityID':
                    {'chains': ['A', 'B', ...],
                     'dbref': {'accession': ('Q96DC8',), 'db': 'UniProt'}
                     'reference_sequence': 'MSLEHHHHHH...',
                     'thermophilicity': 1.0},
                ...},
     'res': resolution,
     'struct': {'space': space_group, 'a_b_c': (a, b, c),
                'ang_a_b_c': (ang_a, ang_b, ang_c)}
    }</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">retrieve_metadata_from_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">biological_assembly</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query the PDB API for information on the PDB code found at the Model.name attribute</span>

<span class="sd">    For each new instance, makes one call to the PDB API, plus an additional call for each Entity, and one more</span>
<span class="sd">    if biological_assembly is passed. If this has been loaded before, it uses the persistent wrapapi.APIDatabase</span>

<span class="sd">    Args:</span>
<span class="sd">        biological_assembly: The number of the biological assembly that is associated with this structural state</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.api_entry (dict[str, dict[Any] | float] | dict):</span>
<span class="sd">            {&#39;assembly&#39;: [[&#39;A&#39;, &#39;B&#39;], ...],</span>
<span class="sd">             &#39;entity&#39;: {&#39;EntityID&#39;:</span>
<span class="sd">                            {&#39;chains&#39;: [&#39;A&#39;, &#39;B&#39;, ...],</span>
<span class="sd">                             &#39;dbref&#39;: {&#39;accession&#39;: (&#39;Q96DC8&#39;,), &#39;db&#39;: &#39;UniProt&#39;}</span>
<span class="sd">                             &#39;reference_sequence&#39;: &#39;MSLEHHHHHH...&#39;,</span>
<span class="sd">                             &#39;thermophilicity&#39;: 1.0},</span>
<span class="sd">                        ...},</span>
<span class="sd">             &#39;res&#39;: resolution,</span>
<span class="sd">             &#39;struct&#39;: {&#39;space&#39;: space_group, &#39;a_b_c&#39;: (a, b, c),</span>
<span class="sd">                        &#39;ang_a_b_c&#39;: (ang_a, ang_b, ang_c)}</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># api_entry = self.api_entry</span>
    <span class="c1"># if api_entry is not None:  # Already tried to solve this</span>
    <span class="c1">#     return</span>

    <span class="c1"># if self.api_db:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># retrieve_api_info = self.api_db.pdb.retrieve_data</span>
        <span class="n">retrieve_api_info</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="n">wrapapi</span><span class="o">.</span><span class="n">api_database_factory</span><span class="p">()</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">retrieve_data</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">retrieve_api_info</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">query_pdb_by</span>

    <span class="c1"># if self.name:  # Try to solve API details from name</span>
    <span class="n">parsed_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">splitter_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="s1">&#39;_-&#39;</span><span class="p">)</span>  <span class="c1"># &#39;entity, assembly&#39;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">parsed_name</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># To parse the name using standard PDB API entry ID&#39;s</span>
            <span class="n">parsed_name</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span> <span class="o">=</span> <span class="n">parsed_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">splitter_iter</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="c1"># We didn&#39;t find an EntryID in parsed_name from splitting typical PDB formatted strings</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The name &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; can&#39;t be coerced to PDB API format&quot;</span><span class="p">)</span>
            <span class="c1"># api_entry = {}</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="c1"># Set the index to the index that was stopped at</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="c1"># At some point, len(parsed_name) == 4</span>
    <span class="k">if</span> <span class="n">biological_assembly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># query_args.update(assembly_integer=self.assembly)</span>
        <span class="c1"># # self.api_entry.update(_get_assembly_info(self.name))</span>
        <span class="n">api_entry</span> <span class="o">=</span> <span class="n">retrieve_api_info</span><span class="p">(</span><span class="n">entry</span><span class="o">=</span><span class="n">parsed_name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">api_entry</span><span class="p">[</span><span class="s1">&#39;assembly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retrieve_api_info</span><span class="p">(</span><span class="n">entry</span><span class="o">=</span><span class="n">parsed_name</span><span class="p">,</span> <span class="n">assembly_integer</span><span class="o">=</span><span class="n">biological_assembly</span><span class="p">)</span>
        <span class="c1"># ^ returns [[&#39;A&#39;, &#39;A&#39;, &#39;A&#39;, ...], ...]</span>
    <span class="k">elif</span> <span class="n">extra</span><span class="p">:</span>  <span class="c1"># Extra not None or []</span>
        <span class="c1"># Try to parse any found extra to an integer denoting entity or assembly ID</span>
        <span class="n">integer</span><span class="p">,</span> <span class="o">*</span><span class="n">non_sense</span> <span class="o">=</span> <span class="n">extra</span>
        <span class="k">if</span> <span class="n">integer</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">non_sense</span><span class="p">:</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Entity integer, such as 1ABC_1.pdb</span>
                <span class="n">api_entry</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">retrieve_api_info</span><span class="p">(</span><span class="n">entry</span><span class="o">=</span><span class="n">parsed_name</span><span class="p">,</span> <span class="n">entity_integer</span><span class="o">=</span><span class="n">integer</span><span class="p">))</span>
                <span class="c1"># retrieve_api_info returns</span>
                <span class="c1"># {&#39;EntityID&#39;: {&#39;chains&#39;: [&#39;A&#39;, &#39;B&#39;, ...],</span>
                <span class="c1">#               &#39;dbref&#39;: {&#39;accession&#39;: (&#39;Q96DC8&#39;,), &#39;db&#39;: &#39;UniProt&#39;}</span>
                <span class="c1">#               &#39;reference_sequence&#39;: &#39;MSLEHHHHHH...&#39;,</span>
                <span class="c1">#               &#39;thermophilicity&#39;: 1.0},</span>
                <span class="c1">#  ...}</span>
                <span class="n">parsed_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">parsed_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">integer</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Get entry alone. This is an assembly or unknown conjugation. Either way entry info is needed</span>
                <span class="n">api_entry</span> <span class="o">=</span> <span class="n">retrieve_api_info</span><span class="p">(</span><span class="n">entry</span><span class="o">=</span><span class="n">parsed_name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># This is an assembly integer, such as 1ABC-1.pdb</span>
                    <span class="n">api_entry</span><span class="p">[</span><span class="s1">&#39;assembly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retrieve_api_info</span><span class="p">(</span><span class="n">entry</span><span class="o">=</span><span class="n">parsed_name</span><span class="p">,</span> <span class="n">assembly_integer</span><span class="o">=</span><span class="n">integer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># This isn&#39;t an integer or there are extra characters</span>
            <span class="c1"># It&#39;s likely they are extra characters that won&#39;t be of help</span>
            <span class="c1"># Tod0, try to collect anyway?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The name &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; contains extra info that can&#39;t be coerced to PDB API format&quot;</span><span class="p">)</span>
            <span class="n">api_entry</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">elif</span> <span class="n">extra</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Nothing extra as it was correct length to begin with, just query entry</span>
        <span class="n">api_entry</span> <span class="o">=</span> <span class="n">retrieve_api_info</span><span class="p">(</span><span class="n">entry</span><span class="o">=</span><span class="n">parsed_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;This logic wasn&#39;t expected and shouldn&#39;t be allowed to persist: &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;self.name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">, parse_name=</span><span class="si">{</span><span class="n">parsed_name</span><span class="si">}</span><span class="s1">, extra=</span><span class="si">{</span><span class="n">extra</span><span class="si">}</span><span class="s1">, idx=</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">api_entry</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found PDB API information: &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">api_entry</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># Set the identified name to lowercase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">parsed_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">api_entry</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsEntities.get_entity" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_entity</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_entity</span><span class="p">(</span><span class="n">entity_id</span><span class="p">:</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Retrieve an Entity by name</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>entity_id</code></b>
            (<code>str</code>)
        
        <div class="doc-md-description">
          <p>The name of the Entity to query</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a> | None</code>
        
        <div class="doc-md-description">
          <p>The Entity if one was found</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Entity</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve an Entity by name</span>

<span class="sd">    Args:</span>
<span class="sd">        entity_id: The name of the Entity to query</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Entity if one was found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entity_id</span> <span class="o">==</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">entity</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsEntities.entity_from_chain" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">entity_from_chain</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entity_from_chain</span><span class="p">(</span><span class="n">chain_id</span><span class="p">:</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the entity associated with a particular chain id</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">entity_from_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Entity</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the entity associated with a particular chain id&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">chain_id</span> <span class="o">==</span> <span class="n">entity</span><span class="o">.</span><span class="n">chain_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">entity</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.ContainsEntities.match_entity_by_seq" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">match_entity_by_seq</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">match_entity_by_seq</span><span class="p">(</span><span class="n">other_seq</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force_closest</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>From another sequence, returns the first matching chain from the corresponding Entity</p>
<p>Uses a local alignment to produce the match score</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>other_seq</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The sequence to query</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>force_closest</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether to force the search if a perfect match isn't identified</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>tolerance</code></b>
            (<code>float</code>, default:
                <code>0.7</code>
)
        
        <div class="doc-md-description">
          <p>The acceptable difference between sequences to consider them the same Entity.
Tuning this parameter is necessary if you have sequences which should be considered different entities,
but are fairly similar</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a> | None</code>
        
        <div class="doc-md-description">
          <p>The matching Entity if one was found</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">match_entity_by_seq</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">other_seq</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force_closest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Entity</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From another sequence, returns the first matching chain from the corresponding Entity</span>

<span class="sd">    Uses a local alignment to produce the match score</span>

<span class="sd">    Args:</span>
<span class="sd">        other_seq: The sequence to query</span>
<span class="sd">        force_closest: Whether to force the search if a perfect match isn&#39;t identified</span>
<span class="sd">        tolerance: The acceptable difference between sequences to consider them the same Entity.</span>
<span class="sd">            Tuning this parameter is necessary if you have sequences which should be considered different entities,</span>
<span class="sd">            but are fairly similar</span>

<span class="sd">    Returns:</span>
<span class="sd">        The matching Entity if one was found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">other_seq</span> <span class="o">==</span> <span class="n">entity</span><span class="o">.</span><span class="n">sequence</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">entity</span>

    <span class="c1"># We didn&#39;t find an ideal match</span>
    <span class="k">if</span> <span class="n">force_closest</span><span class="p">:</span>
        <span class="n">entity_alignment_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
            <span class="n">alignment</span> <span class="o">=</span> <span class="n">generate_alignment</span><span class="p">(</span><span class="n">other_seq</span><span class="p">,</span> <span class="n">entity</span><span class="o">.</span><span class="n">sequence</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">entity_alignment_scores</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="o">=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">score</span>

        <span class="n">max_score</span><span class="p">,</span> <span class="n">max_score_entity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">entity_alignment_scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">normalized_score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">normalized_score</span> <span class="o">&gt;</span> <span class="n">max_score</span><span class="p">:</span>
                <span class="n">max_score</span> <span class="o">=</span> <span class="n">normalized_score</span>  <span class="c1"># alignment_score_d[entity]</span>
                <span class="n">max_score_entity</span> <span class="o">=</span> <span class="n">entity</span>

        <span class="k">if</span> <span class="n">max_score</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">max_score_entity</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.SymmetryOpsMixin" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">SymmetryOpsMixin</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">SymmetryOpsMixin</span><span class="p">(</span><span class="n">sym_entry</span><span class="p">:</span> <span class="n"><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span></span> <span class="o">|</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">transformations</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry_operators</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation_matrices</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translation_matrices</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Implements methods to interact with symmetric Structure instances</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>sym_entry</code></b>
            (<code><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span> | int</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The SymEntry which specifies all symmetry parameters</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>symmetry</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The name of a symmetry to be searched against compatible symmetries</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>transformations</code></b>
            (<code>list[<span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span>]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Transformation operations that reproduce the oligomeric/assembly for each Entity</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rotation_matrices</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Rotation operations that create the symmetric state</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>translation_matrices</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Translation operations that create the symmetric state</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>uc_dimensions</code></b>
            (<code>list[float]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The unit cell dimensions for the crystalline symmetry</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>symmetry_operators</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A set of custom expansion matrices</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>surrounding_uc</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether the 3x3 layer group, or 3x3x3 space group should be generated</p>
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym_entry</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">SymEntry</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">transformations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">TransformationMapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">symmetry_operators</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation_matrices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">translation_matrices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        sym_entry: The SymEntry which specifies all symmetry parameters</span>
<span class="sd">        symmetry: The name of a symmetry to be searched against compatible symmetries</span>
<span class="sd">        transformations: Transformation operations that reproduce the oligomeric/assembly for each Entity</span>
<span class="sd">        rotation_matrices: Rotation operations that create the symmetric state</span>
<span class="sd">        translation_matrices: Translation operations that create the symmetric state</span>
<span class="sd">        uc_dimensions: The unit cell dimensions for the crystalline symmetry</span>
<span class="sd">        symmetry_operators: A set of custom expansion matrices</span>
<span class="sd">        surrounding_uc: Whether the 3x3 layer group, or 3x3x3 space group should be generated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># SymmetryOpsMixin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_symmetry</span><span class="p">(</span><span class="n">sym_entry</span><span class="o">=</span><span class="n">sym_entry</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="o">=</span><span class="n">uc_dimensions</span><span class="p">,</span>
                      <span class="n">operators</span><span class="o">=</span><span class="n">symmetry_operators</span><span class="p">,</span> <span class="n">rotations</span><span class="o">=</span><span class="n">rotation_matrices</span><span class="p">,</span> <span class="n">translations</span><span class="o">=</span><span class="n">translation_matrices</span><span class="p">,</span>
                      <span class="n">transformations</span><span class="o">=</span><span class="n">transformations</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="o">=</span><span class="n">surrounding_uc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.sym_entry" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">sym_entry</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">sym_entry</span><span class="p">:</span> <span class="n"><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The SymEntry specifies the symmetric parameters for the utilized symmetry</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.point_group_symmetry" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">point_group_symmetry</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">point_group_symmetry</span><span class="p">:</span> <span class="n">str</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The point group underlying the resulting SymEntry</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.dimension" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">dimension</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">dimension</span><span class="p">:</span> <span class="n">int</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The dimension of the symmetry from None, 0, 2, or 3</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.uc_dimensions" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">uc_dimensions</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">uc_dimensions</span><span class="p">:</span> <span class="n">tuple</span><span class="p">[</span><span class="n">float</span><span class="p">,</span> <span class="n">float</span><span class="p">,</span> <span class="n">float</span><span class="p">,</span> <span class="n">float</span><span class="p">,</span> <span class="n">float</span><span class="p">,</span> <span class="n">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The unit cell dimensions for the lattice specified by lengths a, b, c and angles alpha, beta, gamma</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>tuple[float, float, float, float, float, float] | None</code>
        
        <div class="doc-md-description">
          <p>length a, length b, length c, angle alpha, angle beta, angle gamma</p>
      </div>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.cryst_record" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">cryst_record</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">cryst_record</span><span class="p">:</span> <span class="n">str</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the symmetry parameters as a CRYST1 entry</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.expand_matrices" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">expand_matrices</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">expand_matrices</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The symmetry rotations to generate each of the symmetry mates</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.expand_translations" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">expand_translations</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">expand_translations</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The symmetry translations to generate each of the symmetry mates</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.chain_transforms" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">chain_transforms</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">chain_transforms</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the transformation operations for each of the symmetry mates (excluding the ASU)</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.number_of_symmetric_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">number_of_symmetric_residues</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">number_of_symmetric_residues</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Describes the number of Residues when accounting for symmetry mates</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.number_of_symmetry_mates" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">number_of_symmetry_mates</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">number_of_symmetry_mates</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Describes the number of symmetric copies present in the coordinates</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.number_of_uc_symmetry_mates" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">number_of_uc_symmetry_mates</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">number_of_uc_symmetry_mates</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Describes the number of symmetry mates present in the unit cell</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.asu_model_index" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">asu_model_index</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">asu_model_index</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The asu equivalent model in the SymmetricModel. Zero-indexed</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.asu_indices" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">asu_indices</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">asu_indices</span><span class="p">:</span> <span class="n">slice</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the ASU indices</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.symmetric_coords" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">symmetric_coords</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">symmetric_coords</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return a view of the symmetric Coords</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.symmetric_coords_split" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">symmetric_coords_split</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">symmetric_coords_split</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>A view of the symmetric coords split at different symmetric models</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.center_of_mass_symmetric" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">center_of_mass_symmetric</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">center_of_mass_symmetric</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The center of mass for the symmetric system with shape (3,)</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetryOpsMixin.center_of_mass_symmetric_models" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">center_of_mass_symmetric_models</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">center_of_mass_symmetric_models</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The center of mass points for each symmetry mate in the symmetric system with shape
(number_of_symmetry_mates, 3)</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.format_biomt" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">format_biomt</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">format_biomt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the SymmetricModel expand_matrices as a BIOMT record</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>str</code>
        
        <div class="doc-md-description">
          <p>The BIOMT REMARK 350 with PDB file formatting</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_biomt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the SymmetricModel expand_matrices as a BIOMT record</span>

<span class="sd">    Returns:</span>
<span class="sd">        The BIOMT REMARK 350 with PDB file formatting</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="s1">&#39;REMARK 350   BIOMT</span><span class="si">{:1d}{:4d}{:10.6f}{:10.6f}{:10.6f}{:15.5f}</span><span class="s1">            &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">v_idx</span><span class="p">,</span> <span class="n">m_idx</span><span class="p">,</span> <span class="o">*</span><span class="n">vec</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">m_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_matrices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_translations</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">v_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">tx</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.format_header" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">format_header</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">format_header</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns any super().format_header() along with the BIOMT record</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>str</code>
        
        <div class="doc-md-description">
          <p>The .pdb file header string</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns any super().format_header() along with the BIOMT record</span>

<span class="sd">    Returns:</span>
<span class="sd">        The .pdb file header string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">format_header</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_biomt</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.set_symmetry" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_symmetry</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">set_symmetry</span><span class="p">(</span><span class="n">sym_entry</span><span class="p">:</span> <span class="n"><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span></span> <span class="o">|</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">crystal</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cryst_record</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Set the model symmetry using the CRYST1 record, or the unit cell dimensions and the Hermann-Mauguin symmetry
notation (in CRYST1 format, ex P432) for the Model assembly. If the assembly is a point group, only the symmetry
notation is required</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>sym_entry</code></b>
            (<code><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span> | int</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The SymEntry which specifies all symmetry parameters</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>symmetry</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The name of a symmetry to be searched against compatible symmetries</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>crystal</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether crystalline symmetry should be used</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>cryst_record</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>If a CRYST1 record is known and should be used</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>uc_dimensions</code></b>
            (<code>list[float]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The unit cell dimensions for the crystalline symmetry</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym_entry</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">SymEntry</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">crystal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cryst_record</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the model symmetry using the CRYST1 record, or the unit cell dimensions and the Hermann-Mauguin symmetry</span>
<span class="sd">    notation (in CRYST1 format, ex P432) for the Model assembly. If the assembly is a point group, only the symmetry</span>
<span class="sd">    notation is required</span>

<span class="sd">    Args:</span>
<span class="sd">        sym_entry: The SymEntry which specifies all symmetry parameters</span>
<span class="sd">        symmetry: The name of a symmetry to be searched against compatible symmetries</span>
<span class="sd">        crystal: Whether crystalline symmetry should be used</span>
<span class="sd">        cryst_record: If a CRYST1 record is known and should be used</span>
<span class="sd">        uc_dimensions: The unit cell dimensions for the crystalline symmetry</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Try to solve for symmetry as uc_dimensions are needed for cryst ops, if available</span>
    <span class="n">crystal_symmetry</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">symmetry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Ensure conversion to HermannMauguin notation. ex: P23 not P 2 3</span>
        <span class="n">symmetry</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">symmetry</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">cryst_record</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cryst_record</span> <span class="o">=</span> <span class="n">cryst_record</span>
        <span class="n">crystal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cryst_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cryst_record</span>  <span class="c1"># Populated above or from file parsing</span>
        <span class="k">if</span> <span class="n">uc_dimensions</span> <span class="ow">and</span> <span class="n">symmetry</span><span class="p">:</span>
            <span class="n">crystal_symmetry</span> <span class="o">=</span> <span class="n">symmetry</span>
            <span class="n">crystal</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">cryst_record</span><span class="p">:</span>  <span class="c1"># Populated above or from file parsing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Parsed record: </span><span class="si">{</span><span class="n">cryst_record</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uc_dimensions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">symmetry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Only if didn&#39;t provide either</span>
            <span class="n">uc_dimensions</span><span class="p">,</span> <span class="n">crystal_symmetry</span> <span class="o">=</span> <span class="n">parse_cryst_record</span><span class="p">(</span><span class="n">cryst_record</span><span class="p">)</span>
            <span class="n">crystal_symmetry</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">crystal_symmetry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found uc_dimensions=</span><span class="si">{</span><span class="n">uc_dimensions</span><span class="si">}</span><span class="s1">, symmetry=</span><span class="si">{</span><span class="n">crystal_symmetry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">crystal</span><span class="p">:</span>  <span class="c1"># CRYST in symmetry.upper():</span>
        <span class="k">if</span> <span class="n">sym_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sym_entry</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">CrystRecord</span>

    <span class="n">number_of_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span>
    <span class="k">if</span> <span class="n">sym_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sym_entry</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">SymEntry</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sym_entry</span><span class="o">.</span><span class="n">needs_cryst_record</span><span class="p">():</span>  <span class="c1"># Replace with relevant info from the CRYST1 record</span>
                <span class="k">if</span> <span class="n">sym_entry</span><span class="o">.</span><span class="n">is_token</span><span class="p">():</span>
                    <span class="c1"># Create a new SymEntry</span>
                    <span class="n">sym_entry</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">CrystSymEntry</span><span class="p">(</span>
                        <span class="n">space_group</span><span class="o">=</span><span class="n">crystal_symmetry</span><span class="p">,</span>
                        <span class="n">sym_map</span><span class="o">=</span><span class="p">[</span><span class="n">crystal_symmetry</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;C1&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_entities</span><span class="p">)])</span>
                    <span class="c1"># Set the uc_dimensions as they must be parsed or provided</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Setting </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">.sym_entry to new crystalline symmetry </span><span class="si">{</span><span class="n">sym_entry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">sym_entry</span><span class="o">.</span><span class="n">resulting_symmetry</span> <span class="o">==</span> <span class="n">crystal_symmetry</span><span class="p">:</span>
                    <span class="c1"># This is already the specified SymEntry, use the CRYST record to set cryst_record</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Setting </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">.sym_entry to </span><span class="si">{</span><span class="n">sym_entry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The parsed CRYST record with symmetry &#39;</span><span class="si">{</span><span class="n">crystal_symmetry</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t match the symmetry &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">sym_entry</span><span class="o">.</span><span class="n">resulting_symmetry</span><span class="si">}</span><span class="s2">&#39; specified by the provided </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">sym_entry</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="n">sym_entry</span><span class="o">.</span><span class="n">uc_dimensions</span> <span class="o">=</span> <span class="n">uc_dimensions</span>
                <span class="n">sym_entry</span><span class="o">.</span><span class="n">cryst_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cryst_record</span>
            <span class="c1"># else:  # SymEntry is set up properly</span>
            <span class="c1">#     self.sym_entry = sym_entry</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Try to solve using sym_entry as integer and any info in symmetry.</span>
            <span class="n">sym_entry</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">parse_symmetry_to_sym_entry</span><span class="p">(</span>
                <span class="n">sym_entry_number</span><span class="o">=</span><span class="n">sym_entry</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">symmetry</span><span class="p">:</span>  <span class="c1"># Provided without uc_dimensions, crystal=True, or cryst_record. Assuming point group</span>
        <span class="n">sym_entry</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">parse_symmetry_to_sym_entry</span><span class="p">(</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">,</span>
            <span class="c1"># The below fails as most of the time entity.symmetry isn&#39;t set up at this point</span>
            <span class="c1"># sym_map=[symmetry] + [entity.symmetry for entity in self.entities]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># No symmetry was provided</span>
        <span class="c1"># self.sym_entry/self.symmetry can be None</span>
        <span class="k">return</span>

    <span class="c1"># Ensure the number of Entity instances matches the SymEntry groups</span>
    <span class="n">n_groups</span> <span class="o">=</span> <span class="n">sym_entry</span><span class="o">.</span><span class="n">number_of_groups</span>
    <span class="k">if</span> <span class="n">number_of_entities</span> <span class="o">!=</span> <span class="n">n_groups</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n_groups</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">verb</span> <span class="o">=</span> <span class="s1">&#39;was&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verb</span> <span class="o">=</span> <span class="s1">&#39;were&#39;</span>

        <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="n">number_of_entities</span><span class="si">}</span><span class="s1"> entities. &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_groups</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">verb</span><span class="si">}</span><span class="s1"> expected based on the </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">sym_entry</span><span class="p">)</span><span class="si">}</span><span class="s1"> specified&#39;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sym_entry</span> <span class="o">=</span> <span class="n">sym_entry</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.reset_mates" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">reset_mates</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">reset_mates</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Remove oligomeric chains. They should be generated fresh</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset_mates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove oligomeric chains. They should be generated fresh&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.is_surrounding_uc" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">is_surrounding_uc</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_surrounding_uc</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns True if the current coordinates contains symmetry mates from the surrounding unit cells</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_surrounding_uc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if the current coordinates contains symmetry mates from the surrounding unit cells&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># This is True if self.number_of_symmetry_mates was set to a larger value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_uc_symmetry_mates</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.make_indices_symmetric" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">make_indices_symmetric</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">make_indices_symmetric</span><span class="p">(</span><span class="n">indices</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n">int</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="structure.base.atom_or_residue_literal">atom_or_residue_literal</span></span> <span class="o">=</span> <span class="s1">&#39;atom&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Extend asymmetric indices using the symmetry state across atom or residue indices</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>indices</code></b>
            (<code><span title="collections.abc.Iterable">Iterable</span>[int]</code>)
        
        <div class="doc-md-description">
          <p>The asymmetric indices to symmetrize</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>dtype</code></b>
            (<code><span title="structure.base.atom_or_residue_literal">atom_or_residue_literal</span></code>, default:
                <code>&#39;atom&#39;</code>
)
        
        <div class="doc-md-description">
          <p>The type of indices to perform symmetrization with</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[int]</code>
        
        <div class="doc-md-description">
          <p>The symmetric indices of the asymmetric input</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_indices_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">atom_or_residue_literal</span> <span class="o">=</span> <span class="s1">&#39;atom&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend asymmetric indices using the symmetry state across atom or residue indices</span>

<span class="sd">    Args:</span>
<span class="sd">        indices: The asymmetric indices to symmetrize</span>
<span class="sd">        dtype: The type of indices to perform symmetrization with</span>

<span class="sd">    Returns:</span>
<span class="sd">        The symmetric indices of the asymmetric input</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">jump_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;number_of_</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The dtype &#39;number_of_</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&#39; wasn&#39;t found in the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object. &quot;</span>
            <span class="s2">&quot;&#39;Possible values of dtype are &#39;atom&#39; or &#39;residue&#39;&quot;</span><span class="p">)</span>

    <span class="n">model_jumps</span> <span class="o">=</span> <span class="p">[</span><span class="n">jump_size</span> <span class="o">*</span> <span class="n">model_num</span> <span class="k">for</span> <span class="n">model_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="n">model_jump</span> <span class="k">for</span> <span class="n">model_jump</span> <span class="ow">in</span> <span class="n">model_jumps</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.return_symmetric_copies" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">return_symmetric_copies</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">return_symmetric_copies</span><span class="p">(</span><span class="n">structure</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.base.StructureBase" href="../base/#structure.base.StructureBase">StructureBase</a></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.StructureBase" href="../base/#structure.base.StructureBase">StructureBase</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Expand the provided Structure using self.symmetry for the symmetry specification</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>structure</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.base.StructureBase" href="../base/#structure.base.StructureBase">StructureBase</a></code>)
        
        <div class="doc-md-description">
          <p>A StructureBase instance containing .coords method/attribute</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[<a class="autorefs autorefs-internal" title="structure.base.StructureBase" href="../base/#structure.base.StructureBase">StructureBase</a>]</code>
        
        <div class="doc-md-description">
          <p>The symmetric copies of the input structure</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">return_symmetric_copies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">StructureBase</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructureBase</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand the provided Structure using self.symmetry for the symmetry specification</span>

<span class="sd">    Args:</span>
<span class="sd">        structure: A StructureBase instance containing .coords method/attribute</span>

<span class="sd">    Returns:</span>
<span class="sd">        The symmetric copies of the input structure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number_of_symmetry_mates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>
    <span class="n">sym_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_symmetric_coords</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

    <span class="n">sym_mates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coord_set</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sym_coords</span><span class="p">,</span> <span class="n">number_of_symmetry_mates</span><span class="p">):</span>
        <span class="n">symmetry_mate</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">symmetry_mate</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">coord_set</span>
        <span class="n">sym_mates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symmetry_mate</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sym_mates</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.generate_symmetric_coords" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">generate_symmetric_coords</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">generate_symmetric_coords</span><span class="p">(</span><span class="n">surrounding_uc</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Expand the asu using self.symmetry for the symmetry specification, and optional unit cell dimensions if
self.dimension &gt; 0. Expands assembly to complete point group, unit cell, or surrounding unit cells</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>surrounding_uc</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether the 3x3 layer group, or 3x3x3 space group should be generated</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_symmetric_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand the asu using self.symmetry for the symmetry specification, and optional unit cell dimensions if</span>
<span class="sd">    self.dimension &gt; 0. Expands assembly to complete point group, unit cell, or surrounding unit cells</span>

<span class="sd">    Args:</span>
<span class="sd">        surrounding_uc: Whether the 3x3 layer group, or 3x3x3 space group should be generated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Generating symmetric coords&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">surrounding_uc</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">uc_number</span> <span class="o">=</span> <span class="mi">27</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">uc_number</span> <span class="o">=</span> <span class="mi">9</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">assert_never</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>
            <span class="c1"># Set the number_of_symmetry_mates to account for the unit cell number</span>
            <span class="c1"># This results in is_surrounding_uc() being True during return_symmetric_coords()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_symmetry_mates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_uc_symmetry_mates</span> <span class="o">*</span> <span class="n">uc_number</span>

    <span class="c1"># Set the self.symmetric_coords property</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric_coords</span> <span class="o">=</span> <span class="n">Coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_symmetric_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.cart_to_frac" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">cart_to_frac</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">cart_to_frac</span><span class="p">(</span><span class="n">cart_coords</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span> <span class="o">|</span> <span class="n">int</span> <span class="o">|</span> <span class="n">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return fractional coordinates from cartesian coordinates
From http://www.ruppweb.org/Xray/tutorial/Coordinate%20system%20transformation.htm</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>cart_coords</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | <span title="collections.abc.Iterable">Iterable</span> | int | float</code>)
        
        <div class="doc-md-description">
          <p>The cartesian coordinates of a unit cell</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="numpy.ndarray">ndarray</span></code>
        
        <div class="doc-md-description">
          <p>The fractional coordinates of a unit cell</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cart_to_frac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cart_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Iterable</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return fractional coordinates from cartesian coordinates</span>
<span class="sd">    From http://www.ruppweb.org/Xray/tutorial/Coordinate%20system%20transformation.htm</span>

<span class="sd">    Args:</span>
<span class="sd">        cart_coords: The cartesian coordinates of a unit cell</span>

<span class="sd">    Returns:</span>
<span class="sd">        The fractional coordinates of a unit cell</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uc_dimensions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Can&#39;t manipulate the unit cell. No unit cell dimensions were passed&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">cart_coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sym_entry</span><span class="o">.</span><span class="n">deorthogonalization_matrix</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.frac_to_cart" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">frac_to_cart</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">frac_to_cart</span><span class="p">(</span><span class="n">frac_coords</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span> <span class="o">|</span> <span class="n">int</span> <span class="o">|</span> <span class="n">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return cartesian coordinates from fractional coordinates
From http://www.ruppweb.org/Xray/tutorial/Coordinate%20system%20transformation.htm</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>frac_coords</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | <span title="collections.abc.Iterable">Iterable</span> | int | float</code>)
        
        <div class="doc-md-description">
          <p>The fractional coordinates of a unit cell</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="numpy.ndarray">ndarray</span></code>
        
        <div class="doc-md-description">
          <p>The cartesian coordinates of a unit cell</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">frac_to_cart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frac_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Iterable</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return cartesian coordinates from fractional coordinates</span>
<span class="sd">    From http://www.ruppweb.org/Xray/tutorial/Coordinate%20system%20transformation.htm</span>

<span class="sd">    Args:</span>
<span class="sd">        frac_coords: The fractional coordinates of a unit cell</span>

<span class="sd">    Returns:</span>
<span class="sd">        The cartesian coordinates of a unit cell</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uc_dimensions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Can&#39;t manipulate the unit cell. No unit cell dimensions were passed&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">frac_coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sym_entry</span><span class="o">.</span><span class="n">orthogonalization_matrix</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.return_symmetric_coords" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">return_symmetric_coords</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">return_symmetric_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n">list</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Provided an input set of coordinates, return the symmetrized coordinates corresponding to the SymmetricModel</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>coords</code></b>
            (<code>list | <span title="numpy.ndarray">ndarray</span></code>)
        
        <div class="doc-md-description">
          <p>The coordinates to symmetrize</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="numpy.ndarray">ndarray</span></code>
        
        <div class="doc-md-description">
          <p>The symmetrized coordinates</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">return_symmetric_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provided an input set of coordinates, return the symmetrized coordinates corresponding to the SymmetricModel</span>

<span class="sd">    Args:</span>
<span class="sd">        coords: The coordinates to symmetrize</span>

<span class="sd">    Returns:</span>
<span class="sd">        The symmetrized coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># surrounding_uc: bool = True</span>
    <span class="c1">#   surrounding_uc: Whether the 3x3 layer group, or 3x3x3 space group should be generated</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_surrounding_uc</span><span class="p">():</span>
            <span class="n">shift_3d</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">z_shifts</span> <span class="o">=</span> <span class="n">shift_3d</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">z_shifts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">assert_never</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>

            <span class="n">uc_frac_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_unit_cell_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">fractional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">surrounding_frac_coords</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">uc_frac_coords</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shift_3d</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">shift_3d</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">z_shifts</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_to_cart</span><span class="p">(</span><span class="n">surrounding_frac_coords</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_unit_cell_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># self.dimension = 0 or None</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.return_unit_cell_coords" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">return_unit_cell_coords</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">return_unit_cell_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">,</span> <span class="n">fractional</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the unit cell coordinates from a set of coordinates for the specified SymmetricModel</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>coords</code></b>
            (<code><span title="numpy.ndarray">ndarray</span></code>)
        
        <div class="doc-md-description">
          <p>The cartesian coordinates to expand to the unit cell</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>fractional</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to return coordinates in fractional or cartesian (False) unit cell frame</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="numpy.ndarray">ndarray</span></code>
        
        <div class="doc-md-description">
          <p>All unit cell coordinates</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">return_unit_cell_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fractional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the unit cell coordinates from a set of coordinates for the specified SymmetricModel</span>

<span class="sd">    Args:</span>
<span class="sd">        coords: The cartesian coordinates to expand to the unit cell</span>
<span class="sd">        fractional: Whether to return coordinates in fractional or cartesian (False) unit cell frame</span>

<span class="sd">    Returns:</span>
<span class="sd">        All unit cell coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cart_to_frac</span><span class="p">(</span><span class="n">coords</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_uc_symmetry_mates</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fractional</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model_coords</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_to_cart</span><span class="p">(</span><span class="n">model_coords</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.find_contacting_asu" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">find_contacting_asu</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">find_contacting_asu</span><span class="p">(</span><span class="n">distance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Find the maximally contacting symmetry mate for each Entity and return the corresponding Entity instances</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
            (<code>float</code>, default:
                <code>8.0</code>
)
        
        <div class="doc-md-description">
          <p>The distance to check for contacts</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[<a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a>]</code>
        
        <div class="doc-md-description">
          <p>The minimal set of Entities containing the maximally touching configuration</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_contacting_asu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Entity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the maximally contacting symmetry mate for each Entity and return the corresponding Entity instances</span>

<span class="sd">    Args:</span>
<span class="sd">        distance: The distance to check for contacts</span>

<span class="sd">    Returns:</span>
<span class="sd">        The minimal set of Entities containing the maximally touching configuration</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entities</span><span class="p">:</span>
        <span class="c1"># The SymmetricModel was probably set without them. Create them, then try to find the asu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_entities</span><span class="p">()</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span>

    <span class="n">number_of_entities</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">number_of_entities</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>
        <span class="n">chain_combinations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Entity</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">entity_combinations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Entity</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">contact_count</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">,</span> <span class="n">combinations</span><span class="p">((</span><span class="n">entity</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">),</span> <span class="mi">2</span><span class="p">))))</span>
        <span class="k">for</span> <span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">chain1</span> <span class="ow">in</span> <span class="n">entity1</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
                <span class="n">chain_cb_coord_tree</span> <span class="o">=</span> <span class="n">BallTree</span><span class="p">(</span><span class="n">chain1</span><span class="o">.</span><span class="n">cb_coords</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">chain2</span> <span class="ow">in</span> <span class="n">entity2</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
                    <span class="n">entity_combinations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">))</span>
                    <span class="n">chain_combinations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">chain1</span><span class="p">,</span> <span class="n">chain2</span><span class="p">))</span>
                    <span class="n">contact_count</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="n">chain_cb_coord_tree</span><span class="o">.</span><span class="n">two_point_correlation</span><span class="p">(</span><span class="n">chain2</span><span class="o">.</span><span class="n">cb_coords</span><span class="p">,</span> <span class="p">[</span><span class="n">distance</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">max_contact_idx</span> <span class="o">=</span> <span class="n">contact_count</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
        <span class="n">additional_chains</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_chains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain_combinations</span><span class="p">[</span><span class="n">max_contact_idx</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_chains</span><span class="p">)</span> <span class="o">!=</span> <span class="n">number_of_entities</span><span class="p">:</span>  <span class="c1"># We found 2 entities at this point</span>
            <span class="c1"># find the indices where either of the maximally contacting chains are utilized</span>
            <span class="n">selected_chain_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chain_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chain_combinations</span><span class="p">)</span>
                                      <span class="k">if</span> <span class="n">max_chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chain_pair</span> <span class="ow">or</span> <span class="n">max_chains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chain_pair</span><span class="p">}</span>
            <span class="n">remaining_entities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">entity_combinations</span><span class="p">[</span><span class="n">max_contact_idx</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">remaining_entities</span><span class="p">:</span>  <span class="c1"># get the max contacts and the associated entity and chain indices</span>
                <span class="c1"># find the indices where the missing entity is utilized</span>
                <span class="n">remaining_indices</span> <span class="o">=</span> \
                    <span class="p">{</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">entity_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entity_combinations</span><span class="p">)</span> <span class="k">if</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entity_pair</span><span class="p">}</span>
                <span class="c1"># pair_position = [0 if entity_pair[0] == entity else 1</span>
                <span class="c1">#                  for idx, entity_pair in enumerate(entity_combinations) if entity in entity_pair]</span>
                <span class="c1"># only use those where found asu chains already occur</span>
                <span class="n">viable_remaining_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">remaining_indices</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">selected_chain_indices</span><span class="p">))</span>
                <span class="c1"># out of the viable indices where the selected chains are matched with the missing entity,</span>
                <span class="c1"># find the highest contact</span>
                <span class="n">max_idx</span> <span class="o">=</span> <span class="n">contact_count</span><span class="p">[</span><span class="n">viable_remaining_indices</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">entity_idx</span><span class="p">,</span> <span class="n">entity_in_combo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                        <span class="n">entity_combinations</span><span class="p">[</span><span class="n">viable_remaining_indices</span><span class="p">[</span><span class="n">max_idx</span><span class="p">]]):</span>
                    <span class="k">if</span> <span class="n">entity</span> <span class="o">==</span> <span class="n">entity_in_combo</span><span class="p">:</span>
                        <span class="n">additional_chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain_combinations</span><span class="p">[</span><span class="n">viable_remaining_indices</span><span class="p">[</span><span class="n">max_idx</span><span class="p">]][</span><span class="n">entity_idx</span><span class="p">])</span>

        <span class="n">new_entities</span> <span class="o">=</span> <span class="n">max_chains</span> <span class="o">+</span> <span class="n">additional_chains</span>
        <span class="c1"># Rearrange the entities to have the same order as provided</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_entity</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span> <span class="k">for</span> <span class="n">new_entity</span> <span class="ow">in</span> <span class="n">new_entities</span> <span class="k">if</span> <span class="n">entity</span> <span class="o">==</span> <span class="n">new_entity</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">entities</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.get_contacting_asu" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_contacting_asu</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_contacting_asu</span><span class="p">(</span><span class="n">distance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.SymmetricModel" href="#structure.model.SymmetricModel">SymmetricModel</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Find the maximally contacting symmetry mate for each Entity and return the corresponding Entity instances as
 a new Pose</p>
<p>If the chain IDs of the asu are the same, then chain IDs will automatically be renamed</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
            (<code>float</code>, default:
                <code>8.0</code>
)
        
        <div class="doc-md-description">
          <p>The distance to check for contacts</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="structure.model.SymmetricModel" href="#structure.model.SymmetricModel">SymmetricModel</a></code>
        
        <div class="doc-md-description">
          <p>A new Model with the minimal set of Entity instances. Will also be symmetric</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_contacting_asu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SymmetricModel</span><span class="p">:</span>  <span class="c1"># Todo -&gt; Self python 3.11</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the maximally contacting symmetry mate for each Entity and return the corresponding Entity instances as</span>
<span class="sd">     a new Pose</span>

<span class="sd">    If the chain IDs of the asu are the same, then chain IDs will automatically be renamed</span>

<span class="sd">    Args:</span>
<span class="sd">        distance: The distance to check for contacts</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new Model with the minimal set of Entity instances. Will also be symmetric</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_contacting_asu</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">({</span><span class="n">entity</span><span class="o">.</span><span class="n">chain_id</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">})</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">):</span>
        <span class="n">rename</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rename</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># assert cls is Pose, f&quot;Can&#39;t {self.get_contacting_asu.__name__} for the class={cls}. Only for Pose&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_entities</span><span class="p">(</span>
        <span class="n">entities</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">-asu&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">sym_entry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sym_entry</span><span class="p">,</span> <span class="n">rename_chains</span><span class="o">=</span><span class="n">rename</span><span class="p">,</span>
        <span class="n">cryst_record</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cryst_record</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># , biomt_header=self.format_biomt(),</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetryOpsMixin.set_contacting_asu" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_contacting_asu</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">set_contacting_asu</span><span class="p">(</span><span class="n">from_assembly</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Find the maximally contacting symmetry mate for each Entity, then set the Pose with this info</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>from_assembly</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether the ASU should be set fresh from the entire assembly instances</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8.0 - The distance to check for contacts</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self: To a SymmetricModel with the minimal set of Entities containing the maximally touching configuration</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_contacting_asu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_assembly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the maximally contacting symmetry mate for each Entity, then set the Pose with this info</span>

<span class="sd">    Args:</span>
<span class="sd">        from_assembly: Whether the ASU should be set fresh from the entire assembly instances</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        distance: float = 8.0 - The distance to check for contacts</span>

<span class="sd">    Sets:</span>
<span class="sd">        self: To a SymmetricModel with the minimal set of Entities containing the maximally touching configuration</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number_of_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">set_contacting_asu</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">() with the asymmetric </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">number_of_entities</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>  <span class="c1"># This can&#39;t be set any better</span>

    <span class="c1"># Check to see if the parsed Model is already represented symmetrically</span>
    <span class="k">if</span> <span class="n">from_assembly</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_dependent_chains</span><span class="p">():</span>  <span class="c1"># and self.is_asymmetric_mates() and not preserve_asymmetry:</span>
        <span class="c1"># If .from_chains() or .from_file(), ensure the SymmetricModel is an asu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Setting the </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1"> to an ASU from a symmetric representation. &#39;</span>
                       <span class="s2">&quot;This method hasn&#39;t been thoroughly debugged&quot;</span><span class="p">)</span>
        <span class="c1"># Essentially performs,</span>
        <span class="c1"># self.assign_residues_from_structures(self.entities)</span>
        <span class="c1"># however, without _assign_residues(), the containers are not updated.</span>
        <span class="c1"># Set base Structure attributes</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_residues</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">):</span>
            <span class="n">new_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">new_atoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
            <span class="n">new_residues</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">residues</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="n">Coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">new_coords</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_atoms</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_atoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_residue_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_residues</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_residues</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_residues</span><span class="p">)</span>

        <span class="c1"># Remove extra chains by creating fresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_chains</span><span class="p">()</span>
        <span class="c1"># Update entities to reflect new indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_structures_states</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span>
        <span class="c1"># Recurse this call to ensure that the entities are contacting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_contacting_asu</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     raise SymmetryError(</span>
        <span class="c1">#         f&quot;Couldn&#39;t {self.set_contacting_asu.__name__}() with the number of parsed chains, &quot;</span>
        <span class="c1">#         f&quot;{self.number_of_chains}. When symmetry={self.symmetry} and the number of entities is &quot;</span>
        <span class="c1">#         f&quot;{self.number_of_entities}, the number of symmetric chains should be &quot;</span>
        <span class="c1">#         f&#39;{number_of_entities * self.number_of_symmetry_mates}&#39;</span>
        <span class="c1">#     )</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># number_of_entities == number_of_chains:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Finding the ASU with the most contacting interface&#39;</span><span class="p">)</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_contacting_asu</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># With perfect symmetry, v this is sufficient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_reset</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">entity</span><span class="o">.</span><span class="n">coords</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">])</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_reset</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.Chain" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Chain</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">Chain</span><span class="p">(</span><span class="n">chain_id</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.Structure" href="#structure.model.Structure">Structure</a></code>, <code><a class="autorefs autorefs-internal" title="structure.model.MetricsMixin" href="#structure.model.MetricsMixin">MetricsMixin</a></code></p>

  
      <p>A grouping of Atom, Coordinates, and Residue instances, typically from a connected polymer</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>chain_id</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The name of the Chain identifier to use for this instance</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>name</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The name of the Chain identifier to use for this instance. Typically used by Entity subclasses.</p>
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        chain_id: The name of the Chain identifier to use for this instance</span>
<span class="sd">        name: The name of the Chain identifier to use for this instance. Typically used by Entity subclasses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">chain_id</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># Chain</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Chain</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Only if this instance is a Chain, not Entity, set the chain_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chain_id</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Chain.chain_id" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">chain_id</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">chain_id</span><span class="p">:</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Chain ID for the instance</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Chain.entity" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">entity</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entity</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Entity associated with the instance</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Chain.entity_id" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">entity_id</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entity_id</span><span class="p">:</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Entity ID associated with the instance</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Chain.reference_sequence" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">reference_sequence</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">reference_sequence</span><span class="p">:</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the entire sequence, constituting all described residues, not just structurally modeled ones</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>str</code>
        
        <div class="doc-md-description">
          <p>The sequence according to the Entity reference, or the Structure sequence if no reference available</p>
      </div>
      </li>
  </ul>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.Chain.calculate_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">calculate_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> doesn&#39;t calculate anything yet...&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="c1"># &#39;name&#39;: self.name,</span>
        <span class="c1"># &#39;n_terminal_helix&#39;: self.is_termini_helical(),</span>
        <span class="c1"># &#39;c_terminal_helix&#39;: self.is_termini_helical(termini=&#39;c&#39;),</span>
        <span class="c1"># &#39;thermophile&#39;: thermophile</span>
        <span class="c1"># &#39;number_of_residues&#39;: self.number_of_residues,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.Entity" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Entity</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">Entity</span><span class="p">(</span><span class="n">operators</span><span class="p">:</span> <span class="n">tuple</span><span class="p">[</span><span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]],</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotations</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translations</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.SymmetryOpsMixin" href="#structure.model.SymmetryOpsMixin">SymmetryOpsMixin</a></code>, <code><a class="autorefs autorefs-internal" title="structure.model.ContainsChains" href="#structure.model.ContainsChains">ContainsChains</a></code>, <code><a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a></code></p>

  
      <p>Maps a biological instance of a Structure which ContainsChains(1-N) and is a Complex, to a single GeneProduct</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>operators</code></b>
            (<code>tuple[<span title="numpy.ndarray">ndarray</span> | list[list[float]], <span title="numpy.ndarray">ndarray</span> | list[float]] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A set of symmetry operations to designate how to apply symmetry</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rotations</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list[list[float]]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A set of rotation matrices used to recapitulate the SymmetricModel from the asymmetric unit</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>translations</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list[float]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A set of translation vectors used to recapitulate the SymmetricModel from the asymmetric unit</p>
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span>
<span class="normal">3257</span>
<span class="normal">3258</span>
<span class="normal">3259</span>
<span class="normal">3260</span>
<span class="normal">3261</span>
<span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span>
<span class="normal">3273</span>
<span class="normal">3274</span>
<span class="normal">3275</span>
<span class="normal">3276</span>
<span class="normal">3277</span>
<span class="normal">3278</span>
<span class="normal">3279</span>
<span class="normal">3280</span>
<span class="normal">3281</span>
<span class="normal">3282</span>
<span class="normal">3283</span>
<span class="normal">3284</span>
<span class="normal">3285</span>
<span class="normal">3286</span>
<span class="normal">3287</span>
<span class="normal">3288</span>
<span class="normal">3289</span>
<span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span>
<span class="normal">3304</span>
<span class="normal">3305</span>
<span class="normal">3306</span>
<span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span>
<span class="normal">3310</span>
<span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span>
<span class="normal">3314</span>
<span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span>
<span class="normal">3318</span>
<span class="normal">3319</span>
<span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">operators</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">rotations</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translations</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="c1"># transformations: list[types.TransformationMapping] = None, surrounding_uc: bool = True,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;When init occurs chain_ids are set if chains were passed. If not, then they are auto generated</span>

<span class="sd">    Args:</span>
<span class="sd">        operators: A set of symmetry operations to designate how to apply symmetry</span>
<span class="sd">        rotations: A set of rotation matrices used to recapitulate the SymmetricModel from the asymmetric unit</span>
<span class="sd">        translations: A set of translation vectors used to recapitulate the SymmetricModel from the asymmetric unit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_captain</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># Entity</span>
                     <span class="n">as_mates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># &lt;- needed when .from_file() w/ self.is_parent()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_captain</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_chain</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mate_rotation_axes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">chains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">chains</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DesignError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Can&#39;t construct </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> instance without &#39;chains&#39;. &quot;</span>
            <span class="s2">&quot;Ensure that you didn&#39;t construct with chains=False | None&quot;</span>
        <span class="p">)</span>

    <span class="n">representative</span><span class="p">,</span> <span class="o">*</span><span class="n">additional_chains</span> <span class="o">=</span> <span class="n">chains</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_parent</span><span class="p">():</span>
        <span class="c1"># When this instance is the parent (.from_file(), .from_chains(parent=None))</span>
        <span class="c1"># Set attributes from representative now that _chains is parsed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">representative</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_residues</span><span class="p">(</span><span class="n">representative</span><span class="o">.</span><span class="n">residues</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">representative</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>

    <span class="c1"># Set up the chain copies</span>
    <span class="n">number_of_symmetry_mates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span>
    <span class="n">symmetry</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">number_of_symmetry_mates</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
            <span class="n">symmetry</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;D</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">number_of_symmetry_mates</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cyclic</span><span class="p">():</span>
            <span class="n">symmetry</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;C</span><span class="si">{</span><span class="n">number_of_symmetry_mates</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Higher than D, probably T, O, I, or asymmetric</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">symmetry</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">subunit_number_to_symmetry</span><span class="p">[</span><span class="n">number_of_symmetry_mates</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t find a compatible symmetry for the Entity with &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">number_of_symmetry_mates</span><span class="si">}</span><span class="s2"> chain copies&quot;</span><span class="p">)</span>
                <span class="c1"># symmetry = None</span>
                <span class="c1"># self.symmetry = &quot;Unknown-symmetry&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_symmetry</span><span class="p">(</span><span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="c1"># No symmetry keyword args were passed</span>
        <span class="k">if</span> <span class="n">operators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">translations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">passed_args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">operators</span><span class="p">:</span>
                <span class="n">passed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;operators&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rotations</span><span class="p">:</span>
                <span class="n">passed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">translations</span><span class="p">:</span>
                <span class="n">passed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ConstructionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t set_symmetry() using </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">passed_args</span><span class="p">)</span><span class="si">}</span><span class="s2"> without explicitly passing &quot;</span>
                <span class="s2">&quot;&#39;symmetry&#39; or &#39;sym_entry&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Set rotations and translations to the correct symmetry operations</span>
    <span class="c1"># where operators, rotations, and translations are user provided from some sort of BIOMT (fiber, other)</span>
    <span class="k">if</span> <span class="n">operators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">symmetry_source_arg</span> <span class="o">=</span> <span class="s2">&quot;&#39;operators&#39; &quot;</span>

        <span class="n">num_operators</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">operators</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operators</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">num_operators</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Providing custom symmetry &#39;operators&#39; may result in improper symmetric &quot;</span>
                             <span class="s1">&#39;configuration. Proceed with caution&#39;</span><span class="p">)</span>
            <span class="n">rotations</span><span class="p">,</span> <span class="n">translations</span> <span class="o">=</span> <span class="n">operators</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operators</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="n">num_operators</span> <span class="o">==</span> <span class="n">number_of_symmetry_mates</span><span class="p">:</span>
            <span class="n">rotations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">translations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rot</span><span class="p">,</span> <span class="n">tx</span> <span class="ow">in</span> <span class="n">operators</span><span class="p">:</span>
                    <span class="n">rotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
                    <span class="n">translations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># Unpack failed</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t parse the &#39;operators&#39;=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">operators</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;Expected a Sequence[rotation shape=(3,3). translation shape=(3,)] pairs.&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operators</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">operators</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="c1"># Parse from a single input of 3 row by 4 column style, like BIOMT</span>
                <span class="n">rotations</span> <span class="o">=</span> <span class="n">operators</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">translations</span> <span class="o">=</span> <span class="n">operators</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">operators</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Assume just rotations</span>
                <span class="n">rotations</span> <span class="o">=</span> <span class="n">operators</span>
                <span class="n">translations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rotations</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConstructionError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The &#39;operators&#39; form </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">operators</span><span class="p">)</span><span class="si">}</span><span class="s2"> isn&#39;t supported.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConstructionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The &#39;operators&#39; form </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">operators</span><span class="p">)</span><span class="si">}</span><span class="s2"> isn&#39;t supported. Must provide a tuple of &quot;</span>
                <span class="s1">&#39;array-like objects with the order (rotation matrices, translation vectors) or use the &#39;</span>
                <span class="s2">&quot;&#39;rotations&#39; and &#39;translations&#39; keyword args&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">symmetry_source_arg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Now that symmetry is set, check if the Structure parsed all symmetric chains</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span> <span class="o">*</span> <span class="n">number_of_symmetry_mates</span><span class="p">:</span>
        <span class="n">parsed_assembly</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parsed_assembly</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set the symmetry operations</span>
    <span class="k">if</span> <span class="n">rotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">translations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotations</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">rotations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">rotations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rotations</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># Assume operators were provided in a standard orientation and transpose for subsequent efficiency</span>
            <span class="c1"># Using .swapaxes(-2, -1) call here instead of .transpose() for safety</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">rotations</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">symmetry_source_arg</span><span class="si">}</span><span class="s2">rotation matrices with 3 dimensions, not </span><span class="si">{</span><span class="n">rotations</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;dimensions. Ensure the passed rotation matrices have a shape of (N symmetry operations, 3, 3)&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">translations</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">translations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">translations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">translations</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Assume operators were provided in a standard orientation each vector needs to be in own array on dim=2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="n">translations</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">symmetry_source_arg</span><span class="si">}</span><span class="s2">translation vectors with 2 dimensions, not </span><span class="si">{</span><span class="n">translations</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;dimensions. Ensure the passed translations have a shape of (N symmetry operations, 3)&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">symmetry_source_arg</span> <span class="o">=</span> <span class="s2">&quot;&#39;chains&#39; &quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># The _expand_matrices rotation matrices are pre-transposed to avoid repetitive operations</span>
            <span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">point_group_symmetry_operatorsT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">]</span>
            <span class="c1"># The _expand_translations vectors are pre-sliced to enable numpy operations</span>
            <span class="n">_expand_translations</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_symmetry_mates</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>

            <span class="k">if</span> <span class="n">parsed_assembly</span><span class="p">:</span>
                <span class="c1"># The Structure should have symmetric chains</span>
                <span class="c1"># This routine is essentially orient(). However, with one Entity, no extra need for orient</span>
                <span class="n">_expand_matrices</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">identity_matrix</span><span class="p">]</span>
                <span class="n">_expand_translations</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">]</span>
                <span class="n">self_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
                <span class="n">ca_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca_coords</span>
                <span class="c1"># Todo match this mechanism with the symmetric chain index</span>
                <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">additional_chains</span><span class="p">:</span>
                    <span class="n">chain_seq</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">sequence</span>
                    <span class="n">additional_chain_coords</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">ca_coords</span>
                    <span class="n">first_chain_coords</span> <span class="o">=</span> <span class="n">ca_coords</span>
                    <span class="k">if</span> <span class="n">chain_seq</span> <span class="o">!=</span> <span class="n">self_seq</span><span class="p">:</span>
                        <span class="c1"># Get aligned indices, then follow with superposition</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1"> require alignment to symmetrize&#39;</span><span class="p">)</span>
                        <span class="n">fixed_indices</span><span class="p">,</span> <span class="n">moving_indices</span> <span class="o">=</span> <span class="n">get_equivalent_indices</span><span class="p">(</span><span class="n">chain_seq</span><span class="p">,</span> <span class="n">self_seq</span><span class="p">)</span>
                        <span class="n">additional_chain_coords</span> <span class="o">=</span> <span class="n">additional_chain_coords</span><span class="p">[</span><span class="n">fixed_indices</span><span class="p">]</span>
                        <span class="n">first_chain_coords</span> <span class="o">=</span> <span class="n">first_chain_coords</span><span class="p">[</span><span class="n">moving_indices</span><span class="p">]</span>

                    <span class="n">_</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">superposition3d</span><span class="p">(</span><span class="n">additional_chain_coords</span><span class="p">,</span> <span class="n">first_chain_coords</span><span class="p">)</span>
                    <span class="n">_expand_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
                    <span class="n">_expand_translations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_expand_matrices</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_expand_translations</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">_expand_matrices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="n">_expand_translations</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> \
                <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">space_group_symmetry_operatorsT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">]</span>

    <span class="c1"># Removed parsed chain information</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_mates</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Entity.mate_rotation_axes" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">mate_rotation_axes</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">mate_rotation_axes</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">int</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]]</span> <span class="o">|</span> <span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Maps mate entities to their rotation matrix</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Entity.entity_id" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">entity_id</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entity_id</span><span class="p">:</span> <span class="n">str</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Entity ID associated with the instance</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Entity.number_of_entities" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">number_of_entities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">number_of_entities</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the number of distinct entities (Gene/Protein products) found in the PoseMetadata</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Entity.entities" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">entities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entities</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the Entity instance as a list</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Entity.chains" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">chains</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">chains</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The mate Chain instances of the instance. If not created, returns transformed copies of the instance</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Entity.assembly" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">assembly</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">assembly</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Model" href="#structure.model.Model">Model</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Access the oligomeric Structure which is a copy of the Entity plus any additional symmetric mate chains</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="structure.model.Model" href="#structure.model.Model">Model</a></code>
        
        <div class="doc-md-description">
          <p>Structures object with the underlying chains in the oligomer</p>
      </div>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Entity.max_symmetry_chain_idx" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">max_symmetry_chain_idx</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">max_symmetry_chain_idx</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The maximum symmetry order present</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Entity.max_symmetry" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">max_symmetry</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">max_symmetry</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The maximum symmetry order present</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.from_chains" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_chains</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_chains</span><span class="p">(</span><span class="n">chains</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.base.Structures" href="../base/#structure.base.Structures">Structures</a></span><span class="p">,</span> <span class="n">residue_indices</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Initialize an Entity from Chain instances</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>chains</code></b>
            (<code>list[<a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a>] | <a class="autorefs autorefs-internal" title="structure.base.Structures" href="../base/#structure.base.Structures">Structures</a></code>)
        
        <div class="doc-md-description">
          <p>A list of Chain instances that match the Entity</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>residue_indices</code></b>
            (<code>list[int]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The indices which the new Entity should contain</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_chains</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">chains</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Chain</span><span class="p">]</span> <span class="o">|</span> <span class="n">Structures</span><span class="p">,</span> <span class="n">residue_indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize an Entity from Chain instances</span>

<span class="sd">    Args:</span>
<span class="sd">        chains: A list of Chain instances that match the Entity</span>
<span class="sd">        residue_indices: The indices which the new Entity should contain</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">operators</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operators&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">residue_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">asymmetry</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">asymmetry</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># No check</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">representative</span><span class="p">,</span> <span class="o">*</span><span class="n">additional_chains</span> <span class="o">=</span> <span class="n">chains</span>

        <span class="n">residue_indices</span> <span class="o">=</span> <span class="n">representative</span><span class="o">.</span><span class="n">residue_indices</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">,</span> <span class="n">residue_indices</span><span class="o">=</span><span class="n">residue_indices</span><span class="p">,</span> <span class="n">operators</span><span class="o">=</span><span class="n">operators</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.coords" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">coords</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">coords</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]])</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Set the Coords object while propagating changes to symmetric "mate" chains</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span>
<span class="normal">3350</span>
<span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span>
<span class="normal">3354</span>
<span class="normal">3355</span>
<span class="normal">3356</span>
<span class="normal">3357</span>
<span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span>
<span class="normal">3369</span>
<span class="normal">3370</span>
<span class="normal">3371</span>
<span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span>
<span class="normal">3378</span>
<span class="normal">3379</span>
<span class="normal">3380</span>
<span class="normal">3381</span>
<span class="normal">3382</span>
<span class="normal">3383</span>
<span class="normal">3384</span>
<span class="normal">3385</span>
<span class="normal">3386</span>
<span class="normal">3387</span>
<span class="normal">3388</span>
<span class="normal">3389</span>
<span class="normal">3390</span>
<span class="normal">3391</span>
<span class="normal">3392</span>
<span class="normal">3393</span>
<span class="normal">3394</span>
<span class="normal">3395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@StructureBase</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the Coords object while propagating changes to symmetric &quot;mate&quot; chains&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_captain</span><span class="p">:</span>
        <span class="c1"># **This routine handles imperfect symmetry**</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Entity captain is updating coords&#39;</span><span class="p">)</span>
        <span class="c1"># Must do these before super().coords.fset()</span>
        <span class="c1"># Populate .chains (if not already) with current coords and transformation</span>
        <span class="n">self_</span><span class="p">,</span> <span class="o">*</span><span class="n">mate_chains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
        <span class="c1"># Set current .ca_coords as prior_ca_coords</span>
        <span class="n">prior_ca_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Set coords with new coords</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContainsAtoms</span><span class="p">,</span> <span class="n">ContainsAtoms</span><span class="p">)</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dependent</span><span class="p">():</span>
            <span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">if</span> <span class="n">_parent</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_is_updating</span><span class="p">:</span>
                <span class="n">_parent</span><span class="o">.</span><span class="n">_dependent_is_updating</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Update the parent which propagates symmetric updates</span>
                <span class="n">_parent</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">_parent</span><span class="o">.</span><span class="n">coords</span>
                <span class="n">_parent</span><span class="o">.</span><span class="n">_dependent_is_updating</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Find the transformation from the old coordinates to the new</span>
        <span class="n">new_ca_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca_coords</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">new_rot</span><span class="p">,</span> <span class="n">new_tx</span> <span class="o">=</span> <span class="n">superposition3d</span><span class="p">(</span><span class="n">new_ca_coords</span><span class="p">,</span> <span class="n">prior_ca_coords</span><span class="p">)</span>

        <span class="n">new_rot_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">new_rot</span><span class="p">)</span>
        <span class="c1"># Remove prior transforms by setting a fresh container</span>
        <span class="n">_expand_matrices</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">identity_matrix</span><span class="p">]</span>
        <span class="n">_expand_translations</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">]</span>
        <span class="c1"># Find the transform between the new coords and the current mate chain coords</span>
        <span class="c1"># for chain, transform in zip(mate_chains, current_chain_transforms):</span>
        <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">mate_chains</span><span class="p">:</span>
            <span class="c1"># self.log.debug(f&#39;Updated transform of mate {chain.chain_id}&#39;)</span>
            <span class="c1"># In liu of using chain.coords as lengths might be different</span>
            <span class="c1"># Transform prior_coords to chain.coords position, then transform using new_rot and new_tx</span>
            <span class="c1"># new_chain_ca_coords = \</span>
            <span class="c1">#     np.matmul(np.matmul(prior_ca_coords,</span>
            <span class="c1">#                         np.transpose(transform[&#39;rotation&#39;])) + transform[&#39;translation&#39;],</span>
            <span class="c1">#               np.transpose(new_rot)) + new_tx</span>
            <span class="n">new_chain_ca_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">ca_coords</span><span class="p">,</span> <span class="n">new_rot_t</span><span class="p">)</span> <span class="o">+</span> <span class="n">new_tx</span>
            <span class="c1"># Find the transform from current coords and the new mate chain coords</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">superposition3d</span><span class="p">(</span><span class="n">new_chain_ca_coords</span><span class="p">,</span> <span class="n">new_ca_coords</span><span class="p">)</span>
            <span class="c1"># Save transform</span>
            <span class="c1"># self._chain_transforms.append(dict(rotation=rot, translation=tx))</span>
            <span class="n">rot_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
            <span class="n">_expand_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rot_t</span><span class="p">)</span>
            <span class="n">_expand_translations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
            <span class="c1"># Transform existing mate chain</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">rot_t</span><span class="p">)</span> <span class="o">+</span> <span class="n">tx</span>
            <span class="c1"># self.log.debug(f&#39;Setting coords on mate chain {chain.chain_id}&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_expand_matrices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_expand_translations</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Accept the new coords</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContainsAtoms</span><span class="p">,</span> <span class="n">ContainsAtoms</span><span class="p">)</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.is_captain" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">is_captain</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_captain</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Is the Entity instance the captain?</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3536</span>
<span class="normal">3537</span>
<span class="normal">3538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_captain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Is the Entity instance the captain?&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_captain</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.is_mate" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">is_mate</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_mate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Is the Entity instance a mate?</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3540</span>
<span class="normal">3541</span>
<span class="normal">3542</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_mate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Is the Entity instance a mate?&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_captain</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.has_mates" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">has_mates</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">has_mates</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns True if this Entity is a captain and has mates</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3554</span>
<span class="normal">3555</span>
<span class="normal">3556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_mates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if this Entity is a captain and has mates&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.remove_mate_chains" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">remove_mate_chains</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">remove_mate_chains</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Clear the Entity of all Chain and Oligomer information</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3591</span>
<span class="normal">3592</span>
<span class="normal">3593</span>
<span class="normal">3594</span>
<span class="normal">3595</span>
<span class="normal">3596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_mate_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear the Entity of all Chain and Oligomer information&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_mates</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_captain</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.make_oligomer" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">make_oligomer</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">make_oligomer</span><span class="p">(</span><span class="n">symmetry</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translation</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation2</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translation2</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Given a symmetry and transformational mapping, generate oligomeric copies of the Entity</p>
<p>Assumes that the symmetric system treats the canonical symmetric axis as the Z-axis, and if the Entity is not at
the origin, that a transformation describing its current position relative to the origin is passed so that it
can be moved to the origin. At the origin, makes the required oligomeric rotations, to generate an oligomer
where symmetric copies are stored in the .chains attribute then reverses the operations back to original
reference frame if any was provided</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>symmetry</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The symmetry to set the Entity to</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rotation</code></b>
            (<code>list[list[float]] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The first rotation to apply, expected array shape (3, 3)</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>translation</code></b>
            (<code>list[float] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The first translation to apply, expected array shape (3,)</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rotation2</code></b>
            (<code>list[list[float]] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The second rotation to apply, expected array shape (3, 3)</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>translation2</code></b>
            (<code>list[float] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The second translation to apply, expected array shape (3,)</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.symmetry (str)
self.sym_entry (SymEntry)
self.number_of_symmetry_mates (int)
self._expand_matrices
self._expand_translations</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3647</span>
<span class="normal">3648</span>
<span class="normal">3649</span>
<span class="normal">3650</span>
<span class="normal">3651</span>
<span class="normal">3652</span>
<span class="normal">3653</span>
<span class="normal">3654</span>
<span class="normal">3655</span>
<span class="normal">3656</span>
<span class="normal">3657</span>
<span class="normal">3658</span>
<span class="normal">3659</span>
<span class="normal">3660</span>
<span class="normal">3661</span>
<span class="normal">3662</span>
<span class="normal">3663</span>
<span class="normal">3664</span>
<span class="normal">3665</span>
<span class="normal">3666</span>
<span class="normal">3667</span>
<span class="normal">3668</span>
<span class="normal">3669</span>
<span class="normal">3670</span>
<span class="normal">3671</span>
<span class="normal">3672</span>
<span class="normal">3673</span>
<span class="normal">3674</span>
<span class="normal">3675</span>
<span class="normal">3676</span>
<span class="normal">3677</span>
<span class="normal">3678</span>
<span class="normal">3679</span>
<span class="normal">3680</span>
<span class="normal">3681</span>
<span class="normal">3682</span>
<span class="normal">3683</span>
<span class="normal">3684</span>
<span class="normal">3685</span>
<span class="normal">3686</span>
<span class="normal">3687</span>
<span class="normal">3688</span>
<span class="normal">3689</span>
<span class="normal">3690</span>
<span class="normal">3691</span>
<span class="normal">3692</span>
<span class="normal">3693</span>
<span class="normal">3694</span>
<span class="normal">3695</span>
<span class="normal">3696</span>
<span class="normal">3697</span>
<span class="normal">3698</span>
<span class="normal">3699</span>
<span class="normal">3700</span>
<span class="normal">3701</span>
<span class="normal">3702</span>
<span class="normal">3703</span>
<span class="normal">3704</span>
<span class="normal">3705</span>
<span class="normal">3706</span>
<span class="normal">3707</span>
<span class="normal">3708</span>
<span class="normal">3709</span>
<span class="normal">3710</span>
<span class="normal">3711</span>
<span class="normal">3712</span>
<span class="normal">3713</span>
<span class="normal">3714</span>
<span class="normal">3715</span>
<span class="normal">3716</span>
<span class="normal">3717</span>
<span class="normal">3718</span>
<span class="normal">3719</span>
<span class="normal">3720</span>
<span class="normal">3721</span>
<span class="normal">3722</span>
<span class="normal">3723</span>
<span class="normal">3724</span>
<span class="normal">3725</span>
<span class="normal">3726</span>
<span class="normal">3727</span>
<span class="normal">3728</span>
<span class="normal">3729</span>
<span class="normal">3730</span>
<span class="normal">3731</span>
<span class="normal">3732</span>
<span class="normal">3733</span>
<span class="normal">3734</span>
<span class="normal">3735</span>
<span class="normal">3736</span>
<span class="normal">3737</span>
<span class="normal">3738</span>
<span class="normal">3739</span>
<span class="normal">3740</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_oligomer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">translation</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">translation2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a symmetry and transformational mapping, generate oligomeric copies of the Entity</span>

<span class="sd">    Assumes that the symmetric system treats the canonical symmetric axis as the Z-axis, and if the Entity is not at</span>
<span class="sd">    the origin, that a transformation describing its current position relative to the origin is passed so that it</span>
<span class="sd">    can be moved to the origin. At the origin, makes the required oligomeric rotations, to generate an oligomer</span>
<span class="sd">    where symmetric copies are stored in the .chains attribute then reverses the operations back to original</span>
<span class="sd">    reference frame if any was provided</span>

<span class="sd">    Args:</span>
<span class="sd">        symmetry: The symmetry to set the Entity to</span>
<span class="sd">        rotation: The first rotation to apply, expected array shape (3, 3)</span>
<span class="sd">        translation: The first translation to apply, expected array shape (3,)</span>
<span class="sd">        rotation2: The second rotation to apply, expected array shape (3, 3)</span>
<span class="sd">        translation2: The second translation to apply, expected array shape (3,)</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.symmetry (str)</span>
<span class="sd">        self.sym_entry (SymEntry)</span>
<span class="sd">        self.number_of_symmetry_mates (int)</span>
<span class="sd">        self._expand_matrices</span>
<span class="sd">        self._expand_translations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_symmetry</span><span class="p">(</span><span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="k">return</span>

    <span class="n">symmetry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span>
    <span class="n">degeneracy_matrices</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">symmetry</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">cubic_point_groups</span><span class="p">:</span>
        <span class="n">rotation_matrices</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">point_group_symmetry_operators</span><span class="p">[</span><span class="n">symmetry</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s1">&#39;D&#39;</span> <span class="ow">in</span> <span class="n">symmetry</span><span class="p">:</span>  <span class="c1"># Provide a 180-degree rotation along x (all D orient symmetries have axis here)</span>
        <span class="n">rotation_matrices</span> <span class="o">=</span> \
            <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">get_rot_matrices</span><span class="p">(</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">rotation_range</span><span class="p">[</span><span class="n">symmetry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)],</span>
                <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">360</span>
            <span class="p">)</span>
        <span class="n">degeneracy_matrices</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">identity_matrix</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">flip_x_matrix</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Symmetry is cyclic</span>
        <span class="n">rotation_matrices</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">get_rot_matrices</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">rotation_range</span><span class="p">[</span><span class="n">symmetry</span><span class="p">],</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>

    <span class="n">degeneracy_rotation_matrices</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">make_rotations_degenerate</span><span class="p">(</span>
        <span class="n">rotation_matrices</span><span class="p">,</span> <span class="n">degeneracy_matrices</span><span class="p">)</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">degeneracy_rotation_matrices</span><span class="p">),</span> \
        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The number of symmetry mates, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">degeneracy_rotation_matrices</span><span class="p">)</span><span class="si">}</span><span class="s2">, &quot;</span>
         <span class="s2">&quot;the number of operations&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">inv_rotation</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">identity_matrix</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inv_rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">translation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span>

    <span class="k">if</span> <span class="n">rotation2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rotation2</span> <span class="o">=</span> <span class="n">inv_rotation2</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">identity_matrix</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inv_rotation2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">rotation2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">translation2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">translation2</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span>
    <span class="c1"># this is helpful for dihedral symmetry as entity must be transformed to origin to get canonical dihedral</span>
    <span class="c1"># entity_inv = entity.get_transformed_copy(rotation=inv_expand_matrix, rotation2=inv_set_matrix[group])</span>
    <span class="c1"># need to reverse any external transformation to the entity coords so rotation occurs at the origin...</span>
    <span class="c1"># and undo symmetry expansion matrices</span>
    <span class="c1"># centered_coords = transform_coordinate_sets(self.coords, translation=-translation2,</span>
    <span class="c1"># centered_coords = transform_coordinate_sets(self._coords.coords, translation=-translation2)</span>
    <span class="n">cb_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_coords</span>
    <span class="n">centered_coords</span> <span class="o">=</span> <span class="n">transform_coordinate_sets</span><span class="p">(</span><span class="n">cb_coords</span><span class="p">,</span> <span class="n">translation</span><span class="o">=-</span><span class="n">translation2</span><span class="p">)</span>

    <span class="n">centered_coords_inv</span> <span class="o">=</span> <span class="n">transform_coordinate_sets</span><span class="p">(</span><span class="n">centered_coords</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">inv_rotation2</span><span class="p">,</span>
                                                    <span class="n">translation</span><span class="o">=-</span><span class="n">translation</span><span class="p">,</span> <span class="n">rotation2</span><span class="o">=</span><span class="n">inv_rotation</span><span class="p">)</span>
    <span class="n">_expand_matrices</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">identity_matrix</span><span class="p">]</span>
    <span class="n">_expand_translations</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">]</span>
    <span class="n">subunit_count</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">rotation_matrix</span> <span class="ow">in</span> <span class="n">degeneracy_rotation_matrices</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">next</span><span class="p">(</span><span class="n">subunit_count</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">rotation_matrix</span> <span class="o">==</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">identity_matrix</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipping </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">make_oligomer</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> transformation 1 as it is identity&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">rot_centered_coords</span> <span class="o">=</span> <span class="n">transform_coordinate_sets</span><span class="p">(</span><span class="n">centered_coords_inv</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation_matrix</span><span class="p">)</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="n">transform_coordinate_sets</span><span class="p">(</span><span class="n">rot_centered_coords</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span> <span class="n">translation</span><span class="o">=</span><span class="n">translation</span><span class="p">,</span>
                                               <span class="n">rotation2</span><span class="o">=</span><span class="n">rotation2</span><span class="p">,</span> <span class="n">translation2</span><span class="o">=</span><span class="n">translation2</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">superposition3d</span><span class="p">(</span><span class="n">new_coords</span><span class="p">,</span> <span class="n">cb_coords</span><span class="p">)</span>
        <span class="n">_expand_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
        <span class="n">_expand_translations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_expand_matrices</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_expand_translations</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># Set the new properties</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_mates</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_chain_ids</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.get_transformed_mate" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_transformed_mate</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_transformed_mate</span><span class="p">(</span><span class="n">rotation</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translation</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation2</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translation2</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Make a semi-deep copy of the Entity, stripping any captain attributes, transforming the coordinates</p>
<p>Transformation proceeds by matrix multiplication and vector addition with the order of operations as:
rotation, translation, rotation2, translation2</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>rotation</code></b>
            (<code>list[list[float]] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The first rotation to apply, expected array shape (3, 3)</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>translation</code></b>
            (<code>list[float] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The first translation to apply, expected array shape (3,)</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rotation2</code></b>
            (<code>list[list[float]] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The second rotation to apply, expected array shape (3, 3)</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>translation2</code></b>
            (<code>list[float] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The second translation to apply, expected array shape (3,)</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>
        
        <div class="doc-md-description">
          <p>A transformed copy of the original object</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3742</span>
<span class="normal">3743</span>
<span class="normal">3744</span>
<span class="normal">3745</span>
<span class="normal">3746</span>
<span class="normal">3747</span>
<span class="normal">3748</span>
<span class="normal">3749</span>
<span class="normal">3750</span>
<span class="normal">3751</span>
<span class="normal">3752</span>
<span class="normal">3753</span>
<span class="normal">3754</span>
<span class="normal">3755</span>
<span class="normal">3756</span>
<span class="normal">3757</span>
<span class="normal">3758</span>
<span class="normal">3759</span>
<span class="normal">3760</span>
<span class="normal">3761</span>
<span class="normal">3762</span>
<span class="normal">3763</span>
<span class="normal">3764</span>
<span class="normal">3765</span>
<span class="normal">3766</span>
<span class="normal">3767</span>
<span class="normal">3768</span>
<span class="normal">3769</span>
<span class="normal">3770</span>
<span class="normal">3771</span>
<span class="normal">3772</span>
<span class="normal">3773</span>
<span class="normal">3774</span>
<span class="normal">3775</span>
<span class="normal">3776</span>
<span class="normal">3777</span>
<span class="normal">3778</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_transformed_mate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotation</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">translation</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">rotation2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">translation2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Entity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a semi-deep copy of the Entity, stripping any captain attributes, transforming the coordinates</span>

<span class="sd">    Transformation proceeds by matrix multiplication and vector addition with the order of operations as:</span>
<span class="sd">    rotation, translation, rotation2, translation2</span>

<span class="sd">    Args:</span>
<span class="sd">        rotation: The first rotation to apply, expected array shape (3, 3)</span>
<span class="sd">        translation: The first translation to apply, expected array shape (3,)</span>
<span class="sd">        rotation2: The second rotation to apply, expected array shape (3, 3)</span>
<span class="sd">        translation2: The second translation to apply, expected array shape (3,)</span>

<span class="sd">    Returns:</span>
<span class="sd">        A transformed copy of the original object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># required for np.ndarray or None checks</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rotation</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span>

    <span class="k">if</span> <span class="n">translation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># required for np.ndarray or None checks</span>
        <span class="n">new_coords</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rotation2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># required for np.ndarray or None checks</span>
        <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">new_coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rotation2</span><span class="p">),</span> <span class="n">out</span><span class="o">=</span><span class="n">new_coords</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">translation2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># required for np.ndarray or None checks</span>
        <span class="n">new_coords</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">translation2</span><span class="p">)</span>

    <span class="n">new_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">new_structure</span><span class="o">.</span><span class="n">_make_mate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">new_structure</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">new_coords</span>

    <span class="k">return</span> <span class="n">new_structure</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.write" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">write</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n">bytes</span> <span class="o">|</span> <span class="n">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file_handle</span><span class="p">:</span> <span class="n"><span title="typing.IO">IO</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">assembly</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Write Entity Structure to a file specified by out_path or with a passed file_handle</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>out_path</code></b>
            (<code>bytes | str</code>, default:
                <code><span title="os.getcwd">getcwd</span>()</code>
)
        
        <div class="doc-md-description">
          <p>The location where the Structure object should be written to disk</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>file_handle</code></b>
            (<code><span title="typing.IO">IO</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Used to write Structure details to an open FileObject</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>header</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A string that is desired at the top of the file</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>assembly</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to write the oligomeric form of the Entity</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>increment_chains</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to write each Structure with a new chain name, otherwise write as
a new Model</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>chain_id</code></b>
        
        <div class="doc-md-description">
          <p>str = None - The chain ID to use</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>atom_offset</code></b>
        
        <div class="doc-md-description">
          <p>int = 0 - How much to offset the atom number by. Default returns one-indexed.
Not used if assembly=True</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.AnyStr">AnyStr</span> | None</code>
        
        <div class="doc-md-description">
          <p>The name of the written file if out_path is used</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3780</span>
<span class="normal">3781</span>
<span class="normal">3782</span>
<span class="normal">3783</span>
<span class="normal">3784</span>
<span class="normal">3785</span>
<span class="normal">3786</span>
<span class="normal">3787</span>
<span class="normal">3788</span>
<span class="normal">3789</span>
<span class="normal">3790</span>
<span class="normal">3791</span>
<span class="normal">3792</span>
<span class="normal">3793</span>
<span class="normal">3794</span>
<span class="normal">3795</span>
<span class="normal">3796</span>
<span class="normal">3797</span>
<span class="normal">3798</span>
<span class="normal">3799</span>
<span class="normal">3800</span>
<span class="normal">3801</span>
<span class="normal">3802</span>
<span class="normal">3803</span>
<span class="normal">3804</span>
<span class="normal">3805</span>
<span class="normal">3806</span>
<span class="normal">3807</span>
<span class="normal">3808</span>
<span class="normal">3809</span>
<span class="normal">3810</span>
<span class="normal">3811</span>
<span class="normal">3812</span>
<span class="normal">3813</span>
<span class="normal">3814</span>
<span class="normal">3815</span>
<span class="normal">3816</span>
<span class="normal">3817</span>
<span class="normal">3818</span>
<span class="normal">3819</span>
<span class="normal">3820</span>
<span class="normal">3821</span>
<span class="normal">3822</span>
<span class="normal">3823</span>
<span class="normal">3824</span>
<span class="normal">3825</span>
<span class="normal">3826</span>
<span class="normal">3827</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file_handle</span><span class="p">:</span> <span class="n">IO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">assembly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write Entity Structure to a file specified by out_path or with a passed file_handle</span>

<span class="sd">    Args:</span>
<span class="sd">        out_path: The location where the Structure object should be written to disk</span>
<span class="sd">        file_handle: Used to write Structure details to an open FileObject</span>
<span class="sd">        header: A string that is desired at the top of the file</span>
<span class="sd">        assembly: Whether to write the oligomeric form of the Entity</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        increment_chains: bool = False - Whether to write each Structure with a new chain name, otherwise write as</span>
<span class="sd">            a new Model</span>
<span class="sd">        chain_id: str = None - The chain ID to use</span>
<span class="sd">        atom_offset: int = 0 - How much to offset the atom number by. Default returns one-indexed.</span>
<span class="sd">            Not used if assembly=True</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the written file if out_path is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Entity</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> is writing </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">assembly</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;atom_offset&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># if &#39;increment_chains&#39; not in kwargs:</span>
            <span class="c1">#     kwargs[&#39;increment_chains&#39;] = True</span>
            <span class="c1"># assembly_models = self._generate_assembly_models(**kwargs)</span>
            <span class="n">assembly_models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">)</span>
            <span class="n">assembly_models</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">multimodel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file_handle</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_write</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># out_path always has default argument current working directory</span>
        <span class="c1"># assembly=True implies all chains will be written, so asu=False to write each SEQRES record</span>
        <span class="n">_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_header</span><span class="p">(</span><span class="n">assembly</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">header</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="n">_header</span> <span class="o">+=</span> <span class="p">(</span><span class="n">header</span> <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_header</span><span class="p">)</span>
            <span class="n">_write</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out_path</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.calculate_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">calculate_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3829</span>
<span class="normal">3830</span>
<span class="normal">3831</span>
<span class="normal">3832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_spatial_orientation_metrics</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> missing argument &#39;reference&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_spatial_orientation_metrics</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.calculate_spatial_orientation_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">calculate_spatial_orientation_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">calculate_spatial_orientation_metrics</span><span class="p">(</span><span class="n">reference</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Calculate metrics for the instance</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>reference</code></b>
            (<code><span title="numpy.ndarray">ndarray</span></code>, default:
                <code><span title="symdesign.utils.symmetry.origin">origin</span></code>
)
        
        <div class="doc-md-description">
          <p>The reference where the point should be measured from</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>{'radius'
'min_radius'
'max_radius'
'n_terminal_orientation'
'c_terminal_orientation'</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>}</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3834</span>
<span class="normal">3835</span>
<span class="normal">3836</span>
<span class="normal">3837</span>
<span class="normal">3838</span>
<span class="normal">3839</span>
<span class="normal">3840</span>
<span class="normal">3841</span>
<span class="normal">3842</span>
<span class="normal">3843</span>
<span class="normal">3844</span>
<span class="normal">3845</span>
<span class="normal">3846</span>
<span class="normal">3847</span>
<span class="normal">3848</span>
<span class="normal">3849</span>
<span class="normal">3850</span>
<span class="normal">3851</span>
<span class="normal">3852</span>
<span class="normal">3853</span>
<span class="normal">3854</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_spatial_orientation_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate metrics for the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        reference: The reference where the point should be measured from</span>

<span class="sd">    Returns:</span>
<span class="sd">        {&#39;radius&#39;</span>
<span class="sd">         &#39;min_radius&#39;</span>
<span class="sd">         &#39;max_radius&#39;</span>
<span class="sd">         &#39;n_terminal_orientation&#39;</span>
<span class="sd">         &#39;c_terminal_orientation&#39;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">distance_from_reference</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">),</span>
        <span class="s1">&#39;min_radius&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">distance_from_reference</span><span class="p">(</span><span class="n">measure</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">),</span>
        <span class="s1">&#39;max_radius&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">distance_from_reference</span><span class="p">(</span><span class="n">measure</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">),</span>
        <span class="s1">&#39;n_terminal_orientation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">termini_proximity_from_reference</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">),</span>
        <span class="s1">&#39;c_terminal_orientation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">termini_proximity_from_reference</span><span class="p">(</span><span class="n">termini</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.get_alphafold_features" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_alphafold_features</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_alphafold_features</span><span class="p">(</span><span class="n">symmetric</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">heteromer</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">msas</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(),</span> <span class="n">no_msa</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">templates</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="structure.model.FeatureDict">FeatureDict</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Retrieve the required feature dictionary for this instance to use in Alphafold inference</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>symmetric</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether the symmetric Entity should be used for feature production. If True, this function will
fully process the FeatureDict in the symmetric form compatible with Alphafold multimer</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>heteromer</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether Alphafold should be run as a heteromer. Features directly used in
Alphafold from this instance should never be used with heteromer=True</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>msas</code></b>
            (<code><span title="collections.abc.Sequence">Sequence</span></code>, default:
                <code>tuple()</code>
)
        
        <div class="doc-md-description">
          <p>A sequence of multiple sequence alignments if they should be included in the features</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>no_msa</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether multiple sequence alignments should be included in the features</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>templates</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether the Entity should be returned with it's template features</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="structure.model.FeatureDict">FeatureDict</span></code>
        
        <div class="doc-md-description">
          <p>The Alphafold FeatureDict which is essentially a dictionary with dict[str, np.ndarray]</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3887</span>
<span class="normal">3888</span>
<span class="normal">3889</span>
<span class="normal">3890</span>
<span class="normal">3891</span>
<span class="normal">3892</span>
<span class="normal">3893</span>
<span class="normal">3894</span>
<span class="normal">3895</span>
<span class="normal">3896</span>
<span class="normal">3897</span>
<span class="normal">3898</span>
<span class="normal">3899</span>
<span class="normal">3900</span>
<span class="normal">3901</span>
<span class="normal">3902</span>
<span class="normal">3903</span>
<span class="normal">3904</span>
<span class="normal">3905</span>
<span class="normal">3906</span>
<span class="normal">3907</span>
<span class="normal">3908</span>
<span class="normal">3909</span>
<span class="normal">3910</span>
<span class="normal">3911</span>
<span class="normal">3912</span>
<span class="normal">3913</span>
<span class="normal">3914</span>
<span class="normal">3915</span>
<span class="normal">3916</span>
<span class="normal">3917</span>
<span class="normal">3918</span>
<span class="normal">3919</span>
<span class="normal">3920</span>
<span class="normal">3921</span>
<span class="normal">3922</span>
<span class="normal">3923</span>
<span class="normal">3924</span>
<span class="normal">3925</span>
<span class="normal">3926</span>
<span class="normal">3927</span>
<span class="normal">3928</span>
<span class="normal">3929</span>
<span class="normal">3930</span>
<span class="normal">3931</span>
<span class="normal">3932</span>
<span class="normal">3933</span>
<span class="normal">3934</span>
<span class="normal">3935</span>
<span class="normal">3936</span>
<span class="normal">3937</span>
<span class="normal">3938</span>
<span class="normal">3939</span>
<span class="normal">3940</span>
<span class="normal">3941</span>
<span class="normal">3942</span>
<span class="normal">3943</span>
<span class="normal">3944</span>
<span class="normal">3945</span>
<span class="normal">3946</span>
<span class="normal">3947</span>
<span class="normal">3948</span>
<span class="normal">3949</span>
<span class="normal">3950</span>
<span class="normal">3951</span>
<span class="normal">3952</span>
<span class="normal">3953</span>
<span class="normal">3954</span>
<span class="normal">3955</span>
<span class="normal">3956</span>
<span class="normal">3957</span>
<span class="normal">3958</span>
<span class="normal">3959</span>
<span class="normal">3960</span>
<span class="normal">3961</span>
<span class="normal">3962</span>
<span class="normal">3963</span>
<span class="normal">3964</span>
<span class="normal">3965</span>
<span class="normal">3966</span>
<span class="normal">3967</span>
<span class="normal">3968</span>
<span class="normal">3969</span>
<span class="normal">3970</span>
<span class="normal">3971</span>
<span class="normal">3972</span>
<span class="normal">3973</span>
<span class="normal">3974</span>
<span class="normal">3975</span>
<span class="normal">3976</span>
<span class="normal">3977</span>
<span class="normal">3978</span>
<span class="normal">3979</span>
<span class="normal">3980</span>
<span class="normal">3981</span>
<span class="normal">3982</span>
<span class="normal">3983</span>
<span class="normal">3984</span>
<span class="normal">3985</span>
<span class="normal">3986</span>
<span class="normal">3987</span>
<span class="normal">3988</span>
<span class="normal">3989</span>
<span class="normal">3990</span>
<span class="normal">3991</span>
<span class="normal">3992</span>
<span class="normal">3993</span>
<span class="normal">3994</span>
<span class="normal">3995</span>
<span class="normal">3996</span>
<span class="normal">3997</span>
<span class="normal">3998</span>
<span class="normal">3999</span>
<span class="normal">4000</span>
<span class="normal">4001</span>
<span class="normal">4002</span>
<span class="normal">4003</span>
<span class="normal">4004</span>
<span class="normal">4005</span>
<span class="normal">4006</span>
<span class="normal">4007</span>
<span class="normal">4008</span>
<span class="normal">4009</span>
<span class="normal">4010</span>
<span class="normal">4011</span>
<span class="normal">4012</span>
<span class="normal">4013</span>
<span class="normal">4014</span>
<span class="normal">4015</span>
<span class="normal">4016</span>
<span class="normal">4017</span>
<span class="normal">4018</span>
<span class="normal">4019</span>
<span class="normal">4020</span>
<span class="normal">4021</span>
<span class="normal">4022</span>
<span class="normal">4023</span>
<span class="normal">4024</span>
<span class="normal">4025</span>
<span class="normal">4026</span>
<span class="normal">4027</span>
<span class="normal">4028</span>
<span class="normal">4029</span>
<span class="normal">4030</span>
<span class="normal">4031</span>
<span class="normal">4032</span>
<span class="normal">4033</span>
<span class="normal">4034</span>
<span class="normal">4035</span>
<span class="normal">4036</span>
<span class="normal">4037</span>
<span class="normal">4038</span>
<span class="normal">4039</span>
<span class="normal">4040</span>
<span class="normal">4041</span>
<span class="normal">4042</span>
<span class="normal">4043</span>
<span class="normal">4044</span>
<span class="normal">4045</span>
<span class="normal">4046</span>
<span class="normal">4047</span>
<span class="normal">4048</span>
<span class="normal">4049</span>
<span class="normal">4050</span>
<span class="normal">4051</span>
<span class="normal">4052</span>
<span class="normal">4053</span>
<span class="normal">4054</span>
<span class="normal">4055</span>
<span class="normal">4056</span>
<span class="normal">4057</span>
<span class="normal">4058</span>
<span class="normal">4059</span>
<span class="normal">4060</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_alphafold_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symmetric</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">heteromer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">msas</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(),</span>
                           <span class="n">no_msa</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">templates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FeatureDict</span><span class="p">:</span>
    <span class="c1"># multimer: bool = False,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the required feature dictionary for this instance to use in Alphafold inference</span>

<span class="sd">    Args:</span>
<span class="sd">        symmetric: Whether the symmetric Entity should be used for feature production. If True, this function will</span>
<span class="sd">            fully process the FeatureDict in the symmetric form compatible with Alphafold multimer</span>
<span class="sd">        heteromer: Whether Alphafold should be run as a heteromer. Features directly used in</span>
<span class="sd">            Alphafold from this instance should never be used with heteromer=True</span>
<span class="sd">        msas: A sequence of multiple sequence alignments if they should be included in the features</span>
<span class="sd">        no_msa: Whether multiple sequence alignments should be included in the features</span>
<span class="sd">        templates: Whether the Entity should be returned with it&#39;s template features</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Alphafold FeatureDict which is essentially a dictionary with dict[str, np.ndarray]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">heteromer</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">symmetric</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_alphafold_features</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> with both &#39;symmetric&#39; and &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;heteromer&#39; True. Only run with symmetric True if this </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;instance alone should be predicted as a multimer&quot;</span><span class="p">)</span>
    <span class="c1"># if templates:</span>
    <span class="c1">#     if symmetric:</span>
    <span class="c1">#         # raise ValueError(f&quot;Couldn&#39;t {self.get_alphafold_features.__name__} with both &#39;symmetric&#39; and &quot;</span>
    <span class="c1">#         logger.warning(f&quot;Couldn&#39;t {self.get_alphafold_features.__name__} with both &#39;symmetric&#39; and &quot;</span>
    <span class="c1">#                        f&quot;&#39;templates&#39; True. Templates not set up for multimer&quot;)</span>
    <span class="c1"># elif symmetric:</span>
    <span class="c1">#     # Set multimer True as we need to make_msa_features_multimeric</span>
    <span class="c1">#     multimer = True</span>

    <span class="c1"># # IS THIS NECESSARY. DON&#39;T THINK SO IF I HAVE MSA</span>
    <span class="c1"># chain_features = alphafold.alphafold.data.pipeline.DataPipeline.process(input_fasta_path=P, msa_output_dir=P)</span>
    <span class="c1"># This ^ runs</span>
    <span class="n">number_of_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
    <span class="n">sequence_features</span> <span class="o">=</span> <span class="n">af_pipeline</span><span class="o">.</span><span class="n">make_sequence_features</span><span class="p">(</span>
        <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">num_res</span><span class="o">=</span><span class="n">number_of_residues</span><span class="p">)</span>
    <span class="c1"># sequence_features = {</span>
    <span class="c1">#     &#39;aatype&#39;: ,  # MAKE ONE HOT with X i.e.unknown are X</span>
    <span class="c1">#     &#39;between_segment_residues&#39;: np.zeros((number_of_residues,), dtype=np.int32),</span>
    <span class="c1">#     &#39;domain_name&#39;: np.array([input_description.encode(&#39;utf-8&#39;)], dtype=np.object_),</span>
    <span class="c1">#     &#39;residue_index&#39;: np.arange(number_of_residues, dtype=np.int32),</span>
    <span class="c1">#     &#39;seq_length&#39;: np.full(number_of_residues, number_of_residues, dtype=np.int32),</span>
    <span class="c1">#     &#39;sequence&#39;: np.array([sequence.encode(&#39;utf-8&#39;)], dtype=np.object_)</span>
    <span class="c1"># }</span>

    <span class="k">def</span> <span class="nf">make_msa_features_multimeric</span><span class="p">(</span><span class="n">msa_feats</span><span class="p">:</span> <span class="n">FeatureDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FeatureDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the feature names for Alphafold heteromeric inputs run in multimer mode&quot;&quot;&quot;</span>
        <span class="n">valid_feats</span> <span class="o">=</span> <span class="n">af_msa_pairing</span><span class="o">.</span><span class="n">MSA_FEATURES</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;msa_species_identifiers&#39;</span><span class="p">,)</span>
        <span class="k">return</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_all_seq&#39;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">msa_feats</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_feats</span><span class="p">}</span>

    <span class="c1"># Multiple sequence alignment processing</span>
    <span class="k">if</span> <span class="n">msas</span><span class="p">:</span>
        <span class="n">msa_features</span> <span class="o">=</span> <span class="n">af_pipeline</span><span class="o">.</span><span class="n">make_msa_features</span><span class="p">(</span><span class="n">msas</span><span class="p">)</span>
        <span class="c1"># Can use a single one...</span>
        <span class="c1"># Other types from AlphaFold include: (uniref90_msa, bfd_msa, mgnify_msa)</span>
        <span class="k">if</span> <span class="n">heteromer</span><span class="p">:</span>
            <span class="c1"># Todo ensure that uniref90 runner was used...</span>
            <span class="c1">#  OR equivalent so that each sequence in a multimeric msa is paired</span>
            <span class="c1"># Stockholm format looks like</span>
            <span class="c1"># #=GF DE                          path/to/profiles/entity_id</span>
            <span class="c1"># #=GC RF                          AY--R...</span>
            <span class="c1"># 2gtr_1                           AY--R...</span>
            <span class="c1"># UniRef100_A0A455ABB#2            NC--R...</span>
            <span class="c1"># UniRef100_UPI00106966C#3         CI--L...</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;No uniprot90 database hooked up...&#39;</span><span class="p">)</span>
            <span class="c1"># with open(self.msa_file, &#39;r&#39;) as f:</span>
            <span class="c1">#     uniref90_lines = f.read()</span>

            <span class="n">uniref90_msa</span> <span class="o">=</span> <span class="n">af_data_parsers</span><span class="o">.</span><span class="n">parse_stockholm</span><span class="p">(</span><span class="n">uniref90_lines</span><span class="p">)</span>
            <span class="n">msa_features</span> <span class="o">=</span> <span class="n">af_pipeline</span><span class="o">.</span><span class="n">make_msa_features</span><span class="p">((</span><span class="n">uniref90_msa</span><span class="p">,))</span>
            <span class="n">msa_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">make_msa_features_multimeric</span><span class="p">(</span><span class="n">msa_features</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msa</span>
        <span class="k">if</span> <span class="n">no_msa</span> <span class="ow">or</span> <span class="n">msa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># or self.msa_file is None:</span>
            <span class="c1"># When no msa_used, construct our own</span>
            <span class="n">num_sequences</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">deletion_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_sequences</span><span class="p">,</span> <span class="n">number_of_residues</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">species_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>  <span class="c1"># Must include an empty &#39;&#39; as the first &quot;reference&quot; sequence</span>
            <span class="n">msa_numeric</span> <span class="o">=</span> <span class="n">sequences_to_numeric</span><span class="p">(</span>
                <span class="p">[</span><span class="n">sequence</span><span class="p">],</span> <span class="n">translation_table</span><span class="o">=</span><span class="n">numerical_translation_alph1_unknown_gaped_bytes</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msa</span><span class="p">:</span>
            <span class="n">deletion_matrix</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">deletion_matrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># [:, msa.query_indices]</span>
            <span class="n">num_sequences</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">length</span>
            <span class="n">species_ids</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">sequence_identifiers</span>
            <span class="c1"># Set the msa.alphabet_type to ensure the numerical_alignment is embedded correctly</span>
            <span class="n">msa</span><span class="o">.</span><span class="n">alphabet_type</span> <span class="o">=</span> <span class="n">protein_letters_alph1_unknown_gaped</span>
            <span class="n">msa_numeric</span> <span class="o">=</span> <span class="n">msa</span><span class="o">.</span><span class="n">numerical_alignment</span><span class="p">[:,</span> <span class="n">msa</span><span class="o">.</span><span class="n">query_indices</span><span class="p">]</span>
            <span class="c1"># self.log.critical(f&#39;982 Found {len(np.flatnonzero(msa.query_indices))} indices utilized in design&#39;)</span>
        <span class="c1"># Todo</span>
        <span class="c1">#  move to additional AlphaFold set up function...</span>
        <span class="c1">#  elif os.path.exists(self.msa_file):</span>
        <span class="c1">#      with open(self.msa_file, &#39;r&#39;) as f:</span>
        <span class="c1">#          uniclust_lines = f.read()</span>
        <span class="c1">#      file, extension = os.path.splitext(self.msa_file)</span>
        <span class="c1">#      if extension == &#39;.sto&#39;:</span>
        <span class="c1">#          uniclust30_msa = af_data_parsers.parse_stockholm(uniclust_lines)</span>
        <span class="c1">#      else:</span>
        <span class="c1">#          raise ValueError(</span>
        <span class="c1">#              f&quot;Currently, the multiple sequence alignment file type &#39;{extension}&#39; isn&#39;t supported\n&quot;</span>
        <span class="c1">#              f&quot;\tOffending file located at: {self.msa_file}&quot;)</span>
        <span class="c1">#      msas = (uniclust30_msa,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t acquire AlphaFold msa features&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found the first 5 species_ids: </span><span class="si">{</span><span class="n">species_ids</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">msa_features</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;deletion_matrix_int&#39;</span><span class="p">:</span> <span class="n">deletion_matrix</span><span class="p">,</span>
            <span class="c1"># When not single sequence, GET THIS FROM THE MATRIX PROBABLY USING CODE IN COLLAPSE PROFILE cumcount...</span>
            <span class="c1"># &#39;msa&#39;: sequences_to_numeric([sequence], translation_table=HHBLITS_AA_TO_ID).astype(dtype=np.int32),</span>
            <span class="s1">&#39;msa&#39;</span><span class="p">:</span> <span class="n">msa_numeric</span><span class="p">,</span>
            <span class="s1">&#39;num_alignments&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">number_of_residues</span><span class="p">,</span> <span class="n">num_sequences</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="c1"># Fill by the number of residues how many sequences are in the MSA</span>
            <span class="s1">&#39;msa_species_identifiers&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">id_</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">species_ids</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1"># Debug features</span>
        <span class="k">for</span> <span class="n">feat</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">msa_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For feature </span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s1">, found shape </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">heteromer</span><span class="p">:</span>
            <span class="c1"># Make a deepcopy just incase this screws up something</span>
            <span class="n">msa_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">make_msa_features_multimeric</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">msa_features</span><span class="p">)))</span>

    <span class="c1"># Template processing</span>
    <span class="k">if</span> <span class="n">templates</span><span class="p">:</span>
        <span class="n">template_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alphafold_template_features</span><span class="p">()</span>  <span class="c1"># symmetric=symmetric, heteromer=heteromer)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">template_features</span> <span class="o">=</span> <span class="n">empty_placeholder_template_features</span><span class="p">(</span><span class="n">num_templates</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_res</span><span class="o">=</span><span class="n">number_of_residues</span><span class="p">)</span>
    <span class="c1"># Debug template features</span>
    <span class="k">for</span> <span class="n">feat</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">template_features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For feature </span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s1">, found shape </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">entity_features</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">msa_features</span><span class="p">,</span>
        <span class="o">**</span><span class="n">sequence_features</span><span class="p">,</span>
        <span class="o">**</span><span class="n">template_features</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">symmetric</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="c1"># Hard code in chain_id as we are using a multimeric predict on the oligomeric version</span>
        <span class="n">chain_id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
        <span class="n">entity_features</span> <span class="o">=</span> <span class="n">af_pipeline_multimer</span><span class="o">.</span><span class="n">convert_monomer_features</span><span class="p">(</span><span class="n">entity_features</span><span class="p">,</span> <span class="n">chain_id</span><span class="o">=</span><span class="n">chain_id</span><span class="p">)</span>

        <span class="n">chain_count</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">entity_integer</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">entity_id</span> <span class="o">=</span> <span class="n">af_pipeline_multimer</span><span class="o">.</span><span class="n">int_id_to_str_id</span><span class="p">(</span><span class="n">entity_integer</span><span class="p">)</span>
        <span class="n">all_chain_features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">sym_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span><span class="p">):</span>
            <span class="c1"># chain_id = next(available_chain_ids_iter)  # The mmCIF formatted chainID with &#39;AB&#39; type notation</span>
            <span class="n">this_entity_features</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">entity_features</span><span class="p">)</span>
            <span class="c1"># Where chain_id increments for each new chain instance i.e. A_1 is 1, A_2 is 2, ...</span>
            <span class="c1"># Where entity_id increments for each new Entity instance i.e. A_1 is 1, A_2 is 1, ...</span>
            <span class="c1"># Where sym_id increments for each new Entity instance regardless of chain i.e. A_1 is 1, A_2 is 2, ...,</span>
            <span class="c1"># B_1 is 1, B2 is 2</span>
            <span class="n">this_entity_features</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;asym_id&#39;</span><span class="p">:</span> <span class="nb">next</span><span class="p">(</span><span class="n">chain_count</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">number_of_residues</span><span class="p">),</span>
                                         <span class="s1">&#39;sym_id&#39;</span><span class="p">:</span> <span class="n">sym_idx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">number_of_residues</span><span class="p">),</span>
                                         <span class="s1">&#39;entity_id&#39;</span><span class="p">:</span> <span class="n">entity_integer</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">number_of_residues</span><span class="p">)})</span>
            <span class="n">chain_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">sym_idx</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">all_chain_features</span><span class="p">[</span><span class="n">chain_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_entity_features</span>

        <span class="c1"># Alternative to pair_and_merge using hhblits a3m output</span>
        <span class="c1"># See PMID:36224222 &quot;Structural predictions of dimeric and trimeric subcomponents&quot; methods section</span>
        <span class="c1"># The first of the two MSAs is constructed by extracting the organism identifiers (OX) from the resulting</span>
        <span class="c1"># a3m file and pairing sequences using the top hit from each OX. The second is constructed by block</span>
        <span class="c1"># diagonalizing the resulting a3m file.</span>
        <span class="n">np_example</span> <span class="o">=</span> <span class="n">af_feature_processing</span><span class="o">.</span><span class="n">pair_and_merge</span><span class="p">(</span><span class="n">all_chain_features</span><span class="o">=</span><span class="n">all_chain_features</span><span class="p">)</span>
        <span class="c1"># Pad MSA to avoid zero-sized extra_msa.</span>
        <span class="n">np_example</span> <span class="o">=</span> <span class="n">af_pipeline_multimer</span><span class="o">.</span><span class="n">pad_msa</span><span class="p">(</span><span class="n">np_example</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np_example</span>  <span class="c1"># This is still a FeatureDict and could be named entity_features</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">entity_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.find_chain_symmetry" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">find_chain_symmetry</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">find_chain_symmetry</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Search for the chain symmetry by using quaternion geometry to solve the symmetric order of the rotations
 which superimpose chains on the Entity. Translates the Entity to the origin using center of mass, then the axis
of rotation only needs to be translated to the center of mass to recapitulate the specific symmetry operation</p>
<p>Requirements - all chains are the same length</p>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.mate_rotation_axes (list[dict[str, int | np.ndarray]])
self._max_symmetry (int)
self.max_symmetry_chain_idx (int)</p>
</details>


  <p>Returns:</p>
  <ul>
      <li class="field-body">
        
        <div class="doc-md-description">
          <p>The name of the file written for symmetry definition file creation</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4062</span>
<span class="normal">4063</span>
<span class="normal">4064</span>
<span class="normal">4065</span>
<span class="normal">4066</span>
<span class="normal">4067</span>
<span class="normal">4068</span>
<span class="normal">4069</span>
<span class="normal">4070</span>
<span class="normal">4071</span>
<span class="normal">4072</span>
<span class="normal">4073</span>
<span class="normal">4074</span>
<span class="normal">4075</span>
<span class="normal">4076</span>
<span class="normal">4077</span>
<span class="normal">4078</span>
<span class="normal">4079</span>
<span class="normal">4080</span>
<span class="normal">4081</span>
<span class="normal">4082</span>
<span class="normal">4083</span>
<span class="normal">4084</span>
<span class="normal">4085</span>
<span class="normal">4086</span>
<span class="normal">4087</span>
<span class="normal">4088</span>
<span class="normal">4089</span>
<span class="normal">4090</span>
<span class="normal">4091</span>
<span class="normal">4092</span>
<span class="normal">4093</span>
<span class="normal">4094</span>
<span class="normal">4095</span>
<span class="normal">4096</span>
<span class="normal">4097</span>
<span class="normal">4098</span>
<span class="normal">4099</span>
<span class="normal">4100</span>
<span class="normal">4101</span>
<span class="normal">4102</span>
<span class="normal">4103</span>
<span class="normal">4104</span>
<span class="normal">4105</span>
<span class="normal">4106</span>
<span class="normal">4107</span>
<span class="normal">4108</span>
<span class="normal">4109</span>
<span class="normal">4110</span>
<span class="normal">4111</span>
<span class="normal">4112</span>
<span class="normal">4113</span>
<span class="normal">4114</span>
<span class="normal">4115</span>
<span class="normal">4116</span>
<span class="normal">4117</span>
<span class="normal">4118</span>
<span class="normal">4119</span>
<span class="normal">4120</span>
<span class="normal">4121</span>
<span class="normal">4122</span>
<span class="normal">4123</span>
<span class="normal">4124</span>
<span class="normal">4125</span>
<span class="normal">4126</span>
<span class="normal">4127</span>
<span class="normal">4128</span>
<span class="normal">4129</span>
<span class="normal">4130</span>
<span class="normal">4131</span>
<span class="normal">4132</span>
<span class="normal">4133</span>
<span class="normal">4134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_chain_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for the chain symmetry by using quaternion geometry to solve the symmetric order of the rotations</span>
<span class="sd">     which superimpose chains on the Entity. Translates the Entity to the origin using center of mass, then the axis</span>
<span class="sd">    of rotation only needs to be translated to the center of mass to recapitulate the specific symmetry operation</span>

<span class="sd">    Requirements - all chains are the same length</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.mate_rotation_axes (list[dict[str, int | np.ndarray]])</span>
<span class="sd">        self._max_symmetry (int)</span>
<span class="sd">        self.max_symmetry_chain_idx (int)</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the file written for symmetry definition file creation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the superposition from the Entity to every mate chain</span>
    <span class="c1"># center_of_mass = self.center_of_mass</span>
    <span class="c1"># symmetric_center_of_mass = self.center_of_mass_symmetric</span>
    <span class="c1"># self.log.debug(f&#39;symmetric_center_of_mass={symmetric_center_of_mass}&#39;)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mate_rotation_axes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mate_rotation_axes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;sym&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reference chain is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>

        <span class="k">def</span> <span class="nf">_get_equivalent_coords</span><span class="p">(</span>
            <span class="n">self_ca_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">self_seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chain_</span><span class="p">:</span> <span class="n">Chain</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">self_ca_coords</span><span class="p">,</span> <span class="n">chain_</span><span class="o">.</span><span class="n">ca_coords</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">_get_equivalent_coords</span><span class="p">(</span>
            <span class="n">self_ca_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">self_seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chain_</span><span class="p">:</span> <span class="n">Chain</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
            <span class="n">chain_seq</span> <span class="o">=</span> <span class="n">chain_</span><span class="o">.</span><span class="n">sequence</span>
            <span class="n">additional_chain_coords</span> <span class="o">=</span> <span class="n">chain_</span><span class="o">.</span><span class="n">ca_coords</span>
            <span class="k">if</span> <span class="n">chain_seq</span> <span class="o">!=</span> <span class="n">self_seq</span><span class="p">:</span>
                <span class="c1"># Get aligned indices, then follow with superposition</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">chain_</span><span class="p">)</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1"> require alignment to symmetrize&#39;</span><span class="p">)</span>
                <span class="n">fixed_indices</span><span class="p">,</span> <span class="n">moving_indices</span> <span class="o">=</span> <span class="n">get_equivalent_indices</span><span class="p">(</span><span class="n">chain_seq</span><span class="p">,</span> <span class="n">self_seq</span><span class="p">)</span>
                <span class="n">additional_chain_coords</span> <span class="o">=</span> <span class="n">additional_chain_coords</span><span class="p">[</span><span class="n">fixed_indices</span><span class="p">]</span>
                <span class="n">self_ca_coords</span> <span class="o">=</span> <span class="n">self_ca_coords</span><span class="p">[</span><span class="n">moving_indices</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">self_ca_coords</span><span class="p">,</span> <span class="n">additional_chain_coords</span>

    <span class="n">ca_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca_coords</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
    <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">self_coords</span><span class="p">,</span> <span class="n">chain_coords</span> <span class="o">=</span> <span class="n">_get_equivalent_coords</span><span class="p">(</span><span class="n">ca_coords</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">chain</span><span class="p">)</span>
        <span class="n">rmsd</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">superposition3d_quat</span><span class="p">(</span><span class="n">self_coords</span><span class="p">,</span> <span class="n">chain_coords</span><span class="p">)</span>
        <span class="c1"># rmsd, quat, tx = superposition3d_quat(cb_coords-center_of_mass, chain.cb_coords-center_of_mass)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rmsd=</span><span class="si">{</span><span class="n">rmsd</span><span class="si">}</span><span class="s1"> quaternion=</span><span class="si">{</span><span class="n">quat</span><span class="si">}</span><span class="s1"> translation=</span><span class="si">{</span><span class="n">tx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">quat</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">symmetry_order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">omega</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">)</span>  <span class="c1"># Round to the nearest integer</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>  <span class="c1"># w is 1, omega is 0</span>
            <span class="c1"># No axis of symmetry here</span>
            <span class="n">symmetry_order</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t find any symmetry order for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> mate Chain </span><span class="si">{</span><span class="n">chain</span><span class="o">.</span><span class="n">chain_id</span><span class="si">}</span><span class="s2">. &quot;</span>
                             <span class="sa">f</span><span class="s1">&#39;Setting symmetry_order=</span><span class="si">{</span><span class="n">symmetry_order</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">chain</span><span class="o">.</span><span class="n">chain_id</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">symmetry_order</span><span class="si">}</span><span class="s1">-fold axis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mate_rotation_axes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;sym&#39;</span><span class="p">:</span> <span class="n">symmetry_order</span><span class="p">,</span> <span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="n">quat</span><span class="p">[:</span><span class="mi">3</span><span class="p">]})</span>

    <span class="c1"># Find the highest order symmetry in the Structure</span>
    <span class="n">max_sym</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_chain_idx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">chain_idx</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mate_rotation_axes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_sym</span><span class="p">:</span>
            <span class="n">max_sym</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span>
            <span class="n">max_chain_idx</span> <span class="o">=</span> <span class="n">chain_idx</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_max_symmetry</span> <span class="o">=</span> <span class="n">max_sym</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_symmetry_chain_idx</span> <span class="o">=</span> <span class="n">max_chain_idx</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.is_cyclic" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">is_cyclic</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_cyclic</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Report whether the symmetry is cyclic</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>bool</code>
        
        <div class="doc-md-description">
          <p>True if the Structure is cyclic, False if not</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4154</span>
<span class="normal">4155</span>
<span class="normal">4156</span>
<span class="normal">4157</span>
<span class="normal">4158</span>
<span class="normal">4159</span>
<span class="normal">4160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_cyclic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Report whether the symmetry is cyclic</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the Structure is cyclic, False if not</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_symmetry</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.is_dihedral" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">is_dihedral</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">is_dihedral</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Report whether the symmetry is dihedral</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>bool</code>
        
        <div class="doc-md-description">
          <p>True if the Structure is dihedral, False if not</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4162</span>
<span class="normal">4163</span>
<span class="normal">4164</span>
<span class="normal">4165</span>
<span class="normal">4166</span>
<span class="normal">4167</span>
<span class="normal">4168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_dihedral</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Report whether the symmetry is dihedral</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the Structure is dihedral, False if not</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_symmetry</span> <span class="o">==</span> <span class="mi">2</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.find_dihedral_chain" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">find_dihedral_chain</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">find_dihedral_chain</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>From the symmetric system, find a dihedral chain and return the instance</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a> | None</code>
        
        <div class="doc-md-description">
          <p>The dihedral mate Chain</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4170</span>
<span class="normal">4171</span>
<span class="normal">4172</span>
<span class="normal">4173</span>
<span class="normal">4174</span>
<span class="normal">4175</span>
<span class="normal">4176</span>
<span class="normal">4177</span>
<span class="normal">4178</span>
<span class="normal">4179</span>
<span class="normal">4180</span>
<span class="normal">4181</span>
<span class="normal">4182</span>
<span class="normal">4183</span>
<span class="normal">4184</span>
<span class="normal">4185</span>
<span class="normal">4186</span>
<span class="normal">4187</span>
<span class="normal">4188</span>
<span class="normal">4189</span>
<span class="normal">4190</span>
<span class="normal">4191</span>
<span class="normal">4192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_dihedral_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Entity</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Todo python 3.11 self</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From the symmetric system, find a dihedral chain and return the instance</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dihedral mate Chain</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Ensure if the structure is dihedral a selected dihedral_chain is orthogonal to the maximum symmetry axis</span>
    <span class="n">max_symmetry_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mate_rotation_axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_symmetry_chain_idx</span><span class="p">][</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">chain_idx</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mate_rotation_axes</span><span class="p">):</span>
        <span class="n">this_chain_axis</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">axis_dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">max_symmetry_axis</span><span class="p">,</span> <span class="n">this_chain_axis</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">axis_dot_product</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">this_chain_axis</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The relation between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_symmetry_chain_idx</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">chain_idx</span><span class="si">}</span><span class="s1"> would &#39;</span>
                                   <span class="s1">&#39;result in a malformed .sdf file&#39;</span><span class="p">)</span>
                    <span class="k">pass</span>  <span class="c1"># This won&#39;t work in the make_symmdef.pl script, should choose orthogonal y-axis</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">chain_idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.make_sdf" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">make_sdf</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">make_sdf</span><span class="p">(</span><span class="n">struct_file</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Use the make_symmdef_file.pl script from Rosetta to make a symmetry definition file on the Structure</p>
<p>perl $ROSETTA/source/src/apps/public/symmetry/make_symmdef_file.pl -p filepath/to/pdb.pdb -i B -q</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>struct_file</code></b>
            (<code><span title="typing.AnyStr">AnyStr</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The location of the input .pdb file</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>out_path</code></b>
            (<code><span title="typing.AnyStr">AnyStr</span></code>, default:
                <code><span title="os.getcwd">getcwd</span>()</code>
)
        
        <div class="doc-md-description">
          <p>The location the symmetry definition file should be written</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>modify_sym_energy_for_cryst</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether the symmetric energy in the file should be modified</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>energy</code></b>
        
        <div class="doc-md-description">
          <p>int = 2 - Scalar to modify the Rosetta energy by</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.AnyStr">AnyStr</span></code>
        
        <div class="doc-md-description">
          <p>Symmetry definition filename</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4194</span>
<span class="normal">4195</span>
<span class="normal">4196</span>
<span class="normal">4197</span>
<span class="normal">4198</span>
<span class="normal">4199</span>
<span class="normal">4200</span>
<span class="normal">4201</span>
<span class="normal">4202</span>
<span class="normal">4203</span>
<span class="normal">4204</span>
<span class="normal">4205</span>
<span class="normal">4206</span>
<span class="normal">4207</span>
<span class="normal">4208</span>
<span class="normal">4209</span>
<span class="normal">4210</span>
<span class="normal">4211</span>
<span class="normal">4212</span>
<span class="normal">4213</span>
<span class="normal">4214</span>
<span class="normal">4215</span>
<span class="normal">4216</span>
<span class="normal">4217</span>
<span class="normal">4218</span>
<span class="normal">4219</span>
<span class="normal">4220</span>
<span class="normal">4221</span>
<span class="normal">4222</span>
<span class="normal">4223</span>
<span class="normal">4224</span>
<span class="normal">4225</span>
<span class="normal">4226</span>
<span class="normal">4227</span>
<span class="normal">4228</span>
<span class="normal">4229</span>
<span class="normal">4230</span>
<span class="normal">4231</span>
<span class="normal">4232</span>
<span class="normal">4233</span>
<span class="normal">4234</span>
<span class="normal">4235</span>
<span class="normal">4236</span>
<span class="normal">4237</span>
<span class="normal">4238</span>
<span class="normal">4239</span>
<span class="normal">4240</span>
<span class="normal">4241</span>
<span class="normal">4242</span>
<span class="normal">4243</span>
<span class="normal">4244</span>
<span class="normal">4245</span>
<span class="normal">4246</span>
<span class="normal">4247</span>
<span class="normal">4248</span>
<span class="normal">4249</span>
<span class="normal">4250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_sdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct_file</span><span class="p">:</span> <span class="n">AnyStr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">AnyStr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use the make_symmdef_file.pl script from Rosetta to make a symmetry definition file on the Structure</span>

<span class="sd">    perl $ROSETTA/source/src/apps/public/symmetry/make_symmdef_file.pl -p filepath/to/pdb.pdb -i B -q</span>

<span class="sd">    Args:</span>
<span class="sd">        struct_file: The location of the input .pdb file</span>
<span class="sd">        out_path: The location the symmetry definition file should be written</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        modify_sym_energy_for_cryst: bool = False - Whether the symmetric energy in the file should be modified</span>
<span class="sd">        energy: int = 2 - Scalar to modify the Rosetta energy by</span>

<span class="sd">    Returns:</span>
<span class="sd">        Symmetry definition filename</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.sdf&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_file</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">out_file</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">cubic_point_groups</span><span class="p">:</span>
        <span class="n">sdf_mode</span> <span class="o">=</span> <span class="s1">&#39;PSEUDO&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Using experimental symmetry definition file generation, proceed with caution as Rosetta &#39;</span>
                         <span class="s1">&#39;runs may fail due to improper set up&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sdf_mode</span> <span class="o">=</span> <span class="s1">&#39;NCS&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">struct_file</span><span class="p">:</span>
        <span class="n">struct_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">assembly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;make_sdf_input-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100000</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">.pdb&#39;</span><span class="p">,</span>
                                 <span class="n">increment_chains</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># As increment_chains is used, get the chain name corresponding to the same index as incremental chain</span>
    <span class="n">available_chain_ids</span> <span class="o">=</span> <span class="n">chain_id_generator</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_symmetry_chain_idx</span><span class="p">):</span>
        <span class="nb">next</span><span class="p">(</span><span class="n">available_chain_ids</span><span class="p">)</span>
    <span class="n">chains</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">available_chain_ids</span><span class="p">)]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>
        <span class="n">chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_dihedral_chain</span><span class="p">()</span><span class="o">.</span><span class="n">chain_id</span><span class="p">)</span>

    <span class="n">sdf_cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;perl&#39;</span><span class="p">,</span> <span class="n">putils</span><span class="o">.</span><span class="n">make_symmdef</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="n">sdf_mode</span><span class="p">,</span> <span class="s1">&#39;-q&#39;</span><span class="p">,</span> <span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="n">struct_file</span><span class="p">,</span> <span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-i&#39;</span>
    <span class="p">]</span> <span class="o">+</span> <span class="n">chains</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Creating symmetry definition file: </span><span class="si">{</span><span class="n">subprocess</span><span class="o">.</span><span class="n">list2cmdline</span><span class="p">(</span><span class="n">sdf_cmd</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># with open(out_file, &#39;w&#39;) as file:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">sdf_cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">)</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">struct_file</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rm </span><span class="si">{</span><span class="n">struct_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DesignError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Symmetry definition file creation failed for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">format_sdf</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">to_file</span><span class="o">=</span><span class="n">out_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1">#                 modify_sym_energy_for_cryst=False, energy=2)</span>

    <span class="k">return</span> <span class="n">out_file</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.format_sdf" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">format_sdf</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">format_sdf</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="n">list</span><span class="p">,</span> <span class="n">to_file</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">modify_sym_energy_for_cryst</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">energy</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Ensure proper sdf formatting before proceeding</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>lines</code></b>
            (<code>list</code>)
        
        <div class="doc-md-description">
          <p>The symmetry definition file lines</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>to_file</code></b>
            (<code><span title="typing.AnyStr">AnyStr</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The name of the symmetry definition file</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>out_path</code></b>
            (<code><span title="typing.AnyStr">AnyStr</span></code>, default:
                <code><span title="os.getcwd">getcwd</span>()</code>
)
        
        <div class="doc-md-description">
          <p>The location the symmetry definition file should be written</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>modify_sym_energy_for_cryst</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether the symmetric energy should match crystallographic systems</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>energy</code></b>
            (<code>int</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Scalar to modify the Rosetta energy by</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.AnyStr">AnyStr</span></code>
        
        <div class="doc-md-description">
          <p>The location the symmetry definition file was written</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4252</span>
<span class="normal">4253</span>
<span class="normal">4254</span>
<span class="normal">4255</span>
<span class="normal">4256</span>
<span class="normal">4257</span>
<span class="normal">4258</span>
<span class="normal">4259</span>
<span class="normal">4260</span>
<span class="normal">4261</span>
<span class="normal">4262</span>
<span class="normal">4263</span>
<span class="normal">4264</span>
<span class="normal">4265</span>
<span class="normal">4266</span>
<span class="normal">4267</span>
<span class="normal">4268</span>
<span class="normal">4269</span>
<span class="normal">4270</span>
<span class="normal">4271</span>
<span class="normal">4272</span>
<span class="normal">4273</span>
<span class="normal">4274</span>
<span class="normal">4275</span>
<span class="normal">4276</span>
<span class="normal">4277</span>
<span class="normal">4278</span>
<span class="normal">4279</span>
<span class="normal">4280</span>
<span class="normal">4281</span>
<span class="normal">4282</span>
<span class="normal">4283</span>
<span class="normal">4284</span>
<span class="normal">4285</span>
<span class="normal">4286</span>
<span class="normal">4287</span>
<span class="normal">4288</span>
<span class="normal">4289</span>
<span class="normal">4290</span>
<span class="normal">4291</span>
<span class="normal">4292</span>
<span class="normal">4293</span>
<span class="normal">4294</span>
<span class="normal">4295</span>
<span class="normal">4296</span>
<span class="normal">4297</span>
<span class="normal">4298</span>
<span class="normal">4299</span>
<span class="normal">4300</span>
<span class="normal">4301</span>
<span class="normal">4302</span>
<span class="normal">4303</span>
<span class="normal">4304</span>
<span class="normal">4305</span>
<span class="normal">4306</span>
<span class="normal">4307</span>
<span class="normal">4308</span>
<span class="normal">4309</span>
<span class="normal">4310</span>
<span class="normal">4311</span>
<span class="normal">4312</span>
<span class="normal">4313</span>
<span class="normal">4314</span>
<span class="normal">4315</span>
<span class="normal">4316</span>
<span class="normal">4317</span>
<span class="normal">4318</span>
<span class="normal">4319</span>
<span class="normal">4320</span>
<span class="normal">4321</span>
<span class="normal">4322</span>
<span class="normal">4323</span>
<span class="normal">4324</span>
<span class="normal">4325</span>
<span class="normal">4326</span>
<span class="normal">4327</span>
<span class="normal">4328</span>
<span class="normal">4329</span>
<span class="normal">4330</span>
<span class="normal">4331</span>
<span class="normal">4332</span>
<span class="normal">4333</span>
<span class="normal">4334</span>
<span class="normal">4335</span>
<span class="normal">4336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_sdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">to_file</span><span class="p">:</span> <span class="n">AnyStr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">AnyStr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
               <span class="n">modify_sym_energy_for_cryst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">energy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensure proper sdf formatting before proceeding</span>

<span class="sd">    Args:</span>
<span class="sd">        lines: The symmetry definition file lines</span>
<span class="sd">        to_file: The name of the symmetry definition file</span>
<span class="sd">        out_path: The location the symmetry definition file should be written</span>
<span class="sd">        modify_sym_energy_for_cryst: Whether the symmetric energy should match crystallographic systems</span>
<span class="sd">        energy: Scalar to modify the Rosetta energy by</span>

<span class="sd">    Returns:</span>
<span class="sd">        The location the symmetry definition file was written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subunits</span><span class="p">,</span> <span class="n">virtuals</span><span class="p">,</span> <span class="n">jumps_com</span><span class="p">,</span> <span class="n">jumps_subunit</span><span class="p">,</span> <span class="n">trunk</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;xyz&#39;</span><span class="p">):</span>
            <span class="n">virtual</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">virtual</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_base&#39;</span><span class="p">):</span>
                <span class="n">subunits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">virtual</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">virtuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">virtual</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;VRT&#39;</span><span class="p">))</span>
            <span class="c1"># last_vrt = line + 1</span>
        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;connect_virtual&#39;</span><span class="p">):</span>
            <span class="n">jump</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;JUMP&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">jump</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_to_com&#39;</span><span class="p">):</span>
                <span class="n">jumps_com</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jump</span><span class="p">[:</span><span class="o">-</span><span class="mi">7</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">jump</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_to_subunit&#39;</span><span class="p">):</span>
                <span class="n">jumps_subunit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jump</span><span class="p">[:</span><span class="o">-</span><span class="mi">11</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jump</span><span class="p">)</span>
            <span class="n">last_jump</span> <span class="o">=</span> <span class="n">idx</span>  <span class="c1"># index where the VRTs and connect_virtuals end. The &quot;last jump&quot;</span>

    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">trunk</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">virtuals</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Symmetry Definition File VRTS are malformed. See &#39;</span><span class="si">{</span><span class="n">to_file</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subunits</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Symmetry Definition File VRTX_base are malformed. See &#39;</span><span class="si">{</span><span class="n">to_file</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dihedral</span><span class="p">():</span>  <span class="c1"># Remove dihedral connecting (trunk) virtuals: VRT, VRT0, VRT1</span>
        <span class="n">virtuals</span> <span class="o">=</span> <span class="p">[</span><span class="n">virtual</span> <span class="k">for</span> <span class="n">virtual</span> <span class="ow">in</span> <span class="n">virtuals</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">virtual</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># subunit_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">virtuals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># &#39;&#39; not present</span>
            <span class="k">pass</span>

    <span class="n">jumps_com_to_add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">virtuals</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">jumps_com</span><span class="p">)</span>
    <span class="n">count_</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">jumps_com_to_add</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">count_</span><span class="p">,</span> <span class="n">jump_com</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jumps_com_to_add</span><span class="p">,</span> <span class="n">count_</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">last_jump</span> <span class="o">+</span> <span class="n">count_</span><span class="p">,</span>
                         <span class="sa">f</span><span class="s1">&#39;connect_virtual JUMP</span><span class="si">{</span><span class="n">jump_com</span><span class="si">}</span><span class="s1">_to_com VRT</span><span class="si">{</span><span class="n">jump_com</span><span class="si">}</span><span class="s1"> VRT</span><span class="si">{</span><span class="n">jump_com</span><span class="si">}</span><span class="s1">_base&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; JUMP</span><span class="si">%s</span><span class="s1">_to_subunit&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">jumps_com_to_add</span><span class="p">))</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">jumps_com_to_add</span><span class="p">)</span>

    <span class="n">jumps_subunit_to_add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">virtuals</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">jumps_subunit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">jumps_subunit_to_add</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">count_</span><span class="p">,</span> <span class="n">jump_subunit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jumps_subunit_to_add</span><span class="p">,</span> <span class="n">count_</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">last_jump</span> <span class="o">+</span> <span class="n">count_</span><span class="p">,</span>
                         <span class="sa">f</span><span class="s1">&#39;connect_virtual JUMP</span><span class="si">{</span><span class="n">jump_subunit</span><span class="si">}</span><span class="s1">_to_subunit VRT</span><span class="si">{</span><span class="n">jump_subunit</span><span class="si">}</span><span class="s1">_base SUBUNIT&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; JUMP</span><span class="si">%s</span><span class="s1">_to_subunit&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">jumps_subunit_to_add</span><span class="p">))</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">jumps_subunit_to_add</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">modify_sym_energy_for_cryst</span><span class="p">:</span>
        <span class="c1"># new energy should equal the energy multiplier times the scoring subunit plus additional complex subunits</span>
        <span class="c1"># where complex subunits = num_subunits - 1</span>
        <span class="c1"># new_energy = &#39;E = %d*%s + &#39; % (energy, subunits[0])  # assumes subunits are read in alphanumerical order</span>
        <span class="c1"># new_energy += &#39; + &#39;.join(&#39;1*(%s:%s)&#39; % t for t in zip(repeat(subunits[0]), subunits[1:]))</span>
        <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;E = 2*</span><span class="si">{</span><span class="n">subunits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">+</span><span class="si">{</span><span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1*(</span><span class="si">{</span><span class="n">subunits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="s2">)&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pair</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">subunits</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">energy</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subunits</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
            <span class="sa">f</span><span class="s1">&#39;E = </span><span class="si">{</span><span class="n">energy</span><span class="si">}</span><span class="s1">*</span><span class="si">{</span><span class="n">subunits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">+</span><span class="si">{</span><span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">energy</span><span class="si">}</span><span class="s2">*(</span><span class="si">{</span><span class="n">subunits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="s2">)&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pair</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">subunits</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">to_file</span><span class="p">:</span>
        <span class="n">to_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.sdf&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">to_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">count_</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Symmetry Definition File &#39;</span><span class="si">{</span><span class="n">to_file</span><span class="si">}</span><span class="s2">&#39; was missing </span><span class="si">{</span><span class="n">count_</span><span class="si">}</span><span class="s2"> lines. A fix was attempted and &quot;</span>
                      <span class="s1">&#39;modeling may be affected&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_file</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.reset_mates" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">reset_mates</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">reset_mates</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Remove oligomeric chains. They should be generated fresh</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4338</span>
<span class="normal">4339</span>
<span class="normal">4340</span>
<span class="normal">4341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset_mates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove oligomeric chains. They should be generated fresh&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Entity.fragment_db" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">fragment_db</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">fragment_db</span><span class="p">(</span><span class="n">fragment_db</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.fragment.db.FragmentDatabase" href="../fragment/db/#structure.fragment.db.FragmentDatabase">FragmentDatabase</a></span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Set the Structure FragmentDatabase to assist with Fragment creation, manipulation, and profiles.
Sets .fragment_db for each dependent Structure in 'structure_containers'</p>
<p>Entity specific implementation to prevent recursion with [1:]</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4343</span>
<span class="normal">4344</span>
<span class="normal">4345</span>
<span class="normal">4346</span>
<span class="normal">4347</span>
<span class="normal">4348</span>
<span class="normal">4349</span>
<span class="normal">4350</span>
<span class="normal">4351</span>
<span class="normal">4352</span>
<span class="normal">4353</span>
<span class="normal">4354</span>
<span class="normal">4355</span>
<span class="normal">4356</span>
<span class="normal">4357</span>
<span class="normal">4358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@ContainsResidues</span><span class="o">.</span><span class="n">fragment_db</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">fragment_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fragment_db</span><span class="p">:</span> <span class="n">FragmentDatabase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the Structure FragmentDatabase to assist with Fragment creation, manipulation, and profiles.</span>
<span class="sd">    Sets .fragment_db for each dependent Structure in &#39;structure_containers&#39;</span>

<span class="sd">    Entity specific implementation to prevent recursion with [1:]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set this instance then set all dependents</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">)</span><span class="o">.</span><span class="n">fragment_db</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fragment_db</span><span class="p">)</span>
    <span class="n">_fragment_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fragment_db</span>
    <span class="k">if</span> <span class="n">_fragment_db</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">structure_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">structure_type</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">fragment_db</span> <span class="o">=</span> <span class="n">_fragment_db</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># This is likely the RELOAD_DB token. Just return.</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.Model" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Model</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">Model</span><span class="p">(</span><span class="n">chains</span><span class="p">:</span> <span class="n">bool</span> <span class="o">|</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">chain_ids</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rename_chains</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">as_mates</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.ContainsChains" href="#structure.model.ContainsChains">ContainsChains</a></code></p>

  
      <p>The main class for simple Structure manipulation, particularly containing multiple Chain instances</p>
<p>Can initialize by passing a file, or passing Atom/Residue/Chain instances. If your Structure is symmetric, a
SymmetricModel should be used instead. If you have multiple Model instances, use the MultiModel class.</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>chain_ids</code></b>
            (<code><span title="collections.abc.Iterable">Iterable</span>[str]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A list of identifiers to assign to each Chain instance</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>chains</code></b>
            (<code>bool | <span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="structure.model.Chain" href="#structure.model.Chain">Chain</a>]</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether to create Chain instances from passed Structure container instances, or existing Chain
instances to create the Model with</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rename_chains</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to name each chain an incrementally new Alphabetical character</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>as_mates</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether Chain instances should be controlled by a captain (True), or be dependents</p>
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chains</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Chain</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">chain_ids</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">rename_chains</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">as_mates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        chain_ids: A list of identifiers to assign to each Chain instance</span>
<span class="sd">        chains: Whether to create Chain instances from passed Structure container instances, or existing Chain</span>
<span class="sd">            instances to create the Model with</span>
<span class="sd">        rename_chains: Whether to name each chain an incrementally new Alphabetical character</span>
<span class="sd">        as_mates: Whether Chain instances should be controlled by a captain (True), or be dependents</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># ContainsChains</span>
    <span class="c1"># Use the same list as default to save parsed chain ids</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">original_chain_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">chains</span><span class="p">:</span>  <span class="c1"># Populate chains</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure_containers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;_chains&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="c1"># Set the chains accordingly, copying them to remove prior relationships</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_structure_containers</span><span class="p">()</span>  <span class="c1"># Copy each Chain in chains</span>
            <span class="k">if</span> <span class="n">as_mates</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DesignError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t initialize </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.chains as it is missing &#39;.residues&#39; while &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">as_mates</span><span class="si">=}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Create the instance from existing chains</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assign_residues_from_structures</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span>
                <span class="c1"># Reindex all residue and atom indices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reset_and_reindex_structures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">)</span>
                <span class="c1"># Set the parent attribute for all containers</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_structure_container_attributes</span><span class="p">(</span><span class="n">_parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">chain_ids</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">id_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">,</span> <span class="n">chain_ids</span><span class="p">):</span>
                    <span class="n">chain</span><span class="o">.</span><span class="n">chain_id</span> <span class="o">=</span> <span class="n">id_</span>
            <span class="c1"># By using extend, self.original_chain_ids are set as well</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">chain</span><span class="o">.</span><span class="n">chain_id</span> <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Create Chain instances from Residues</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_chains</span><span class="p">(</span><span class="n">chain_ids</span><span class="o">=</span><span class="n">chain_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">as_mates</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
                    <span class="n">chain</span><span class="o">.</span><span class="n">make_parent</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">rename_chains</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_chain_ids_pdb_compatible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename_chains</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original chain_ids: </span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_chain_ids</span><span class="p">)</span><span class="si">}</span><span class="s1"> | &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;Loaded chain_ids: </span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_parent</span><span class="p">():</span>
        <span class="n">reference_sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">reference_sequence</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference_sequence</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># Was parsed from file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_reference_sequence_from_seqres</span><span class="p">(</span><span class="n">reference_sequence</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                </details>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.Models" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Models</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">Models</span><span class="p">(</span><span class="n">models</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.ContainsEntities" href="#structure.model.ContainsEntities">ContainsEntities</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="collections.UserList">UserList</span></code></p>

  
      <p>Container for Model instances. Primarily used for writing [symmetric] multimodel-like Structure instances</p>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4462</span>
<span class="normal">4463</span>
<span class="normal">4464</span>
<span class="normal">4465</span>
<span class="normal">4466</span>
<span class="normal">4467</span>
<span class="normal">4468</span>
<span class="normal">4469</span>
<span class="normal">4470</span>
<span class="normal">4471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">ContainsEntities</span> <span class="o">|</span> <span class="n">Entity</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">initlist</span><span class="o">=</span><span class="n">models</span><span class="p">)</span>  <span class="c1"># Sets UserList.data to models</span>

    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">(</span><span class="n">ContainsEntities</span><span class="p">,</span> <span class="n">Entity</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can&#39;t initialize </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> with a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. Must be an Iterable&quot;</span>
                <span class="sa">f</span><span class="s1">&#39; of </span><span class="si">{</span><span class="n">Model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;Nameless-</span><span class="si">{</span><span class="n">Models</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Models.number_of_models" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">number_of_models</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">number_of_models</span><span class="p">:</span> <span class="n">int</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The number of unique models that are found in the Models object</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.Models.from_models" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_models</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_models</span><span class="p">(</span><span class="n">models</span><span class="p">:</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Model" href="#structure.model.Model">Model</a></span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Initialize from an iterable of Model instances</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4457</span>
<span class="normal">4458</span>
<span class="normal">4459</span>
<span class="normal">4460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_models</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Model</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize from an iterable of Model instances&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Models.write" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">write</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n">bytes</span> <span class="o">|</span> <span class="n">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file_handle</span><span class="p">:</span> <span class="n"><span title="typing.IO">IO</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multimodel</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">increment_chains</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Write Model Atoms to a file specified by out_path or with a passed file_handle</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>out_path</code></b>
            (<code>bytes | str</code>, default:
                <code><span title="os.getcwd">getcwd</span>()</code>
)
        
        <div class="doc-md-description">
          <p>The location where the Structure object should be written to disk</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>file_handle</code></b>
            (<code><span title="typing.IO">IO</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Used to write Structure details to an open FileObject</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>header</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A string that is desired at the top of the file</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>multimodel</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether MODEL and ENDMDL records should be added at the end of each Model</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>increment_chains</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to write each Chain with an incrementing chain ID,
otherwise use the chain IDs present, repeating for each Model</p>
        </div>
      </li>
  </ul>
      <p>Keyword Args
    assembly: bool = False - Whether to write an assembly representation of each Model instance</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.AnyStr">AnyStr</span> | None</code>
        
        <div class="doc-md-description">
          <p>The name of the written file if out_path is used</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4501</span>
<span class="normal">4502</span>
<span class="normal">4503</span>
<span class="normal">4504</span>
<span class="normal">4505</span>
<span class="normal">4506</span>
<span class="normal">4507</span>
<span class="normal">4508</span>
<span class="normal">4509</span>
<span class="normal">4510</span>
<span class="normal">4511</span>
<span class="normal">4512</span>
<span class="normal">4513</span>
<span class="normal">4514</span>
<span class="normal">4515</span>
<span class="normal">4516</span>
<span class="normal">4517</span>
<span class="normal">4518</span>
<span class="normal">4519</span>
<span class="normal">4520</span>
<span class="normal">4521</span>
<span class="normal">4522</span>
<span class="normal">4523</span>
<span class="normal">4524</span>
<span class="normal">4525</span>
<span class="normal">4526</span>
<span class="normal">4527</span>
<span class="normal">4528</span>
<span class="normal">4529</span>
<span class="normal">4530</span>
<span class="normal">4531</span>
<span class="normal">4532</span>
<span class="normal">4533</span>
<span class="normal">4534</span>
<span class="normal">4535</span>
<span class="normal">4536</span>
<span class="normal">4537</span>
<span class="normal">4538</span>
<span class="normal">4539</span>
<span class="normal">4540</span>
<span class="normal">4541</span>
<span class="normal">4542</span>
<span class="normal">4543</span>
<span class="normal">4544</span>
<span class="normal">4545</span>
<span class="normal">4546</span>
<span class="normal">4547</span>
<span class="normal">4548</span>
<span class="normal">4549</span>
<span class="normal">4550</span>
<span class="normal">4551</span>
<span class="normal">4552</span>
<span class="normal">4553</span>
<span class="normal">4554</span>
<span class="normal">4555</span>
<span class="normal">4556</span>
<span class="normal">4557</span>
<span class="normal">4558</span>
<span class="normal">4559</span>
<span class="normal">4560</span>
<span class="normal">4561</span>
<span class="normal">4562</span>
<span class="normal">4563</span>
<span class="normal">4564</span>
<span class="normal">4565</span>
<span class="normal">4566</span>
<span class="normal">4567</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file_handle</span><span class="p">:</span> <span class="n">IO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">multimodel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">increment_chains</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write Model Atoms to a file specified by out_path or with a passed file_handle</span>

<span class="sd">    Args:</span>
<span class="sd">        out_path: The location where the Structure object should be written to disk</span>
<span class="sd">        file_handle: Used to write Structure details to an open FileObject</span>
<span class="sd">        header: A string that is desired at the top of the file</span>
<span class="sd">        multimodel: Whether MODEL and ENDMDL records should be added at the end of each Model</span>
<span class="sd">        increment_chains: Whether to write each Chain with an incrementing chain ID,</span>
<span class="sd">            otherwise use the chain IDs present, repeating for each Model</span>

<span class="sd">    Keyword Args</span>
<span class="sd">        assembly: bool = False - Whether to write an assembly representation of each Model instance</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the written file if out_path is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Models</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> is writing </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">increment_chains</span><span class="p">:</span>
            <span class="n">available_chain_ids</span> <span class="o">=</span> <span class="n">chain_id_generator</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">_get_chain_id</span><span class="p">(</span><span class="n">struct</span><span class="p">:</span> <span class="n">Chain</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">available_chain_ids</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">_get_chain_id</span><span class="p">(</span><span class="n">struct</span><span class="p">:</span> <span class="n">Chain</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">chain_id</span>

        <span class="n">chain</span><span class="p">:</span> <span class="n">Chain</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">_write_model</span><span class="p">(</span><span class="n">_model</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">offset</span>
            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">_model</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
                <span class="n">chain_id</span> <span class="o">=</span> <span class="n">_get_chain_id</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
                <span class="n">chain</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">chain_id</span><span class="o">=</span><span class="n">chain_id</span><span class="p">,</span> <span class="n">atom_offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">c_term_residue</span><span class="p">:</span> <span class="n">Residue</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">c_terminal_residue</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">chain</span><span class="o">.</span><span class="n">number_of_atoms</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TER   </span><span class="si">{</span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s1">&gt;5d</span><span class="si">}</span><span class="s1">      </span><span class="si">{</span><span class="n">c_term_residue</span><span class="o">.</span><span class="n">type</span><span class="si">:</span><span class="s1">3s</span><span class="si">}</span><span class="s1"> &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">chain_id</span><span class="si">:</span><span class="s1">1s</span><span class="si">}{</span><span class="n">c_term_residue</span><span class="o">.</span><span class="n">number</span><span class="si">:</span><span class="s1">&gt;4d</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">multimodel</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">model_number</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:9s}{:&gt;4d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;MODEL&#39;</span><span class="p">,</span> <span class="n">model_number</span><span class="p">))</span>
                <span class="n">_write_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ENDMDL</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">_write_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file_handle</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_write</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># out_path always has default argument current working directory</span>
        <span class="n">_header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># self.format_header(**kwargs)</span>
        <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">header</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="n">_header</span> <span class="o">+=</span> <span class="p">(</span><span class="n">header</span> <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_header</span><span class="p">)</span>
            <span class="n">_write</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out_path</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.SymmetricModel" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">SymmetricModel</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">SymmetricModel</span><span class="p">(</span><span class="n">sym_entry</span><span class="p">:</span> <span class="n"><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span></span> <span class="o">|</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">transformations</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry_operators</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation_matrices</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translation_matrices</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.SymmetryOpsMixin" href="#structure.model.SymmetryOpsMixin">SymmetryOpsMixin</a></code>, <code><a class="autorefs autorefs-internal" title="structure.model.ContainsEntities" href="#structure.model.ContainsEntities">ContainsEntities</a></code></p>

  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>sym_entry</code></b>
            (<code><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span> | int</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The SymEntry which specifies all symmetry parameters</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>symmetry</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The name of a symmetry to be searched against compatible symmetries</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>transformations</code></b>
            (<code>list[<span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span>]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Transformation operations that reproduce the oligomeric/assembly for each Entity</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rotation_matrices</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Rotation operations that create the symmetric state</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>translation_matrices</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Translation operations that create the symmetric state</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>uc_dimensions</code></b>
            (<code>list[float]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The unit cell dimensions for the crystalline symmetry</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>symmetry_operators</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A set of custom expansion matrices</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>surrounding_uc</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether the 3x3 layer group, or 3x3x3 space group should be generated</p>
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym_entry</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">SymEntry</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">transformations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">TransformationMapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">symmetry_operators</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation_matrices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">translation_matrices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        sym_entry: The SymEntry which specifies all symmetry parameters</span>
<span class="sd">        symmetry: The name of a symmetry to be searched against compatible symmetries</span>
<span class="sd">        transformations: Transformation operations that reproduce the oligomeric/assembly for each Entity</span>
<span class="sd">        rotation_matrices: Rotation operations that create the symmetric state</span>
<span class="sd">        translation_matrices: Translation operations that create the symmetric state</span>
<span class="sd">        uc_dimensions: The unit cell dimensions for the crystalline symmetry</span>
<span class="sd">        symmetry_operators: A set of custom expansion matrices</span>
<span class="sd">        surrounding_uc: Whether the 3x3 layer group, or 3x3x3 space group should be generated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># SymmetryOpsMixin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_symmetry</span><span class="p">(</span><span class="n">sym_entry</span><span class="o">=</span><span class="n">sym_entry</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="o">=</span><span class="n">uc_dimensions</span><span class="p">,</span>
                      <span class="n">operators</span><span class="o">=</span><span class="n">symmetry_operators</span><span class="p">,</span> <span class="n">rotations</span><span class="o">=</span><span class="n">rotation_matrices</span><span class="p">,</span> <span class="n">translations</span><span class="o">=</span><span class="n">translation_matrices</span><span class="p">,</span>
                      <span class="n">transformations</span><span class="o">=</span><span class="n">transformations</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="o">=</span><span class="n">surrounding_uc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetricModel.symmetric_coords_split_by_entity" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">symmetric_coords_split_by_entity</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">symmetric_coords_split_by_entity</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>A view of the symmetric coords split for each symmetric model by the Pose Entity indices</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetricModel.symmetric_coords_by_entity" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">symmetric_coords_by_entity</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">symmetric_coords_by_entity</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>A view of the symmetric coords for each Entity in order of the Pose Entity indices</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetricModel.center_of_mass_symmetric_entities" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">center_of_mass_symmetric_entities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">center_of_mass_symmetric_entities</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The center of mass position for each Entity instance in the symmetric system for each symmetry mate with
shape [(number_of_symmetry_mates, 3), ... number_of_entities]</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetricModel.assembly" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">assembly</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">assembly</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Model" href="#structure.model.Model">Model</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Provides the Structure object containing all symmetric chains in the assembly unless the design is 2- or 3-D
then the assembly only contains the contacting models</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetricModel.assembly_minimally_contacting" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">assembly_minimally_contacting</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">assembly_minimally_contacting</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Model" href="#structure.model.Model">Model</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Provides the Structure object only containing the SymmetricModel instances contacting the ASU</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetricModel.entity_transformations" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">entity_transformations</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">entity_transformations</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span></span><span class="p">]</span> <span class="o">|</span> <span class="n">list</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The transformation parameters for each Entity in the SymmetricModel. Each entry has the
TransformationMapping type</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.SymmetricModel.assembly_tree" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">assembly_tree</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">assembly_tree</span><span class="p">:</span> <span class="n"><span title="structure.model.BinaryTreeType">BinaryTreeType</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Holds the tree structure of the backbone and cb symmetric_coords not including the asu coords</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.from_assembly" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">from_assembly</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">from_assembly</span><span class="p">(</span><span class="n">assembly</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Model" href="#structure.model.Model">Model</a></span><span class="p">,</span> <span class="n">sym_entry</span><span class="p">:</span> <span class="n"><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span></span> <span class="o">|</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Initialize from a symmetric assembly</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4591</span>
<span class="normal">4592</span>
<span class="normal">4593</span>
<span class="normal">4594</span>
<span class="normal">4595</span>
<span class="normal">4596</span>
<span class="normal">4597</span>
<span class="normal">4598</span>
<span class="normal">4599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_assembly</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">assembly</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">sym_entry</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">SymEntry</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">symmetry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize from a symmetric assembly&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">symmetry</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sym_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Can&#39;t initialize without symmetry. Pass &#39;symmetry&#39; or &#39;sym_entry&#39; to &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">from_assembly</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">() constructor&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">assembly</span><span class="p">,</span> <span class="n">sym_entry</span><span class="o">=</span><span class="n">sym_entry</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.set_symmetry" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">set_symmetry</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">set_symmetry</span><span class="p">(</span><span class="n">sym_entry</span><span class="p">:</span> <span class="n"><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span></span> <span class="o">|</span> <span class="n">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">crystal</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cryst_record</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">operators</span><span class="p">:</span> <span class="n">tuple</span><span class="p">[</span><span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]],</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotations</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translations</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span> <span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">transformations</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Set the model symmetry using the CRYST1 record, or the unit cell dimensions and the Hermann-Mauguin symmetry
notation (in CRYST1 format, ex P432) for the Model assembly. If the assembly is a point group, only the symmetry
notation is required</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>sym_entry</code></b>
            (<code><span title="symdesign.utils.SymEntry.SymEntry">SymEntry</span> | int</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The SymEntry which specifies all symmetry parameters</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>symmetry</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The name of a symmetry to be searched against compatible symmetries</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>crystal</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether crystalline symmetry should be used</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>cryst_record</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>If a CRYST1 record is known and should be used</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>uc_dimensions</code></b>
            (<code>list[float]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The unit cell dimensions for the crystalline symmetry</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>operators</code></b>
            (<code>tuple[<span title="numpy.ndarray">ndarray</span> | list[list[float]], <span title="numpy.ndarray">ndarray</span> | list[float]] | <span title="numpy.ndarray">ndarray</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A set of custom expansion matrices</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>rotations</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list[list[float]]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A set of rotation matrices used to recapitulate the SymmetricModel from the asymmetric unit</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>translations</code></b>
            (<code><span title="numpy.ndarray">ndarray</span> | list[float]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A set of translation vectors used to recapitulate the SymmetricModel from the asymmetric unit</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>transformations</code></b>
            (<code>list[<span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span>]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Transformation operations that reproduce the oligomeric state for each Entity</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>surrounding_uc</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether the 3x3 layer group, or 3x3x3 space group should be generated</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>crystal</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether crystalline symmetry should be used</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>cryst_record</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>If a CRYST1 record is known and should be used</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4608</span>
<span class="normal">4609</span>
<span class="normal">4610</span>
<span class="normal">4611</span>
<span class="normal">4612</span>
<span class="normal">4613</span>
<span class="normal">4614</span>
<span class="normal">4615</span>
<span class="normal">4616</span>
<span class="normal">4617</span>
<span class="normal">4618</span>
<span class="normal">4619</span>
<span class="normal">4620</span>
<span class="normal">4621</span>
<span class="normal">4622</span>
<span class="normal">4623</span>
<span class="normal">4624</span>
<span class="normal">4625</span>
<span class="normal">4626</span>
<span class="normal">4627</span>
<span class="normal">4628</span>
<span class="normal">4629</span>
<span class="normal">4630</span>
<span class="normal">4631</span>
<span class="normal">4632</span>
<span class="normal">4633</span>
<span class="normal">4634</span>
<span class="normal">4635</span>
<span class="normal">4636</span>
<span class="normal">4637</span>
<span class="normal">4638</span>
<span class="normal">4639</span>
<span class="normal">4640</span>
<span class="normal">4641</span>
<span class="normal">4642</span>
<span class="normal">4643</span>
<span class="normal">4644</span>
<span class="normal">4645</span>
<span class="normal">4646</span>
<span class="normal">4647</span>
<span class="normal">4648</span>
<span class="normal">4649</span>
<span class="normal">4650</span>
<span class="normal">4651</span>
<span class="normal">4652</span>
<span class="normal">4653</span>
<span class="normal">4654</span>
<span class="normal">4655</span>
<span class="normal">4656</span>
<span class="normal">4657</span>
<span class="normal">4658</span>
<span class="normal">4659</span>
<span class="normal">4660</span>
<span class="normal">4661</span>
<span class="normal">4662</span>
<span class="normal">4663</span>
<span class="normal">4664</span>
<span class="normal">4665</span>
<span class="normal">4666</span>
<span class="normal">4667</span>
<span class="normal">4668</span>
<span class="normal">4669</span>
<span class="normal">4670</span>
<span class="normal">4671</span>
<span class="normal">4672</span>
<span class="normal">4673</span>
<span class="normal">4674</span>
<span class="normal">4675</span>
<span class="normal">4676</span>
<span class="normal">4677</span>
<span class="normal">4678</span>
<span class="normal">4679</span>
<span class="normal">4680</span>
<span class="normal">4681</span>
<span class="normal">4682</span>
<span class="normal">4683</span>
<span class="normal">4684</span>
<span class="normal">4685</span>
<span class="normal">4686</span>
<span class="normal">4687</span>
<span class="normal">4688</span>
<span class="normal">4689</span>
<span class="normal">4690</span>
<span class="normal">4691</span>
<span class="normal">4692</span>
<span class="normal">4693</span>
<span class="normal">4694</span>
<span class="normal">4695</span>
<span class="normal">4696</span>
<span class="normal">4697</span>
<span class="normal">4698</span>
<span class="normal">4699</span>
<span class="normal">4700</span>
<span class="normal">4701</span>
<span class="normal">4702</span>
<span class="normal">4703</span>
<span class="normal">4704</span>
<span class="normal">4705</span>
<span class="normal">4706</span>
<span class="normal">4707</span>
<span class="normal">4708</span>
<span class="normal">4709</span>
<span class="normal">4710</span>
<span class="normal">4711</span>
<span class="normal">4712</span>
<span class="normal">4713</span>
<span class="normal">4714</span>
<span class="normal">4715</span>
<span class="normal">4716</span>
<span class="normal">4717</span>
<span class="normal">4718</span>
<span class="normal">4719</span>
<span class="normal">4720</span>
<span class="normal">4721</span>
<span class="normal">4722</span>
<span class="normal">4723</span>
<span class="normal">4724</span>
<span class="normal">4725</span>
<span class="normal">4726</span>
<span class="normal">4727</span>
<span class="normal">4728</span>
<span class="normal">4729</span>
<span class="normal">4730</span>
<span class="normal">4731</span>
<span class="normal">4732</span>
<span class="normal">4733</span>
<span class="normal">4734</span>
<span class="normal">4735</span>
<span class="normal">4736</span>
<span class="normal">4737</span>
<span class="normal">4738</span>
<span class="normal">4739</span>
<span class="normal">4740</span>
<span class="normal">4741</span>
<span class="normal">4742</span>
<span class="normal">4743</span>
<span class="normal">4744</span>
<span class="normal">4745</span>
<span class="normal">4746</span>
<span class="normal">4747</span>
<span class="normal">4748</span>
<span class="normal">4749</span>
<span class="normal">4750</span>
<span class="normal">4751</span>
<span class="normal">4752</span>
<span class="normal">4753</span>
<span class="normal">4754</span>
<span class="normal">4755</span>
<span class="normal">4756</span>
<span class="normal">4757</span>
<span class="normal">4758</span>
<span class="normal">4759</span>
<span class="normal">4760</span>
<span class="normal">4761</span>
<span class="normal">4762</span>
<span class="normal">4763</span>
<span class="normal">4764</span>
<span class="normal">4765</span>
<span class="normal">4766</span>
<span class="normal">4767</span>
<span class="normal">4768</span>
<span class="normal">4769</span>
<span class="normal">4770</span>
<span class="normal">4771</span>
<span class="normal">4772</span>
<span class="normal">4773</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym_entry</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">SymEntry</span><span class="o">.</span><span class="n">SymEntry</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">crystal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cryst_record</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">operators</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rotations</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">translations</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">transformations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">TransformationMapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">surrounding_uc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the model symmetry using the CRYST1 record, or the unit cell dimensions and the Hermann-Mauguin symmetry</span>
<span class="sd">    notation (in CRYST1 format, ex P432) for the Model assembly. If the assembly is a point group, only the symmetry</span>
<span class="sd">    notation is required</span>

<span class="sd">    Args:</span>
<span class="sd">        sym_entry: The SymEntry which specifies all symmetry parameters</span>
<span class="sd">        symmetry: The name of a symmetry to be searched against compatible symmetries</span>
<span class="sd">        crystal: Whether crystalline symmetry should be used</span>
<span class="sd">        cryst_record: If a CRYST1 record is known and should be used</span>
<span class="sd">        uc_dimensions: The unit cell dimensions for the crystalline symmetry</span>
<span class="sd">        operators: A set of custom expansion matrices</span>
<span class="sd">        rotations: A set of rotation matrices used to recapitulate the SymmetricModel from the asymmetric unit</span>
<span class="sd">        translations: A set of translation vectors used to recapitulate the SymmetricModel from the asymmetric unit</span>
<span class="sd">        transformations: Transformation operations that reproduce the oligomeric state for each Entity</span>
<span class="sd">        surrounding_uc: Whether the 3x3 layer group, or 3x3x3 space group should be generated</span>
<span class="sd">        crystal: Whether crystalline symmetry should be used</span>
<span class="sd">        cryst_record: If a CRYST1 record is known and should be used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_symmetry</span><span class="p">(</span>
        <span class="n">sym_entry</span><span class="o">=</span><span class="n">sym_entry</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">,</span>
        <span class="n">crystal</span><span class="o">=</span><span class="n">crystal</span><span class="p">,</span> <span class="n">cryst_record</span><span class="o">=</span><span class="n">cryst_record</span><span class="p">,</span> <span class="n">uc_dimensions</span><span class="o">=</span><span class="n">uc_dimensions</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">number_of_symmetry_mates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="c1"># No symmetry keyword args were passed</span>
        <span class="k">if</span> <span class="n">operators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">translations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">passed_args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">operators</span><span class="p">:</span>
                <span class="n">passed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;operators&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rotations</span><span class="p">:</span>
                <span class="n">passed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">translations</span><span class="p">:</span>
                <span class="n">passed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ConstructionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t set_symmetry() using </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">passed_args</span><span class="p">)</span><span class="si">}</span><span class="s2"> without explicitly passing &quot;</span>
                <span class="s2">&quot;&#39;symmetry&#39; or &#39;sym_entry&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Set rotations and translations to the correct symmetry operations</span>
    <span class="c1"># where operators, rotations, and translations are user provided from some sort of BIOMT (fiber, other)</span>
    <span class="k">if</span> <span class="n">operators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">symmetry_source_arg</span> <span class="o">=</span> <span class="s2">&quot;&#39;operators&#39; &quot;</span>

        <span class="n">num_operators</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">operators</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operators</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">num_operators</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Providing custom symmetry &#39;operators&#39; may result in improper symmetric &quot;</span>
                             <span class="s1">&#39;configuration. Proceed with caution&#39;</span><span class="p">)</span>
            <span class="n">rotations</span><span class="p">,</span> <span class="n">translations</span> <span class="o">=</span> <span class="n">operators</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operators</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="n">num_operators</span> <span class="o">==</span> <span class="n">number_of_symmetry_mates</span><span class="p">:</span>
            <span class="n">rotations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">translations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rot</span><span class="p">,</span> <span class="n">tx</span> <span class="ow">in</span> <span class="n">operators</span><span class="p">:</span>
                    <span class="n">rotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
                    <span class="n">translations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># Unpack failed</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t parse the &#39;operators&#39;=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">operators</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;Expected a Sequence[rotation shape=(3,3). translation shape=(3,)] pairs.&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operators</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">operators</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="c1"># Parse from a single input of 3 row by 4 column style, like BIOMT</span>
                <span class="n">rotations</span> <span class="o">=</span> <span class="n">operators</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">translations</span> <span class="o">=</span> <span class="n">operators</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">operators</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Assume just rotations</span>
                <span class="n">rotations</span> <span class="o">=</span> <span class="n">operators</span>
                <span class="n">translations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rotations</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConstructionError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The &#39;operators&#39; form </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">operators</span><span class="p">)</span><span class="si">}</span><span class="s2"> isn&#39;t supported.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConstructionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The &#39;operators&#39; form </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">operators</span><span class="p">)</span><span class="si">}</span><span class="s2"> isn&#39;t supported. Must provide a tuple of &quot;</span>
                <span class="s1">&#39;array-like objects with the order (rotation matrices, translation vectors) or use the &#39;</span>
                <span class="s2">&quot;&#39;rotations&#39; and &#39;translations&#39; keyword args&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">symmetry_source_arg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Now that symmetry is set, check if the Structure parsed all symmetric chains</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span> <span class="o">*</span> <span class="n">number_of_symmetry_mates</span><span class="p">:</span>
        <span class="n">parsed_assembly</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parsed_assembly</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set the symmetry operations</span>
    <span class="k">if</span> <span class="n">rotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">translations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotations</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">rotations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">rotations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rotations</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># Assume operators were provided in a standard orientation and transpose for subsequent efficiency</span>
            <span class="c1"># Using .swapaxes(-2, -1) call here instead of .transpose() for safety</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">rotations</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">symmetry_source_arg</span><span class="si">}</span><span class="s2">rotation matrices with 3 dimensions, not </span><span class="si">{</span><span class="n">rotations</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;dimensions. Ensure the passed rotation matrices have a shape of (N symmetry operations, 3, 3)&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">translations</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">translations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">translations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">translations</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Assume operators were provided in a standard orientation each vector needs to be in own array on dim=2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="n">translations</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">symmetry_source_arg</span><span class="si">}</span><span class="s2">translation vectors with 2 dimensions, not </span><span class="si">{</span><span class="n">translations</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;dimensions. Ensure the passed translations have a shape of (N symmetry operations, 3)&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># The symmetry operators must be possible to find or canonical.</span>
        <span class="n">symmetry_source_arg</span> <span class="o">=</span> <span class="s2">&quot;&#39;chains&#39; &quot;</span>
        <span class="c1"># Get canonical operators</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># The _expand_matrices rotation matrices are pre-transposed to avoid repetitive operations</span>
            <span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">point_group_symmetry_operatorsT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">]</span>
            <span class="c1"># The _expand_translations vectors are pre-sliced to enable numpy operations</span>
            <span class="n">_expand_translations</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>

            <span class="k">if</span> <span class="n">parsed_assembly</span><span class="p">:</span>
                <span class="c1"># The Structure should have symmetric chains</span>
                <span class="c1"># Set up symmetry operations using orient</span>

                <span class="c1"># Save the original position for subsequent reversion</span>
                <span class="n">ca_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1"># Transform to canonical orientation.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orient</span><span class="p">()</span>
                <span class="c1"># Set the symmetry operations again as they are incorrect after orient()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">_expand_matrices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="n">_expand_translations</span>
                <span class="c1"># Next, transform back to original and carry the correctly situated symmetry operations along.</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">superposition3d</span><span class="p">(</span><span class="n">ca_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca_coords</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">translation</span><span class="o">=</span><span class="n">tx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span> <span class="o">=</span> <span class="n">_expand_matrices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> <span class="n">_expand_translations</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_matrices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_translations</span> <span class="o">=</span> \
                <span class="n">utils</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">space_group_symmetry_operatorsT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">]</span>

    <span class="c1"># Removed parsed chain information</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_mates</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric_coords</span><span class="o">.</span><span class="n">coords</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_symmetric_coords</span><span class="p">(</span><span class="n">surrounding_uc</span><span class="o">=</span><span class="n">surrounding_uc</span><span class="p">)</span>

    <span class="c1"># Check if the oligomer is constructed for each entity</span>
    <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">subunit_number</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_entry</span><span class="o">.</span><span class="n">group_subunit_numbers</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="o">!=</span> <span class="n">subunit_number</span><span class="p">:</span>
            <span class="c1"># Generate oligomers for each entity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_oligomers</span><span class="p">(</span><span class="n">transformations</span><span class="o">=</span><span class="n">transformations</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="c1"># Once oligomers are specified the ASU can be set properly</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_contacting_asu</span><span class="p">(</span><span class="n">from_assembly</span><span class="o">=</span><span class="n">parsed_assembly</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.get_asu_interaction_model_indices" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_asu_interaction_model_indices</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_asu_interaction_model_indices</span><span class="p">(</span><span class="n">calculate_contacts</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>From an ASU, find the symmetric models that immediately surround the ASU</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>calculate_contacts</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether to calculate interacting models by atomic contacts</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>distance</code></b>
            (<code>float</code>, default:
                <code>8.0</code>
)
        
        <div class="doc-md-description">
          <p>When calculate_contacts is True, the CB distance which nearby symmetric models should be found
When calculate_contacts is False, uses the ASU radius plus the maximum Entity radius</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[int]</code>
        
        <div class="doc-md-description">
          <p>The indices of the models that contact the asu</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5087</span>
<span class="normal">5088</span>
<span class="normal">5089</span>
<span class="normal">5090</span>
<span class="normal">5091</span>
<span class="normal">5092</span>
<span class="normal">5093</span>
<span class="normal">5094</span>
<span class="normal">5095</span>
<span class="normal">5096</span>
<span class="normal">5097</span>
<span class="normal">5098</span>
<span class="normal">5099</span>
<span class="normal">5100</span>
<span class="normal">5101</span>
<span class="normal">5102</span>
<span class="normal">5103</span>
<span class="normal">5104</span>
<span class="normal">5105</span>
<span class="normal">5106</span>
<span class="normal">5107</span>
<span class="normal">5108</span>
<span class="normal">5109</span>
<span class="normal">5110</span>
<span class="normal">5111</span>
<span class="normal">5112</span>
<span class="normal">5113</span>
<span class="normal">5114</span>
<span class="normal">5115</span>
<span class="normal">5116</span>
<span class="normal">5117</span>
<span class="normal">5118</span>
<span class="normal">5119</span>
<span class="normal">5120</span>
<span class="normal">5121</span>
<span class="normal">5122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_asu_interaction_model_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calculate_contacts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> \
        <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From an ASU, find the symmetric models that immediately surround the ASU</span>

<span class="sd">    Args:</span>
<span class="sd">        calculate_contacts: Whether to calculate interacting models by atomic contacts</span>
<span class="sd">        distance: When calculate_contacts is True, the CB distance which nearby symmetric models should be found</span>
<span class="sd">            When calculate_contacts is False, uses the ASU radius plus the maximum Entity radius</span>

<span class="sd">    Returns:</span>
<span class="sd">        The indices of the models that contact the asu</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">calculate_contacts</span><span class="p">:</span>
        <span class="c1"># DEBUG self.report_symmetric_coords(self.get_asu_interaction_model_indices.__name__)</span>
        <span class="n">asu_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backbone_and_cb_indices</span><span class="p">],</span> <span class="n">distance</span><span class="p">)</span>
        <span class="c1"># Combine each subarray of the asu_query and divide by the assembly_tree interval length -&gt; len(asu_query)</span>
        <span class="n">interacting_models</span> <span class="o">=</span> <span class="p">(</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">({</span><span class="n">asu_idx</span> <span class="k">for</span> <span class="n">asu_contacts</span> <span class="ow">in</span> <span class="n">asu_query</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                                                    <span class="k">for</span> <span class="n">asu_idx</span> <span class="ow">in</span> <span class="n">asu_contacts</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
                                              <span class="p">)</span>
                                     <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">asu_query</span><span class="p">)</span>
                             <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># The asu is missing from assembly_tree so add 1 to get the</span>
        <span class="c1"># correct model indices ^</span>
        <span class="n">interacting_models</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">interacting_models</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># The furthest point from the asu COM + the max individual Entity radius</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">+</span> <span class="nb">max</span><span class="p">([</span><span class="n">entity</span><span class="o">.</span><span class="n">radius</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For ASU neighbor query, using the distance=</span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">center_of_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass</span>
        <span class="n">interacting_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">sym_model_com</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass_symmetric_models</span><span class="p">)</span>
                              <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">center_of_mass</span> <span class="o">-</span> <span class="n">sym_model_com</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">distance</span><span class="p">]</span>
        <span class="c1"># Remove the first index from the interacting_models due to exclusion of asu from convention above</span>
        <span class="n">interacting_models</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interacting_models</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.get_asu_atom_indices" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_asu_atom_indices</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_asu_atom_indices</span><span class="p">(</span><span class="n">as_slice</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">slice</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Find the coordinate indices of the asu equivalent model in the SymmetricModel. Zero-indexed</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[int] | slice</code>
        
        <div class="doc-md-description">
          <p>The indices in the SymmetricModel where the ASU is also located</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5124</span>
<span class="normal">5125</span>
<span class="normal">5126</span>
<span class="normal">5127</span>
<span class="normal">5128</span>
<span class="normal">5129</span>
<span class="normal">5130</span>
<span class="normal">5131</span>
<span class="normal">5132</span>
<span class="normal">5133</span>
<span class="normal">5134</span>
<span class="normal">5135</span>
<span class="normal">5136</span>
<span class="normal">5137</span>
<span class="normal">5138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_asu_atom_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_slice</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the coordinate indices of the asu equivalent model in the SymmetricModel. Zero-indexed</span>

<span class="sd">    Returns:</span>
<span class="sd">        The indices in the SymmetricModel where the ASU is also located</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">asu_model_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asu_model_index</span>
    <span class="n">number_of_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">number_of_atoms</span> <span class="o">*</span> <span class="n">asu_model_idx</span>
    <span class="n">end_idx</span> <span class="o">=</span> <span class="n">number_of_atoms</span> <span class="o">*</span> <span class="p">(</span><span class="n">asu_model_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">as_slice</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.get_oligomeric_atom_indices" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_oligomeric_atom_indices</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_oligomeric_atom_indices</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Find the coordinate indices of the intra-oligomeric equivalent models in the SymmetricModel. Zero-indexed</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>entity</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>)
        
        <div class="doc-md-description">
          <p>The Entity with oligomeric chains to query for corresponding symmetry mates</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[int]</code>
        
        <div class="doc-md-description">
          <p>The indices in the SymmetricModel where the intra-oligomeric contacts are located</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5140</span>
<span class="normal">5141</span>
<span class="normal">5142</span>
<span class="normal">5143</span>
<span class="normal">5144</span>
<span class="normal">5145</span>
<span class="normal">5146</span>
<span class="normal">5147</span>
<span class="normal">5148</span>
<span class="normal">5149</span>
<span class="normal">5150</span>
<span class="normal">5151</span>
<span class="normal">5152</span>
<span class="normal">5153</span>
<span class="normal">5154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_oligomeric_atom_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="n">Entity</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the coordinate indices of the intra-oligomeric equivalent models in the SymmetricModel. Zero-indexed</span>

<span class="sd">    Args:</span>
<span class="sd">        entity: The Entity with oligomeric chains to query for corresponding symmetry mates</span>

<span class="sd">    Returns:</span>
<span class="sd">        The indices in the SymmetricModel where the intra-oligomeric contacts are located</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number_of_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span>
    <span class="n">oligomeric_atom_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">model_number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">oligomeric_model_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity</span><span class="p">):</span>
        <span class="n">oligomeric_atom_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number_of_atoms</span> <span class="o">*</span> <span class="n">model_number</span><span class="p">,</span>
                                             <span class="n">number_of_atoms</span> <span class="o">*</span> <span class="p">(</span><span class="n">model_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">oligomeric_atom_indices</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.get_asu_interaction_indices" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_asu_interaction_indices</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_asu_interaction_indices</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Find the coordinate indices for the models in the SymmetricModel interacting with the asu. Zero-indexed</p>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>calculate_contacts</code></b>
        
        <div class="doc-md-description">
          <p>bool = True - Whether to calculate interacting models by atomic contacts</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8.0 - When calculate_contacts is True, the CB distance which nearby symmetric models
 should be found. When calculate_contacts is False, uses the ASU radius plus the maximum Entity radius</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[int]</code>
        
        <div class="doc-md-description">
          <p>The indices in the SymmetricModel where the asu contacts other models</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5156</span>
<span class="normal">5157</span>
<span class="normal">5158</span>
<span class="normal">5159</span>
<span class="normal">5160</span>
<span class="normal">5161</span>
<span class="normal">5162</span>
<span class="normal">5163</span>
<span class="normal">5164</span>
<span class="normal">5165</span>
<span class="normal">5166</span>
<span class="normal">5167</span>
<span class="normal">5168</span>
<span class="normal">5169</span>
<span class="normal">5170</span>
<span class="normal">5171</span>
<span class="normal">5172</span>
<span class="normal">5173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_asu_interaction_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the coordinate indices for the models in the SymmetricModel interacting with the asu. Zero-indexed</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        calculate_contacts: bool = True - Whether to calculate interacting models by atomic contacts</span>
<span class="sd">        distance: float = 8.0 - When calculate_contacts is True, the CB distance which nearby symmetric models</span>
<span class="sd">             should be found. When calculate_contacts is False, uses the ASU radius plus the maximum Entity radius</span>

<span class="sd">    Returns:</span>
<span class="sd">        The indices in the SymmetricModel where the asu contacts other models</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number_of_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span>
    <span class="n">interacting_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">model_number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_asu_interaction_model_indices</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">interacting_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number_of_atoms</span> <span class="o">*</span> <span class="n">model_number</span><span class="p">,</span>
                                         <span class="n">number_of_atoms</span> <span class="o">*</span> <span class="p">(</span><span class="n">model_number</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">interacting_indices</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.make_oligomers" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">make_oligomers</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">make_oligomers</span><span class="p">(</span><span class="n">transformations</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Generate oligomers for each Entity in the SymmetricModel</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>transformations</code></b>
            (<code>list[<span title="symdesign.utils.types.TransformationMapping">TransformationMapping</span>]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The entity_transformations operations that reproduce the individual oligomers</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5539</span>
<span class="normal">5540</span>
<span class="normal">5541</span>
<span class="normal">5542</span>
<span class="normal">5543</span>
<span class="normal">5544</span>
<span class="normal">5545</span>
<span class="normal">5546</span>
<span class="normal">5547</span>
<span class="normal">5548</span>
<span class="normal">5549</span>
<span class="normal">5550</span>
<span class="normal">5551</span>
<span class="normal">5552</span>
<span class="normal">5553</span>
<span class="normal">5554</span>
<span class="normal">5555</span>
<span class="normal">5556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_oligomers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">TransformationMapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate oligomers for each Entity in the SymmetricModel</span>

<span class="sd">    Args:</span>
<span class="sd">        transformations: The entity_transformations operations that reproduce the individual oligomers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Initializing oligomeric symmetry&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transformations</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">transformations</span><span class="p">):</span>
        <span class="c1"># If this fails then the symmetry is failed... It should never return an empty list as</span>
        <span class="c1"># .entity_transformations -&gt; ._assign_pose_transformation() will raise SymmetryError</span>
        <span class="n">transformations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_transformations</span>

    <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">subunit_number</span><span class="p">,</span> <span class="n">symmetry</span><span class="p">,</span> <span class="n">transformation</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_entry</span><span class="o">.</span><span class="n">group_subunit_numbers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_entry</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span> <span class="n">transformations</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="o">!=</span> <span class="n">subunit_number</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">make_oligomer</span><span class="p">(</span><span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">,</span> <span class="o">**</span><span class="n">transformation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span><span class="si">}</span><span class="s1"> is already the correct oligomer, skipping make_oligomer()&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.symmetric_assembly_is_clash" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">symmetric_assembly_is_clash</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">symmetric_assembly_is_clash</span><span class="p">(</span><span class="n">measure</span><span class="p">:</span> <span class="n"><span title="structure.utils.coords_type_literal">coords_type_literal</span></span> <span class="o">=</span> <span class="n">default_clash_criteria</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="n">default_clash_distance</span><span class="p">,</span> <span class="n">warn</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">bool</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns True if the SymmetricModel presents any clashes at the specified distance</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>measure</code></b>
            (<code><span title="structure.utils.coords_type_literal">coords_type_literal</span></code>, default:
                <code><span title="structure.utils.default_clash_criteria">default_clash_criteria</span></code>
)
        
        <div class="doc-md-description">
          <p>The atom type to measure clashing by</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>distance</code></b>
            (<code>float</code>, default:
                <code><span title="structure.utils.default_clash_distance">default_clash_distance</span></code>
)
        
        <div class="doc-md-description">
          <p>The distance which clashes should be checked</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>warn</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to emit warnings about identified clashes</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>bool</code>
        
        <div class="doc-md-description">
          <p>True if the symmetric assembly clashes with the asu, False otherwise</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5558</span>
<span class="normal">5559</span>
<span class="normal">5560</span>
<span class="normal">5561</span>
<span class="normal">5562</span>
<span class="normal">5563</span>
<span class="normal">5564</span>
<span class="normal">5565</span>
<span class="normal">5566</span>
<span class="normal">5567</span>
<span class="normal">5568</span>
<span class="normal">5569</span>
<span class="normal">5570</span>
<span class="normal">5571</span>
<span class="normal">5572</span>
<span class="normal">5573</span>
<span class="normal">5574</span>
<span class="normal">5575</span>
<span class="normal">5576</span>
<span class="normal">5577</span>
<span class="normal">5578</span>
<span class="normal">5579</span>
<span class="normal">5580</span>
<span class="normal">5581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">symmetric_assembly_is_clash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measure</span><span class="p">:</span> <span class="n">coords_type_literal</span> <span class="o">=</span> <span class="n">default_clash_criteria</span><span class="p">,</span>
                                <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">default_clash_distance</span><span class="p">,</span> <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if the SymmetricModel presents any clashes at the specified distance</span>

<span class="sd">    Args:</span>
<span class="sd">        measure: The atom type to measure clashing by</span>
<span class="sd">        distance: The distance which clashes should be checked</span>
<span class="sd">        warn: Whether to emit warnings about identified clashes</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the symmetric assembly clashes with the asu, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Can&#39;t check if the assembly is clashing as it has no symmetry&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">measure</span><span class="si">}</span><span class="s1">_indices&#39;</span><span class="p">)</span>
    <span class="n">clashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_tree</span><span class="o">.</span><span class="n">two_point_correlation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="p">[</span><span class="n">distance</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">clashes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Found </span><span class="si">{</span><span class="n">clashes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> clashing sites. Pose isn&#39;t a viable symmetric assembly&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Clash</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># No clash</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.SymmetricModel.write" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">write</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n">bytes</span> <span class="o">|</span> <span class="n">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file_handle</span><span class="p">:</span> <span class="n"><span title="typing.IO">IO</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">assembly</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Write SymmetricModel Atoms to a file specified by out_path or with a passed file_handle</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>out_path</code></b>
            (<code>bytes | str</code>, default:
                <code><span title="os.getcwd">getcwd</span>()</code>
)
        
        <div class="doc-md-description">
          <p>The location where the Structure object should be written to disk</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>file_handle</code></b>
            (<code><span title="typing.IO">IO</span></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Used to write Structure details to an open FileObject</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>header</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A string that is desired at the top of the file</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>assembly</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to write the full assembly. Default writes only the ASU</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>increment_chains</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to write each Structure with a new chain name, otherwise write as
a new Model</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>surrounding_uc</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether the 3x3 layer group, or 3x3x3 space group should be written when
assembly is True and self.dimension &gt; 1</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.AnyStr">AnyStr</span> | None</code>
        
        <div class="doc-md-description">
          <p>The name of the written file if out_path is used</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5606</span>
<span class="normal">5607</span>
<span class="normal">5608</span>
<span class="normal">5609</span>
<span class="normal">5610</span>
<span class="normal">5611</span>
<span class="normal">5612</span>
<span class="normal">5613</span>
<span class="normal">5614</span>
<span class="normal">5615</span>
<span class="normal">5616</span>
<span class="normal">5617</span>
<span class="normal">5618</span>
<span class="normal">5619</span>
<span class="normal">5620</span>
<span class="normal">5621</span>
<span class="normal">5622</span>
<span class="normal">5623</span>
<span class="normal">5624</span>
<span class="normal">5625</span>
<span class="normal">5626</span>
<span class="normal">5627</span>
<span class="normal">5628</span>
<span class="normal">5629</span>
<span class="normal">5630</span>
<span class="normal">5631</span>
<span class="normal">5632</span>
<span class="normal">5633</span>
<span class="normal">5634</span>
<span class="normal">5635</span>
<span class="normal">5636</span>
<span class="normal">5637</span>
<span class="normal">5638</span>
<span class="normal">5639</span>
<span class="normal">5640</span>
<span class="normal">5641</span>
<span class="normal">5642</span>
<span class="normal">5643</span>
<span class="normal">5644</span>
<span class="normal">5645</span>
<span class="normal">5646</span>
<span class="normal">5647</span>
<span class="normal">5648</span>
<span class="normal">5649</span>
<span class="normal">5650</span>
<span class="normal">5651</span>
<span class="normal">5652</span>
<span class="normal">5653</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">file_handle</span><span class="p">:</span> <span class="n">IO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">assembly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write SymmetricModel Atoms to a file specified by out_path or with a passed file_handle</span>

<span class="sd">    Args:</span>
<span class="sd">        out_path: The location where the Structure object should be written to disk</span>
<span class="sd">        file_handle: Used to write Structure details to an open FileObject</span>
<span class="sd">        header: A string that is desired at the top of the file</span>
<span class="sd">        assembly: Whether to write the full assembly. Default writes only the ASU</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        increment_chains: bool = False - Whether to write each Structure with a new chain name, otherwise write as</span>
<span class="sd">            a new Model</span>
<span class="sd">        surrounding_uc: bool = False - Whether the 3x3 layer group, or 3x3x3 space group should be written when</span>
<span class="sd">            assembly is True and self.dimension &gt; 1</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the written file if out_path is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SymmetricModel</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> is writing </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">is_symmetric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_symmetric</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">assembly</span><span class="p">:</span>
                <span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_assembly_models</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">models</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Skip all models, write asu. Use biomt_record/cryst_record for symmetry</span>
                <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
                    <span class="n">entity</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Finish with a standard write</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file_handle</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_write</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># out_path default argument is current working directory</span>
        <span class="c1"># Write the header as an asu if no assembly requested or not symmetric</span>
        <span class="n">assembly_header</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_symmetric</span> <span class="ow">and</span> <span class="n">assembly</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_symmetric</span>
        <span class="n">_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_header</span><span class="p">(</span><span class="n">assembly</span><span class="o">=</span><span class="n">assembly_header</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">header</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="n">_header</span> <span class="o">+=</span> <span class="p">(</span><span class="n">header</span> <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_header</span><span class="p">)</span>
            <span class="n">_write</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out_path</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="structure.model.Pose" class="doc doc-heading">
          <span class="doc doc-object-name doc-class-name">Pose</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">Pose</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="structure.model.SymmetricModel" href="#structure.model.SymmetricModel">SymmetricModel</a></code>, <code><a class="autorefs autorefs-internal" title="structure.model.MetricsMixin" href="#structure.model.MetricsMixin">MetricsMixin</a></code></p>

  
      <p>A Pose is made of single or multiple Structure objects such as Entities, Chains, or other structures.
All objects share a common feature such as the same symmetric system or the same general atom configuration in
separate models across the Structure or sequence.</p>
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>**kwargs</code></b>
        
        <div class="doc-md-description">
          
        </div>
      </li>
  </ul>

                <details class="quote">
                  <summary>Source code in <code>symdesign/structure/model.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5732</span>
<span class="normal">5733</span>
<span class="normal">5734</span>
<span class="normal">5735</span>
<span class="normal">5736</span>
<span class="normal">5737</span>
<span class="normal">5738</span>
<span class="normal">5739</span>
<span class="normal">5740</span>
<span class="normal">5741</span>
<span class="normal">5742</span>
<span class="normal">5743</span>
<span class="normal">5744</span>
<span class="normal">5745</span>
<span class="normal">5746</span>
<span class="normal">5747</span>
<span class="normal">5748</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the instance</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># Pose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_design_selection_entity_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_design_selector_atom_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom_indices</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_required_atom_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_entity_name_pair</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface_unique</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fragment_info_by_entity_pair</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">split_interface_ss_elements</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ss_sequence_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ss_type_sequence</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.split_interface_ss_elements" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">split_interface_ss_elements</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">split_interface_ss_elements</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Stores the interface number mapped to an index corresponding to the secondary structure type 
Ex: {1: [0, 0, 1, 2, ...] , 2: [9, 9, 9, 13, ...]]}</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.ss_sequence_indices" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">ss_sequence_indices</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ss_sequence_indices</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Index which indicates the Residue membership to the secondary structure type element sequence</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.ss_type_sequence" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">ss_type_sequence</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ss_type_sequence</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The ordered secondary structure type sequence which contains one character/secondary structure element</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.active_entities" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">active_entities</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">active_entities</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Entity instances that are available for design calculations given a design selector</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.interface_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">interface_residues</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">interface_residues</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Residue instances identified in interfaces in the Pose sorted based on index.
Residue instances may be completely buried depending on interface distance</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.interface_residues_by_entity_pair" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">interface_residues_by_entity_pair</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">interface_residues_by_entity_pair</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">tuple</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">],</span> <span class="n">tuple</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">],</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Residue instances identified between pairs of Entity instances</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.interface_neighbor_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">interface_neighbor_residues</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">interface_neighbor_residues</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Residue instances identified as neighbors to interfaces in the Pose. Assumes default distance of 8 A</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.design_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">design_residues</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">design_residues</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Residue instances identified for design in the Pose. Includes interface_residues</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.required_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">required_residues</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">required_residues</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the Residue instances that are required according to DesignSelector</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.core_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">core_residues</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">core_residues</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Get the Residue instances that reside in the core of the interfaces</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>relative_sasa_thresh</code></b>
        
        <div class="doc-md-description">
          <p>The relative area threshold that the Residue should fall below before it is considered
'core'. Default cutoff percent is based on Levy, E. 2010</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>atom</code></b>
        
        <div class="doc-md-description">
          <p>bool = True - Whether the output should be generated for each atom.
If False, will be generated for each Residue</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>probe_radius</code></b>
        
        <div class="doc-md-description">
          <p>float = 1.4 - The radius which surface area should be generated</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>]</code>
        
        <div class="doc-md-description">
          <p>The core Residue instances</p>
      </div>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.rim_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">rim_residues</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">rim_residues</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Get the Residue instances that reside in the rim of the interface</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>relative_sasa_thresh</code></b>
        
        <div class="doc-md-description">
          <p>The relative area threshold that the Residue should fall below before it is considered
'rim'. Default cutoff percent is based on Levy, E. 2010</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>atom</code></b>
        
        <div class="doc-md-description">
          <p>bool = True - Whether the output should be generated for each atom.
If False, will be generated for each Residue</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>probe_radius</code></b>
        
        <div class="doc-md-description">
          <p>float = 1.4 - The radius which surface area should be generated</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>]</code>
        
        <div class="doc-md-description">
          <p>The rim Residue instances</p>
      </div>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.support_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">support_residues</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">support_residues</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Get the Residue instances that support the interface</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>relative_sasa_thresh</code></b>
        
        <div class="doc-md-description">
          <p>The relative area threshold that the Residue should fall below before it is considered
'support'. Default cutoff percent is based on Levy, E. 2010</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>atom</code></b>
        
        <div class="doc-md-description">
          <p>bool = True - Whether the output should be generated for each atom.
If False, will be generated for each Residue</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>probe_radius</code></b>
        
        <div class="doc-md-description">
          <p>float = 1.4 - The radius which surface area should be generated</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>]</code>
        
        <div class="doc-md-description">
          <p>The support Residue instances</p>
      </div>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.fragment_info_by_entity_pair" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">fragment_info_by_entity_pair</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">fragment_info_by_entity_pair</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">tuple</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">],</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="structure.fragment.db.FragmentInfo">FragmentInfo</span></span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the FragmentInfo present as the result of structural overlap between pairs of Entity instances</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.interface_fragment_residue_indices" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">interface_fragment_residue_indices</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">interface_fragment_residue_indices</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">int</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>The Residue indices where Fragment occurrences are observed</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.interface_residues_by_interface_unique" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">interface_residues_by_interface_unique</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">interface_residues_by_interface_unique</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Keeps the Residue instances grouped by membership to each side of the interface.
Residues are unique to one side of the interface
    Ex: {1: [Residue, ...], 2: [Residue, ...]}</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.interface_residues_by_interface" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">interface_residues_by_interface</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">interface_residues_by_interface</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Keeps the Residue instances grouped by membership to each side of the interface.
Residues can be duplicated on each side when interface contains a 2-fold axis of symmetry
    Ex: {1: [Residue, ...], 2: [Residue, ...]}</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="structure.model.Pose.fragment_metrics_by_entity_pair" class="doc doc-heading">
          <span class="doc doc-object-name doc-attribute-name">fragment_metrics_by_entity_pair</span>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">fragment_metrics_by_entity_pair</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">tuple</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span><span class="p">],</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the metrics from structural overlapping Fragment observations between pairs of Entity instances</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.calculate_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">calculate_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Calculate metrics for the instance</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>{
'entity_max_radius_average_deviation',
'entity_min_radius_average_deviation',
'entity_radius_average_deviation',
'interface_b_factor',
'interface1_secondary_structure_fragment_topology',
'interface1_secondary_structure_fragment_count',
'interface1_secondary_structure_topology',
'interface1_secondary_structure_count',
'interface2_secondary_structure_fragment_topology',
'interface2_secondary_structure_fragment_count',
'interface2_secondary_structure_topology',
'interface2_secondary_structure_count',
'maximum_radius',
'minimum_radius',
'multiple_fragment_ratio',
'nanohedra_score_normalized',
'nanohedra_score_center_normalized',
'nanohedra_score',
'nanohedra_score_center',
'number_residues_interface_fragment_total',
'number_residues_interface_fragment_center',
'number_fragments_interface',
'number_residues_interface',
'number_residues_interface_non_fragment',
'percent_fragment_helix',
'percent_fragment_strand',
'percent_fragment_coil',
'percent_residues_fragment_interface_total',
'percent_residues_fragment_interface_center',
'percent_residues_non_fragment_interface',
'pose_length',
'symmetric_interface'</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>}</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5750</span>
<span class="normal">5751</span>
<span class="normal">5752</span>
<span class="normal">5753</span>
<span class="normal">5754</span>
<span class="normal">5755</span>
<span class="normal">5756</span>
<span class="normal">5757</span>
<span class="normal">5758</span>
<span class="normal">5759</span>
<span class="normal">5760</span>
<span class="normal">5761</span>
<span class="normal">5762</span>
<span class="normal">5763</span>
<span class="normal">5764</span>
<span class="normal">5765</span>
<span class="normal">5766</span>
<span class="normal">5767</span>
<span class="normal">5768</span>
<span class="normal">5769</span>
<span class="normal">5770</span>
<span class="normal">5771</span>
<span class="normal">5772</span>
<span class="normal">5773</span>
<span class="normal">5774</span>
<span class="normal">5775</span>
<span class="normal">5776</span>
<span class="normal">5777</span>
<span class="normal">5778</span>
<span class="normal">5779</span>
<span class="normal">5780</span>
<span class="normal">5781</span>
<span class="normal">5782</span>
<span class="normal">5783</span>
<span class="normal">5784</span>
<span class="normal">5785</span>
<span class="normal">5786</span>
<span class="normal">5787</span>
<span class="normal">5788</span>
<span class="normal">5789</span>
<span class="normal">5790</span>
<span class="normal">5791</span>
<span class="normal">5792</span>
<span class="normal">5793</span>
<span class="normal">5794</span>
<span class="normal">5795</span>
<span class="normal">5796</span>
<span class="normal">5797</span>
<span class="normal">5798</span>
<span class="normal">5799</span>
<span class="normal">5800</span>
<span class="normal">5801</span>
<span class="normal">5802</span>
<span class="normal">5803</span>
<span class="normal">5804</span>
<span class="normal">5805</span>
<span class="normal">5806</span>
<span class="normal">5807</span>
<span class="normal">5808</span>
<span class="normal">5809</span>
<span class="normal">5810</span>
<span class="normal">5811</span>
<span class="normal">5812</span>
<span class="normal">5813</span>
<span class="normal">5814</span>
<span class="normal">5815</span>
<span class="normal">5816</span>
<span class="normal">5817</span>
<span class="normal">5818</span>
<span class="normal">5819</span>
<span class="normal">5820</span>
<span class="normal">5821</span>
<span class="normal">5822</span>
<span class="normal">5823</span>
<span class="normal">5824</span>
<span class="normal">5825</span>
<span class="normal">5826</span>
<span class="normal">5827</span>
<span class="normal">5828</span>
<span class="normal">5829</span>
<span class="normal">5830</span>
<span class="normal">5831</span>
<span class="normal">5832</span>
<span class="normal">5833</span>
<span class="normal">5834</span>
<span class="normal">5835</span>
<span class="normal">5836</span>
<span class="normal">5837</span>
<span class="normal">5838</span>
<span class="normal">5839</span>
<span class="normal">5840</span>
<span class="normal">5841</span>
<span class="normal">5842</span>
<span class="normal">5843</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate metrics for the instance</span>

<span class="sd">    Returns:</span>
<span class="sd">        {</span>
<span class="sd">            &#39;entity_max_radius_average_deviation&#39;,</span>
<span class="sd">            &#39;entity_min_radius_average_deviation&#39;,</span>
<span class="sd">            &#39;entity_radius_average_deviation&#39;,</span>
<span class="sd">            &#39;interface_b_factor&#39;,</span>
<span class="sd">            &#39;interface1_secondary_structure_fragment_topology&#39;,</span>
<span class="sd">            &#39;interface1_secondary_structure_fragment_count&#39;,</span>
<span class="sd">            &#39;interface1_secondary_structure_topology&#39;,</span>
<span class="sd">            &#39;interface1_secondary_structure_count&#39;,</span>
<span class="sd">            &#39;interface2_secondary_structure_fragment_topology&#39;,</span>
<span class="sd">            &#39;interface2_secondary_structure_fragment_count&#39;,</span>
<span class="sd">            &#39;interface2_secondary_structure_topology&#39;,</span>
<span class="sd">            &#39;interface2_secondary_structure_count&#39;,</span>
<span class="sd">            &#39;maximum_radius&#39;,</span>
<span class="sd">            &#39;minimum_radius&#39;,</span>
<span class="sd">            &#39;multiple_fragment_ratio&#39;,</span>
<span class="sd">            &#39;nanohedra_score_normalized&#39;,</span>
<span class="sd">            &#39;nanohedra_score_center_normalized&#39;,</span>
<span class="sd">            &#39;nanohedra_score&#39;,</span>
<span class="sd">            &#39;nanohedra_score_center&#39;,</span>
<span class="sd">            &#39;number_residues_interface_fragment_total&#39;,</span>
<span class="sd">            &#39;number_residues_interface_fragment_center&#39;,</span>
<span class="sd">            &#39;number_fragments_interface&#39;,</span>
<span class="sd">            &#39;number_residues_interface&#39;,</span>
<span class="sd">            &#39;number_residues_interface_non_fragment&#39;,</span>
<span class="sd">            &#39;percent_fragment_helix&#39;,</span>
<span class="sd">            &#39;percent_fragment_strand&#39;,</span>
<span class="sd">            &#39;percent_fragment_coil&#39;,</span>
<span class="sd">            &#39;percent_residues_fragment_interface_total&#39;,</span>
<span class="sd">            &#39;percent_residues_fragment_interface_center&#39;,</span>
<span class="sd">            &#39;percent_residues_non_fragment_interface&#39;,</span>
<span class="sd">            &#39;pose_length&#39;,</span>
<span class="sd">            &#39;symmetric_interface&#39;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">minimum_radius</span><span class="p">,</span> <span class="n">maximum_radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="mf">0.</span>
    <span class="n">entity_metrics</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reference_com</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass_symmetric</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="c1"># _entity_metrics = entity.calculate_metrics()</span>
        <span class="n">_entity_metrics</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">calculate_spatial_orientation_metrics</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference_com</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_entity_metrics</span><span class="p">[</span><span class="s1">&#39;min_radius&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">minimum_radius</span><span class="p">:</span>
            <span class="n">minimum_radius</span> <span class="o">=</span> <span class="n">_entity_metrics</span><span class="p">[</span><span class="s1">&#39;min_radius&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">_entity_metrics</span><span class="p">[</span><span class="s1">&#39;max_radius&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">maximum_radius</span><span class="p">:</span>
            <span class="n">maximum_radius</span> <span class="o">=</span> <span class="n">_entity_metrics</span><span class="p">[</span><span class="s1">&#39;max_radius&#39;</span><span class="p">]</span>
        <span class="n">entity_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_entity_metrics</span><span class="p">)</span>

    <span class="n">pose_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;minimum_radius&#39;</span><span class="p">:</span> <span class="n">minimum_radius</span><span class="p">,</span>
                    <span class="s1">&#39;maximum_radius&#39;</span><span class="p">:</span> <span class="n">maximum_radius</span><span class="p">,</span>
                    <span class="s1">&#39;pose_length&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
                    <span class="c1"># &#39;sequence&#39;: self.sequence</span>
                    <span class="p">}</span>
    <span class="n">radius_ratio_sum</span> <span class="o">=</span> <span class="n">min_ratio_sum</span> <span class="o">=</span> <span class="n">max_ratio_sum</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># residue_ratio_sum</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># index_combinations = combinations(range(1, 1 + len(entity_metrics)), 2)</span>
    <span class="k">for</span> <span class="n">counter</span><span class="p">,</span> <span class="p">(</span><span class="n">metrics1</span><span class="p">,</span> <span class="n">metrics2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">entity_metrics</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">counter</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]:</span>
            <span class="n">radius_ratio</span> <span class="o">=</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">radius_ratio</span> <span class="o">=</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;min_radius&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;min_radius&#39;</span><span class="p">]:</span>
            <span class="n">min_ratio</span> <span class="o">=</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;min_radius&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;min_radius&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_ratio</span> <span class="o">=</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;min_radius&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;min_radius&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;max_radius&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;max_radius&#39;</span><span class="p">]:</span>
            <span class="n">max_ratio</span> <span class="o">=</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;max_radius&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;max_radius&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_ratio</span> <span class="o">=</span> <span class="n">metrics1</span><span class="p">[</span><span class="s1">&#39;max_radius&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics2</span><span class="p">[</span><span class="s1">&#39;max_radius&#39;</span><span class="p">]</span>

        <span class="n">radius_ratio_sum</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">radius_ratio</span>
        <span class="n">min_ratio_sum</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">min_ratio</span>
        <span class="n">max_ratio_sum</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">max_ratio</span>
        <span class="c1"># residue_ratio_sum += abs(1 - residue_ratio)</span>
        <span class="c1"># entity_idx1, entity_idx2 = next(index_combinations)</span>
        <span class="c1"># pose_metrics.update({f&#39;entity_radius_ratio_{entity_idx1}v{entity_idx2}&#39;: radius_ratio,</span>
        <span class="c1">#                      f&#39;entity_min_radius_ratio_{entity_idx1}v{entity_idx2}&#39;: min_ratio,</span>
        <span class="c1">#                      f&#39;entity_max_radius_ratio_{entity_idx1}v{entity_idx2}&#39;: max_ratio,</span>
        <span class="c1">#                      f&#39;entity_number_of_residues_ratio_{entity_idx1}v{entity_idx2}&#39;: residue_ratio})</span>

    <span class="n">pose_metrics</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;entity_radius_average_deviation&#39;</span><span class="p">:</span> <span class="n">radius_ratio_sum</span> <span class="o">/</span> <span class="n">counter</span><span class="p">,</span>
                         <span class="s1">&#39;entity_min_radius_average_deviation&#39;</span><span class="p">:</span> <span class="n">min_ratio_sum</span> <span class="o">/</span> <span class="n">counter</span><span class="p">,</span>
                         <span class="s1">&#39;entity_max_radius_average_deviation&#39;</span><span class="p">:</span> <span class="n">max_ratio_sum</span> <span class="o">/</span> <span class="n">counter</span><span class="p">,</span>
                         <span class="c1"># &#39;entity_number_of_residues_average_deviation&#39;: residue_ratio_sum / counter</span>
                         <span class="p">})</span>
    <span class="n">pose_metrics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">interface_metrics</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">pose_metrics</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.apply_design_selector" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">apply_design_selector</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">apply_design_selector</span><span class="p">(</span><span class="n">selection</span><span class="p">:</span> <span class="n"><span title="structure.model.StructureSpecification">StructureSpecification</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n"><span title="structure.model.StructureSpecification">StructureSpecification</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">required</span><span class="p">:</span> <span class="n"><span title="structure.model.StructureSpecification">StructureSpecification</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Set up a design selector for the Pose including selections, masks, and required Entities and Atoms</p>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self._design_selection_entity_names set[str]
self._design_selector_atom_indices set[int]
self._required_atom_indices Sequence[int]</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5934</span>
<span class="normal">5935</span>
<span class="normal">5936</span>
<span class="normal">5937</span>
<span class="normal">5938</span>
<span class="normal">5939</span>
<span class="normal">5940</span>
<span class="normal">5941</span>
<span class="normal">5942</span>
<span class="normal">5943</span>
<span class="normal">5944</span>
<span class="normal">5945</span>
<span class="normal">5946</span>
<span class="normal">5947</span>
<span class="normal">5948</span>
<span class="normal">5949</span>
<span class="normal">5950</span>
<span class="normal">5951</span>
<span class="normal">5952</span>
<span class="normal">5953</span>
<span class="normal">5954</span>
<span class="normal">5955</span>
<span class="normal">5956</span>
<span class="normal">5957</span>
<span class="normal">5958</span>
<span class="normal">5959</span>
<span class="normal">5960</span>
<span class="normal">5961</span>
<span class="normal">5962</span>
<span class="normal">5963</span>
<span class="normal">5964</span>
<span class="normal">5965</span>
<span class="normal">5966</span>
<span class="normal">5967</span>
<span class="normal">5968</span>
<span class="normal">5969</span>
<span class="normal">5970</span>
<span class="normal">5971</span>
<span class="normal">5972</span>
<span class="normal">5973</span>
<span class="normal">5974</span>
<span class="normal">5975</span>
<span class="normal">5976</span>
<span class="normal">5977</span>
<span class="normal">5978</span>
<span class="normal">5979</span>
<span class="normal">5980</span>
<span class="normal">5981</span>
<span class="normal">5982</span>
<span class="normal">5983</span>
<span class="normal">5984</span>
<span class="normal">5985</span>
<span class="normal">5986</span>
<span class="normal">5987</span>
<span class="normal">5988</span>
<span class="normal">5989</span>
<span class="normal">5990</span>
<span class="normal">5991</span>
<span class="normal">5992</span>
<span class="normal">5993</span>
<span class="normal">5994</span>
<span class="normal">5995</span>
<span class="normal">5996</span>
<span class="normal">5997</span>
<span class="normal">5998</span>
<span class="normal">5999</span>
<span class="normal">6000</span>
<span class="normal">6001</span>
<span class="normal">6002</span>
<span class="normal">6003</span>
<span class="normal">6004</span>
<span class="normal">6005</span>
<span class="normal">6006</span>
<span class="normal">6007</span>
<span class="normal">6008</span>
<span class="normal">6009</span>
<span class="normal">6010</span>
<span class="normal">6011</span>
<span class="normal">6012</span>
<span class="normal">6013</span>
<span class="normal">6014</span>
<span class="normal">6015</span>
<span class="normal">6016</span>
<span class="normal">6017</span>
<span class="normal">6018</span>
<span class="normal">6019</span>
<span class="normal">6020</span>
<span class="normal">6021</span>
<span class="normal">6022</span>
<span class="normal">6023</span>
<span class="normal">6024</span>
<span class="normal">6025</span>
<span class="normal">6026</span>
<span class="normal">6027</span>
<span class="normal">6028</span>
<span class="normal">6029</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_design_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="n">StructureSpecification</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">StructureSpecification</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">required</span><span class="p">:</span> <span class="n">StructureSpecification</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up a design selector for the Pose including selections, masks, and required Entities and Atoms</span>

<span class="sd">    Sets:</span>
<span class="sd">        self._design_selection_entity_names set[str]</span>
<span class="sd">        self._design_selector_atom_indices set[int]</span>
<span class="sd">        self._required_atom_indices Sequence[int]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">grab_indices</span><span class="p">(</span><span class="n">entities</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chains</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">residues</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
        <span class="c1"># atoms: set[int] = None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the residue selector to a set of entities and a set of atom indices</span>

<span class="sd">        Args:</span>
<span class="sd">            entities: The Entity identifiers to include in selection schemes</span>
<span class="sd">            chains: The Chain identifiers to include in selection schemes</span>
<span class="sd">            residues: The Residue identifiers to include in selection schemes</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple with the names of Entity instances and the indices of the Atom/Coord instances that are parsed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if start_with_none:</span>
        <span class="c1">#     set_function = set.union</span>
        <span class="c1"># else:  # Start with all indices and include those of interest</span>
        <span class="c1">#     set_function = set.intersection</span>

        <span class="n">entity_atom_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">entities_of_interest</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># All selectors could be a set() or None.</span>
        <span class="k">if</span> <span class="n">entities</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entity_name</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">entity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No entity named &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">entities_of_interest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
                <span class="n">entity_atom_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">atom_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">chains</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chain_id</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
                <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">chain_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No chain named &#39;</span><span class="si">{</span><span class="n">chain_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">entities_of_interest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">entity</span><span class="p">)</span>
                <span class="n">entity_atom_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">atom_indices</span><span class="p">)</span>

        <span class="c1"># vv This is for the additive model</span>
        <span class="c1"># atom_indices.union(iter_chain.from_iterable(self.chain(chain_id).get_residue_atom_indices(numbers=residues)</span>
        <span class="c1">#                                     for chain_id in chains))</span>
        <span class="c1"># vv This is for the intersectional model</span>
        <span class="c1"># atom_indices = set_function(atom_indices, entity_atom_indices)</span>
        <span class="c1"># entity_set = set_function(entity_set, [ent.name for ent in entities_of_interest])</span>
        <span class="n">atom_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">entity_atom_indices</span><span class="p">)</span>
        <span class="n">entity_set</span> <span class="o">=</span> <span class="p">{</span><span class="n">ent</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities_of_interest</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">residues</span><span class="p">:</span>
            <span class="n">atom_indices</span> <span class="o">=</span> <span class="n">atom_indices</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_residue_atom_indices</span><span class="p">(</span><span class="n">numbers</span><span class="o">=</span><span class="n">residues</span><span class="p">))</span>
        <span class="c1"># if pdb_residues:</span>
        <span class="c1">#     atom_indices = set_function(atom_indices, self.get_residue_atom_indices(numbers=residues, pdb=True))</span>
        <span class="c1"># if atoms:</span>
        <span class="c1">#     atom_indices = set_function(atom_indices, [idx for idx in self._atom_indices if idx in atoms])</span>

        <span class="k">return</span> <span class="n">entity_set</span><span class="p">,</span> <span class="n">atom_indices</span>

    <span class="k">if</span> <span class="n">selection</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The &#39;design_selector&#39; </span><span class="si">{</span><span class="n">selection</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">entity_selection</span><span class="p">,</span> <span class="n">atom_selection</span> <span class="o">=</span> <span class="n">grab_indices</span><span class="p">(</span><span class="o">**</span><span class="n">selection</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Use existing entities and indices</span>
        <span class="n">entity_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_design_selection_entity_names</span>
        <span class="n">atom_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_design_selector_atom_indices</span>

    <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The &#39;design_selector&#39; </span><span class="si">{</span><span class="n">mask</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">entity_mask</span><span class="p">,</span> <span class="n">atom_mask</span> <span class="o">=</span> <span class="n">grab_indices</span><span class="p">(</span><span class="o">**</span><span class="n">mask</span><span class="p">)</span>  <span class="c1"># , start_with_none=True)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">entity_mask</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">atom_mask</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">entity_selection</span> <span class="o">=</span> <span class="n">entity_selection</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">entity_mask</span><span class="p">)</span>
    <span class="n">atom_selection</span> <span class="o">=</span> <span class="n">atom_selection</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">atom_mask</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">required</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The &#39;design_selector&#39; </span><span class="si">{</span><span class="n">required</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">entity_required</span><span class="p">,</span> <span class="n">required_atom_indices</span> <span class="o">=</span> <span class="n">grab_indices</span><span class="p">(</span><span class="o">**</span><span class="n">required</span><span class="p">)</span>  <span class="c1"># , start_with_none=True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_required_atom_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">required_atom_indices</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">entity_required</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_design_selection_entity_names</span> <span class="o">=</span> <span class="n">entity_selection</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">entity_required</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_design_selector_atom_indices</span> <span class="o">=</span> <span class="n">atom_selection</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_required_atom_indices</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Entities: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Active Entities: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_design_selection_entity_names</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_alphafold_features" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_alphafold_features</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_alphafold_features</span><span class="p">(</span><span class="n">symmetric</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">multimer</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="structure.model.FeatureDict">FeatureDict</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Retrieve the required feature dictionary for this instance to use in Alphafold inference</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>symmetric</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether the symmetric version of the Pose should be used for feature production</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>multimer</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to run as a multimer. If multimer is True while symmetric is False, the Pose will
be processed according to the ASU</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>msas</code></b>
        
        <div class="doc-md-description">
          <p>Sequence - A sequence of multiple sequence alignments if they should be included in the features</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>no_msa</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether multiple sequence alignments should be included in the features</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="structure.model.FeatureDict">FeatureDict</span></code>
        
        <div class="doc-md-description">
          <p>The alphafold FeatureDict which is essentially a dictionary with dict[str, np.ndarray]</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6036</span>
<span class="normal">6037</span>
<span class="normal">6038</span>
<span class="normal">6039</span>
<span class="normal">6040</span>
<span class="normal">6041</span>
<span class="normal">6042</span>
<span class="normal">6043</span>
<span class="normal">6044</span>
<span class="normal">6045</span>
<span class="normal">6046</span>
<span class="normal">6047</span>
<span class="normal">6048</span>
<span class="normal">6049</span>
<span class="normal">6050</span>
<span class="normal">6051</span>
<span class="normal">6052</span>
<span class="normal">6053</span>
<span class="normal">6054</span>
<span class="normal">6055</span>
<span class="normal">6056</span>
<span class="normal">6057</span>
<span class="normal">6058</span>
<span class="normal">6059</span>
<span class="normal">6060</span>
<span class="normal">6061</span>
<span class="normal">6062</span>
<span class="normal">6063</span>
<span class="normal">6064</span>
<span class="normal">6065</span>
<span class="normal">6066</span>
<span class="normal">6067</span>
<span class="normal">6068</span>
<span class="normal">6069</span>
<span class="normal">6070</span>
<span class="normal">6071</span>
<span class="normal">6072</span>
<span class="normal">6073</span>
<span class="normal">6074</span>
<span class="normal">6075</span>
<span class="normal">6076</span>
<span class="normal">6077</span>
<span class="normal">6078</span>
<span class="normal">6079</span>
<span class="normal">6080</span>
<span class="normal">6081</span>
<span class="normal">6082</span>
<span class="normal">6083</span>
<span class="normal">6084</span>
<span class="normal">6085</span>
<span class="normal">6086</span>
<span class="normal">6087</span>
<span class="normal">6088</span>
<span class="normal">6089</span>
<span class="normal">6090</span>
<span class="normal">6091</span>
<span class="normal">6092</span>
<span class="normal">6093</span>
<span class="normal">6094</span>
<span class="normal">6095</span>
<span class="normal">6096</span>
<span class="normal">6097</span>
<span class="normal">6098</span>
<span class="normal">6099</span>
<span class="normal">6100</span>
<span class="normal">6101</span>
<span class="normal">6102</span>
<span class="normal">6103</span>
<span class="normal">6104</span>
<span class="normal">6105</span>
<span class="normal">6106</span>
<span class="normal">6107</span>
<span class="normal">6108</span>
<span class="normal">6109</span>
<span class="normal">6110</span>
<span class="normal">6111</span>
<span class="normal">6112</span>
<span class="normal">6113</span>
<span class="normal">6114</span>
<span class="normal">6115</span>
<span class="normal">6116</span>
<span class="normal">6117</span>
<span class="normal">6118</span>
<span class="normal">6119</span>
<span class="normal">6120</span>
<span class="normal">6121</span>
<span class="normal">6122</span>
<span class="normal">6123</span>
<span class="normal">6124</span>
<span class="normal">6125</span>
<span class="normal">6126</span>
<span class="normal">6127</span>
<span class="normal">6128</span>
<span class="normal">6129</span>
<span class="normal">6130</span>
<span class="normal">6131</span>
<span class="normal">6132</span>
<span class="normal">6133</span>
<span class="normal">6134</span>
<span class="normal">6135</span>
<span class="normal">6136</span>
<span class="normal">6137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_alphafold_features</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">symmetric</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">multimer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FeatureDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the required feature dictionary for this instance to use in Alphafold inference</span>

<span class="sd">    Args:</span>
<span class="sd">        symmetric: Whether the symmetric version of the Pose should be used for feature production</span>
<span class="sd">        multimer: Whether to run as a multimer. If multimer is True while symmetric is False, the Pose will</span>
<span class="sd">            be processed according to the ASU</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        msas: Sequence - A sequence of multiple sequence alignments if they should be included in the features</span>
<span class="sd">        no_msa: bool = False - Whether multiple sequence alignments should be included in the features</span>

<span class="sd">    Returns:</span>
<span class="sd">        The alphafold FeatureDict which is essentially a dictionary with dict[str, np.ndarray]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># heteromer = heteromer or self.number_of_entities &gt; 1</span>
    <span class="c1"># symmetric = symmetric or heteromer or self.number_of_chains &gt; 1</span>
    <span class="c1"># if multimer:</span>

    <span class="c1"># Set up the ASU unless otherwise specified</span>
    <span class="n">number_of_symmetry_mates</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">symmetric</span><span class="p">:</span>
            <span class="n">number_of_symmetry_mates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>
            <span class="n">multimer</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># else:</span>
    <span class="c1">#     self.log.warning(&quot;Can&#39;t run as symmetric since Pose isn&#39;t symmetric&quot;)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># self.log.warning(f&quot;Can&#39;t run with symmetric=True while multimer=False on a {self.__class__.__name__}. &quot;</span>
        <span class="c1">#                  f&quot;Setting heteromer=True&quot;)</span>
        <span class="n">heteromer</span> <span class="o">=</span> <span class="n">multimer</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">heteromer</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># if self.number_of_chains &gt; 1:</span>
        <span class="c1">#     multimer = True</span>
        <span class="c1"># raise ValueError(f&quot;Can&#39;t run monomer when {self.number_of_entities} entities are present in the &quot;</span>
        <span class="c1">#                  f&quot;{self.__class__.__name__}. Use Entity.{Entity.get_alphafold_features.__name__} on &quot;</span>
        <span class="c1">#                  f&quot;each entity individually instead&quot;)</span>

    <span class="n">chain_count</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">all_chain_features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">available_chain_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain_id_generator</span><span class="p">())[:</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span><span class="p">]</span>
    <span class="n">available_chain_ids_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">available_chain_ids</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entity_idx</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">):</span>
        <span class="n">entity_features</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">get_alphafold_features</span><span class="p">(</span><span class="n">heteromer</span><span class="o">=</span><span class="n">heteromer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># no_msa=no_msa)</span>
        <span class="c1"># The above function creates most of the work for the adaptation</span>
        <span class="c1"># particular importance needs to be given to the MSA used.</span>
        <span class="c1"># Should fragments be utilized in the MSA? If so, naming them in some way to pair is required!</span>
        <span class="c1"># Follow the example in:</span>
        <span class="c1">#    af_pipeline.make_msa_features(msas: Sequence[af_data_parsers.Msa]) -&gt; FeatureDict</span>
        <span class="c1"># to featurize</span>

        <span class="k">if</span> <span class="n">multimer</span><span class="p">:</span>  <span class="c1"># symmetric:</span>
            <span class="c1"># The chain_id passed to this function is used by the entity_features to (maybe) tie different chains</span>
            <span class="c1"># to this chain. In alphafold implementation, the chain_id passed should be oriented so that each</span>
            <span class="c1"># additional entity has the chain_id of the chain number within the entire system.</span>
            <span class="c1"># For example, for an A4B4 heteromer with C4 symmetry, the chain_id for entity idx 0 would be A and for</span>
            <span class="c1"># entity idx 1 would be E. This may not be important, but this is how symmetric is prepared</span>
            <span class="n">chain_id</span> <span class="o">=</span> <span class="n">available_chain_ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="o">*</span> <span class="n">entity_idx</span><span class="p">]</span>
            <span class="n">entity_features</span> <span class="o">=</span> <span class="n">af_pipeline_multimer</span><span class="o">.</span><span class="n">convert_monomer_features</span><span class="p">(</span><span class="n">entity_features</span><span class="p">,</span> <span class="n">chain_id</span><span class="o">=</span><span class="n">chain_id</span><span class="p">)</span>

            <span class="n">entity_integer</span> <span class="o">=</span> <span class="n">entity_idx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">af_pipeline_multimer</span><span class="o">.</span><span class="n">int_id_to_str_id</span><span class="p">(</span><span class="n">entity_integer</span><span class="p">)</span>

        <span class="n">entity_length</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">number_of_residues</span>
        <span class="c1"># for _ in range(self.number_of_symmetry_mates):</span>
        <span class="k">for</span> <span class="n">sym_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">number_of_symmetry_mates</span><span class="p">):</span>
            <span class="c1"># chain_id = next(available_chain_ids_iter)  # The mmCIF formatted chainID with &#39;AB&#39; type notation</span>
            <span class="n">this_entity_features</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">entity_features</span><span class="p">)</span>
            <span class="c1"># Where chain_id increments for each new chain instance i.e. A_1 is 1, A_2 is 2, ...</span>
            <span class="c1"># Where entity_id increments for each new Entity instance i.e. A_1 is 1, A_2 is 1, ...</span>
            <span class="c1"># Where sym_id increments for each new Entity instance regardless of chain i.e. A_1 is 1, A_2 is 2, ...,</span>
            <span class="c1"># B_1 is 1, B2 is 2</span>
            <span class="k">if</span> <span class="n">multimer</span><span class="p">:</span>  <span class="c1"># symmetric:</span>
                <span class="n">this_entity_features</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;asym_id&#39;</span><span class="p">:</span> <span class="nb">next</span><span class="p">(</span><span class="n">chain_count</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">entity_length</span><span class="p">),</span>
                                             <span class="s1">&#39;sym_id&#39;</span><span class="p">:</span> <span class="n">sym_idx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">entity_length</span><span class="p">),</span>
                                             <span class="s1">&#39;entity_id&#39;</span><span class="p">:</span> <span class="n">entity_integer</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">entity_length</span><span class="p">)})</span>
                <span class="n">chain_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">sym_idx</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chain_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">available_chain_ids_iter</span><span class="p">)</span>
            <span class="c1"># Make the key &#39;&lt;seq_id&gt;_&lt;sym_id&gt;&#39; where seq_id is the chain name assigned to the Entity where</span>
            <span class="c1"># chain names increment according to reverse spreadsheet style i.e. A,B,...AA,BA,...</span>
            <span class="c1"># and sym_id increments from 1 to number_of_symmetry_mates</span>
            <span class="n">all_chain_features</span><span class="p">[</span><span class="n">chain_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_entity_features</span>
            <span class="c1"># all_chain_features[next(available_chain_ids_iter)] = this_entity_features</span>
            <span class="c1"># all_chain_features[next(available_chain_ids_iter)] = this_entity_features</span>
            <span class="c1"># NOT HERE chain_features = convert_monomer_features(copy.deepcopy(entity_features), chain_id=chain_id)</span>
            <span class="c1"># all_chain_features[chain_id] = chain_features</span>

    <span class="c1"># This v performed above during all_chain_features creation</span>
    <span class="c1"># all_chain_features = \</span>
    <span class="c1">#     af_pipeline_multimer.add_assembly_features(all_chain_features)</span>

    <span class="k">if</span> <span class="n">multimer</span><span class="p">:</span>  <span class="c1"># symmetric:</span>
        <span class="n">all_chain_features</span> <span class="o">=</span> <span class="n">af_feature_processing</span><span class="o">.</span><span class="n">pair_and_merge</span><span class="p">(</span><span class="n">all_chain_features</span><span class="o">=</span><span class="n">all_chain_features</span><span class="p">)</span>
        <span class="c1"># Pad MSA to avoid zero-sized extra_msa.</span>
        <span class="n">all_chain_features</span> <span class="o">=</span> <span class="n">af_pipeline_multimer</span><span class="o">.</span><span class="n">pad_msa</span><span class="p">(</span><span class="n">all_chain_features</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_chain_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_proteinmpnn_params" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_proteinmpnn_params</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_proteinmpnn_params</span><span class="p">(</span><span class="n">ca_only</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pssm_bias_flag</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pssm_multi</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">bias_pssm_by_probabilities</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pssm_log_odds_flag</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">interface</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>ca_only</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether a minimal CA variant of the protein should be used for design calculations</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_bias_flag</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to use bias to modulate the residue probabilities designed</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_multi</code></b>
            (<code>float</code>, default:
                <code>0.0</code>
)
        
        <div class="doc-md-description">
          <p>How much to skew the design probabilities towards the sequence profile.
Bounded between [0, 1] where 0 is no sequence profile probability.
Only used with pssm_bias_flag and modifies each coefficient in pssm_coef by the fractional amount</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>bias_pssm_by_probabilities</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to produce bias by profile probabilities as opposed to lods</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_log_odds_flag</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to use log_odds threshold (&gt;0) to limit amino acid types of designed residues
Creates pssm_log_odds_mask based on the threshold</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>interface</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to design the interface</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>neighbors</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to design interface neighbors</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8. - The distance to measure Residues across an interface</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>A mapping of the ProteinMPNN parameter names to their data, typically arrays</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6139</span>
<span class="normal">6140</span>
<span class="normal">6141</span>
<span class="normal">6142</span>
<span class="normal">6143</span>
<span class="normal">6144</span>
<span class="normal">6145</span>
<span class="normal">6146</span>
<span class="normal">6147</span>
<span class="normal">6148</span>
<span class="normal">6149</span>
<span class="normal">6150</span>
<span class="normal">6151</span>
<span class="normal">6152</span>
<span class="normal">6153</span>
<span class="normal">6154</span>
<span class="normal">6155</span>
<span class="normal">6156</span>
<span class="normal">6157</span>
<span class="normal">6158</span>
<span class="normal">6159</span>
<span class="normal">6160</span>
<span class="normal">6161</span>
<span class="normal">6162</span>
<span class="normal">6163</span>
<span class="normal">6164</span>
<span class="normal">6165</span>
<span class="normal">6166</span>
<span class="normal">6167</span>
<span class="normal">6168</span>
<span class="normal">6169</span>
<span class="normal">6170</span>
<span class="normal">6171</span>
<span class="normal">6172</span>
<span class="normal">6173</span>
<span class="normal">6174</span>
<span class="normal">6175</span>
<span class="normal">6176</span>
<span class="normal">6177</span>
<span class="normal">6178</span>
<span class="normal">6179</span>
<span class="normal">6180</span>
<span class="normal">6181</span>
<span class="normal">6182</span>
<span class="normal">6183</span>
<span class="normal">6184</span>
<span class="normal">6185</span>
<span class="normal">6186</span>
<span class="normal">6187</span>
<span class="normal">6188</span>
<span class="normal">6189</span>
<span class="normal">6190</span>
<span class="normal">6191</span>
<span class="normal">6192</span>
<span class="normal">6193</span>
<span class="normal">6194</span>
<span class="normal">6195</span>
<span class="normal">6196</span>
<span class="normal">6197</span>
<span class="normal">6198</span>
<span class="normal">6199</span>
<span class="normal">6200</span>
<span class="normal">6201</span>
<span class="normal">6202</span>
<span class="normal">6203</span>
<span class="normal">6204</span>
<span class="normal">6205</span>
<span class="normal">6206</span>
<span class="normal">6207</span>
<span class="normal">6208</span>
<span class="normal">6209</span>
<span class="normal">6210</span>
<span class="normal">6211</span>
<span class="normal">6212</span>
<span class="normal">6213</span>
<span class="normal">6214</span>
<span class="normal">6215</span>
<span class="normal">6216</span>
<span class="normal">6217</span>
<span class="normal">6218</span>
<span class="normal">6219</span>
<span class="normal">6220</span>
<span class="normal">6221</span>
<span class="normal">6222</span>
<span class="normal">6223</span>
<span class="normal">6224</span>
<span class="normal">6225</span>
<span class="normal">6226</span>
<span class="normal">6227</span>
<span class="normal">6228</span>
<span class="normal">6229</span>
<span class="normal">6230</span>
<span class="normal">6231</span>
<span class="normal">6232</span>
<span class="normal">6233</span>
<span class="normal">6234</span>
<span class="normal">6235</span>
<span class="normal">6236</span>
<span class="normal">6237</span>
<span class="normal">6238</span>
<span class="normal">6239</span>
<span class="normal">6240</span>
<span class="normal">6241</span>
<span class="normal">6242</span>
<span class="normal">6243</span>
<span class="normal">6244</span>
<span class="normal">6245</span>
<span class="normal">6246</span>
<span class="normal">6247</span>
<span class="normal">6248</span>
<span class="normal">6249</span>
<span class="normal">6250</span>
<span class="normal">6251</span>
<span class="normal">6252</span>
<span class="normal">6253</span>
<span class="normal">6254</span>
<span class="normal">6255</span>
<span class="normal">6256</span>
<span class="normal">6257</span>
<span class="normal">6258</span>
<span class="normal">6259</span>
<span class="normal">6260</span>
<span class="normal">6261</span>
<span class="normal">6262</span>
<span class="normal">6263</span>
<span class="normal">6264</span>
<span class="normal">6265</span>
<span class="normal">6266</span>
<span class="normal">6267</span>
<span class="normal">6268</span>
<span class="normal">6269</span>
<span class="normal">6270</span>
<span class="normal">6271</span>
<span class="normal">6272</span>
<span class="normal">6273</span>
<span class="normal">6274</span>
<span class="normal">6275</span>
<span class="normal">6276</span>
<span class="normal">6277</span>
<span class="normal">6278</span>
<span class="normal">6279</span>
<span class="normal">6280</span>
<span class="normal">6281</span>
<span class="normal">6282</span>
<span class="normal">6283</span>
<span class="normal">6284</span>
<span class="normal">6285</span>
<span class="normal">6286</span>
<span class="normal">6287</span>
<span class="normal">6288</span>
<span class="normal">6289</span>
<span class="normal">6290</span>
<span class="normal">6291</span>
<span class="normal">6292</span>
<span class="normal">6293</span>
<span class="normal">6294</span>
<span class="normal">6295</span>
<span class="normal">6296</span>
<span class="normal">6297</span>
<span class="normal">6298</span>
<span class="normal">6299</span>
<span class="normal">6300</span>
<span class="normal">6301</span>
<span class="normal">6302</span>
<span class="normal">6303</span>
<span class="normal">6304</span>
<span class="normal">6305</span>
<span class="normal">6306</span>
<span class="normal">6307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_proteinmpnn_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ca_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pssm_bias_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pssm_multi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
                           <span class="n">bias_pssm_by_probabilities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pssm_log_odds_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                           <span class="n">interface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="c1"># decode_core_first: bool = False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        ca_only: Whether a minimal CA variant of the protein should be used for design calculations</span>
<span class="sd">        pssm_bias_flag: Whether to use bias to modulate the residue probabilities designed</span>
<span class="sd">        pssm_multi: How much to skew the design probabilities towards the sequence profile.</span>
<span class="sd">            Bounded between [0, 1] where 0 is no sequence profile probability.</span>
<span class="sd">            Only used with pssm_bias_flag and modifies each coefficient in pssm_coef by the fractional amount</span>
<span class="sd">        bias_pssm_by_probabilities: Whether to produce bias by profile probabilities as opposed to lods</span>
<span class="sd">        pssm_log_odds_flag: Whether to use log_odds threshold (&gt;0) to limit amino acid types of designed residues</span>
<span class="sd">            Creates pssm_log_odds_mask based on the threshold</span>
<span class="sd">        interface: Whether to design the interface</span>
<span class="sd">        neighbors: Whether to design interface neighbors</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        distance: float = 8. - The distance to measure Residues across an interface</span>

<span class="sd">    Returns:</span>
<span class="sd">        A mapping of the ProteinMPNN parameter names to their data, typically arrays</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#   decode_core_first: Whether to decode the interface core first</span>
    <span class="c1"># Initialize pose data structures for design</span>
    <span class="n">number_of_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="k">if</span> <span class="n">interface</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_and_split_interface</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Add all interface + required residues</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">design_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_residues</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues</span>
        <span class="k">if</span> <span class="n">neighbors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">design_residues</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_neighbor_residues</span>

        <span class="n">design_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_residues</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">design_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span>
        <span class="n">design_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number_of_residues</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">ca_only</span><span class="p">:</span>  <span class="c1"># self.job.design.ca_only:</span>
        <span class="n">coords_type</span> <span class="o">=</span> <span class="s1">&#39;ca_coords&#39;</span>
        <span class="n">num_model_residues</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coords_type</span> <span class="o">=</span> <span class="s1">&#39;backbone_coords&#39;</span>
        <span class="n">num_model_residues</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="c1"># Make masks for the sequence design task</span>
    <span class="c1"># Residue position mask denotes which residues should be designed. 1 - designed, 0 - known</span>
    <span class="n">residue_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">number_of_residues</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># (number_of_residues,)</span>
    <span class="n">residue_mask</span><span class="p">[</span><span class="n">design_indices</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">omit_AAs_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">mpnn_alphabet_length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># (alphabet_length,)</span>
    <span class="n">bias_AAs_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">omit_AAs_np</span><span class="p">)</span>  <span class="c1"># (alphabet_length,)</span>
    <span class="n">omit_AA_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_residues</span><span class="p">,</span> <span class="n">ml</span><span class="o">.</span><span class="n">mpnn_alphabet_length</span><span class="p">),</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># (number_of_residues, alphabet_length)</span>
    <span class="n">bias_by_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">omit_AA_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># (number_of_residues, alphabet_length)</span>

    <span class="c1"># Get sequence profile to include for design bias</span>
    <span class="n">pssm_threshold</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># Must be a greater probability than wild-type</span>
    <span class="n">pssm_log_odds</span> <span class="o">=</span> <span class="n">pssm_as_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">lod</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># (number_of_residues, 20)</span>
    <span class="n">pssm_log_odds_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pssm_log_odds</span> <span class="o">&gt;=</span> <span class="n">pssm_threshold</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>  <span class="c1"># (number_of_residues, 20)</span>
    <span class="n">pssm_coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">residue_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># (number_of_residues,)</span>
    <span class="c1"># shape (1, 21) where last index (20) is 1</span>

    <span class="c1"># Make the pssm_bias between 0 and 1 specifying how important position is where 1 is more important</span>
    <span class="k">if</span> <span class="n">bias_pssm_by_probabilities</span><span class="p">:</span>
        <span class="n">pssm_probability</span> <span class="o">=</span> <span class="n">pssm_as_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">pssm_bias</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">pssm_probability</span><span class="p">)</span>  <span class="c1"># (number_of_residues, 20)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pssm_bias</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">pssm_log_odds</span><span class="p">)</span>  <span class="c1"># (number_of_residues, 20)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="n">number_of_symmetry_mates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>
        <span class="n">number_of_sym_residues</span> <span class="o">=</span> <span class="n">number_of_residues</span> <span class="o">*</span> <span class="n">number_of_symmetry_mates</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_symmetric_coords</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords_type</span><span class="p">))</span>
        <span class="c1"># Should be N, CA, C, O for each residue</span>
        <span class="c1">#  v - Residue</span>
        <span class="c1"># [[[N  [x, y, z],</span>
        <span class="c1">#   [CA [x, y, z],</span>
        <span class="c1">#   [C  [x, y, z],</span>
        <span class="c1">#   [O  [x, y, z]],</span>
        <span class="c1">#  [[], ...      ]]</span>
        <span class="c1"># split the coordinates into those grouped by residues</span>
        <span class="c1"># X = np.array(.split(X, self.number_of_residues))</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">number_of_sym_residues</span><span class="p">,</span> <span class="n">num_model_residues</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># (number_of_sym_residues, 4, 3)</span>

        <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence_numeric</span><span class="p">,</span> <span class="n">number_of_symmetry_mates</span><span class="p">)</span>  <span class="c1"># (number_of_sym_residues,)</span>
        <span class="c1"># self.log.info(f&#39;self.sequence_numeric: {self.sequence_numeric}&#39;)</span>
        <span class="c1"># self.log.info(f&#39;Tiled sequence_numeric.shape: {S.shape}&#39;)</span>
        <span class="c1"># self.log.info(f&#39;Tiled sequence_numeric start: {S[:5]}&#39;)</span>
        <span class="c1"># self.log.info(f&#39;Tiled sequence_numeric chain_break: &#39;</span>
        <span class="c1">#               f&#39;{S[number_of_residues-5: number_of_residues+5]}&#39;)</span>

        <span class="c1"># Make masks for the sequence design task</span>
        <span class="n">residue_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">residue_mask</span><span class="p">,</span> <span class="n">number_of_symmetry_mates</span><span class="p">)</span>  <span class="c1"># (number_of_sym_residues,)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">residue_mask</span><span class="p">)</span>  <span class="c1"># (number_of_sym_residues,)</span>
        <span class="c1"># Chain mask denotes which chains should be designed. 1 - designed, 0 - known</span>
        <span class="c1"># For symmetric systems, treat each chain as designed as the logits are averaged during model.tied_sample()</span>
        <span class="n">chain_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">residue_mask</span><span class="p">)</span>  <span class="c1"># (number_of_sym_residues,)</span>
        <span class="c1"># Set up a simple array where each residue index has the index of the chain starting with the index of 1</span>
        <span class="n">chain_encoding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">residue_mask</span><span class="p">)</span>  <span class="c1"># (number_of_residues,)</span>
        <span class="c1"># Set up an array where each residue index is incremented, however each chain break has an increment of 100</span>
        <span class="n">residue_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">number_of_sym_residues</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># (number_of_residues,)</span>
        <span class="n">number_of_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span>
        <span class="k">for</span> <span class="n">model_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_symmetry_mates</span><span class="p">):</span>
            <span class="n">model_offset</span> <span class="o">=</span> <span class="n">model_idx</span> <span class="o">*</span> <span class="n">number_of_residues</span>
            <span class="n">model_entity_number</span> <span class="o">=</span> <span class="n">model_idx</span> <span class="o">*</span> <span class="n">number_of_entities</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">entity_number_of_residues</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">number_of_residues</span>
                <span class="n">entity_start</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">offset_index</span> <span class="o">+</span> <span class="n">model_offset</span>
                <span class="n">chain_encoding</span><span class="p">[</span><span class="n">entity_start</span><span class="p">:</span><span class="n">entity_start</span> <span class="o">+</span> <span class="n">entity_number_of_residues</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_entity_number</span> <span class="o">+</span> <span class="n">idx</span>
                <span class="n">residue_idx</span><span class="p">[</span><span class="n">entity_start</span><span class="p">:</span><span class="n">entity_start</span> <span class="o">+</span> <span class="n">entity_number_of_residues</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="p">(</span><span class="n">model_entity_number</span><span class="o">+</span><span class="n">idx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="c1"># self.log.debug(f&#39;Tiled chain_encoding chain_break: &#39;</span>
        <span class="c1">#                f&#39;{chain_encoding[number_of_residues-5: number_of_residues+5]}&#39;)</span>
        <span class="c1"># self.log.debug(f&#39;Tiled residue_idx chain_break: &#39;</span>
        <span class="c1">#                f&#39;{residue_idx[number_of_residues-5: number_of_residues+5]}&#39;)</span>

        <span class="n">pssm_coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">pssm_coef</span><span class="p">,</span> <span class="n">number_of_symmetry_mates</span><span class="p">)</span>  <span class="c1"># (number_of_sym_residues,)</span>
        <span class="c1"># Below have shape (number_of_sym_residues, alphabet_length)</span>
        <span class="n">pssm_bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">pssm_bias</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_symmetry_mates</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">pssm_log_odds_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">pssm_log_odds_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_symmetry_mates</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">omit_AA_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">omit_AA_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_symmetry_mates</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">bias_by_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">bias_by_res</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_symmetry_mates</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tiled bias_by_res start: </span><span class="si">{</span><span class="n">bias_by_res</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tiled bias_by_res: &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">bias_by_res</span><span class="p">[</span><span class="n">number_of_residues</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">number_of_residues</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">tied_beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">residue_mask</span><span class="p">)</span>  <span class="c1"># (number_of_sym_residues,)</span>
        <span class="n">tied_pos</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">make_indices_symmetric</span><span class="p">([</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">design_indices</span><span class="p">]</span>
        <span class="c1"># (design_residues, number_of_symmetry_mates)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords_type</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">number_of_residues</span><span class="p">,</span> <span class="n">num_model_residues</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># (residues, 4, 3)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_numeric</span>  <span class="c1"># (number_of_residues,)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">residue_mask</span><span class="p">)</span>  <span class="c1"># (number_of_residues,)</span>
        <span class="n">chain_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">residue_mask</span><span class="p">)</span>  <span class="c1"># (number_of_residues,)</span>
        <span class="c1"># Set up a simple array where each residue index has the index of the chain starting with the index of 1</span>
        <span class="n">chain_encoding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">residue_mask</span><span class="p">)</span>  <span class="c1"># (number_of_residues,)</span>
        <span class="c1"># Set up an array where each residue index is incremented, however each chain break has an increment of 100</span>
        <span class="n">residue_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">number_of_residues</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># (number_of_residues,)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">):</span>
            <span class="n">entity_number_of_residues</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">number_of_residues</span>
            <span class="n">entity_start</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">offset_index</span>
            <span class="n">chain_encoding</span><span class="p">[</span><span class="n">entity_start</span><span class="p">:</span> <span class="n">entity_start</span> <span class="o">+</span> <span class="n">entity_number_of_residues</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">residue_idx</span><span class="p">[</span><span class="n">entity_start</span><span class="p">:</span> <span class="n">entity_start</span> <span class="o">+</span> <span class="n">entity_number_of_residues</span><span class="p">]</span> <span class="o">+=</span> <span class="n">idx</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">tied_beta</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># np.ones_like(residue_mask)  # (number_of_sym_residues,)</span>
        <span class="n">tied_pos</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># [[]]</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
                <span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span>
                <span class="n">chain_mask</span><span class="o">=</span><span class="n">chain_mask</span><span class="p">,</span>
                <span class="n">chain_encoding</span><span class="o">=</span><span class="n">chain_encoding</span><span class="p">,</span>
                <span class="n">residue_idx</span><span class="o">=</span><span class="n">residue_idx</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
                <span class="n">omit_AAs_np</span><span class="o">=</span><span class="n">omit_AAs_np</span><span class="p">,</span>
                <span class="n">bias_AAs_np</span><span class="o">=</span><span class="n">bias_AAs_np</span><span class="p">,</span>
                <span class="n">chain_M_pos</span><span class="o">=</span><span class="n">residue_mask</span><span class="p">,</span>
                <span class="n">omit_AA_mask</span><span class="o">=</span><span class="n">omit_AA_mask</span><span class="p">,</span>
                <span class="n">pssm_coef</span><span class="o">=</span><span class="n">pssm_coef</span><span class="p">,</span>
                <span class="n">pssm_bias</span><span class="o">=</span><span class="n">pssm_bias</span><span class="p">,</span>
                <span class="n">pssm_multi</span><span class="o">=</span><span class="n">pssm_multi</span><span class="p">,</span>
                <span class="n">pssm_log_odds_flag</span><span class="o">=</span><span class="n">pssm_log_odds_flag</span><span class="p">,</span>
                <span class="n">pssm_log_odds_mask</span><span class="o">=</span><span class="n">pssm_log_odds_mask</span><span class="p">,</span>
                <span class="n">pssm_bias_flag</span><span class="o">=</span><span class="n">pssm_bias_flag</span><span class="p">,</span>
                <span class="n">tied_pos</span><span class="o">=</span><span class="n">tied_pos</span><span class="p">,</span>
                <span class="n">tied_beta</span><span class="o">=</span><span class="n">tied_beta</span><span class="p">,</span>
                <span class="n">bias_by_res</span><span class="o">=</span><span class="n">bias_by_res</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.generate_proteinmpnn_decode_order" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">generate_proteinmpnn_decode_order</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">generate_proteinmpnn_decode_order</span><span class="p">(</span><span class="n">to_device</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">core_first</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the decoding order for ProteinMPNN. Currently just returns an array of random floats</p>
<p>For original ProteinMPNN GitHub release, the decoding order is only dependent on first entry in batch for
model.tied_sample() while it is dependent on the entire batch for model.sample()</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>to_device</code></b>
            (<code>str</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Whether the decoding order should be transferred to the device that a ProteinMPNN model is on</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>core_first</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether the core residues (identified as fragment pairs) should be decoded first</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="torch.Tensor">Tensor</span> | <span title="numpy.ndarray">ndarray</span></code>
        
        <div class="doc-md-description">
          <p>The decoding order to be used in ProteinMPNN graph decoding</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6309</span>
<span class="normal">6310</span>
<span class="normal">6311</span>
<span class="normal">6312</span>
<span class="normal">6313</span>
<span class="normal">6314</span>
<span class="normal">6315</span>
<span class="normal">6316</span>
<span class="normal">6317</span>
<span class="normal">6318</span>
<span class="normal">6319</span>
<span class="normal">6320</span>
<span class="normal">6321</span>
<span class="normal">6322</span>
<span class="normal">6323</span>
<span class="normal">6324</span>
<span class="normal">6325</span>
<span class="normal">6326</span>
<span class="normal">6327</span>
<span class="normal">6328</span>
<span class="normal">6329</span>
<span class="normal">6330</span>
<span class="normal">6331</span>
<span class="normal">6332</span>
<span class="normal">6333</span>
<span class="normal">6334</span>
<span class="normal">6335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_proteinmpnn_decode_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">core_first</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> \
        <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the decoding order for ProteinMPNN. Currently just returns an array of random floats</span>

<span class="sd">    For original ProteinMPNN GitHub release, the decoding order is only dependent on first entry in batch for</span>
<span class="sd">    model.tied_sample() while it is dependent on the entire batch for model.sample()</span>

<span class="sd">    Args:</span>
<span class="sd">        to_device: Whether the decoding order should be transferred to the device that a ProteinMPNN model is on</span>
<span class="sd">        core_first: Whether the core residues (identified as fragment pairs) should be decoded first</span>

<span class="sd">    Returns:</span>
<span class="sd">        The decoding order to be used in ProteinMPNN graph decoding</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="n">pose_length</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>

    <span class="k">if</span> <span class="n">core_first</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;core_first is not available yet&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># random decoding order</span>
        <span class="n">decode_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">pose_length</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">to_device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">decode_order</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">decode_order</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">to_device</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_proteinmpnn_unbound_coords" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_proteinmpnn_unbound_coords</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_proteinmpnn_unbound_coords</span><span class="p">(</span><span class="n">ca_only</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Translate the coordinates along z in increments of 1000 to separate coordinates</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>ca_only</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether a minimal CA variant of the protein should be used for design calculations</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="numpy.ndarray">ndarray</span></code>
        
        <div class="doc-md-description">
          <p>The Pose coords where each Entity has been translated away from other entities</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6337</span>
<span class="normal">6338</span>
<span class="normal">6339</span>
<span class="normal">6340</span>
<span class="normal">6341</span>
<span class="normal">6342</span>
<span class="normal">6343</span>
<span class="normal">6344</span>
<span class="normal">6345</span>
<span class="normal">6346</span>
<span class="normal">6347</span>
<span class="normal">6348</span>
<span class="normal">6349</span>
<span class="normal">6350</span>
<span class="normal">6351</span>
<span class="normal">6352</span>
<span class="normal">6353</span>
<span class="normal">6354</span>
<span class="normal">6355</span>
<span class="normal">6356</span>
<span class="normal">6357</span>
<span class="normal">6358</span>
<span class="normal">6359</span>
<span class="normal">6360</span>
<span class="normal">6361</span>
<span class="normal">6362</span>
<span class="normal">6363</span>
<span class="normal">6364</span>
<span class="normal">6365</span>
<span class="normal">6366</span>
<span class="normal">6367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_proteinmpnn_unbound_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ca_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translate the coordinates along z in increments of 1000 to separate coordinates</span>

<span class="sd">    Args:</span>
<span class="sd">        ca_only: Whether a minimal CA variant of the protein should be used for design calculations</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Pose coords where each Entity has been translated away from other entities</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ca_only</span><span class="p">:</span>
        <span class="n">coords_type</span> <span class="o">=</span> <span class="s1">&#39;ca_coords&#39;</span>
        <span class="n">num_model_residues</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coords_type</span> <span class="o">=</span> <span class="s1">&#39;backbone_coords&#39;</span>
        <span class="n">num_model_residues</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">unbound_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="n">number_of_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetric_residues</span>
        <span class="n">coord_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_symmetric_coords</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_of_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
        <span class="k">def</span> <span class="nf">coord_func</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span> <span class="k">return</span> <span class="n">coords</span>

    <span class="c1"># Caution this doesn&#39;t move the oligomeric unit, it moves the ASU entity.</span>
    <span class="c1"># &quot;Unbound&quot; measurements shouldn&#39;t modify the oligomeric unit</span>
    <span class="n">entity_unbound_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">entity_unbound_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_func</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">coords_type</span><span class="p">)</span> <span class="o">+</span> <span class="n">unbound_transform</span><span class="o">*</span><span class="n">idx</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">entity_unbound_coords</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">number_of_residues</span><span class="p">,</span> <span class="n">num_model_residues</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.score_sequences" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">score_sequences</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">score_sequences</span><span class="p">(</span><span class="n">sequences</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">|</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n">str</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><span title="numpy.array">array</span></span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n"><span title="structure.utils.design_programs_literal">design_programs_literal</span></span> <span class="o">=</span> <span class="n">putils</span><span class="o">.</span><span class="n">proteinmpnn</span><span class="p">,</span> <span class="n">measure_unbound</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ca_only</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Analyze the output of sequence design</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>sequences</code></b>
            (<code><span title="collections.abc.Sequence">Sequence</span>[str] | <span title="collections.abc.Sequence">Sequence</span>[<span title="collections.abc.Sequence">Sequence</span>[str]] | <span title="numpy.array">array</span></code>)
        
        <div class="doc-md-description">
          <p>The sequences to score</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>method</code></b>
            (<code><span title="structure.utils.design_programs_literal">design_programs_literal</span></code>, default:
                <code><span title="structure.model.putils.proteinmpnn">proteinmpnn</span></code>
)
        
        <div class="doc-md-description">
          <p>Whether to score using ProteinMPNN or Rosetta</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>measure_unbound</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether the protein should be scored in the unbound state</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>ca_only</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether a minimal CA variant of the protein should be used for design calculations</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>model_name</code></b>
        
        <div class="doc-md-description">
          <p>The name of the model to use from ProteinMPNN taking the format v_X_Y,
where X is neighbor distance and Y is noise</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>backbone_noise</code></b>
        
        <div class="doc-md-description">
          <p>float = 0.0 - The amount of backbone noise to add to the pose during design</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_multi</code></b>
        
        <div class="doc-md-description">
          <p>float = 0.0 - How much to skew the design probabilities towards the sequence profile.
Bounded between [0, 1] where 0 is no sequence profile probability.
Only used with pssm_bias_flag</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_log_odds_flag</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to use log_odds mask to limit the residues designed</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_bias_flag</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to use bias to modulate the residue probabilites designed</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>bias_pssm_by_probabilities</code></b>
        
        <div class="doc-md-description">
          <p>Whether to produce bias by profile probabilities as opposed to profile lods</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>#</code></b>
            (<code>interface</code>)
        
        <div class="doc-md-description">
          <p>Whether to design the interface</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>#</code></b>
            (<code>neighbors</code>)
        
        <div class="doc-md-description">
          <p>Whether to design interface neighbors</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>decode_core_first</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to decode identified fragments (constituting the protein core)
first</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>A mapping of the design score type name to the per-residue output data which is a ndarray with shape</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>(number of sequences, pose_length).</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>For proteinmpnn,</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>these are the outputs: 'sequences', 'numeric_sequences', 'proteinmpnn_loss_complex', and</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>'proteinmpnn_loss_unbound' mapped to their corresponding arrays with data types as np.ndarray</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>For rosetta, this function isn't implemented</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6369</span>
<span class="normal">6370</span>
<span class="normal">6371</span>
<span class="normal">6372</span>
<span class="normal">6373</span>
<span class="normal">6374</span>
<span class="normal">6375</span>
<span class="normal">6376</span>
<span class="normal">6377</span>
<span class="normal">6378</span>
<span class="normal">6379</span>
<span class="normal">6380</span>
<span class="normal">6381</span>
<span class="normal">6382</span>
<span class="normal">6383</span>
<span class="normal">6384</span>
<span class="normal">6385</span>
<span class="normal">6386</span>
<span class="normal">6387</span>
<span class="normal">6388</span>
<span class="normal">6389</span>
<span class="normal">6390</span>
<span class="normal">6391</span>
<span class="normal">6392</span>
<span class="normal">6393</span>
<span class="normal">6394</span>
<span class="normal">6395</span>
<span class="normal">6396</span>
<span class="normal">6397</span>
<span class="normal">6398</span>
<span class="normal">6399</span>
<span class="normal">6400</span>
<span class="normal">6401</span>
<span class="normal">6402</span>
<span class="normal">6403</span>
<span class="normal">6404</span>
<span class="normal">6405</span>
<span class="normal">6406</span>
<span class="normal">6407</span>
<span class="normal">6408</span>
<span class="normal">6409</span>
<span class="normal">6410</span>
<span class="normal">6411</span>
<span class="normal">6412</span>
<span class="normal">6413</span>
<span class="normal">6414</span>
<span class="normal">6415</span>
<span class="normal">6416</span>
<span class="normal">6417</span>
<span class="normal">6418</span>
<span class="normal">6419</span>
<span class="normal">6420</span>
<span class="normal">6421</span>
<span class="normal">6422</span>
<span class="normal">6423</span>
<span class="normal">6424</span>
<span class="normal">6425</span>
<span class="normal">6426</span>
<span class="normal">6427</span>
<span class="normal">6428</span>
<span class="normal">6429</span>
<span class="normal">6430</span>
<span class="normal">6431</span>
<span class="normal">6432</span>
<span class="normal">6433</span>
<span class="normal">6434</span>
<span class="normal">6435</span>
<span class="normal">6436</span>
<span class="normal">6437</span>
<span class="normal">6438</span>
<span class="normal">6439</span>
<span class="normal">6440</span>
<span class="normal">6441</span>
<span class="normal">6442</span>
<span class="normal">6443</span>
<span class="normal">6444</span>
<span class="normal">6445</span>
<span class="normal">6446</span>
<span class="normal">6447</span>
<span class="normal">6448</span>
<span class="normal">6449</span>
<span class="normal">6450</span>
<span class="normal">6451</span>
<span class="normal">6452</span>
<span class="normal">6453</span>
<span class="normal">6454</span>
<span class="normal">6455</span>
<span class="normal">6456</span>
<span class="normal">6457</span>
<span class="normal">6458</span>
<span class="normal">6459</span>
<span class="normal">6460</span>
<span class="normal">6461</span>
<span class="normal">6462</span>
<span class="normal">6463</span>
<span class="normal">6464</span>
<span class="normal">6465</span>
<span class="normal">6466</span>
<span class="normal">6467</span>
<span class="normal">6468</span>
<span class="normal">6469</span>
<span class="normal">6470</span>
<span class="normal">6471</span>
<span class="normal">6472</span>
<span class="normal">6473</span>
<span class="normal">6474</span>
<span class="normal">6475</span>
<span class="normal">6476</span>
<span class="normal">6477</span>
<span class="normal">6478</span>
<span class="normal">6479</span>
<span class="normal">6480</span>
<span class="normal">6481</span>
<span class="normal">6482</span>
<span class="normal">6483</span>
<span class="normal">6484</span>
<span class="normal">6485</span>
<span class="normal">6486</span>
<span class="normal">6487</span>
<span class="normal">6488</span>
<span class="normal">6489</span>
<span class="normal">6490</span>
<span class="normal">6491</span>
<span class="normal">6492</span>
<span class="normal">6493</span>
<span class="normal">6494</span>
<span class="normal">6495</span>
<span class="normal">6496</span>
<span class="normal">6497</span>
<span class="normal">6498</span>
<span class="normal">6499</span>
<span class="normal">6500</span>
<span class="normal">6501</span>
<span class="normal">6502</span>
<span class="normal">6503</span>
<span class="normal">6504</span>
<span class="normal">6505</span>
<span class="normal">6506</span>
<span class="normal">6507</span>
<span class="normal">6508</span>
<span class="normal">6509</span>
<span class="normal">6510</span>
<span class="normal">6511</span>
<span class="normal">6512</span>
<span class="normal">6513</span>
<span class="normal">6514</span>
<span class="normal">6515</span>
<span class="normal">6516</span>
<span class="normal">6517</span>
<span class="normal">6518</span>
<span class="normal">6519</span>
<span class="normal">6520</span>
<span class="normal">6521</span>
<span class="normal">6522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>  <span class="c1"># Ensure no gradients are produced</span>
<span class="k">def</span> <span class="nf">score_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequences</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                    <span class="n">method</span><span class="p">:</span> <span class="n">design_programs_literal</span> <span class="o">=</span> <span class="n">putils</span><span class="o">.</span><span class="n">proteinmpnn</span><span class="p">,</span>
                    <span class="n">measure_unbound</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ca_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze the output of sequence design</span>

<span class="sd">    Args:</span>
<span class="sd">        sequences: The sequences to score</span>
<span class="sd">        method: Whether to score using ProteinMPNN or Rosetta</span>
<span class="sd">        measure_unbound: Whether the protein should be scored in the unbound state</span>
<span class="sd">        ca_only: Whether a minimal CA variant of the protein should be used for design calculations</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        model_name: The name of the model to use from ProteinMPNN taking the format v_X_Y,</span>
<span class="sd">            where X is neighbor distance and Y is noise</span>
<span class="sd">        backbone_noise: float = 0.0 - The amount of backbone noise to add to the pose during design</span>
<span class="sd">        pssm_multi: float = 0.0 - How much to skew the design probabilities towards the sequence profile.</span>
<span class="sd">            Bounded between [0, 1] where 0 is no sequence profile probability.</span>
<span class="sd">            Only used with pssm_bias_flag</span>
<span class="sd">        pssm_log_odds_flag: bool = False - Whether to use log_odds mask to limit the residues designed</span>
<span class="sd">        pssm_bias_flag: bool = False - Whether to use bias to modulate the residue probabilites designed</span>
<span class="sd">        bias_pssm_by_probabilities: Whether to produce bias by profile probabilities as opposed to profile lods</span>
<span class="sd">        # interface: Whether to design the interface</span>
<span class="sd">        # neighbors: Whether to design interface neighbors</span>
<span class="sd">        decode_core_first: bool = False - Whether to decode identified fragments (constituting the protein core)</span>
<span class="sd">            first</span>

<span class="sd">    Returns:</span>
<span class="sd">        A mapping of the design score type name to the per-residue output data which is a ndarray with shape</span>
<span class="sd">        (number of sequences, pose_length).</span>
<span class="sd">        For proteinmpnn,</span>
<span class="sd">        these are the outputs: &#39;sequences&#39;, &#39;numeric_sequences&#39;, &#39;proteinmpnn_loss_complex&#39;, and</span>
<span class="sd">        &#39;proteinmpnn_loss_unbound&#39; mapped to their corresponding arrays with data types as np.ndarray</span>

<span class="sd">        For rosetta, this function isn&#39;t implemented</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="n">putils</span><span class="o">.</span><span class="n">rosetta</span><span class="p">:</span>
        <span class="n">sequences_and_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t score with Rosetta from this method yet...&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="n">putils</span><span class="o">.</span><span class="n">proteinmpnn</span><span class="p">:</span>  <span class="c1"># Design with vanilla version of ProteinMPNN</span>
        <span class="c1"># Convert the sequences to correct format</span>
        <span class="c1"># missing_alphabet = &#39;&#39;</span>
        <span class="n">warn_alphabet</span> <span class="o">=</span> <span class="s1">&#39;With passed sequences type of </span><span class="si">{}</span><span class="s1">, ensure that the order of &#39;</span> \
                        <span class="sa">f</span><span class="s1">&#39;integers is of the default ProteinMPNN alphabet &quot;</span><span class="si">{</span><span class="n">ml</span><span class="o">.</span><span class="n">mpnn_alphabet</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

        <span class="k">def</span> <span class="nf">convert_and_check_sequence_type</span><span class="p">(</span><span class="n">sequences_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]]:</span>
            <span class="n">incorrect_input</span> <span class="o">=</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The passed sequences must be an Sequence[Sequence[Any]]&#39;</span><span class="p">)</span>
            <span class="n">nesting_level</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">sequences_</span>
            <span class="c1"># print(item)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">nesting_level</span><span class="p">)</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># print(item)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">final_level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">nesting_level</span><span class="p">)</span>
                <span class="n">item_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="c1"># print(final_level)</span>
                <span class="c1"># print(item_type)</span>
                <span class="k">if</span> <span class="n">final_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item_type</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                        <span class="n">sequences_</span> <span class="o">=</span> <span class="n">sequences_to_numeric</span><span class="p">(</span>
                            <span class="n">sequences</span><span class="p">,</span> <span class="n">translation_table</span><span class="o">=</span><span class="n">ml</span><span class="o">.</span><span class="n">proteinmpnn_default_translation_table</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">incorrect_input</span>
                <span class="k">elif</span> <span class="n">final_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item_type</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequences_</span><span class="p">):</span>
                            <span class="n">sequences</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

                        <span class="n">sequences_</span> <span class="o">=</span> <span class="n">sequences_to_numeric</span><span class="p">(</span>
                            <span class="n">sequences</span><span class="p">,</span> <span class="n">translation_table</span><span class="o">=</span><span class="n">ml</span><span class="o">.</span><span class="n">proteinmpnn_default_translation_table</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warn_alphabet</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span>
                        <span class="n">sequences_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sequences_</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">incorrect_input</span>
                <span class="c1"># print(&#39;Final&#39;, sequences)</span>
            <span class="k">return</span> <span class="n">sequences_</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">sequences</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">np_torch_int_float_types</span><span class="p">:</span>
                <span class="c1"># This is an integer sequence. An alphabet is required</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warn_alphabet</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sequences</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
                <span class="n">numeric_sequences</span> <span class="o">=</span> <span class="n">sequences</span>
                <span class="n">sequences</span> <span class="o">=</span> <span class="n">numeric_to_sequence</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
                <span class="c1"># raise ValueError(missing_alphabet)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># This is an AnyStr type?</span>
                <span class="n">numeric_sequences</span> <span class="o">=</span> <span class="n">sequences_to_numeric</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Some sort of iterable</span>
            <span class="n">numeric_sequences</span> <span class="o">=</span> <span class="n">convert_and_check_sequence_type</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>

        <span class="c1"># pose_length = self.number_of_residues</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">pose_length</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">numeric_sequences</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">batch_length</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">PROTEINMPNN_SCORE_BATCH_LEN</span>

        <span class="c1"># Set up parameters and model sampling type based on symmetry</span>
        <span class="k">if</span> <span class="n">measure_unbound</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X_unbound&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_proteinmpnn_unbound_coords</span><span class="p">(</span><span class="n">ca_only</span><span class="o">=</span><span class="n">ca_only</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Set up return containers based on the asymmetric sequence</span>
        <span class="n">per_residue_complex_sequence_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">numeric_sequences</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">per_residue_unbound_sequence_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">per_residue_complex_sequence_loss</span><span class="p">)</span>

        <span class="c1"># Set up parameters for the scoring task, including scoring all positions</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_proteinmpnn_params</span><span class="p">(</span><span class="n">ca_only</span><span class="o">=</span><span class="n">ca_only</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="c1"># Remove the precalculated sequence array to add our own</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
        <span class="c1"># # Insert the designed sequences inplace of the pose sequence</span>
        <span class="c1"># parameters[&#39;S&#39;] = np.tile(numeric_sequences, (1, number_of_symmetry_mates))</span>
        <span class="c1"># Set up for symmetry</span>
        <span class="n">numeric_sequences_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">numeric_sequences</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span><span class="p">))</span>
        <span class="c1"># Solve decoding order</span>
        <span class="c1"># parameters[&#39;randn&#39;] = self.generate_proteinmpnn_decode_order(**kwargs)  # to_device=device)</span>
        <span class="c1"># decoding_order = self.generate_proteinmpnn_decode_order(**kwargs)  # to_device=device)</span>
        <span class="c1"># Solve decoding order</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;decoding_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_proteinmpnn_decode_order</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># to_device=device)</span>

        <span class="nd">@ml</span><span class="o">.</span><span class="n">batch_calculation</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">batch_length</span><span class="o">=</span><span class="n">batch_length</span><span class="p">,</span>
                              <span class="n">setup</span><span class="o">=</span><span class="n">ml</span><span class="o">.</span><span class="n">setup_pose_batch_for_proteinmpnn</span><span class="p">,</span>
                              <span class="n">compute_failure_exceptions</span><span class="o">=</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span>
                                                          <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_exceptions</span><span class="o">.</span><span class="n">_ArrayMemoryError</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">_proteinmpnn_batch_score</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ml</span><span class="o">.</span><span class="n">proteinmpnn_batch_score</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>

        <span class="c1"># Set up the model with the desired weights</span>
        <span class="n">proteinmpnn_model</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">proteinmpnn_factory</span><span class="p">(</span><span class="n">ca_only</span><span class="o">=</span><span class="n">ca_only</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">proteinmpnn_model</span><span class="o">.</span><span class="n">device</span>

        <span class="c1"># Send the numpy array to torch.tensor and the device</span>
        <span class="c1"># Pass sequences as &#39;S&#39; parameter to _proteinmpnn_batch_score instead of as setup_kwargs</span>
        <span class="c1"># unique_parameters = ml.proteinmpnn_to_device(device, S=sequences, decoding_order=decoding_order)</span>
        <span class="n">unique_parameters</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">proteinmpnn_to_device</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">numeric_sequences_</span><span class="p">)</span>
        <span class="c1"># score_start = time.time()</span>
        <span class="n">scores</span> <span class="o">=</span> \
            <span class="n">_proteinmpnn_batch_score</span><span class="p">(</span><span class="n">proteinmpnn_model</span><span class="p">,</span> <span class="o">**</span><span class="n">unique_parameters</span><span class="p">,</span>  <span class="c1"># S=sequences,</span>
                                     <span class="n">pose_length</span><span class="o">=</span><span class="n">pose_length</span><span class="p">,</span>  <span class="c1"># decoding_order=decoding_order,</span>
                                     <span class="n">setup_args</span><span class="o">=</span><span class="p">(</span><span class="n">device</span><span class="p">,),</span>
                                     <span class="n">setup_kwargs</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                                     <span class="n">return_containers</span><span class="o">=</span><span class="p">{</span>
                                         <span class="s1">&#39;proteinmpnn_loss_complex&#39;</span><span class="p">:</span> <span class="n">per_residue_complex_sequence_loss</span><span class="p">,</span>
                                         <span class="s1">&#39;proteinmpnn_loss_unbound&#39;</span><span class="p">:</span> <span class="n">per_residue_unbound_sequence_loss</span><span class="p">})</span>
        <span class="n">sequences_and_scores</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sequences&#39;</span><span class="p">:</span> <span class="n">sequences</span><span class="p">,</span>
                                <span class="s1">&#39;numeric_sequences&#39;</span><span class="p">:</span> <span class="n">numeric_sequences</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">scores</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sequences_and_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39; isn&#39;t a viable scoring protocol&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sequences_and_scores</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.design_sequences" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">design_sequences</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">design_sequences</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="n"><span title="structure.utils.design_programs_literal">design_programs_literal</span></span> <span class="o">=</span> <span class="n">putils</span><span class="o">.</span><span class="n">proteinmpnn</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">temperatures</span><span class="p">:</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">interface</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">measure_unbound</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ca_only</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Perform sequence design on the Pose</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>method</code></b>
            (<code><span title="structure.utils.design_programs_literal">design_programs_literal</span></code>, default:
                <code><span title="structure.model.putils.proteinmpnn">proteinmpnn</span></code>
)
        
        <div class="doc-md-description">
          <p>Whether to design using ProteinMPNN or Rosetta</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>number</code></b>
            (<code>int</code>, default:
                <code>10</code>
)
        
        <div class="doc-md-description">
          <p>The number of sequences to design</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>temperatures</code></b>
            (<code><span title="collections.abc.Sequence">Sequence</span>[float]</code>, default:
                <code>(0.1)</code>
)
        
        <div class="doc-md-description">
          <p>The temperatures to perform design at</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>interface</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to design the interface</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>neighbors</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to design interface neighbors</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>measure_unbound</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether the protein should be designed with concern for the unbound state</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>ca_only</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether a minimal CA variant of the protein should be used for design calculations</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>neighbors</code></b>
            (<code>bool</code>)
        
        <div class="doc-md-description">
          <p>bool = False - Whether to design interface neighbors</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>model_name</code></b>
        
        <div class="doc-md-description">
          <p>The name of the model to use from ProteinMPNN taking the format v_X_Y,
where X is neighbor distance and Y is noise</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>backbone_noise</code></b>
        
        <div class="doc-md-description">
          <p>float = 0.0 - The amount of backbone noise to add to the pose during design</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_multi</code></b>
        
        <div class="doc-md-description">
          <p>float = 0.0 - How much to skew the design probabilities towards the sequence profile.
Bounded between [0, 1] where 0 is no sequence profile probability.
Only used with pssm_bias_flag</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_log_odds_flag</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to use log_odds mask to limit the residues designed</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>pssm_bias_flag</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to use bias to modulate the residue probabilites designed</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>bias_pssm_by_probabilities</code></b>
        
        <div class="doc-md-description">
          <p>Whether to produce bias by profile probabilities as opposed to profile lods</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>decode_core_first</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to decode identified fragments (constituting the protein core)
first</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>A mapping of the design score type to the per-residue output data which is a ndarray with shape</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>(number*temperatures, pose_length).</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>For proteinmpnn,</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>these are the outputs 'sequences', 'numeric_sequences', 'design_indices', 'proteinmpnn_loss_complex', and</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>'proteinmpnn_loss_unbound' mapped to their corresponding score types. For each return array, the return</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>varies such as: [temp1/number1, temp1/number2, ...,</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>tempN/number1, ...] where designs are sorted by temperature</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>For rosetta, this function isn't implemented</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6524</span>
<span class="normal">6525</span>
<span class="normal">6526</span>
<span class="normal">6527</span>
<span class="normal">6528</span>
<span class="normal">6529</span>
<span class="normal">6530</span>
<span class="normal">6531</span>
<span class="normal">6532</span>
<span class="normal">6533</span>
<span class="normal">6534</span>
<span class="normal">6535</span>
<span class="normal">6536</span>
<span class="normal">6537</span>
<span class="normal">6538</span>
<span class="normal">6539</span>
<span class="normal">6540</span>
<span class="normal">6541</span>
<span class="normal">6542</span>
<span class="normal">6543</span>
<span class="normal">6544</span>
<span class="normal">6545</span>
<span class="normal">6546</span>
<span class="normal">6547</span>
<span class="normal">6548</span>
<span class="normal">6549</span>
<span class="normal">6550</span>
<span class="normal">6551</span>
<span class="normal">6552</span>
<span class="normal">6553</span>
<span class="normal">6554</span>
<span class="normal">6555</span>
<span class="normal">6556</span>
<span class="normal">6557</span>
<span class="normal">6558</span>
<span class="normal">6559</span>
<span class="normal">6560</span>
<span class="normal">6561</span>
<span class="normal">6562</span>
<span class="normal">6563</span>
<span class="normal">6564</span>
<span class="normal">6565</span>
<span class="normal">6566</span>
<span class="normal">6567</span>
<span class="normal">6568</span>
<span class="normal">6569</span>
<span class="normal">6570</span>
<span class="normal">6571</span>
<span class="normal">6572</span>
<span class="normal">6573</span>
<span class="normal">6574</span>
<span class="normal">6575</span>
<span class="normal">6576</span>
<span class="normal">6577</span>
<span class="normal">6578</span>
<span class="normal">6579</span>
<span class="normal">6580</span>
<span class="normal">6581</span>
<span class="normal">6582</span>
<span class="normal">6583</span>
<span class="normal">6584</span>
<span class="normal">6585</span>
<span class="normal">6586</span>
<span class="normal">6587</span>
<span class="normal">6588</span>
<span class="normal">6589</span>
<span class="normal">6590</span>
<span class="normal">6591</span>
<span class="normal">6592</span>
<span class="normal">6593</span>
<span class="normal">6594</span>
<span class="normal">6595</span>
<span class="normal">6596</span>
<span class="normal">6597</span>
<span class="normal">6598</span>
<span class="normal">6599</span>
<span class="normal">6600</span>
<span class="normal">6601</span>
<span class="normal">6602</span>
<span class="normal">6603</span>
<span class="normal">6604</span>
<span class="normal">6605</span>
<span class="normal">6606</span>
<span class="normal">6607</span>
<span class="normal">6608</span>
<span class="normal">6609</span>
<span class="normal">6610</span>
<span class="normal">6611</span>
<span class="normal">6612</span>
<span class="normal">6613</span>
<span class="normal">6614</span>
<span class="normal">6615</span>
<span class="normal">6616</span>
<span class="normal">6617</span>
<span class="normal">6618</span>
<span class="normal">6619</span>
<span class="normal">6620</span>
<span class="normal">6621</span>
<span class="normal">6622</span>
<span class="normal">6623</span>
<span class="normal">6624</span>
<span class="normal">6625</span>
<span class="normal">6626</span>
<span class="normal">6627</span>
<span class="normal">6628</span>
<span class="normal">6629</span>
<span class="normal">6630</span>
<span class="normal">6631</span>
<span class="normal">6632</span>
<span class="normal">6633</span>
<span class="normal">6634</span>
<span class="normal">6635</span>
<span class="normal">6636</span>
<span class="normal">6637</span>
<span class="normal">6638</span>
<span class="normal">6639</span>
<span class="normal">6640</span>
<span class="normal">6641</span>
<span class="normal">6642</span>
<span class="normal">6643</span>
<span class="normal">6644</span>
<span class="normal">6645</span>
<span class="normal">6646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>  <span class="c1"># Ensure no gradients are produced</span>
<span class="k">def</span> <span class="nf">design_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">design_programs_literal</span> <span class="o">=</span> <span class="n">putils</span><span class="o">.</span><span class="n">proteinmpnn</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="n">temperatures</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,),</span> <span class="n">interface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">measure_unbound</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ca_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform sequence design on the Pose</span>

<span class="sd">    Args:</span>
<span class="sd">        method: Whether to design using ProteinMPNN or Rosetta</span>
<span class="sd">        number: The number of sequences to design</span>
<span class="sd">        temperatures: The temperatures to perform design at</span>
<span class="sd">        interface: Whether to design the interface</span>
<span class="sd">        neighbors: Whether to design interface neighbors</span>
<span class="sd">        measure_unbound: Whether the protein should be designed with concern for the unbound state</span>
<span class="sd">        ca_only: Whether a minimal CA variant of the protein should be used for design calculations</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        neighbors: bool = False - Whether to design interface neighbors</span>
<span class="sd">        model_name: The name of the model to use from ProteinMPNN taking the format v_X_Y,</span>
<span class="sd">            where X is neighbor distance and Y is noise</span>
<span class="sd">        backbone_noise: float = 0.0 - The amount of backbone noise to add to the pose during design</span>
<span class="sd">        pssm_multi: float = 0.0 - How much to skew the design probabilities towards the sequence profile.</span>
<span class="sd">            Bounded between [0, 1] where 0 is no sequence profile probability.</span>
<span class="sd">            Only used with pssm_bias_flag</span>
<span class="sd">        pssm_log_odds_flag: bool = False - Whether to use log_odds mask to limit the residues designed</span>
<span class="sd">        pssm_bias_flag: bool = False - Whether to use bias to modulate the residue probabilites designed</span>
<span class="sd">        bias_pssm_by_probabilities: Whether to produce bias by profile probabilities as opposed to profile lods</span>
<span class="sd">        decode_core_first: bool = False - Whether to decode identified fragments (constituting the protein core)</span>
<span class="sd">            first</span>

<span class="sd">    Returns:</span>
<span class="sd">        A mapping of the design score type to the per-residue output data which is a ndarray with shape</span>
<span class="sd">        (number*temperatures, pose_length).</span>
<span class="sd">        For proteinmpnn,</span>
<span class="sd">        these are the outputs &#39;sequences&#39;, &#39;numeric_sequences&#39;, &#39;design_indices&#39;, &#39;proteinmpnn_loss_complex&#39;, and</span>
<span class="sd">        &#39;proteinmpnn_loss_unbound&#39; mapped to their corresponding score types. For each return array, the return</span>
<span class="sd">        varies such as: [temp1/number1, temp1/number2, ...,</span>
<span class="sd">        tempN/number1, ...] where designs are sorted by temperature</span>

<span class="sd">        For rosetta, this function isn&#39;t implemented</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># rosetta: Whether to design using Rosetta energy functions</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="n">putils</span><span class="o">.</span><span class="n">rosetta</span><span class="p">:</span>
        <span class="n">sequences_and_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t design with Rosetta from this method yet...&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="n">putils</span><span class="o">.</span><span class="n">proteinmpnn</span><span class="p">:</span>  <span class="c1"># Design with vanilla version of ProteinMPNN</span>
        <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
        <span class="c1"># Set up parameters and model sampling type based on symmetry</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
            <span class="c1"># number_of_symmetry_mates = pose.number_of_symmetry_mates</span>
            <span class="c1"># mpnn_sample = proteinmpnn_model.tied_sample</span>
            <span class="n">number_of_residues</span> <span class="o">=</span> <span class="n">pose_length</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># mpnn_sample = proteinmpnn_model.sample</span>
            <span class="n">number_of_residues</span> <span class="o">=</span> <span class="n">pose_length</span>

        <span class="k">if</span> <span class="n">measure_unbound</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X_unbound&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_proteinmpnn_unbound_coords</span><span class="p">(</span><span class="n">ca_only</span><span class="o">=</span><span class="n">ca_only</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Set up the inference task</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_proteinmpnn_params</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">interface</span><span class="p">,</span> <span class="n">neighbors</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span>
                                                        <span class="n">ca_only</span><span class="o">=</span><span class="n">ca_only</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="c1"># Solve decoding order</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;randn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_proteinmpnn_decode_order</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># to_device=device)</span>

        <span class="c1"># Set up the model with the desired weights</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">number</span>
        <span class="n">proteinmpnn_model</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">proteinmpnn_factory</span><span class="p">(</span><span class="n">ca_only</span><span class="o">=</span><span class="n">ca_only</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">proteinmpnn_model</span><span class="o">.</span><span class="n">device</span>
        <span class="n">batch_length</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">calculate_proteinmpnn_batch_length</span><span class="p">(</span><span class="n">proteinmpnn_model</span><span class="p">,</span> <span class="n">number_of_residues</span><span class="p">)</span>
        <span class="c1"># batch_length = ml.PROTEINMPNN_DESIGN_BATCH_LEN</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found ProteinMPNN batch_length=</span><span class="si">{</span><span class="n">batch_length</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">generated_sequences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temperatures</span><span class="p">),</span> <span class="n">pose_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">per_residue_complex_sequence_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">generated_sequences</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">per_residue_unbound_sequence_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">per_residue_complex_sequence_loss</span><span class="p">)</span>
        <span class="n">design_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">pose_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

        <span class="nd">@ml</span><span class="o">.</span><span class="n">batch_calculation</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">batch_length</span><span class="o">=</span><span class="n">batch_length</span><span class="p">,</span>
                              <span class="n">setup</span><span class="o">=</span><span class="n">ml</span><span class="o">.</span><span class="n">setup_pose_batch_for_proteinmpnn</span><span class="p">,</span>
                              <span class="n">compute_failure_exceptions</span><span class="o">=</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span>
                                                          <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_exceptions</span><span class="o">.</span><span class="n">_ArrayMemoryError</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">_proteinmpnn_batch_design</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ml</span><span class="o">.</span><span class="n">proteinmpnn_batch_design</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>

        <span class="c1"># Data has shape (batch_length, number_of_temperatures, pose_length)</span>
        <span class="n">number_of_temps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">temperatures</span><span class="p">)</span>
        <span class="c1"># design_start = time.time()</span>
        <span class="n">sequences_and_scores</span> <span class="o">=</span> \
            <span class="n">_proteinmpnn_batch_design</span><span class="p">(</span><span class="n">proteinmpnn_model</span><span class="p">,</span> <span class="n">temperatures</span><span class="o">=</span><span class="n">temperatures</span><span class="p">,</span> <span class="n">pose_length</span><span class="o">=</span><span class="n">pose_length</span><span class="p">,</span>
                                      <span class="n">setup_args</span><span class="o">=</span><span class="p">(</span><span class="n">device</span><span class="p">,),</span>
                                      <span class="n">setup_kwargs</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                                      <span class="n">return_containers</span><span class="o">=</span><span class="p">{</span>
                                          <span class="s1">&#39;sequences&#39;</span><span class="p">:</span> <span class="n">generated_sequences</span><span class="p">,</span>
                                          <span class="s1">&#39;proteinmpnn_loss_complex&#39;</span><span class="p">:</span> <span class="n">per_residue_complex_sequence_loss</span><span class="p">,</span>
                                          <span class="s1">&#39;proteinmpnn_loss_unbound&#39;</span><span class="p">:</span> <span class="n">per_residue_unbound_sequence_loss</span><span class="p">,</span>
                                          <span class="s1">&#39;design_indices&#39;</span><span class="p">:</span> <span class="n">design_indices</span><span class="p">})</span>
        <span class="c1"># self.log.debug(f&quot;Took {time.time() - design_start:8f}s for _proteinmpnn_batch_design&quot;)</span>

        <span class="n">sequences_and_scores</span><span class="p">[</span><span class="s1">&#39;numeric_sequences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequences_and_scores</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sequences&#39;</span><span class="p">)</span>
        <span class="n">sequences_and_scores</span><span class="p">[</span><span class="s1">&#39;sequences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numeric_to_sequence</span><span class="p">(</span><span class="n">sequences_and_scores</span><span class="p">[</span><span class="s1">&#39;numeric_sequences&#39;</span><span class="p">])</span>

        <span class="c1"># Format returns to have shape (temperatures*size, pose_length) where the temperatures vary slower</span>
        <span class="c1"># Ex: [temp1/pose1, temp1/pose2, ..., tempN/pose1, ...] This groups the designs by temperature first</span>
        <span class="k">for</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">sequences_and_scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;design_indices&#39;</span><span class="p">:</span>
                <span class="c1"># These must vary by temperature</span>
                <span class="n">sequences_and_scores</span><span class="p">[</span><span class="s1">&#39;design_indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_temps</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="c1"># self.log.debug(f&#39;Found design_indices with shape: {sequences_and_scores[&quot;design_indices&quot;].shape}&#39;)</span>
                <span class="k">continue</span>
            <span class="c1"># print(f&quot;{data_type} has shape {data.shape}&quot;)</span>
            <span class="n">sequences_and_scores</span><span class="p">[</span><span class="n">data_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pose_length</span><span class="p">)</span>

        <span class="c1"># self.log.debug(f&#39;Found sequences with shape {sequences_and_scores[&quot;sequences&quot;].shape}&#39;)</span>
        <span class="c1"># self.log.debug(f&#39;Found proteinmpnn_loss_complex with shape {sequences_and_scores[&quot;proteinmpnn_loss_complex&quot;].shape}&#39;)</span>
        <span class="c1"># self.log.debug(f&#39;Found proteinmpnn_loss_unbound with shape {sequences_and_scores[&quot;proteinmpnn_loss_unbound&quot;].shape}&#39;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sequences_and_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39; isn&#39;t a viable design protocol&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sequences_and_scores</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_termini_accessibility" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_termini_accessibility</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_termini_accessibility</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">report_if_helix</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">bool</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns a dictionary indicating which termini are not buried. Coarsely locates termini which face outward</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>entity</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The Structure to query which originates in the pose</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>report_if_helix</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether the query should additionally report on the helicity of the termini</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, bool]</code>
        
        <div class="doc-md-description">
          <p>A dictionary with the mapping from termini to True if the termini is exposed
Ex: {'n': True, 'c': False}</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6648</span>
<span class="normal">6649</span>
<span class="normal">6650</span>
<span class="normal">6651</span>
<span class="normal">6652</span>
<span class="normal">6653</span>
<span class="normal">6654</span>
<span class="normal">6655</span>
<span class="normal">6656</span>
<span class="normal">6657</span>
<span class="normal">6658</span>
<span class="normal">6659</span>
<span class="normal">6660</span>
<span class="normal">6661</span>
<span class="normal">6662</span>
<span class="normal">6663</span>
<span class="normal">6664</span>
<span class="normal">6665</span>
<span class="normal">6666</span>
<span class="normal">6667</span>
<span class="normal">6668</span>
<span class="normal">6669</span>
<span class="normal">6670</span>
<span class="normal">6671</span>
<span class="normal">6672</span>
<span class="normal">6673</span>
<span class="normal">6674</span>
<span class="normal">6675</span>
<span class="normal">6676</span>
<span class="normal">6677</span>
<span class="normal">6678</span>
<span class="normal">6679</span>
<span class="normal">6680</span>
<span class="normal">6681</span>
<span class="normal">6682</span>
<span class="normal">6683</span>
<span class="normal">6684</span>
<span class="normal">6685</span>
<span class="normal">6686</span>
<span class="normal">6687</span>
<span class="normal">6688</span>
<span class="normal">6689</span>
<span class="normal">6690</span>
<span class="normal">6691</span>
<span class="normal">6692</span>
<span class="normal">6693</span>
<span class="normal">6694</span>
<span class="normal">6695</span>
<span class="normal">6696</span>
<span class="normal">6697</span>
<span class="normal">6698</span>
<span class="normal">6699</span>
<span class="normal">6700</span>
<span class="normal">6701</span>
<span class="normal">6702</span>
<span class="normal">6703</span>
<span class="normal">6704</span>
<span class="normal">6705</span>
<span class="normal">6706</span>
<span class="normal">6707</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_termini_accessibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="n">Entity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">report_if_helix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dictionary indicating which termini are not buried. Coarsely locates termini which face outward</span>

<span class="sd">    Args:</span>
<span class="sd">        entity: The Structure to query which originates in the pose</span>
<span class="sd">        report_if_helix: Whether the query should additionally report on the helicity of the termini</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with the mapping from termini to True if the termini is exposed</span>
<span class="sd">            Ex: {&#39;n&#39;: True, &#39;c&#39;: False}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assembly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">assembly</span><span class="o">.</span><span class="n">sasa</span><span class="p">:</span>
        <span class="n">assembly</span><span class="o">.</span><span class="n">get_sasa</span><span class="p">()</span>

    <span class="c1"># Find the chain that matches the Entity</span>
    <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">assembly</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">chain</span><span class="o">.</span><span class="n">entity_id</span> <span class="o">==</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">entity_chain</span> <span class="o">=</span> <span class="n">chain</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DesignError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t find a corresponding </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span><span class="si">}</span><span class="s2">.chain for the passed entity=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">n_term</span> <span class="o">=</span> <span class="n">c_term</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">entity_reference</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Locating termini accessibility for lattice symmetries hasn&#39;t been tested&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_entity</span><span class="p">,</span> <span class="n">entity_transformation</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_transformations</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">entity</span> <span class="o">==</span> <span class="n">_entity</span><span class="p">:</span>
                    <span class="n">entity_reference</span> <span class="o">=</span> <span class="n">entity_transformation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;translation2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Can&#39;t measure point of reference for entity=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span><span class="si">}</span><span class="s2"> as a matching instance wasn&#39;t &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;found in the </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">termini_proximity_from_reference</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">entity_reference</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if outward</span>
        <span class="k">if</span> <span class="n">entity_chain</span><span class="o">.</span><span class="n">n_terminal_residue</span><span class="o">.</span><span class="n">relative_sasa</span> <span class="o">&gt;</span> <span class="n">metrics</span><span class="o">.</span><span class="n">default_sasa_burial_threshold</span><span class="p">:</span>
            <span class="n">n_term</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">termini_proximity_from_reference</span><span class="p">(</span><span class="n">termini</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">entity_reference</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if outward</span>
        <span class="k">if</span> <span class="n">entity_chain</span><span class="o">.</span><span class="n">c_terminal_residue</span><span class="o">.</span><span class="n">relative_sasa</span> <span class="o">&gt;</span> <span class="n">metrics</span><span class="o">.</span><span class="n">default_sasa_burial_threshold</span><span class="p">:</span>
            <span class="n">c_term</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">report_if_helix</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">retrieve_stride_info</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="n">structure_db</span><span class="o">.</span><span class="n">structure_database_factory</span><span class="p">()</span><span class="o">.</span><span class="n">stride</span><span class="o">.</span><span class="n">retrieve_data</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parsed_secondary_structure</span> <span class="o">=</span> <span class="n">retrieve_stride_info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parsed_secondary_structure</span><span class="p">:</span>
                <span class="n">entity</span><span class="o">.</span><span class="n">secondary_structure</span> <span class="o">=</span> <span class="n">parsed_secondary_structure</span>

        <span class="n">n_term</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">n_term</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">is_termini_helical</span><span class="p">()</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="n">c_term</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">c_term</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">is_termini_helical</span><span class="p">(</span><span class="n">termini</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_term</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c_term</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.per_residue_contact_order" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">per_residue_contact_order</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">per_residue_contact_order</span><span class="p">(</span><span class="n">oligomeric_interfaces</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Calculate the contact order separating calculation for chain breaks as would be expected for 3 state folding</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>oligomeric_interfaces</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to query oligomeric interfaces</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>The dictionary of {'contact_order': array of shape (number_of_residues,)}</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6709</span>
<span class="normal">6710</span>
<span class="normal">6711</span>
<span class="normal">6712</span>
<span class="normal">6713</span>
<span class="normal">6714</span>
<span class="normal">6715</span>
<span class="normal">6716</span>
<span class="normal">6717</span>
<span class="normal">6718</span>
<span class="normal">6719</span>
<span class="normal">6720</span>
<span class="normal">6721</span>
<span class="normal">6722</span>
<span class="normal">6723</span>
<span class="normal">6724</span>
<span class="normal">6725</span>
<span class="normal">6726</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_residue_contact_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oligomeric_interfaces</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the contact order separating calculation for chain breaks as would be expected for 3 state folding</span>

<span class="sd">    Args:</span>
<span class="sd">        oligomeric_interfaces: Whether to query oligomeric interfaces</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dictionary of {&#39;contact_order&#39;: array of shape (number_of_residues,)}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">oligomeric_interfaces</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Need to perform &#39;oligomeric_interfaces&#39; calculation on the Entity.oligomer&quot;</span><span class="p">)</span>

    <span class="n">contact_order</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">):</span>
        <span class="n">contact_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">contact_order</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;contact_order&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">contact_order</span><span class="p">)}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_folding_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_folding_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_folding_metrics</span><span class="p">(</span><span class="n">profile_type</span><span class="p">:</span> <span class="n"><span title="symdesign.sequence.profile_types">profile_types</span></span> <span class="o">=</span> <span class="s1">&#39;evolutionary&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tuple</span><span class="p">[</span><span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">,</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">,</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Calculate metrics relating to the Pose folding, separating calculation for chain breaks. These include
contact_order, hydrophobic_collapse, and hydrophobic_collapse_profile (each Entity MUST have a .*_profile
attribute to return the hydrophobic collapse profile!)</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>profile_type</code></b>
            (<code><span title="symdesign.sequence.profile_types">profile_types</span></code>, default:
                <code>&#39;evolutionary&#39;</code>
)
        
        <div class="doc-md-description">
          <p>The type of profile to use to calculate the hydrophobic collapse profile</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>hydrophobicity</code></b>
        
        <div class="doc-md-description">
          <p>str = 'standard'  The hydrophobicity scale to consider. Either 'standard' (FILV),
'expanded' (FMILYVW), or provide one with 'custom' keyword argument</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>custom</code></b>
        
        <div class="doc-md-description">
          <p>mapping[str, float | int] = None  A user defined mapping of amino acid type, hydrophobicity value
pairs</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>alphabet_type</code></b>
        
        <div class="doc-md-description">
          <p>alphabet_types = None  The amino acid alphabet if the sequence consists of integer
characters</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>lower_window</code></b>
        
        <div class="doc-md-description">
          <p>int = 3  The smallest window used to measure</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>upper_window</code></b>
        
        <div class="doc-md-description">
          <p>int = 9  The largest window used to measure</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>tuple[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>The per-residue contact_order_z_score (number_of_residues),
a per-residue hydrophobic_collapse (number_of_residues),
and the hydrophobic_collapse profile (number_of_residues) based on Entity.evolutionary_profile instances</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6728</span>
<span class="normal">6729</span>
<span class="normal">6730</span>
<span class="normal">6731</span>
<span class="normal">6732</span>
<span class="normal">6733</span>
<span class="normal">6734</span>
<span class="normal">6735</span>
<span class="normal">6736</span>
<span class="normal">6737</span>
<span class="normal">6738</span>
<span class="normal">6739</span>
<span class="normal">6740</span>
<span class="normal">6741</span>
<span class="normal">6742</span>
<span class="normal">6743</span>
<span class="normal">6744</span>
<span class="normal">6745</span>
<span class="normal">6746</span>
<span class="normal">6747</span>
<span class="normal">6748</span>
<span class="normal">6749</span>
<span class="normal">6750</span>
<span class="normal">6751</span>
<span class="normal">6752</span>
<span class="normal">6753</span>
<span class="normal">6754</span>
<span class="normal">6755</span>
<span class="normal">6756</span>
<span class="normal">6757</span>
<span class="normal">6758</span>
<span class="normal">6759</span>
<span class="normal">6760</span>
<span class="normal">6761</span>
<span class="normal">6762</span>
<span class="normal">6763</span>
<span class="normal">6764</span>
<span class="normal">6765</span>
<span class="normal">6766</span>
<span class="normal">6767</span>
<span class="normal">6768</span>
<span class="normal">6769</span>
<span class="normal">6770</span>
<span class="normal">6771</span>
<span class="normal">6772</span>
<span class="normal">6773</span>
<span class="normal">6774</span>
<span class="normal">6775</span>
<span class="normal">6776</span>
<span class="normal">6777</span>
<span class="normal">6778</span>
<span class="normal">6779</span>
<span class="normal">6780</span>
<span class="normal">6781</span>
<span class="normal">6782</span>
<span class="normal">6783</span>
<span class="normal">6784</span>
<span class="normal">6785</span>
<span class="normal">6786</span>
<span class="normal">6787</span>
<span class="normal">6788</span>
<span class="normal">6789</span>
<span class="normal">6790</span>
<span class="normal">6791</span>
<span class="normal">6792</span>
<span class="normal">6793</span>
<span class="normal">6794</span>
<span class="normal">6795</span>
<span class="normal">6796</span>
<span class="normal">6797</span>
<span class="normal">6798</span>
<span class="normal">6799</span>
<span class="normal">6800</span>
<span class="normal">6801</span>
<span class="normal">6802</span>
<span class="normal">6803</span>
<span class="normal">6804</span>
<span class="normal">6805</span>
<span class="normal">6806</span>
<span class="normal">6807</span>
<span class="normal">6808</span>
<span class="normal">6809</span>
<span class="normal">6810</span>
<span class="normal">6811</span>
<span class="normal">6812</span>
<span class="normal">6813</span>
<span class="normal">6814</span>
<span class="normal">6815</span>
<span class="normal">6816</span>
<span class="normal">6817</span>
<span class="normal">6818</span>
<span class="normal">6819</span>
<span class="normal">6820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_folding_metrics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">profile_type</span><span class="p">:</span> <span class="n">profile_types</span> <span class="o">=</span> <span class="s1">&#39;evolutionary&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate metrics relating to the Pose folding, separating calculation for chain breaks. These include</span>
<span class="sd">    contact_order, hydrophobic_collapse, and hydrophobic_collapse_profile (each Entity MUST have a .*_profile</span>
<span class="sd">    attribute to return the hydrophobic collapse profile!)</span>

<span class="sd">    Args:</span>
<span class="sd">        profile_type: The type of profile to use to calculate the hydrophobic collapse profile</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        hydrophobicity: str = &#39;standard&#39;  The hydrophobicity scale to consider. Either &#39;standard&#39; (FILV),</span>
<span class="sd">            &#39;expanded&#39; (FMILYVW), or provide one with &#39;custom&#39; keyword argument</span>
<span class="sd">        custom: mapping[str, float | int] = None  A user defined mapping of amino acid type, hydrophobicity value</span>
<span class="sd">            pairs</span>
<span class="sd">        alphabet_type: alphabet_types = None  The amino acid alphabet if the sequence consists of integer</span>
<span class="sd">            characters</span>
<span class="sd">        lower_window: int = 3  The smallest window used to measure</span>
<span class="sd">        upper_window: int = 9  The largest window used to measure</span>

<span class="sd">    Returns:</span>
<span class="sd">        The per-residue contact_order_z_score (number_of_residues),</span>
<span class="sd">            a per-residue hydrophobic_collapse (number_of_residues),</span>
<span class="sd">            and the hydrophobic_collapse profile (number_of_residues) based on Entity.evolutionary_profile instances</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#       and the hydrophobic_collapse profile (msa.length, msa.number_of_residues) based on Entity.msa instances</span>
    <span class="c1"># Measure the wild type (reference) entity versus modified entity(ies) to find the hci delta</span>
    <span class="c1"># Calculate Reference sequence statistics</span>
    <span class="n">contact_order_z</span><span class="p">,</span> <span class="n">hydrophobic_collapse</span><span class="p">,</span> <span class="n">hydrophobic_collapse_profile</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">msa_metrics</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">):</span>
        <span class="n">contact_order</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">contact_order</span>
        <span class="c1"># This calculation shouldn&#39;t depend on oligomers... Only assumes unfolded -&gt; folded</span>
        <span class="c1"># contact_order = entity_oligomer.contact_order[:entity.number_of_residues]</span>
        <span class="n">entity_residue_contact_order_z</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">z_score</span><span class="p">(</span><span class="n">contact_order</span><span class="p">,</span> <span class="n">contact_order</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contact_order</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">contact_order_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity_residue_contact_order_z</span><span class="p">)</span>
        <span class="c1"># inverse_residue_contact_order_z.append(entity_residue_contact_order_z * -1)</span>
        <span class="n">hydrophobic_collapse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">hydrophobic_collapse</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="c1"># Set the entity.msa which makes a copy and adjusts for any disordered residues</span>
        <span class="c1"># This method is more accurate as it uses full sequences from MSA. However,</span>
        <span class="c1"># more time-consuming and may not matter much</span>
        <span class="c1"># if chain.msa and msa_metrics:</span>
        <span class="c1">#     hydrophobic_collapse_profile.append(chain.collapse_profile(**kwargs))</span>
        <span class="c1">#     collapse = chain.collapse_profile()</span>
        <span class="c1">#     entity_collapse_mean.append(collapse.mean(axis=-2))</span>
        <span class="c1">#     entity_collapse_std.append(collapse.std(axis=-2))</span>
        <span class="c1">#     reference_collapse_z_score.append(utils.z_score(reference_collapse, entity_collapse_mean[idx],</span>
        <span class="c1">#                                                     entity_collapse_std[idx]))</span>
        <span class="k">if</span> <span class="n">msa_metrics</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">evolutionary_profile</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">profile</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">profile_type</span><span class="si">}</span><span class="s1">_profile&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">profile_type</span> <span class="o">==</span> <span class="s1">&#39;fragment&#39;</span><span class="p">:</span>
                    <span class="n">profile_array</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">profile_array</span> <span class="o">=</span> <span class="n">pssm_as_array</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># No profile from getattr()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The profile_type &#39;</span><span class="si">{</span><span class="n">profile_type</span><span class="si">}</span><span class="s2">&#39; isn&#39;t available on </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">hydrophobic_collapse_profile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">metrics</span><span class="o">.</span><span class="n">hydrophobic_collapse_index</span><span class="p">(</span><span class="n">profile_array</span><span class="p">,</span> <span class="n">alphabet_type</span><span class="o">=</span><span class="s1">&#39;protein_letters_alph1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">msa_metrics</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">contact_order_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">contact_order_z</span><span class="p">)</span>
    <span class="n">hydrophobic_collapse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">hydrophobic_collapse</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">missing</span><span class="p">):</span>  <span class="c1"># Need to sum as it could be empty from no .entities and then wouldn&#39;t collect either</span>
        <span class="n">hydrophobic_collapse_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There were missing .evolutionary_profile attributes for </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s1"> Entity instances.&#39;</span>
                         <span class="sa">f</span><span class="s1">&#39; The collapse_profile will not be captured for the entire </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1">#     self.log.warning(f&#39;There were missing MultipleSequenceAlignment objects on {sum(missing)} Entity &#39;</span>
    <span class="c1">#                      &#39;instances. The collapse_profile will not be captured for the entire &#39;</span>
    <span class="c1">#                      f&#39;{self.__class__.__name__}.&#39;)</span>
    <span class="c1"># else:</span>
    <span class="c1">#     # We have to concatenate where the values will be different</span>
    <span class="c1">#     # axis=1 is along the residues, so the result should be the length of the pose</span>
    <span class="c1">#     # axis=0 will be different for each individual entity, so we pad to the maximum for lesser ones</span>
    <span class="c1">#     array_sizes = [array.shape[0] for array in hydrophobic_collapse_profile]</span>
    <span class="c1">#     axis0_max_length = max(array_sizes)</span>
    <span class="c1">#     # full_hydrophobic_collapse_profile = \</span>
    <span class="c1">#     #     np.full((axis0_max_length, self.number_of_residues), np.nan)  # , dtype=np.float32)</span>
    <span class="c1">#     for idx, array in enumerate(hydrophobic_collapse_profile):</span>
    <span class="c1">#         hydrophobic_collapse_profile[idx] = \</span>
    <span class="c1">#             np.pad(array, ((0, axis0_max_length - array_sizes[idx]), (0, 0)), constant_values=np.nan)</span>
    <span class="c1">#</span>
    <span class="c1">#     hydrophobic_collapse_profile = np.concatenate(hydrophobic_collapse_profile, axis=1)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hydrophobic_collapse_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">hydrophobic_collapse_profile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">contact_order_z</span><span class="p">,</span> <span class="n">hydrophobic_collapse</span><span class="p">,</span> <span class="n">hydrophobic_collapse_profile</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.interface_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">interface_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">interface_metrics</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Gather all metrics relating to the Pose and the interfaces within the Pose</p>
<p>Calls self.get_fragment_metrics(), self.calculate_secondary_structure()</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>Metrics measured as: {
'entity_max_radius_average_deviation',
'entity_min_radius_average_deviation',
'entity_radius_average_deviation',
'interface_b_factor',
'interface1_secondary_structure_fragment_topology',
'interface1_secondary_structure_fragment_count',
'interface1_secondary_structure_topology',
'interface1_secondary_structure_count',
'interface2_secondary_structure_fragment_topology',
'interface2_secondary_structure_fragment_count',
'interface2_secondary_structure_topology',
'interface2_secondary_structure_count',
'maximum_radius',
'minimum_radius',
'multiple_fragment_ratio',
'nanohedra_score_normalized',
'nanohedra_score_center_normalized',
'nanohedra_score',
'nanohedra_score_center',
'number_residues_interface_fragment_total',
'number_residues_interface_fragment_center',
'number_fragments_interface',
'number_residues_interface',
'number_residues_interface_non_fragment',
'percent_fragment_helix',
'percent_fragment_strand',
'percent_fragment_coil',
'percent_residues_fragment_interface_total',
'percent_residues_fragment_interface_center',
'percent_residues_non_fragment_interface',
'pose_length',
'symmetric_interface'</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>}</p>
<h4 id="structure.model.Pose.interface_metrics--entity_radius_ratio_v">'entity_radius_ratio_#v#',</h4>
<h4 id="structure.model.Pose.interface_metrics--entity_min_radius_ratio_v">'entity_min_radius_ratio_#v#',</h4>
<h4 id="structure.model.Pose.interface_metrics--entity_max_radius_ratio_v">'entity_max_radius_ratio_#v#',</h4>
<h4 id="structure.model.Pose.interface_metrics--entity_number_of_residues_ratio_v">'entity_number_of_residues_ratio_#v#',</h4>
<h4 id="structure.model.Pose.interface_metrics--entity_number_of_residues_average_deviation">'entity_number_of_residues_average_deviation,</h4>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6822</span>
<span class="normal">6823</span>
<span class="normal">6824</span>
<span class="normal">6825</span>
<span class="normal">6826</span>
<span class="normal">6827</span>
<span class="normal">6828</span>
<span class="normal">6829</span>
<span class="normal">6830</span>
<span class="normal">6831</span>
<span class="normal">6832</span>
<span class="normal">6833</span>
<span class="normal">6834</span>
<span class="normal">6835</span>
<span class="normal">6836</span>
<span class="normal">6837</span>
<span class="normal">6838</span>
<span class="normal">6839</span>
<span class="normal">6840</span>
<span class="normal">6841</span>
<span class="normal">6842</span>
<span class="normal">6843</span>
<span class="normal">6844</span>
<span class="normal">6845</span>
<span class="normal">6846</span>
<span class="normal">6847</span>
<span class="normal">6848</span>
<span class="normal">6849</span>
<span class="normal">6850</span>
<span class="normal">6851</span>
<span class="normal">6852</span>
<span class="normal">6853</span>
<span class="normal">6854</span>
<span class="normal">6855</span>
<span class="normal">6856</span>
<span class="normal">6857</span>
<span class="normal">6858</span>
<span class="normal">6859</span>
<span class="normal">6860</span>
<span class="normal">6861</span>
<span class="normal">6862</span>
<span class="normal">6863</span>
<span class="normal">6864</span>
<span class="normal">6865</span>
<span class="normal">6866</span>
<span class="normal">6867</span>
<span class="normal">6868</span>
<span class="normal">6869</span>
<span class="normal">6870</span>
<span class="normal">6871</span>
<span class="normal">6872</span>
<span class="normal">6873</span>
<span class="normal">6874</span>
<span class="normal">6875</span>
<span class="normal">6876</span>
<span class="normal">6877</span>
<span class="normal">6878</span>
<span class="normal">6879</span>
<span class="normal">6880</span>
<span class="normal">6881</span>
<span class="normal">6882</span>
<span class="normal">6883</span>
<span class="normal">6884</span>
<span class="normal">6885</span>
<span class="normal">6886</span>
<span class="normal">6887</span>
<span class="normal">6888</span>
<span class="normal">6889</span>
<span class="normal">6890</span>
<span class="normal">6891</span>
<span class="normal">6892</span>
<span class="normal">6893</span>
<span class="normal">6894</span>
<span class="normal">6895</span>
<span class="normal">6896</span>
<span class="normal">6897</span>
<span class="normal">6898</span>
<span class="normal">6899</span>
<span class="normal">6900</span>
<span class="normal">6901</span>
<span class="normal">6902</span>
<span class="normal">6903</span>
<span class="normal">6904</span>
<span class="normal">6905</span>
<span class="normal">6906</span>
<span class="normal">6907</span>
<span class="normal">6908</span>
<span class="normal">6909</span>
<span class="normal">6910</span>
<span class="normal">6911</span>
<span class="normal">6912</span>
<span class="normal">6913</span>
<span class="normal">6914</span>
<span class="normal">6915</span>
<span class="normal">6916</span>
<span class="normal">6917</span>
<span class="normal">6918</span>
<span class="normal">6919</span>
<span class="normal">6920</span>
<span class="normal">6921</span>
<span class="normal">6922</span>
<span class="normal">6923</span>
<span class="normal">6924</span>
<span class="normal">6925</span>
<span class="normal">6926</span>
<span class="normal">6927</span>
<span class="normal">6928</span>
<span class="normal">6929</span>
<span class="normal">6930</span>
<span class="normal">6931</span>
<span class="normal">6932</span>
<span class="normal">6933</span>
<span class="normal">6934</span>
<span class="normal">6935</span>
<span class="normal">6936</span>
<span class="normal">6937</span>
<span class="normal">6938</span>
<span class="normal">6939</span>
<span class="normal">6940</span>
<span class="normal">6941</span>
<span class="normal">6942</span>
<span class="normal">6943</span>
<span class="normal">6944</span>
<span class="normal">6945</span>
<span class="normal">6946</span>
<span class="normal">6947</span>
<span class="normal">6948</span>
<span class="normal">6949</span>
<span class="normal">6950</span>
<span class="normal">6951</span>
<span class="normal">6952</span>
<span class="normal">6953</span>
<span class="normal">6954</span>
<span class="normal">6955</span>
<span class="normal">6956</span>
<span class="normal">6957</span>
<span class="normal">6958</span>
<span class="normal">6959</span>
<span class="normal">6960</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interface_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gather all metrics relating to the Pose and the interfaces within the Pose</span>

<span class="sd">    Calls self.get_fragment_metrics(), self.calculate_secondary_structure()</span>

<span class="sd">    Returns:</span>
<span class="sd">        Metrics measured as: {</span>
<span class="sd">            &#39;entity_max_radius_average_deviation&#39;,</span>
<span class="sd">            &#39;entity_min_radius_average_deviation&#39;,</span>
<span class="sd">            &#39;entity_radius_average_deviation&#39;,</span>
<span class="sd">            &#39;interface_b_factor&#39;,</span>
<span class="sd">            &#39;interface1_secondary_structure_fragment_topology&#39;,</span>
<span class="sd">            &#39;interface1_secondary_structure_fragment_count&#39;,</span>
<span class="sd">            &#39;interface1_secondary_structure_topology&#39;,</span>
<span class="sd">            &#39;interface1_secondary_structure_count&#39;,</span>
<span class="sd">            &#39;interface2_secondary_structure_fragment_topology&#39;,</span>
<span class="sd">            &#39;interface2_secondary_structure_fragment_count&#39;,</span>
<span class="sd">            &#39;interface2_secondary_structure_topology&#39;,</span>
<span class="sd">            &#39;interface2_secondary_structure_count&#39;,</span>
<span class="sd">            &#39;maximum_radius&#39;,</span>
<span class="sd">            &#39;minimum_radius&#39;,</span>
<span class="sd">            &#39;multiple_fragment_ratio&#39;,</span>
<span class="sd">            &#39;nanohedra_score_normalized&#39;,</span>
<span class="sd">            &#39;nanohedra_score_center_normalized&#39;,</span>
<span class="sd">            &#39;nanohedra_score&#39;,</span>
<span class="sd">            &#39;nanohedra_score_center&#39;,</span>
<span class="sd">            &#39;number_residues_interface_fragment_total&#39;,</span>
<span class="sd">            &#39;number_residues_interface_fragment_center&#39;,</span>
<span class="sd">            &#39;number_fragments_interface&#39;,</span>
<span class="sd">            &#39;number_residues_interface&#39;,</span>
<span class="sd">            &#39;number_residues_interface_non_fragment&#39;,</span>
<span class="sd">            &#39;percent_fragment_helix&#39;,</span>
<span class="sd">            &#39;percent_fragment_strand&#39;,</span>
<span class="sd">            &#39;percent_fragment_coil&#39;,</span>
<span class="sd">            &#39;percent_residues_fragment_interface_total&#39;,</span>
<span class="sd">            &#39;percent_residues_fragment_interface_center&#39;,</span>
<span class="sd">            &#39;percent_residues_non_fragment_interface&#39;,</span>
<span class="sd">            &#39;pose_length&#39;,</span>
<span class="sd">            &#39;symmetric_interface&#39;</span>
<span class="sd">        }</span>
<span class="sd">            # &#39;entity_radius_ratio_#v#&#39;,</span>
<span class="sd">            # &#39;entity_min_radius_ratio_#v#&#39;,</span>
<span class="sd">            # &#39;entity_max_radius_ratio_#v#&#39;,</span>
<span class="sd">            # &#39;entity_number_of_residues_ratio_#v#&#39;,</span>
<span class="sd">            # &#39;entity_number_of_residues_average_deviation,</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pose_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fragment_metrics</span><span class="p">(</span><span class="n">total_interface</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Remove *_indices from further analysis</span>
    <span class="n">interface_fragment_residue_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_fragment_residue_indices</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pose_metrics</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;center_indices&#39;</span><span class="p">,</span> <span class="p">[]))</span>
    <span class="n">pose_metrics</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;total_indices&#39;</span><span class="p">)</span>
    <span class="n">number_residues_fragment_center</span> <span class="o">=</span> <span class="n">pose_metrics</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;number_residues_fragment_center&#39;</span><span class="p">)</span>
    <span class="n">number_residues_fragment_total</span> <span class="o">=</span> <span class="n">pose_metrics</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;number_residues_fragment_total&#39;</span><span class="p">)</span>

    <span class="n">interface_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues</span>
    <span class="n">number_residues_interface</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interface_residues</span><span class="p">)</span>
    <span class="n">number_residues_interface_non_fragment</span> <span class="o">=</span> <span class="n">number_residues_interface</span> <span class="o">-</span> <span class="n">number_residues_fragment_total</span>
    <span class="c1"># if number_residues_interface_non_fragment &lt; 0:</span>
    <span class="c1">#     raise ValueError(f&#39;Fragment metrics are broken due to &quot;number_residues_interface_non_fragment&quot; &gt; 1&#39;)</span>
    <span class="c1"># Interface B Factor</span>
    <span class="n">int_b_factor</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">residue</span><span class="o">.</span><span class="n">b_factor</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">interface_residues</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># If interface_distance is different from interface query and fragment generation these can be &lt; 0 or &gt; 1</span>
        <span class="n">percent_residues_fragment_interface_center</span> <span class="o">=</span> <span class="n">number_residues_fragment_center</span> <span class="o">/</span> <span class="n">number_residues_interface</span>
        <span class="c1"># This value can be more than 1 so not a percent...</span>
        <span class="c1"># percent_residues_fragment_interface_total = number_residues_fragment_total / number_residues_interface</span>
        <span class="n">percent_residues_fragment_interface_total</span> <span class="o">=</span> \
            <span class="nb">min</span><span class="p">(</span><span class="n">number_residues_fragment_total</span> <span class="o">/</span> <span class="n">number_residues_interface</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">percent_interface_residues_non_fragment</span> <span class="o">=</span> <span class="n">number_residues_interface_non_fragment</span> <span class="o">/</span> <span class="n">number_residues_interface</span>
        <span class="c1"># if percent_residues_fragment_interface_center &gt; 1:</span>
        <span class="c1">#     raise ValueError(f&#39;Fragment metrics are broken due to &quot;percent_residues_fragment_interface_center&quot;&gt;1&#39;)</span>
        <span class="c1"># if percent_interface_residues_non_fragment &gt; 1:</span>
        <span class="c1">#     raise ValueError(f&#39;Fragment metrics are broken due to &quot;percent_interface_residues_non_fragment&quot; &gt; 1&#39;)</span>
        <span class="n">ave_b_factor</span> <span class="o">=</span> <span class="n">int_b_factor</span> <span class="o">/</span> <span class="n">number_residues_interface</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">: No interface residues were found. Is there an interface in your design?&#39;</span><span class="p">)</span>
        <span class="n">ave_b_factor</span> <span class="o">=</span> <span class="n">percent_residues_fragment_interface_center</span> <span class="o">=</span> <span class="n">percent_residues_fragment_interface_total</span> <span class="o">=</span> \
            <span class="n">percent_interface_residues_non_fragment</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">pose_metrics</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;interface_b_factor&#39;</span><span class="p">:</span> <span class="n">ave_b_factor</span><span class="p">,</span>
        <span class="s1">&#39;number_residues_interface&#39;</span><span class="p">:</span> <span class="n">number_residues_interface</span><span class="p">,</span>
        <span class="s1">&#39;number_residues_interface_fragment_center&#39;</span><span class="p">:</span> <span class="n">number_residues_fragment_center</span><span class="p">,</span>
        <span class="s1">&#39;number_residues_interface_fragment_total&#39;</span><span class="p">:</span> <span class="n">number_residues_fragment_total</span><span class="p">,</span>
        <span class="s1">&#39;number_residues_interface_non_fragment&#39;</span><span class="p">:</span> <span class="n">number_residues_interface_non_fragment</span><span class="p">,</span>
        <span class="s1">&#39;percent_residues_non_fragment_interface&#39;</span><span class="p">:</span> <span class="n">percent_interface_residues_non_fragment</span><span class="p">,</span>
        <span class="s1">&#39;percent_residues_fragment_interface_total&#39;</span><span class="p">:</span> <span class="n">percent_residues_fragment_interface_total</span><span class="p">,</span>
        <span class="s1">&#39;percent_residues_fragment_interface_center&#39;</span><span class="p">:</span> <span class="n">percent_residues_fragment_interface_center</span><span class="p">})</span>

    <span class="n">interface_residues_by_interface_unique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues_by_interface_unique</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss_sequence_indices</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss_type_sequence</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_secondary_structure</span><span class="p">()</span>

    <span class="c1"># interface_ss_topology = {}  # {1: &#39;HHLH&#39;, 2: &#39;HSH&#39;}</span>
    <span class="c1"># interface_ss_fragment_topology = {}  # {1: &#39;HHH&#39;, 2: &#39;HH&#39;}</span>
    <span class="n">ss_type_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss_type_sequence</span>
    <span class="n">total_interface_ss_topology</span> <span class="o">=</span> <span class="n">total_interface_ss_fragment_topology</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_interface_ss_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Use unique as 2-fold interfaces &#39;interface_residues_by_interface_unique&#39; duplicate fragment_elements</span>
        <span class="n">fragment_elements</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">element</span> <span class="k">for</span> <span class="n">residue</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">interface_residues_by_interface_unique</span><span class="p">[</span><span class="n">number</span><span class="p">],</span> <span class="n">elements</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">interface_fragment_residue_indices</span><span class="p">}</span>
        <span class="c1"># Take the set of elements as there are element repeats if SS is continuous over residues</span>
        <span class="n">interface_ss_topology</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ss_type_array</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
        <span class="n">interface_ss_fragment_topology</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ss_type_array</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">fragment_elements</span><span class="p">)</span>

        <span class="n">pose_metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;interface</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s1">_secondary_structure_topology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interface_ss_topology</span>
        <span class="n">pose_metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;interface</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s1">_secondary_structure_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interface_ss_topology</span><span class="p">)</span>
        <span class="n">total_interface_ss_topology</span> <span class="o">+=</span> <span class="n">interface_ss_topology</span>
        <span class="n">pose_metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;interface</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s1">_secondary_structure_fragment_topology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interface_ss_fragment_topology</span>
        <span class="n">pose_metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;interface</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s1">_secondary_structure_fragment_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interface_ss_fragment_topology</span><span class="p">)</span>
        <span class="n">total_interface_ss_fragment_topology</span> <span class="o">+=</span> <span class="n">interface_ss_fragment_topology</span>

    <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;interface_secondary_structure_fragment_topology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_interface_ss_fragment_topology</span>
    <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;interface_secondary_structure_fragment_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_interface_ss_fragment_topology</span><span class="p">)</span>
    <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;interface_secondary_structure_topology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_interface_ss_topology</span>
    <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;interface_secondary_structure_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_interface_ss_topology</span><span class="p">)</span>

    <span class="c1"># Calculate secondary structure percent for the entire interface</span>
    <span class="n">helical_designations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">]</span>
    <span class="n">strand_designations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]</span>
    <span class="n">coil_designations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span>
    <span class="n">number_helical_residues</span> <span class="o">=</span> <span class="n">number_strand_residues</span> <span class="o">=</span> <span class="n">number_loop_residues</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">interface_residues</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">secondary_structure</span> <span class="ow">in</span> <span class="n">helical_designations</span><span class="p">:</span>
            <span class="n">number_helical_residues</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">residue</span><span class="o">.</span><span class="n">secondary_structure</span> <span class="ow">in</span> <span class="n">strand_designations</span><span class="p">:</span>
            <span class="n">number_strand_residues</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">residue</span><span class="o">.</span><span class="n">secondary_structure</span> <span class="ow">in</span> <span class="n">coil_designations</span><span class="p">:</span>
            <span class="n">number_loop_residues</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;percent_interface_helix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_helical_residues</span> <span class="o">/</span> <span class="n">number_residues_interface</span>
    <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;percent_interface_strand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_strand_residues</span> <span class="o">/</span> <span class="n">number_residues_interface</span>
    <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;percent_interface_coil&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_loop_residues</span> <span class="o">/</span> <span class="n">number_residues_interface</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues_by_interface</span> <span class="o">==</span> <span class="n">interface_residues_by_interface_unique</span><span class="p">:</span>
        <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;symmetric_interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pose_metrics</span><span class="p">[</span><span class="s1">&#39;symmetric_interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">pose_metrics</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.per_residue_errat" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">per_residue_errat</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">per_residue_errat</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return per-residue metrics for the interface surface area</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, list[float]]</code>
        
        <div class="doc-md-description">
          <p>The dictionary of errat metrics {errat_deviation, } mapped to arrays of shape (number_of_residues,)</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6962</span>
<span class="normal">6963</span>
<span class="normal">6964</span>
<span class="normal">6965</span>
<span class="normal">6966</span>
<span class="normal">6967</span>
<span class="normal">6968</span>
<span class="normal">6969</span>
<span class="normal">6970</span>
<span class="normal">6971</span>
<span class="normal">6972</span>
<span class="normal">6973</span>
<span class="normal">6974</span>
<span class="normal">6975</span>
<span class="normal">6976</span>
<span class="normal">6977</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_residue_errat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return per-residue metrics for the interface surface area</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dictionary of errat metrics {errat_deviation, } mapped to arrays of shape (number_of_residues,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">per_residue_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># pose_length = self.number_of_residues</span>
    <span class="n">assembly_minimally_contacting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_minimally_contacting</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Starting </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1"> Errat&#39;</span><span class="p">)</span>
    <span class="n">errat_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">per_residue_errat</span> <span class="o">=</span> <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">errat</span><span class="p">(</span><span class="n">out_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Finished Errat, took </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">errat_start</span><span class="si">:</span><span class="s1">6f</span><span class="si">}</span><span class="s1"> s&#39;</span><span class="p">)</span>
    <span class="n">per_residue_data</span><span class="p">[</span><span class="s1">&#39;errat_deviation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_residue_errat</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">per_residue_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.per_residue_interface_surface_area" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">per_residue_interface_surface_area</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">per_residue_interface_surface_area</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return per-residue metrics for the interface surface area</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, list[float]]</code>
        
        <div class="doc-md-description">
          <p>The dictionary of metrics mapped to arrays of values with shape (number_of_residues,)
Metrics include sasa_hydrophobic_complex, sasa_polar_complex, sasa_relative_complex,
sasa_hydrophobic_bound, sasa_polar_bound, sasa_relative_bound</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7080</span>
<span class="normal">7081</span>
<span class="normal">7082</span>
<span class="normal">7083</span>
<span class="normal">7084</span>
<span class="normal">7085</span>
<span class="normal">7086</span>
<span class="normal">7087</span>
<span class="normal">7088</span>
<span class="normal">7089</span>
<span class="normal">7090</span>
<span class="normal">7091</span>
<span class="normal">7092</span>
<span class="normal">7093</span>
<span class="normal">7094</span>
<span class="normal">7095</span>
<span class="normal">7096</span>
<span class="normal">7097</span>
<span class="normal">7098</span>
<span class="normal">7099</span>
<span class="normal">7100</span>
<span class="normal">7101</span>
<span class="normal">7102</span>
<span class="normal">7103</span>
<span class="normal">7104</span>
<span class="normal">7105</span>
<span class="normal">7106</span>
<span class="normal">7107</span>
<span class="normal">7108</span>
<span class="normal">7109</span>
<span class="normal">7110</span>
<span class="normal">7111</span>
<span class="normal">7112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_residue_interface_surface_area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return per-residue metrics for the interface surface area</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dictionary of metrics mapped to arrays of values with shape (number_of_residues,)</span>
<span class="sd">            Metrics include sasa_hydrophobic_complex, sasa_polar_complex, sasa_relative_complex,</span>
<span class="sd">            sasa_hydrophobic_bound, sasa_polar_bound, sasa_relative_bound</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">per_residue_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="n">assembly_minimally_contacting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_minimally_contacting</span>

    <span class="c1"># Perform SASA measurements</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">sasa</span><span class="p">:</span>
        <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">get_sasa</span><span class="p">()</span>
    <span class="n">assembly_asu_residues</span> <span class="o">=</span> <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">residues</span><span class="p">[:</span><span class="n">pose_length</span><span class="p">]</span>
    <span class="n">per_residue_data</span><span class="p">[</span><span class="s1">&#39;sasa_hydrophobic_complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">residue</span><span class="o">.</span><span class="n">sasa_apolar</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">assembly_asu_residues</span><span class="p">]</span>
    <span class="n">per_residue_data</span><span class="p">[</span><span class="s1">&#39;sasa_polar_complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">residue</span><span class="o">.</span><span class="n">sasa_polar</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">assembly_asu_residues</span><span class="p">]</span>
    <span class="n">per_residue_data</span><span class="p">[</span><span class="s1">&#39;sasa_relative_complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">residue</span><span class="o">.</span><span class="n">relative_sasa</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">assembly_asu_residues</span><span class="p">]</span>
    <span class="n">per_residue_sasa_unbound_apolar</span><span class="p">,</span> <span class="n">per_residue_sasa_unbound_polar</span><span class="p">,</span> <span class="n">per_residue_sasa_unbound_relative</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">sasa</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">get_sasa</span><span class="p">()</span>
        <span class="n">oligomer_asu_residues</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">residues</span><span class="p">[:</span><span class="n">entity</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">]</span>
        <span class="n">per_residue_sasa_unbound_apolar</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">residue</span><span class="o">.</span><span class="n">sasa_apolar</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">oligomer_asu_residues</span><span class="p">])</span>
        <span class="n">per_residue_sasa_unbound_polar</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">residue</span><span class="o">.</span><span class="n">sasa_polar</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">oligomer_asu_residues</span><span class="p">])</span>
        <span class="n">per_residue_sasa_unbound_relative</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">residue</span><span class="o">.</span><span class="n">relative_sasa</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">oligomer_asu_residues</span><span class="p">])</span>

    <span class="n">per_residue_data</span><span class="p">[</span><span class="s1">&#39;sasa_hydrophobic_bound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_residue_sasa_unbound_apolar</span>
    <span class="n">per_residue_data</span><span class="p">[</span><span class="s1">&#39;sasa_polar_bound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_residue_sasa_unbound_polar</span>
    <span class="n">per_residue_data</span><span class="p">[</span><span class="s1">&#39;sasa_relative_bound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_residue_sasa_unbound_relative</span>

    <span class="k">return</span> <span class="n">per_residue_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.per_residue_relative_surface_area" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">per_residue_relative_surface_area</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">per_residue_relative_surface_area</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the relative solvent accessible surface area (SASA), per residue type compared to ideal three residue
peptides, in both the bound (but not repacked) and complex states of the constituent Entity instances</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="numpy.ndarray">ndarray</span>]</code>
        
        <div class="doc-md-description">
          <p>Mapping of 'sasa_relative_complex' and 'sasa_relative_bound' to array with the per-residue relative SASA</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7210</span>
<span class="normal">7211</span>
<span class="normal">7212</span>
<span class="normal">7213</span>
<span class="normal">7214</span>
<span class="normal">7215</span>
<span class="normal">7216</span>
<span class="normal">7217</span>
<span class="normal">7218</span>
<span class="normal">7219</span>
<span class="normal">7220</span>
<span class="normal">7221</span>
<span class="normal">7222</span>
<span class="normal">7223</span>
<span class="normal">7224</span>
<span class="normal">7225</span>
<span class="normal">7226</span>
<span class="normal">7227</span>
<span class="normal">7228</span>
<span class="normal">7229</span>
<span class="normal">7230</span>
<span class="normal">7231</span>
<span class="normal">7232</span>
<span class="normal">7233</span>
<span class="normal">7234</span>
<span class="normal">7235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_residue_relative_surface_area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the relative solvent accessible surface area (SASA), per residue type compared to ideal three residue</span>
<span class="sd">    peptides, in both the bound (but not repacked) and complex states of the constituent Entity instances</span>

<span class="sd">    Returns:</span>
<span class="sd">        Mapping of &#39;sasa_relative_complex&#39; and &#39;sasa_relative_bound&#39; to array with the per-residue relative SASA</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="n">assembly_minimally_contacting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_minimally_contacting</span>

    <span class="c1"># Perform SASA measurements</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">sasa</span><span class="p">:</span>
        <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">get_sasa</span><span class="p">()</span>
    <span class="n">assembly_asu_residues</span> <span class="o">=</span> <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">residues</span><span class="p">[:</span><span class="n">pose_length</span><span class="p">]</span>
    <span class="n">per_residue_relative_sasa_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">residue</span><span class="o">.</span><span class="n">relative_sasa</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">assembly_asu_residues</span><span class="p">])</span>
    <span class="n">per_residue_relative_sasa_unbound</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">sasa</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">get_sasa</span><span class="p">()</span>
        <span class="n">oligomer_asu_residues</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">residues</span><span class="p">[:</span><span class="n">entity</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">]</span>
        <span class="n">per_residue_relative_sasa_unbound</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">residue</span><span class="o">.</span><span class="n">relative_sasa</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">oligomer_asu_residues</span><span class="p">])</span>

    <span class="n">per_residue_relative_sasa_unbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">per_residue_relative_sasa_unbound</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;sasa_relative_complex&#39;</span><span class="p">:</span> <span class="n">per_residue_relative_sasa_complex</span><span class="p">,</span>
            <span class="s1">&#39;sasa_relative_bound&#39;</span><span class="p">:</span> <span class="n">per_residue_relative_sasa_unbound</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.per_residue_buried_surface_area" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">per_residue_buried_surface_area</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">per_residue_buried_surface_area</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the buried surface area (BSA) as a result of all interfaces between Entity instances</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="numpy.ndarray">ndarray</span></code>
        
        <div class="doc-md-description">
          <p>An array with the per-residue unbound solvent accessible surface area (SASA) minus the SASA of the complex</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7237</span>
<span class="normal">7238</span>
<span class="normal">7239</span>
<span class="normal">7240</span>
<span class="normal">7241</span>
<span class="normal">7242</span>
<span class="normal">7243</span>
<span class="normal">7244</span>
<span class="normal">7245</span>
<span class="normal">7246</span>
<span class="normal">7247</span>
<span class="normal">7248</span>
<span class="normal">7249</span>
<span class="normal">7250</span>
<span class="normal">7251</span>
<span class="normal">7252</span>
<span class="normal">7253</span>
<span class="normal">7254</span>
<span class="normal">7255</span>
<span class="normal">7256</span>
<span class="normal">7257</span>
<span class="normal">7258</span>
<span class="normal">7259</span>
<span class="normal">7260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_residue_buried_surface_area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the buried surface area (BSA) as a result of all interfaces between Entity instances</span>

<span class="sd">    Returns:</span>
<span class="sd">        An array with the per-residue unbound solvent accessible surface area (SASA) minus the SASA of the complex</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="n">assembly_minimally_contacting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_minimally_contacting</span>

    <span class="c1"># Perform SASA measurements</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">sasa</span><span class="p">:</span>
        <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">get_sasa</span><span class="p">()</span>
    <span class="n">assembly_asu_residues</span> <span class="o">=</span> <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">residues</span><span class="p">[:</span><span class="n">pose_length</span><span class="p">]</span>
    <span class="n">per_residue_sasa_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">residue</span><span class="o">.</span><span class="n">sasa</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">assembly_asu_residues</span><span class="p">])</span>
    <span class="n">per_residue_sasa_unbound</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">sasa</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">get_sasa</span><span class="p">()</span>
        <span class="n">oligomer_asu_residues</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">residues</span><span class="p">[:</span><span class="n">entity</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">]</span>
        <span class="n">per_residue_sasa_unbound</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">residue</span><span class="o">.</span><span class="n">sasa</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">oligomer_asu_residues</span><span class="p">])</span>

    <span class="n">per_residue_sasa_unbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">per_residue_sasa_unbound</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">per_residue_sasa_unbound</span> <span class="o">-</span> <span class="n">per_residue_sasa_complex</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.per_residue_spatial_aggregation_propensity" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">per_residue_spatial_aggregation_propensity</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">per_residue_spatial_aggregation_propensity</span><span class="p">(</span><span class="n">distance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return per-residue spatial_aggregation for the complexed and unbound states. Positive values are more
aggregation prone, while negative values are less prone</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
            (<code>float</code>, default:
                <code>5.0</code>
)
        
        <div class="doc-md-description">
          <p>The distance in angstroms to measure Atom instances in contact</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, list[float]]</code>
        
        <div class="doc-md-description">
          <p>The dictionary of metrics mapped to arrays of values with shape (number_of_residues,)
Metrics include 'spatial_aggregation_propensity' and 'spatial_aggregation_propensity_unbound'</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7262</span>
<span class="normal">7263</span>
<span class="normal">7264</span>
<span class="normal">7265</span>
<span class="normal">7266</span>
<span class="normal">7267</span>
<span class="normal">7268</span>
<span class="normal">7269</span>
<span class="normal">7270</span>
<span class="normal">7271</span>
<span class="normal">7272</span>
<span class="normal">7273</span>
<span class="normal">7274</span>
<span class="normal">7275</span>
<span class="normal">7276</span>
<span class="normal">7277</span>
<span class="normal">7278</span>
<span class="normal">7279</span>
<span class="normal">7280</span>
<span class="normal">7281</span>
<span class="normal">7282</span>
<span class="normal">7283</span>
<span class="normal">7284</span>
<span class="normal">7285</span>
<span class="normal">7286</span>
<span class="normal">7287</span>
<span class="normal">7288</span>
<span class="normal">7289</span>
<span class="normal">7290</span>
<span class="normal">7291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">per_residue_spatial_aggregation_propensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return per-residue spatial_aggregation for the complexed and unbound states. Positive values are more</span>
<span class="sd">    aggregation prone, while negative values are less prone</span>

<span class="sd">    Args:</span>
<span class="sd">        distance: The distance in angstroms to measure Atom instances in contact</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dictionary of metrics mapped to arrays of values with shape (number_of_residues,)</span>
<span class="sd">            Metrics include &#39;spatial_aggregation_propensity&#39; and &#39;spatial_aggregation_propensity_unbound&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">per_residue_sap</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="n">assembly_minimally_contacting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_minimally_contacting</span>
    <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">spatial_aggregation_propensity_per_residue</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
    <span class="n">assembly_asu_residues</span> <span class="o">=</span> <span class="n">assembly_minimally_contacting</span><span class="o">.</span><span class="n">residues</span><span class="p">[:</span><span class="n">pose_length</span><span class="p">]</span>
    <span class="n">per_residue_sap</span><span class="p">[</span><span class="s1">&#39;spatial_aggregation_propensity&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="p">[</span><span class="n">residue</span><span class="o">.</span><span class="n">spatial_aggregation_propensity</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">assembly_asu_residues</span><span class="p">]</span>
    <span class="c1"># Calculate sap for each Entity</span>
    <span class="n">per_residue_sap_unbound</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">spatial_aggregation_propensity_per_residue</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">oligomer_asu_residues</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">residues</span><span class="p">[:</span><span class="n">entity</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">]</span>
        <span class="c1"># per_residue_sap_unbound.extend(entity.assembly.spatial_aggregation_propensity[:entity.number_of_residues])</span>
        <span class="n">per_residue_sap_unbound</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="n">residue</span><span class="o">.</span><span class="n">spatial_aggregation_propensity</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">oligomer_asu_residues</span><span class="p">])</span>

    <span class="n">per_residue_sap</span><span class="p">[</span><span class="s1">&#39;spatial_aggregation_propensity_unbound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">per_residue_sap_unbound</span>

    <span class="k">return</span> <span class="n">per_residue_sap</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_interface" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_interface</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_interface</span><span class="p">(</span><span class="n">distance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Model" href="#structure.model.Model">Model</a></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Provide a view of the Pose interface by generating a Model containing only interface Residues</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
            (<code>float</code>, default:
                <code>8.0</code>
)
        
        <div class="doc-md-description">
          <p>The distance across the interface to query for Residue contacts</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-internal" title="structure.model.Model" href="#structure.model.Model">Model</a></code>
        
        <div class="doc-md-description">
          <p>The Structure containing only the Residues in the interface</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7293</span>
<span class="normal">7294</span>
<span class="normal">7295</span>
<span class="normal">7296</span>
<span class="normal">7297</span>
<span class="normal">7298</span>
<span class="normal">7299</span>
<span class="normal">7300</span>
<span class="normal">7301</span>
<span class="normal">7302</span>
<span class="normal">7303</span>
<span class="normal">7304</span>
<span class="normal">7305</span>
<span class="normal">7306</span>
<span class="normal">7307</span>
<span class="normal">7308</span>
<span class="normal">7309</span>
<span class="normal">7310</span>
<span class="normal">7311</span>
<span class="normal">7312</span>
<span class="normal">7313</span>
<span class="normal">7314</span>
<span class="normal">7315</span>
<span class="normal">7316</span>
<span class="normal">7317</span>
<span class="normal">7318</span>
<span class="normal">7319</span>
<span class="normal">7320</span>
<span class="normal">7321</span>
<span class="normal">7322</span>
<span class="normal">7323</span>
<span class="normal">7324</span>
<span class="normal">7325</span>
<span class="normal">7326</span>
<span class="normal">7327</span>
<span class="normal">7328</span>
<span class="normal">7329</span>
<span class="normal">7330</span>
<span class="normal">7331</span>
<span class="normal">7332</span>
<span class="normal">7333</span>
<span class="normal">7334</span>
<span class="normal">7335</span>
<span class="normal">7336</span>
<span class="normal">7337</span>
<span class="normal">7338</span>
<span class="normal">7339</span>
<span class="normal">7340</span>
<span class="normal">7341</span>
<span class="normal">7342</span>
<span class="normal">7343</span>
<span class="normal">7344</span>
<span class="normal">7345</span>
<span class="normal">7346</span>
<span class="normal">7347</span>
<span class="normal">7348</span>
<span class="normal">7349</span>
<span class="normal">7350</span>
<span class="normal">7351</span>
<span class="normal">7352</span>
<span class="normal">7353</span>
<span class="normal">7354</span>
<span class="normal">7355</span>
<span class="normal">7356</span>
<span class="normal">7357</span>
<span class="normal">7358</span>
<span class="normal">7359</span>
<span class="normal">7360</span>
<span class="normal">7361</span>
<span class="normal">7362</span>
<span class="normal">7363</span>
<span class="normal">7364</span>
<span class="normal">7365</span>
<span class="normal">7366</span>
<span class="normal">7367</span>
<span class="normal">7368</span>
<span class="normal">7369</span>
<span class="normal">7370</span>
<span class="normal">7371</span>
<span class="normal">7372</span>
<span class="normal">7373</span>
<span class="normal">7374</span>
<span class="normal">7375</span>
<span class="normal">7376</span>
<span class="normal">7377</span>
<span class="normal">7378</span>
<span class="normal">7379</span>
<span class="normal">7380</span>
<span class="normal">7381</span>
<span class="normal">7382</span>
<span class="normal">7383</span>
<span class="normal">7384</span>
<span class="normal">7385</span>
<span class="normal">7386</span>
<span class="normal">7387</span>
<span class="normal">7388</span>
<span class="normal">7389</span>
<span class="normal">7390</span>
<span class="normal">7391</span>
<span class="normal">7392</span>
<span class="normal">7393</span>
<span class="normal">7394</span>
<span class="normal">7395</span>
<span class="normal">7396</span>
<span class="normal">7397</span>
<span class="normal">7398</span>
<span class="normal">7399</span>
<span class="normal">7400</span>
<span class="normal">7401</span>
<span class="normal">7402</span>
<span class="normal">7403</span>
<span class="normal">7404</span>
<span class="normal">7405</span>
<span class="normal">7406</span>
<span class="normal">7407</span>
<span class="normal">7408</span>
<span class="normal">7409</span>
<span class="normal">7410</span>
<span class="normal">7411</span>
<span class="normal">7412</span>
<span class="normal">7413</span>
<span class="normal">7414</span>
<span class="normal">7415</span>
<span class="normal">7416</span>
<span class="normal">7417</span>
<span class="normal">7418</span>
<span class="normal">7419</span>
<span class="normal">7420</span>
<span class="normal">7421</span>
<span class="normal">7422</span>
<span class="normal">7423</span>
<span class="normal">7424</span>
<span class="normal">7425</span>
<span class="normal">7426</span>
<span class="normal">7427</span>
<span class="normal">7428</span>
<span class="normal">7429</span>
<span class="normal">7430</span>
<span class="normal">7431</span>
<span class="normal">7432</span>
<span class="normal">7433</span>
<span class="normal">7434</span>
<span class="normal">7435</span>
<span class="normal">7436</span>
<span class="normal">7437</span>
<span class="normal">7438</span>
<span class="normal">7439</span>
<span class="normal">7440</span>
<span class="normal">7441</span>
<span class="normal">7442</span>
<span class="normal">7443</span>
<span class="normal">7444</span>
<span class="normal">7445</span>
<span class="normal">7446</span>
<span class="normal">7447</span>
<span class="normal">7448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide a view of the Pose interface by generating a Model containing only interface Residues</span>

<span class="sd">    Args:</span>
<span class="sd">        distance: The distance across the interface to query for Residue contacts</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Structure containing only the Residues in the interface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This function has not been properly converted to deal with non-symmetric poses&#39;</span><span class="p">)</span>

    <span class="c1"># interface_residues = []</span>
    <span class="c1"># interface_core_coords = []</span>
    <span class="c1"># for residues1, residues2 in self.interface_residues_by_entity_pair.values():</span>
    <span class="c1">#     if not residues1 and not residues2:  # no interface</span>
    <span class="c1">#         continue</span>
    <span class="c1">#     elif residues1 and not residues2:  # symmetric case</span>
    <span class="c1">#         interface_residues.extend(residues1)</span>
    <span class="c1">#         # This was useful when not doing the symmetrization below...</span>
    <span class="c1">#         # symmetric_residues = []</span>
    <span class="c1">#         # for _ in range(number_of_models):</span>
    <span class="c1">#         #     symmetric_residues.extend(residues1)</span>
    <span class="c1">#         # residues1_coords = np.concatenate([residue.coords for residue in residues1])</span>
    <span class="c1">#         # # Add the number of symmetric observed structures to a single new Structure</span>
    <span class="c1">#         # symmetric_residue_structure = Chain.from_residues(residues=symmetric_residues)</span>
    <span class="c1">#         # # symmetric_residues2_coords = self.return_symmetric_coords(residues1_coords)</span>
    <span class="c1">#         # symmetric_residue_structure.replace_coords(self.return_symmetric_coords(residues1_coords))</span>
    <span class="c1">#         # # use a single instance of the residue coords to perform a distance query against symmetric coords</span>
    <span class="c1">#         # residues_tree = BallTree(residues1_coords)</span>
    <span class="c1">#         # symmetric_query = residues_tree.query_radius(symmetric_residue_structure.coords, distance)</span>
    <span class="c1">#         # # symmetric_indices = [symmetry_idx for symmetry_idx, asu_contacts in enumerate(symmetric_query)</span>
    <span class="c1">#         # #                      if asu_contacts.any()]</span>
    <span class="c1">#         # # finally, add all correctly located, asu interface indexed symmetrical residues to the interface</span>
    <span class="c1">#         # coords_indexed_residues = symmetric_residue_structure.coords_indexed_residues</span>
    <span class="c1">#         # interface_residues.extend(set(coords_indexed_residues[sym_idx]</span>
    <span class="c1">#         #                               for sym_idx, asu_contacts in enumerate(symmetric_query)</span>
    <span class="c1">#         #                               if asu_contacts.any()))</span>
    <span class="c1">#     else:  # non-symmetric case</span>
    <span class="c1">#         interface_core_coords.extend([residue.cb_coords for residue in residues1])</span>
    <span class="c1">#         interface_core_coords.extend([residue.cb_coords for residue in residues2])</span>
    <span class="c1">#         interface_residues.extend(residues1), interface_residues.extend(residues2)</span>

    <span class="c1"># return Chain.from_residues(residues=sorted(interface_residues, key=lambda residue: residue.number))</span>
    <span class="c1"># interface_symmetry_mates = self.return_symmetric_copies(interface_asu_structure)</span>
    <span class="c1"># interface_coords = interface_asu_structure.coords</span>
    <span class="c1"># interface_cb_indices = interface_asu_structure.cb_indices</span>
    <span class="c1"># print(&#39;NUMBER of RESIDUES:&#39;, interface_asu_structure.number_of_residues,</span>
    <span class="c1">#       &#39;\nNUMBER of CB INDICES&#39;, len(interface_cb_indices))</span>
    <span class="c1"># residue_number = interface_asu_structure.number_of_residues</span>
    <span class="c1"># [interface_asu_structure.cb_indices + (residue_number * model) for model in self.number_of_symmetry_mates]</span>
    <span class="c1"># symmetric_cb_indices = np.array([idx + (coords_length * model_num) for model_num in range(number_of_models)</span>
    <span class="c1">#                                  for idx in interface_asu_structure.cb_indices])</span>
    <span class="c1"># print(&#39;Number sym CB INDICES:\n&#39;, len(symmetric_cb_indices))</span>
    <span class="c1"># From the interface core, find the mean position to seed clustering</span>
    <span class="n">entities_asu_com</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass</span>
    <span class="c1"># initial_interface_coords = self.return_symmetric_coords(entities_asu_com)</span>
    <span class="n">initial_interface_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass_symmetric_models</span>
    <span class="c1"># initial_interface_coords = self.return_symmetric_coords(np.array(interface_core_coords).mean(axis=0))</span>

    <span class="c1"># Get all interface residues and sort to ensure the asu is ordered and entity breaks can be found</span>
    <span class="n">sorted_residues</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interface_residues</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">residue</span><span class="p">:</span> <span class="n">residue</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">interface_asu_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_residues</span><span class="p">(</span><span class="n">residues</span><span class="o">=</span><span class="n">sorted_residues</span><span class="p">)</span>  <span class="c1"># , chains=False, entities=False)</span>
    <span class="c1"># symmetric_cb_indices = self.make_indices_symmetric(interface_asu_structure.cb_indices)</span>
    <span class="n">number_of_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>
    <span class="n">coords_length</span> <span class="o">=</span> <span class="n">interface_asu_structure</span><span class="o">.</span><span class="n">number_of_atoms</span>
    <span class="n">jump_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords_length</span> <span class="o">*</span> <span class="n">model_num</span> <span class="k">for</span> <span class="n">model_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_models</span><span class="p">)]</span>
    <span class="n">symmetric_cb_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="n">jump_size</span> <span class="k">for</span> <span class="n">jump_size</span> <span class="ow">in</span> <span class="n">jump_sizes</span>
                            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">interface_asu_structure</span><span class="o">.</span><span class="n">cb_indices</span><span class="p">]</span>
    <span class="n">symmetric_interface_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_symmetric_coords</span><span class="p">(</span><span class="n">interface_asu_structure</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
    <span class="c1"># index_cluster_labels = KMeans(n_clusters=self.number_of_symmetry_mates).fit_predict(symmetric_interface_coords)</span>
    <span class="c1"># symmetric_interface_cb_coords = symmetric_interface_coords[symmetric_cb_indices]</span>
    <span class="c1"># print(&#39;Number sym CB COORDS:\n&#39;, len(symmetric_interface_cb_coords))</span>
    <span class="c1"># initial_cluster_indices = [interface_cb_indices[0] + (coords_length * model_number)</span>
    <span class="c1">#                            for model_number in range(self.number_of_symmetry_mates)]</span>
    <span class="c1"># Fit a KMeans model to the symmetric interface cb coords</span>
    <span class="n">kmeans_cluster_model</span> <span class="o">=</span> \
        <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">number_of_models</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">initial_interface_coords</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">symmetric_interface_coords</span><span class="p">[</span><span class="n">symmetric_cb_indices</span><span class="p">])</span>
    <span class="c1"># kmeans_cluster_model = \</span>
    <span class="c1">#     KMeans(n_clusters=self.number_of_symmetry_mates, init=symmetric_interface_coords[initial_cluster_indices],</span>
    <span class="c1">#            n_init=1).fit(symmetric_interface_cb_coords)</span>
    <span class="c1"># Find the label where the asu is nearest too</span>
    <span class="n">asu_label</span> <span class="o">=</span> <span class="n">kmeans_cluster_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">entities_asu_com</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>  <span class="c1"># &lt;- add new first axis</span>
    <span class="c1"># asu_interface_labels = kmeans_cluster_model.predict(interface_asu_structure.cb_coords)</span>

    <span class="c1"># closest_interface_indices = np.where(index_cluster_labels == 0, True, False)</span>
    <span class="c1"># [False, False, False, True, True, True, True, True, True, False, False, False, False, False, ...]</span>
    <span class="c1"># symmetric_residues = interface_asu_structure.residues * self.number_of_symmetry_mates</span>
    <span class="c1"># [1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, ...]</span>
    <span class="c1"># asu_index = np.median(asu_interface_labels)</span>
    <span class="c1"># grab the symmetric indices for a single interface cluster, matching spatial proximity to the asu_index</span>
    <span class="c1"># closest_asu_sym_cb_indices = symmetric_cb_indices[index_cluster_labels == asu_index]</span>
    <span class="c1"># index_cluster_labels = kmeans_cluster_model.labels_</span>
    <span class="n">closest_asu_sym_cb_indices</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">kmeans_cluster_model</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">asu_label</span><span class="p">,</span> <span class="n">symmetric_cb_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># # find the cb indices of the closest interface asu</span>
    <span class="c1"># closest_asu_cb_indices = closest_asu_sym_cb_indices % coords_length</span>
    <span class="c1"># interface_asu_structure.coords_indexed_residues</span>
    <span class="c1"># find the model indices of the closest interface asu</span>
    <span class="c1"># print(&#39;Normal sym CB INDICES\n:&#39;, closest_asu_sym_cb_indices)</span>

    <span class="c1"># Create an array where each model is along axis=0 and each cb_index is along axis=1</span>
    <span class="c1"># The values in the array correspond to the symmetric cb_index if the cb_index is in the ASU</span>
    <span class="c1"># or 0 if the index isn&#39;t in the ASU</span>
    <span class="c1"># In this example the numbers aren&#39;t actually cb atom indices, they are cb residue indices...</span>
    <span class="c1"># [[ 0,  0, 2, 3, 4,  0, ...],</span>
    <span class="c1">#  [10,  0, 0, 0, 0,  0, ...],</span>
    <span class="c1">#  [ 0, 21, 0, 0, 0, 25, ...]].sum(axis=0) -&gt;</span>
    <span class="c1"># [ 10, 21, 2, 3, 4, 25, ...]</span>
    <span class="n">sym_cb_index_per_cb</span> <span class="o">=</span> <span class="n">closest_asu_sym_cb_indices</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">number_of_models</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># print(&#39;FLATTENED CB INDICES to get MODEL\n:&#39;, sym_cb_index_per_cb)</span>
    <span class="c1"># Now divide that array by the number of atoms to get the model index</span>
    <span class="n">sym_model_indices_per_cb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sym_cb_index_per_cb</span> <span class="o">//</span> <span class="n">coords_length</span><span class="p">)</span>
    <span class="c1"># print(&#39;FLOORED sym CB INDICES to get MODEL\n:&#39;, sym_model_indices_per_cb)</span>
    <span class="n">symmetry_mate_index_symmetric_coords</span> <span class="o">=</span> <span class="n">symmetric_interface_coords</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">number_of_models</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="c1"># print(&#39;RESHAPED SYMMETRIC COORDS SHAPE:&#39;, symmetry_mate_index_symmetric_coords.shape,</span>
    <span class="c1">#       &#39;\nCOORDS length:&#39;, coords_length)</span>
    <span class="c1"># Get the cb coords from the symmetric coords that correspond to the asu indices</span>
    <span class="n">closest_interface_coords</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">symmetry_mate_index_symmetric_coords</span><span class="p">[</span><span class="n">model_idx</span><span class="p">,</span> <span class="n">residue</span><span class="o">.</span><span class="n">atom_indices</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">model_idx</span><span class="p">,</span> <span class="n">residue</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sym_model_indices_per_cb</span><span class="p">,</span> <span class="n">interface_asu_structure</span><span class="o">.</span><span class="n">residues</span><span class="p">)])</span>
    <span class="c1"># closest_symmetric_coords = \</span>
    <span class="c1">#     np.where(index_cluster_labels[:, None] == asu_index, symmetric_interface_coords, np.array([0.0, 0.0, 0.0]))</span>
    <span class="c1"># closest_interface_coords = \</span>
    <span class="c1">#     closest_symmetric_coords.reshape((self.number_of_symmetry_mates, interface_coords.shape[0], -1)).sum(axis=0)</span>

    <span class="n">interface_asu_structure</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">closest_interface_coords</span>

    <span class="c1"># Correct structure attributes</span>
    <span class="c1"># Get the new indices where there are different Entity instances</span>
    <span class="n">entity_breaks</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_breaks</span><span class="p">)</span>
    <span class="n">next_entity_break</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">entity_breaks</span><span class="p">)</span>
    <span class="n">interface_residue_entity_breaks</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 0]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">residue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_residues</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">next_entity_break</span><span class="p">:</span>
            <span class="n">interface_residue_entity_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">next_entity_break</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">entity_breaks</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reached the end of self.entity_breaks before sorted_residues ran out&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Add the final idx</span>
        <span class="n">interface_residue_entity_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># For each residue, rename the chain_id according to the model it belongs to</span>
    <span class="n">number_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entities</span>
    <span class="n">model_chain_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain_id_generator</span><span class="p">())[:</span><span class="n">number_of_models</span> <span class="o">*</span> <span class="n">number_entities</span><span class="p">]</span>
    <span class="n">entity_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">next_interface_asu_entity_break</span> <span class="o">=</span> <span class="n">interface_residue_entity_breaks</span><span class="p">[</span><span class="n">entity_idx</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">model_idx</span><span class="p">,</span> <span class="n">residue</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sym_model_indices_per_cb</span><span class="p">,</span> <span class="n">interface_asu_structure</span><span class="o">.</span><span class="n">residues</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">next_interface_asu_entity_break</span><span class="p">:</span>  <span class="c1"># Increment the entity_idx</span>
            <span class="n">entity_idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">next_interface_asu_entity_break</span> <span class="o">=</span> <span class="n">interface_residue_entity_breaks</span><span class="p">[</span><span class="n">entity_idx</span><span class="p">]</span>
        <span class="n">residue</span><span class="o">.</span><span class="n">chain_id</span> <span class="o">=</span> <span class="n">model_chain_ids</span><span class="p">[(</span><span class="n">model_idx</span> <span class="o">*</span> <span class="n">number_entities</span><span class="p">)</span> <span class="o">+</span> <span class="n">entity_idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">interface_asu_structure</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_interface_residues" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_interface_residues</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_interface_residues</span><span class="p">(</span><span class="n">entity1</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tuple</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span> <span class="o">|</span> <span class="n">list</span><span class="p">,</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]</span> <span class="o">|</span> <span class="n">list</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Get unique Residues across an interface between two Entities</p>
<p>If the interface occurs between the same Entity which is non-symmetrically defined, but happens to occur along a
dimeric axis of symmetry (evaluates to True when the same Residue is found on each side of the interface), then
the residues are returned belonging to only one side of the interface</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>entity1</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>First Entity to measure interface between</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>entity2</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>Second Entity to measure interface between</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>oligomeric_interfaces</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to query oligomeric interfaces</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8. - The distance to measure Residues across an interface</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>tuple[list[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>] | list, list[<a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a>] | list]</code>
        
        <div class="doc-md-description">
          <p>The Entity1 and Entity2 interface Residue instances</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7570</span>
<span class="normal">7571</span>
<span class="normal">7572</span>
<span class="normal">7573</span>
<span class="normal">7574</span>
<span class="normal">7575</span>
<span class="normal">7576</span>
<span class="normal">7577</span>
<span class="normal">7578</span>
<span class="normal">7579</span>
<span class="normal">7580</span>
<span class="normal">7581</span>
<span class="normal">7582</span>
<span class="normal">7583</span>
<span class="normal">7584</span>
<span class="normal">7585</span>
<span class="normal">7586</span>
<span class="normal">7587</span>
<span class="normal">7588</span>
<span class="normal">7589</span>
<span class="normal">7590</span>
<span class="normal">7591</span>
<span class="normal">7592</span>
<span class="normal">7593</span>
<span class="normal">7594</span>
<span class="normal">7595</span>
<span class="normal">7596</span>
<span class="normal">7597</span>
<span class="normal">7598</span>
<span class="normal">7599</span>
<span class="normal">7600</span>
<span class="normal">7601</span>
<span class="normal">7602</span>
<span class="normal">7603</span>
<span class="normal">7604</span>
<span class="normal">7605</span>
<span class="normal">7606</span>
<span class="normal">7607</span>
<span class="normal">7608</span>
<span class="normal">7609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_interface_residues</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">entity1</span><span class="p">:</span> <span class="n">Entity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="n">Entity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Residue</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Residue</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get unique Residues across an interface between two Entities</span>

<span class="sd">    If the interface occurs between the same Entity which is non-symmetrically defined, but happens to occur along a</span>
<span class="sd">    dimeric axis of symmetry (evaluates to True when the same Residue is found on each side of the interface), then</span>
<span class="sd">    the residues are returned belonging to only one side of the interface</span>

<span class="sd">    Args:</span>
<span class="sd">        entity1: First Entity to measure interface between</span>
<span class="sd">        entity2: Second Entity to measure interface between</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        oligomeric_interfaces: bool = False - Whether to query oligomeric interfaces</span>
<span class="sd">        distance: float = 8. - The distance to measure Residues across an interface</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Entity1 and Entity2 interface Residue instances</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entity1_residues</span><span class="p">,</span> <span class="n">entity2_residues</span> <span class="o">=</span> \
        <span class="n">split_residue_pairs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_find_interface_residue_pairs</span><span class="p">(</span><span class="n">entity1</span><span class="o">=</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="o">=</span><span class="n">entity2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity1_residues</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entity2_residues</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Interface search at </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> found no interface residues&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">entity1</span> <span class="o">==</span> <span class="n">entity2</span><span class="p">:</span>  <span class="c1"># If symmetric query</span>
        <span class="c1"># Is the interface across a dimeric interface?</span>
        <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">entity2_residues</span><span class="p">:</span>  <span class="c1"># entity2 usually has fewer residues, this might be quickest</span>
            <span class="k">if</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">entity1_residues</span><span class="p">:</span>  <span class="c1"># The interface is dimeric</span>
                <span class="c1"># Include all residues found to only one side and move on</span>
                <span class="n">entity1_residues</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">entity1_residues</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">entity2_residues</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">res</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="n">entity2_residues</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">break</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At Entity </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> | Entity </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> interface:&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> found residue numbers: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">entity1_residues</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> found residue numbers: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">entity2_residues</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">entity1_residues</span><span class="p">,</span> <span class="n">entity2_residues</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.local_density_interface" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">local_density_interface</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">local_density_interface</span><span class="p">(</span><span class="n">distance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="mf">12.0</span><span class="p">,</span> <span class="n">atom_distance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">float</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Returns the density of heavy Atoms neighbors within 'distance' Angstroms to Atoms in the Pose interface</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
            (<code>float</code>, default:
                <code>12.0</code>
)
        
        <div class="doc-md-description">
          <p>The cutoff distance with which Atoms should be included in local density</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>atom_distance</code></b>
            (<code>float</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The distance to measure contacts between atoms. By default, uses default_atom_count_distance</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>residue_distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8. - The distance to residue contacts in the interface. Uses the default if None</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>oligomeric_interfaces</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to query oligomeric interfaces</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>float</code>
        
        <div class="doc-md-description">
          <p>The local atom density around the interface</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7678</span>
<span class="normal">7679</span>
<span class="normal">7680</span>
<span class="normal">7681</span>
<span class="normal">7682</span>
<span class="normal">7683</span>
<span class="normal">7684</span>
<span class="normal">7685</span>
<span class="normal">7686</span>
<span class="normal">7687</span>
<span class="normal">7688</span>
<span class="normal">7689</span>
<span class="normal">7690</span>
<span class="normal">7691</span>
<span class="normal">7692</span>
<span class="normal">7693</span>
<span class="normal">7694</span>
<span class="normal">7695</span>
<span class="normal">7696</span>
<span class="normal">7697</span>
<span class="normal">7698</span>
<span class="normal">7699</span>
<span class="normal">7700</span>
<span class="normal">7701</span>
<span class="normal">7702</span>
<span class="normal">7703</span>
<span class="normal">7704</span>
<span class="normal">7705</span>
<span class="normal">7706</span>
<span class="normal">7707</span>
<span class="normal">7708</span>
<span class="normal">7709</span>
<span class="normal">7710</span>
<span class="normal">7711</span>
<span class="normal">7712</span>
<span class="normal">7713</span>
<span class="normal">7714</span>
<span class="normal">7715</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">local_density_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">12.</span><span class="p">,</span> <span class="n">atom_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the density of heavy Atoms neighbors within &#39;distance&#39; Angstroms to Atoms in the Pose interface</span>

<span class="sd">    Args:</span>
<span class="sd">        distance: The cutoff distance with which Atoms should be included in local density</span>
<span class="sd">        atom_distance: The distance to measure contacts between atoms. By default, uses default_atom_count_distance</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        residue_distance: float = 8. - The distance to residue contacts in the interface. Uses the default if None</span>
<span class="sd">        oligomeric_interfaces: bool = False - Whether to query oligomeric interfaces</span>

<span class="sd">    Returns:</span>
<span class="sd">        The local atom density around the interface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">atom_distance</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_distance</span>

    <span class="n">interface_indices1</span><span class="p">,</span> <span class="n">interface_indices2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues_by_entity_pair</span><span class="p">:</span>
        <span class="n">atoms_indices1</span><span class="p">,</span> <span class="n">atoms_indices2</span> <span class="o">=</span> \
            <span class="n">split_number_pairs_and_sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_find_interface_atom_pairs</span><span class="p">(</span><span class="n">entity1</span><span class="o">=</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="o">=</span><span class="n">entity2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">interface_indices1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">atoms_indices1</span><span class="p">)</span>
        <span class="n">interface_indices2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">atoms_indices2</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">interface_indices1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">interface_indices2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No interface atoms located during </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">local_density_interface</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.</span>

    <span class="n">interface_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">interface_indices1</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">interface_indices2</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="n">interface_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_coords</span><span class="p">[</span><span class="n">interface_indices</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interface_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">interface_indices</span><span class="p">]</span>

    <span class="n">interface_tree</span> <span class="o">=</span> <span class="n">BallTree</span><span class="p">(</span><span class="n">interface_coords</span><span class="p">)</span>
    <span class="n">interface_counts</span> <span class="o">=</span> <span class="n">interface_tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span><span class="n">interface_coords</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">count_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interface_counts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.query_entity_pair_for_fragments" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">query_entity_pair_for_fragments</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">query_entity_pair_for_fragments</span><span class="p">(</span><span class="n">entity1</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">oligomeric_interfaces</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>For all found interface residues in an Entity/Entity interface, search for corresponding fragment pairs</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>entity1</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The first Entity to measure for interface fragments</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>entity2</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The second Entity to measure for interface fragments</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>oligomeric_interfaces</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to query oligomeric interfaces</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>by_distance</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether interface Residue instances should be found by inter-residue Cb distance</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8. - The distance to measure Residues across an interface</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self._fragment_info_by_entity_pair (dict[tuple[str, str], list[FragmentInfo]])</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7728</span>
<span class="normal">7729</span>
<span class="normal">7730</span>
<span class="normal">7731</span>
<span class="normal">7732</span>
<span class="normal">7733</span>
<span class="normal">7734</span>
<span class="normal">7735</span>
<span class="normal">7736</span>
<span class="normal">7737</span>
<span class="normal">7738</span>
<span class="normal">7739</span>
<span class="normal">7740</span>
<span class="normal">7741</span>
<span class="normal">7742</span>
<span class="normal">7743</span>
<span class="normal">7744</span>
<span class="normal">7745</span>
<span class="normal">7746</span>
<span class="normal">7747</span>
<span class="normal">7748</span>
<span class="normal">7749</span>
<span class="normal">7750</span>
<span class="normal">7751</span>
<span class="normal">7752</span>
<span class="normal">7753</span>
<span class="normal">7754</span>
<span class="normal">7755</span>
<span class="normal">7756</span>
<span class="normal">7757</span>
<span class="normal">7758</span>
<span class="normal">7759</span>
<span class="normal">7760</span>
<span class="normal">7761</span>
<span class="normal">7762</span>
<span class="normal">7763</span>
<span class="normal">7764</span>
<span class="normal">7765</span>
<span class="normal">7766</span>
<span class="normal">7767</span>
<span class="normal">7768</span>
<span class="normal">7769</span>
<span class="normal">7770</span>
<span class="normal">7771</span>
<span class="normal">7772</span>
<span class="normal">7773</span>
<span class="normal">7774</span>
<span class="normal">7775</span>
<span class="normal">7776</span>
<span class="normal">7777</span>
<span class="normal">7778</span>
<span class="normal">7779</span>
<span class="normal">7780</span>
<span class="normal">7781</span>
<span class="normal">7782</span>
<span class="normal">7783</span>
<span class="normal">7784</span>
<span class="normal">7785</span>
<span class="normal">7786</span>
<span class="normal">7787</span>
<span class="normal">7788</span>
<span class="normal">7789</span>
<span class="normal">7790</span>
<span class="normal">7791</span>
<span class="normal">7792</span>
<span class="normal">7793</span>
<span class="normal">7794</span>
<span class="normal">7795</span>
<span class="normal">7796</span>
<span class="normal">7797</span>
<span class="normal">7798</span>
<span class="normal">7799</span>
<span class="normal">7800</span>
<span class="normal">7801</span>
<span class="normal">7802</span>
<span class="normal">7803</span>
<span class="normal">7804</span>
<span class="normal">7805</span>
<span class="normal">7806</span>
<span class="normal">7807</span>
<span class="normal">7808</span>
<span class="normal">7809</span>
<span class="normal">7810</span>
<span class="normal">7811</span>
<span class="normal">7812</span>
<span class="normal">7813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">query_entity_pair_for_fragments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity1</span><span class="p">:</span> <span class="n">Entity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="n">Entity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="n">oligomeric_interfaces</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For all found interface residues in an Entity/Entity interface, search for corresponding fragment pairs</span>

<span class="sd">    Args:</span>
<span class="sd">        entity1: The first Entity to measure for interface fragments</span>
<span class="sd">        entity2: The second Entity to measure for interface fragments</span>
<span class="sd">        oligomeric_interfaces: Whether to query oligomeric interfaces</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        by_distance: bool = False - Whether interface Residue instances should be found by inter-residue Cb distance</span>
<span class="sd">        distance: float = 8. - The distance to measure Residues across an interface</span>

<span class="sd">    Sets:</span>
<span class="sd">        self._fragment_info_by_entity_pair (dict[tuple[str, str], list[FragmentInfo]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fragment_info_by_entity_pair</span><span class="p">:</span>
        <span class="c1"># Due to asymmetry in fragment generation, (2, 1) isn&#39;t checked</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">residues1</span><span class="p">,</span> <span class="n">residues2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues_by_entity_pair</span><span class="p">[(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># When interface_residues haven&#39;t been set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_and_split_interface</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">residues1</span><span class="p">,</span> <span class="n">residues2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues_by_entity_pair</span><span class="p">[(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DesignError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">query_entity_pair_for_fragments</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> can&#39;t access &#39;interface_residues&#39; as the Entity &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;pair </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> hasn&#39;t located any &#39;interface_residues&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Because of the way self.interface_residues_by_entity_pair is set, when there isn&#39;t an interface, a check on</span>
    <span class="c1"># residues1 is sufficient, however residues2 is empty with an interface present across a</span>
    <span class="c1"># non-oligomeric dimeric 2-fold</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">residues1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No residues at the </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> interface. Fragments not available&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fragment_info_by_entity_pair</span><span class="p">[(</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span>

    <span class="n">frag_residues1</span> <span class="o">=</span> <span class="n">entity1</span><span class="o">.</span><span class="n">get_fragment_residues</span><span class="p">(</span><span class="n">residues</span><span class="o">=</span><span class="n">residues1</span><span class="p">,</span> <span class="n">fragment_db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fragment_db</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">residues2</span><span class="p">:</span>  <span class="c1"># entity1 == entity2 and not residues2:</span>
        <span class="n">frag_residues2</span> <span class="o">=</span> <span class="n">frag_residues1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">frag_residues2</span> <span class="o">=</span> <span class="n">entity2</span><span class="o">.</span><span class="n">get_fragment_residues</span><span class="p">(</span><span class="n">residues</span><span class="o">=</span><span class="n">residues2</span><span class="p">,</span> <span class="n">fragment_db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fragment_db</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">frag_residues1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">frag_residues2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No fragments found at the </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> interface&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fragment_info_by_entity_pair</span><span class="p">[(</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At Entity </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> | Entity </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> interface:</span><span class="se">\n\t</span><span class="s1">&#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">frag_residues1</span><span class="p">)</span><span class="si">}</span><span class="s1"> interface fragments at residues: &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">number</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">frag_residues1</span><span class="p">]))</span><span class="si">}</span><span class="se">\n\t</span><span class="s1">&#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">frag_residues2</span><span class="p">)</span><span class="si">}</span><span class="s1"> interface fragments at residues: &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">number</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">frag_residues2</span><span class="p">]))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="c1"># Even if entity1 == entity2, only need to expand the entity2 fragments due to surface/ghost frag mechanics</span>
        <span class="n">skip_models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">entity1</span> <span class="o">==</span> <span class="n">entity2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">oligomeric_interfaces</span><span class="p">:</span>  <span class="c1"># Intra-oligomeric contacts are desired</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Including oligomeric models: &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">oligomeric_model_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity1</span><span class="p">)))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">entity1</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
                <span class="c1"># Remove interactions with the intra-oligomeric contacts (contains asu)</span>
                <span class="n">skip_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oligomeric_model_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipping oligomeric models: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">skip_models</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># else:  # Probably a C1</span>

        <span class="n">symmetric_frags2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">return_symmetric_copies</span><span class="p">(</span><span class="n">residue</span><span class="p">)</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">frag_residues2</span><span class="p">]</span>
        <span class="n">frag_residues2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">frag_mates</span> <span class="ow">in</span> <span class="n">symmetric_frags2</span><span class="p">:</span>
            <span class="n">frag_residues2</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">frag</span> <span class="k">for</span> <span class="n">sym_idx</span><span class="p">,</span> <span class="n">frag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frag_mates</span><span class="p">)</span> <span class="k">if</span> <span class="n">sym_idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip_models</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Entity </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">frag_residues2</span><span class="p">)</span><span class="si">}</span><span class="s1"> symmetric fragments&#39;</span><span class="p">)</span>

    <span class="c1"># For clash check, only the backbone and Cb are desired</span>
    <span class="n">entity1_coords</span> <span class="o">=</span> <span class="n">entity1</span><span class="o">.</span><span class="n">backbone_and_cb_coords</span>
    <span class="n">fragment_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">ghostfrag_surfacefrag_pairs</span> <span class="o">=</span> \
        <span class="n">find_fragment_overlap</span><span class="p">(</span><span class="n">frag_residues1</span><span class="p">,</span> <span class="n">frag_residues2</span><span class="p">,</span> <span class="n">clash_coords</span><span class="o">=</span><span class="n">entity1_coords</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ghostfrag_surfacefrag_pairs</span><span class="p">)</span><span class="si">}</span><span class="s1"> overlapping fragment pairs at the </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> | &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> interface&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Took </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fragment_time_start</span><span class="si">:</span><span class="s1">.8f</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fragment_info_by_entity_pair</span><span class="p">[(</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> \
        <span class="n">create_fragment_info_from_pairs</span><span class="p">(</span><span class="n">ghostfrag_surfacefrag_pairs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.find_and_split_interface" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">find_and_split_interface</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">find_and_split_interface</span><span class="p">(</span><span class="n">by_distance</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Locate interfaces regions for the designable entities and split into two contiguous interface residues sets</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>by_distance</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether interface Residue instances should be found by inter-residue Cb distance</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8. - The distance to measure Residues across an interface</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>oligomeric_interfaces</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to query oligomeric interfaces</p>
        </div>
      </li>
  </ul>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self._interface_residues_by_entity_pair (dict[tuple[str, str], tuple[list[int], list[int]]]):
    The Entity1/Entity2 interface mapped to the interface Residues
self._interface_residues_by_interface (dict[int, list[int]]): Residue instances separated by
    interface topology
self._interface_residues_by_interface_unique (dict[int, list[int]]): Residue instances separated by
    interface topology removing any dimeric duplicates</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7833</span>
<span class="normal">7834</span>
<span class="normal">7835</span>
<span class="normal">7836</span>
<span class="normal">7837</span>
<span class="normal">7838</span>
<span class="normal">7839</span>
<span class="normal">7840</span>
<span class="normal">7841</span>
<span class="normal">7842</span>
<span class="normal">7843</span>
<span class="normal">7844</span>
<span class="normal">7845</span>
<span class="normal">7846</span>
<span class="normal">7847</span>
<span class="normal">7848</span>
<span class="normal">7849</span>
<span class="normal">7850</span>
<span class="normal">7851</span>
<span class="normal">7852</span>
<span class="normal">7853</span>
<span class="normal">7854</span>
<span class="normal">7855</span>
<span class="normal">7856</span>
<span class="normal">7857</span>
<span class="normal">7858</span>
<span class="normal">7859</span>
<span class="normal">7860</span>
<span class="normal">7861</span>
<span class="normal">7862</span>
<span class="normal">7863</span>
<span class="normal">7864</span>
<span class="normal">7865</span>
<span class="normal">7866</span>
<span class="normal">7867</span>
<span class="normal">7868</span>
<span class="normal">7869</span>
<span class="normal">7870</span>
<span class="normal">7871</span>
<span class="normal">7872</span>
<span class="normal">7873</span>
<span class="normal">7874</span>
<span class="normal">7875</span>
<span class="normal">7876</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_and_split_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_distance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Locate interfaces regions for the designable entities and split into two contiguous interface residues sets</span>

<span class="sd">    Args:</span>
<span class="sd">        by_distance: Whether interface Residue instances should be found by inter-residue Cb distance</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        distance: float = 8. - The distance to measure Residues across an interface</span>
<span class="sd">        oligomeric_interfaces: bool = False - Whether to query oligomeric interfaces</span>

<span class="sd">    Sets:</span>
<span class="sd">        self._interface_residues_by_entity_pair (dict[tuple[str, str], tuple[list[int], list[int]]]):</span>
<span class="sd">            The Entity1/Entity2 interface mapped to the interface Residues</span>
<span class="sd">        self._interface_residues_by_interface (dict[int, list[int]]): Residue instances separated by</span>
<span class="sd">            interface topology</span>
<span class="sd">        self._interface_residues_by_interface_unique (dict[int, list[int]]): Residue instances separated by</span>
<span class="sd">            interface topology removing any dimeric duplicates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Interface residues weren&#39;t set as they&#39;re already set. If they&#39;ve been changed, the &quot;</span>
                       <span class="s2">&quot;attribute &#39;interface_residues_by_interface&#39; should be reset&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">active_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_entities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Find and split interface using active_entities: &#39;</span>
                   <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">active_entities</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">by_distance</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
            <span class="n">entity_combinations</span> <span class="o">=</span> <span class="n">combinations_with_replacement</span><span class="p">(</span><span class="n">active_entities</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entity_combinations</span> <span class="o">=</span> <span class="n">combinations</span><span class="p">(</span><span class="n">active_entities</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">entity_pair</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Entity</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span> <span class="ow">in</span> <span class="n">entity_combinations</span><span class="p">:</span>
            <span class="n">residues1</span><span class="p">,</span> <span class="n">residues2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface_residues</span><span class="p">(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_entity_name_pair</span><span class="p">[(</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">residues1</span><span class="p">],</span>
                <span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">residues2</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_find_interface_residues_by_buried_surface_area</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">check_interface_topology</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.check_interface_topology" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">check_interface_topology</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">check_interface_topology</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>From each pair of entities that share an interface, split the identified residues into two distinct groups.
If an interface can't be composed into two distinct groups, raise DesignError</p>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self._interface_residues_by_interface (dict[int, list[int]]): Residue instances separated by
    interface topology
self._interface_residues_by_interface_unique (dict[int, list[int]]): Residue instances separated by
    interface topology removing any dimeric duplicates</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7878</span>
<span class="normal">7879</span>
<span class="normal">7880</span>
<span class="normal">7881</span>
<span class="normal">7882</span>
<span class="normal">7883</span>
<span class="normal">7884</span>
<span class="normal">7885</span>
<span class="normal">7886</span>
<span class="normal">7887</span>
<span class="normal">7888</span>
<span class="normal">7889</span>
<span class="normal">7890</span>
<span class="normal">7891</span>
<span class="normal">7892</span>
<span class="normal">7893</span>
<span class="normal">7894</span>
<span class="normal">7895</span>
<span class="normal">7896</span>
<span class="normal">7897</span>
<span class="normal">7898</span>
<span class="normal">7899</span>
<span class="normal">7900</span>
<span class="normal">7901</span>
<span class="normal">7902</span>
<span class="normal">7903</span>
<span class="normal">7904</span>
<span class="normal">7905</span>
<span class="normal">7906</span>
<span class="normal">7907</span>
<span class="normal">7908</span>
<span class="normal">7909</span>
<span class="normal">7910</span>
<span class="normal">7911</span>
<span class="normal">7912</span>
<span class="normal">7913</span>
<span class="normal">7914</span>
<span class="normal">7915</span>
<span class="normal">7916</span>
<span class="normal">7917</span>
<span class="normal">7918</span>
<span class="normal">7919</span>
<span class="normal">7920</span>
<span class="normal">7921</span>
<span class="normal">7922</span>
<span class="normal">7923</span>
<span class="normal">7924</span>
<span class="normal">7925</span>
<span class="normal">7926</span>
<span class="normal">7927</span>
<span class="normal">7928</span>
<span class="normal">7929</span>
<span class="normal">7930</span>
<span class="normal">7931</span>
<span class="normal">7932</span>
<span class="normal">7933</span>
<span class="normal">7934</span>
<span class="normal">7935</span>
<span class="normal">7936</span>
<span class="normal">7937</span>
<span class="normal">7938</span>
<span class="normal">7939</span>
<span class="normal">7940</span>
<span class="normal">7941</span>
<span class="normal">7942</span>
<span class="normal">7943</span>
<span class="normal">7944</span>
<span class="normal">7945</span>
<span class="normal">7946</span>
<span class="normal">7947</span>
<span class="normal">7948</span>
<span class="normal">7949</span>
<span class="normal">7950</span>
<span class="normal">7951</span>
<span class="normal">7952</span>
<span class="normal">7953</span>
<span class="normal">7954</span>
<span class="normal">7955</span>
<span class="normal">7956</span>
<span class="normal">7957</span>
<span class="normal">7958</span>
<span class="normal">7959</span>
<span class="normal">7960</span>
<span class="normal">7961</span>
<span class="normal">7962</span>
<span class="normal">7963</span>
<span class="normal">7964</span>
<span class="normal">7965</span>
<span class="normal">7966</span>
<span class="normal">7967</span>
<span class="normal">7968</span>
<span class="normal">7969</span>
<span class="normal">7970</span>
<span class="normal">7971</span>
<span class="normal">7972</span>
<span class="normal">7973</span>
<span class="normal">7974</span>
<span class="normal">7975</span>
<span class="normal">7976</span>
<span class="normal">7977</span>
<span class="normal">7978</span>
<span class="normal">7979</span>
<span class="normal">7980</span>
<span class="normal">7981</span>
<span class="normal">7982</span>
<span class="normal">7983</span>
<span class="normal">7984</span>
<span class="normal">7985</span>
<span class="normal">7986</span>
<span class="normal">7987</span>
<span class="normal">7988</span>
<span class="normal">7989</span>
<span class="normal">7990</span>
<span class="normal">7991</span>
<span class="normal">7992</span>
<span class="normal">7993</span>
<span class="normal">7994</span>
<span class="normal">7995</span>
<span class="normal">7996</span>
<span class="normal">7997</span>
<span class="normal">7998</span>
<span class="normal">7999</span>
<span class="normal">8000</span>
<span class="normal">8001</span>
<span class="normal">8002</span>
<span class="normal">8003</span>
<span class="normal">8004</span>
<span class="normal">8005</span>
<span class="normal">8006</span>
<span class="normal">8007</span>
<span class="normal">8008</span>
<span class="normal">8009</span>
<span class="normal">8010</span>
<span class="normal">8011</span>
<span class="normal">8012</span>
<span class="normal">8013</span>
<span class="normal">8014</span>
<span class="normal">8015</span>
<span class="normal">8016</span>
<span class="normal">8017</span>
<span class="normal">8018</span>
<span class="normal">8019</span>
<span class="normal">8020</span>
<span class="normal">8021</span>
<span class="normal">8022</span>
<span class="normal">8023</span>
<span class="normal">8024</span>
<span class="normal">8025</span>
<span class="normal">8026</span>
<span class="normal">8027</span>
<span class="normal">8028</span>
<span class="normal">8029</span>
<span class="normal">8030</span>
<span class="normal">8031</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_interface_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From each pair of entities that share an interface, split the identified residues into two distinct groups.</span>
<span class="sd">    If an interface can&#39;t be composed into two distinct groups, raise DesignError</span>

<span class="sd">    Sets:</span>
<span class="sd">        self._interface_residues_by_interface (dict[int, list[int]]): Residue instances separated by</span>
<span class="sd">            interface topology</span>
<span class="sd">        self._interface_residues_by_interface_unique (dict[int, list[int]]): Residue instances separated by</span>
<span class="sd">            interface topology removing any dimeric duplicates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_side</span><span class="p">,</span> <span class="n">second_side</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="n">first_interface_side</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># {}</span>
    <span class="n">second_interface_side</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># {}</span>
    <span class="c1"># interface = {first_side: {}, second_side: {}}</span>
    <span class="c1"># Assume no symmetric contacts to start, i.e. [False, False]</span>
    <span class="n">self_indication</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set to True if the interface side (1 or 2) contains self-symmetric contacts&quot;&quot;&quot;</span>
    <span class="n">symmetric_dimer</span> <span class="o">=</span> <span class="p">{</span><span class="n">entity</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">}</span>
    <span class="n">terminate</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">),</span> <span class="p">(</span><span class="n">residues1</span><span class="p">,</span> <span class="n">residues2</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues_by_entity_pair</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># if not entity_residues:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">residues1</span><span class="p">:</span>  <span class="c1"># No residues were found at this interface</span>
            <span class="k">continue</span>
        <span class="c1"># Partition residues from each entity to the correct interface side</span>
        <span class="c1"># Check for any existing symmetry</span>
        <span class="k">if</span> <span class="n">entity1</span> <span class="o">==</span> <span class="n">entity2</span><span class="p">:</span>  <span class="c1"># The query is with itself. Record as a self interaction</span>
            <span class="n">_self</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">residues2</span><span class="p">:</span>  <span class="c1"># The interface is a symmetric dimer and residues were removed from interface 2</span>
                <span class="n">symmetric_dimer</span><span class="p">[</span><span class="n">entity1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Set residues2 as residues1</span>
                <span class="n">residues2</span> <span class="o">=</span> <span class="n">residues1</span>  <span class="c1"># .copy()  # Add residues1 to residues2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_self</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">first_interface_side</span><span class="p">:</span>  <span class="c1"># This is first interface observation</span>
            <span class="c1"># Add the pair to the dictionary in their indexed order</span>
            <span class="n">first_interface_side</span><span class="p">[</span><span class="n">entity1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues1</span><span class="p">)</span>  <span class="c1"># residues1.copy()</span>
            <span class="n">second_interface_side</span><span class="p">[</span><span class="n">entity2</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues2</span><span class="p">)</span>  <span class="c1"># residues2.copy()</span>
            <span class="c1"># Indicate whether the interface is a self symmetric interface by marking side 2 with _self</span>
            <span class="n">self_indication</span><span class="p">[</span><span class="n">second_side</span><span class="p">]</span> <span class="o">=</span> <span class="n">_self</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Interface already assigned, so interface observation &gt;= 2</span>
            <span class="c1"># Need to check if either Entity is in either side before adding correctly</span>
            <span class="k">if</span> <span class="n">entity1</span> <span class="ow">in</span> <span class="n">first_interface_side</span><span class="p">:</span>  <span class="c1"># is Entity1 on the interface side 1?</span>
                <span class="c1"># Is Entity1 in interface1 here as a result of self symmetric interaction?</span>
                <span class="k">if</span> <span class="n">self_indication</span><span class="p">[</span><span class="n">first_side</span><span class="p">]:</span>
                    <span class="c1"># Yes. Ex4 - self Entity was added to index 0 while ASU added to index 1</span>
                    <span class="c1"># Add Entity1 to interface side 2</span>
                    <span class="n">second_interface_side</span><span class="p">[</span><span class="n">entity1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues1</span><span class="p">)</span>
                    <span class="c1"># Add new Entity2 to interface side 1</span>
                    <span class="n">first_interface_side</span><span class="p">[</span><span class="n">entity2</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues2</span><span class="p">)</span>  <span class="c1"># residues2.copy()</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Entities are properly indexed</span>
                    <span class="c1"># Add Entity1 to the first</span>
                    <span class="n">first_interface_side</span><span class="p">[</span><span class="n">entity1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues1</span><span class="p">)</span>
                    <span class="c1"># Because of combinations with replacement Entity search, the second Entity isn&#39;t in</span>
                    <span class="c1"># interface side 2, UNLESS the Entity self interaction is on interface 1 (above if check)</span>
                    <span class="c1"># Therefore, add Entity2 to the second without checking for overwrite</span>
                    <span class="n">second_interface_side</span><span class="p">[</span><span class="n">entity2</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues2</span><span class="p">)</span>  <span class="c1"># residues2.copy()</span>
                    <span class="c1"># This can&#39;t happen, it would VIOLATE RULES</span>
                    <span class="c1"># if _self:</span>
                    <span class="c1">#     self_indication[second_side] = _self</span>
            <span class="c1"># Entity1 isn&#39;t in the first index. It may be in the second, it may not</span>
            <span class="k">elif</span> <span class="n">entity1</span> <span class="ow">in</span> <span class="n">second_interface_side</span><span class="p">:</span>
                <span class="c1"># Yes. Ex5, add to interface side 2</span>
                <span class="n">second_interface_side</span><span class="p">[</span><span class="n">entity1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues1</span><span class="p">)</span>
                <span class="c1"># Also, add Entity2 to the first side</span>
                <span class="c1"># Entity 2 can&#39;t be in interface side 1 due to combinations with replacement check</span>
                <span class="n">first_interface_side</span><span class="p">[</span><span class="n">entity2</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues2</span><span class="p">)</span>  <span class="c1"># residues2.copy()</span>
                <span class="k">if</span> <span class="n">_self</span><span class="p">:</span>  <span class="c1"># Only modify if self is True, don&#39;t want to overwrite an existing True value</span>
                    <span class="n">self_indication</span><span class="p">[</span><span class="n">first_side</span><span class="p">]</span> <span class="o">=</span> <span class="n">_self</span>
            <span class="c1"># If Entity1 is missing, check Entity2 to see if it has been identified yet</span>
            <span class="c1"># This is more likely from combinations with replacement</span>
            <span class="k">elif</span> <span class="n">entity2</span> <span class="ow">in</span> <span class="n">second_interface_side</span><span class="p">:</span>
                <span class="c1"># Possible in an iteration Ex: (A:D) (C:D)</span>
                <span class="n">second_interface_side</span><span class="p">[</span><span class="n">entity2</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues2</span><span class="p">)</span>
                <span class="c1"># Entity 1 was not in first interface (from if #1), therefore we can set directly</span>
                <span class="n">first_interface_side</span><span class="p">[</span><span class="n">entity1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residues1</span><span class="p">)</span>  <span class="c1"># residues1.copy()</span>
                <span class="c1"># Ex3</span>
                <span class="k">if</span> <span class="n">_self</span><span class="p">:</span>  <span class="c1"># Only modify if self is True, don&#39;t want to overwrite an existing True value</span>
                    <span class="n">self_indication</span><span class="p">[</span><span class="n">first_side</span><span class="p">]</span> <span class="o">=</span> <span class="n">_self</span>
            <span class="k">elif</span> <span class="n">entity2</span> <span class="ow">in</span> <span class="n">first_interface_side</span><span class="p">:</span>
                <span class="c1"># The first Entity wasn&#39;t found in either interface, but both interfaces are already set,</span>
                <span class="c1"># therefore Entity pair isn&#39;t self, so the only way this works is if entity1 is further in the</span>
                <span class="c1"># iterative process which is an impossible topology given combinations with replacement.</span>
                <span class="c1"># Violates interface separation rules</span>
                <span class="n">second_interface_side</span><span class="p">[</span><span class="n">entity1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">terminate</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="c1"># Neither of our Entities were found, thus we would add 2 entities to each interface side, violation</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_interface_side</span><span class="p">[</span><span class="n">entity1</span><span class="p">]</span> <span class="o">=</span> <span class="n">second_interface_side</span><span class="p">[</span><span class="n">entity2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">terminate</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_interface_side</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">second_interface_side</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">self_indication</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_interface_side</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">second_interface_side</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">terminate</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">terminate</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;The set of interfaces found during interface search generated a topologically &#39;</span>
                          <span class="s1">&#39;disallowed combination.</span><span class="se">\n\t</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1"> This cannot be modeled by a simple split for residues &#39;</span>
                          <span class="s1">&#39;on either side while respecting the requirements of polymeric Entities. &#39;</span>
                          <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Please correct your design_selectors to reduce the number of Entities you are &#39;</span>
                          <span class="s1">&#39;attempting to design&#39;</span>
                          <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">interface_entities</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">interface_entities</span> <span class="ow">in</span> <span class="p">(</span><span class="n">first_interface_side</span><span class="p">,</span> <span class="n">second_interface_side</span><span class="p">)),</span>
                             <span class="s1">&#39;Symmetry was set which may have influenced this unfeasible topology, you can try to &#39;</span>
                             <span class="s1">&#39;set it False. &#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">DesignError</span><span class="p">(</span><span class="s1">&#39;The specified interfaces generated a topologically disallowed combination&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">first_interface_side</span><span class="p">:</span>
        <span class="c1"># raise utils.DesignError(&#39;Interface was unable to be split because no residues were found on one side of &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The interface wasn&#39;t able to be split because no residues were found on one side. &quot;</span>
                         <span class="s2">&quot;Check that your input has an interface or your flags aren&#39;t too stringent&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">interface_number</span><span class="p">,</span> <span class="n">entity_residues</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">first_interface_side</span><span class="p">,</span> <span class="n">second_interface_side</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">_residue_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">residues</span> <span class="ow">in</span> <span class="n">entity_residues</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface</span><span class="p">[</span><span class="n">interface_number</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_residue_indices</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">symmetric_dimer</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="c1"># For each entity, find the maximum residue observations on each interface side</span>
        <span class="n">entity_observations</span> <span class="o">=</span> <span class="p">{</span><span class="n">entity</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">dimer</span> <span class="ow">in</span> <span class="n">symmetric_dimer</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">dimer</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">interface_index</span><span class="p">,</span> <span class="n">entity_residues</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">first_interface_side</span><span class="p">,</span> <span class="n">second_interface_side</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">observations</span> <span class="ow">in</span> <span class="n">entity_observations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">observations</span><span class="p">[</span><span class="n">interface_index</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">entity_residues</span><span class="p">[</span><span class="n">entity</span><span class="p">])</span>

        <span class="c1"># Remove non-unique occurrences by entity if there are fewer observations</span>
        <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">observations</span> <span class="ow">in</span> <span class="n">entity_observations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">interface_obs1</span><span class="p">,</span> <span class="n">interface_obs2</span> <span class="o">=</span> <span class="n">entity_observations</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">interface_obs1</span> <span class="o">&gt;</span> <span class="n">interface_obs2</span><span class="p">:</span>
                <span class="n">second_interface_side</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">interface_obs1</span> <span class="o">&lt;</span> <span class="n">interface_obs2</span><span class="p">:</span>
                <span class="n">first_interface_side</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">entity_observations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># This is a homo-dimer, by convention, get rid of the second side</span>
                <span class="n">second_interface_side</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SymmetryError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t separate </span><span class="si">{</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> dimeric interface into unique residues. The number of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;residues in each interface is equal: </span><span class="si">{</span><span class="n">interface_obs1</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">interface_obs2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Perform the sort as without dimeric constraints</span>
        <span class="k">for</span> <span class="n">interface_number</span><span class="p">,</span> <span class="n">entity_residues</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">first_interface_side</span><span class="p">,</span> <span class="n">second_interface_side</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">_residue_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">residues</span> <span class="ow">in</span> <span class="n">entity_residues</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface_unique</span><span class="p">[</span><span class="n">interface_number</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_residue_indices</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Just make a copy of the internal list... Avoids unforeseen issues if these are ever modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface_unique</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">number</span><span class="p">:</span> <span class="n">residue_indices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
             <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">residue_indices</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.calculate_secondary_structure" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">calculate_secondary_structure</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">calculate_secondary_structure</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Curate the secondary structure topology for each Entity</p>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.ss_sequence_indices (list[int]):
    Index which indicates the Residue membership to the secondary structure type element sequence
self.ss_type_sequence (list[str]):
    The ordered secondary structure type sequence which contains one character/secondary structure element
self.split_interface_ss_elements (dict[int, list[int]]):
    Maps the interface number to a list of indices corresponding to the secondary structure type
    Ex: {1: [0, 0, 1, 2, ...] , 2: [9, 9, 9, 13, ...]]}</p>
</details>
          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8066</span>
<span class="normal">8067</span>
<span class="normal">8068</span>
<span class="normal">8069</span>
<span class="normal">8070</span>
<span class="normal">8071</span>
<span class="normal">8072</span>
<span class="normal">8073</span>
<span class="normal">8074</span>
<span class="normal">8075</span>
<span class="normal">8076</span>
<span class="normal">8077</span>
<span class="normal">8078</span>
<span class="normal">8079</span>
<span class="normal">8080</span>
<span class="normal">8081</span>
<span class="normal">8082</span>
<span class="normal">8083</span>
<span class="normal">8084</span>
<span class="normal">8085</span>
<span class="normal">8086</span>
<span class="normal">8087</span>
<span class="normal">8088</span>
<span class="normal">8089</span>
<span class="normal">8090</span>
<span class="normal">8091</span>
<span class="normal">8092</span>
<span class="normal">8093</span>
<span class="normal">8094</span>
<span class="normal">8095</span>
<span class="normal">8096</span>
<span class="normal">8097</span>
<span class="normal">8098</span>
<span class="normal">8099</span>
<span class="normal">8100</span>
<span class="normal">8101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_secondary_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Curate the secondary structure topology for each Entity</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.ss_sequence_indices (list[int]):</span>
<span class="sd">            Index which indicates the Residue membership to the secondary structure type element sequence</span>
<span class="sd">        self.ss_type_sequence (list[str]):</span>
<span class="sd">            The ordered secondary structure type sequence which contains one character/secondary structure element</span>
<span class="sd">        self.split_interface_ss_elements (dict[int, list[int]]):</span>
<span class="sd">            Maps the interface number to a list of indices corresponding to the secondary structure type</span>
<span class="sd">            Ex: {1: [0, 0, 1, 2, ...] , 2: [9, 9, 9, 13, ...]]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pose_secondary_structure</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>  <span class="c1"># self.active_entities:</span>
        <span class="n">pose_secondary_structure</span> <span class="o">+=</span> <span class="n">entity</span><span class="o">.</span><span class="n">secondary_structure</span>

    <span class="c1"># Increment a secondary structure index which changes with every secondary structure transition</span>
    <span class="c1"># Simultaneously, map the secondary structure type to an array of pose length</span>
    <span class="n">ss_increment_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ss_sequence_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">ss_increment_index</span><span class="p">]</span>
    <span class="n">ss_type_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">pose_secondary_structure</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">prior_ss_type</span><span class="p">,</span> <span class="n">ss_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pose_secondary_structure</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">pose_secondary_structure</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">if</span> <span class="n">prior_ss_type</span> <span class="o">!=</span> <span class="n">ss_type</span><span class="p">:</span>
            <span class="n">ss_increment_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ss_type_sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss_type</span><span class="p">)</span>
        <span class="n">ss_sequence_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss_increment_index</span><span class="p">)</span>

    <span class="c1"># Clear any information if it exists</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ss_sequence_indices</span><span class="o">.</span><span class="n">clear</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss_type_sequence</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ss_sequence_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ss_sequence_indices</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ss_type_sequence</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ss_type_sequence</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">residue_indices</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface_unique</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split_interface_ss_elements</span><span class="p">[</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ss_sequence_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">residue_indices</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found interface secondary structure: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">split_interface_ss_elements</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">secondary_structure</span> <span class="o">=</span> <span class="n">pose_secondary_structure</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.calculate_fragment_profile" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">calculate_fragment_profile</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">calculate_fragment_profile</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Take the fragment_profile from each member Entity and combine</p>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>evo_fill</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to fill missing positions with evolutionary profile values</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>alpha</code></b>
        
        <div class="doc-md-description">
          <p>float = 0.5 - The maximum contribution of the fragment profile to use, bounded between (0, 1].
0 means no use of fragments in the .profile, while 1 means only use fragments</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8103</span>
<span class="normal">8104</span>
<span class="normal">8105</span>
<span class="normal">8106</span>
<span class="normal">8107</span>
<span class="normal">8108</span>
<span class="normal">8109</span>
<span class="normal">8110</span>
<span class="normal">8111</span>
<span class="normal">8112</span>
<span class="normal">8113</span>
<span class="normal">8114</span>
<span class="normal">8115</span>
<span class="normal">8116</span>
<span class="normal">8117</span>
<span class="normal">8118</span>
<span class="normal">8119</span>
<span class="normal">8120</span>
<span class="normal">8121</span>
<span class="normal">8122</span>
<span class="normal">8123</span>
<span class="normal">8124</span>
<span class="normal">8125</span>
<span class="normal">8126</span>
<span class="normal">8127</span>
<span class="normal">8128</span>
<span class="normal">8129</span>
<span class="normal">8130</span>
<span class="normal">8131</span>
<span class="normal">8132</span>
<span class="normal">8133</span>
<span class="normal">8134</span>
<span class="normal">8135</span>
<span class="normal">8136</span>
<span class="normal">8137</span>
<span class="normal">8138</span>
<span class="normal">8139</span>
<span class="normal">8140</span>
<span class="normal">8141</span>
<span class="normal">8142</span>
<span class="normal">8143</span>
<span class="normal">8144</span>
<span class="normal">8145</span>
<span class="normal">8146</span>
<span class="normal">8147</span>
<span class="normal">8148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_fragment_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take the fragment_profile from each member Entity and combine</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        evo_fill: bool = False - Whether to fill missing positions with evolutionary profile values</span>
<span class="sd">        alpha: float = 0.5 - The maximum contribution of the fragment profile to use, bounded between (0, 1].</span>
<span class="sd">            0 means no use of fragments in the .profile, while 1 means only use fragments</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#   keep_extras: bool = True - Whether to keep values for all that are missing data</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">),</span> <span class="n">fragment_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_info_by_entity_pair</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fragment_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Query Pair: </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
                           <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Fragment Info:</span><span class="si">{</span><span class="n">fragment_info</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">entity1</span><span class="o">.</span><span class="n">add_fragments_to_profile</span><span class="p">(</span><span class="n">fragments</span><span class="o">=</span><span class="n">fragment_info</span><span class="p">,</span> <span class="n">alignment_type</span><span class="o">=</span><span class="s1">&#39;mapped&#39;</span><span class="p">)</span>
            <span class="n">entity2</span><span class="o">.</span><span class="n">add_fragments_to_profile</span><span class="p">(</span><span class="n">fragments</span><span class="o">=</span><span class="n">fragment_info</span><span class="p">,</span> <span class="n">alignment_type</span><span class="o">=</span><span class="s1">&#39;paired&#39;</span><span class="p">)</span>

    <span class="c1"># The order of this and below could be switched by combining self.fragment_map too</span>
    <span class="c1"># Also, need to extract the entity.fragment_map to process_fragment_profile()</span>
    <span class="n">fragments_available</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">fragment_map</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">simplify_fragment_profile</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fragments_available</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">fragment_profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">create_null_profile</span><span class="p">(</span><span class="n">nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zero_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;fragment&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fragments_available</span><span class="p">:</span>
        <span class="c1"># # This assumes all values are present. What if they are not?</span>
        <span class="c1"># self.fragment_profile = concatenate_profile([entity.fragment_profile for entity in self.entities],</span>
        <span class="c1">#                                             start_at=0)</span>
        <span class="c1"># self.alpha = concatenate_profile([entity.alpha for entity in self.entities])</span>
        <span class="n">fragment_profile</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">fragment_profile</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">fragment_profile</span><span class="p">)</span>
            <span class="n">alpha</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">fragment_profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span><span class="n">fragment_profile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;fragment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">_alpha</span>  <span class="c1"># Logic enforces entity is always referenced here</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">)]</span>  <span class="c1"># Reset the data</span>
        <span class="n">fragment_profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_null_profile</span><span class="p">(</span><span class="n">nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zero_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;fragment&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_profile</span> <span class="o">=</span> <span class="n">fragment_profile</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_fragment_observations" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_fragment_observations</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_fragment_observations</span><span class="p">(</span><span class="n">interface</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="structure.fragment.db.FragmentInfo">FragmentInfo</span></span><span class="p">]</span> <span class="o">|</span> <span class="n">list</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the fragment observations identified on the Pose for various types of tertiary structure interactions</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>interface</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Whether to return fragment observations from only the Pose interface</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>list[<span title="structure.fragment.db.FragmentInfo">FragmentInfo</span>] | list</code>
        
        <div class="doc-md-description">
          <p>The fragment observations</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8150</span>
<span class="normal">8151</span>
<span class="normal">8152</span>
<span class="normal">8153</span>
<span class="normal">8154</span>
<span class="normal">8155</span>
<span class="normal">8156</span>
<span class="normal">8157</span>
<span class="normal">8158</span>
<span class="normal">8159</span>
<span class="normal">8160</span>
<span class="normal">8161</span>
<span class="normal">8162</span>
<span class="normal">8163</span>
<span class="normal">8164</span>
<span class="normal">8165</span>
<span class="normal">8166</span>
<span class="normal">8167</span>
<span class="normal">8168</span>
<span class="normal">8169</span>
<span class="normal">8170</span>
<span class="normal">8171</span>
<span class="normal">8172</span>
<span class="normal">8173</span>
<span class="normal">8174</span>
<span class="normal">8175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fragment_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FragmentInfo</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the fragment observations identified on the Pose for various types of tertiary structure interactions</span>

<span class="sd">    Args:</span>
<span class="sd">        interface: Whether to return fragment observations from only the Pose interface</span>

<span class="sd">    Returns:</span>
<span class="sd">        The fragment observations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure fragments are generated if they aren&#39;t already</span>
    <span class="k">if</span> <span class="n">interface</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_interface_fragments</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_fragments</span><span class="p">()</span>

    <span class="n">interface_residues_by_entity_pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface_residues_by_entity_pair</span>
    <span class="n">observations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># {(ent1, ent2): [{mapped: res_num1, paired: res_num2, cluster: (int, int, int), match: score}, ...], ...}</span>
    <span class="k">for</span> <span class="n">entity_pair</span><span class="p">,</span> <span class="n">fragment_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_info_by_entity_pair</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">interface</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entity_pair</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interface_residues_by_entity_pair</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="n">observations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fragment_info</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">observations</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.get_fragment_metrics" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">get_fragment_metrics</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">get_fragment_metrics</span><span class="p">(</span><span class="n">fragments</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n"><span title="structure.fragment.db.FragmentInfo">FragmentInfo</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">total_interface</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">by_interface</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">by_entity</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">entity1</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return fragment metrics from the Pose. Returns the entire Pose unless by_interface or by_entity is True</p>
<p>Uses data from self.fragment_queries unless fragments are passed</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>fragments</code></b>
            (<code>list[<span title="structure.fragment.db.FragmentInfo">FragmentInfo</span>]</code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>A list of fragment observations</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>total_interface</code></b>
            (<code>bool</code>, default:
                <code>True</code>
)
        
        <div class="doc-md-description">
          <p>Return all fragment metrics for every interface found in the Pose</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>by_interface</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Return fragment metrics for each particular interface between Chain instances in the Pose</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>by_entity</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Return fragment metrics for each Entity found in the Pose</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>entity1</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The first Entity object to identify the interface if per_interface=True</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>entity2</code></b>
            (<code><a class="autorefs autorefs-internal" title="structure.model.Entity" href="#structure.model.Entity">Entity</a></code>, default:
                <code>None</code>
)
        
        <div class="doc-md-description">
          <p>The second Entity object to identify the interface if per_interface=True</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8. - The distance to measure Residues across an interface</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>oligomeric_interfaces</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether to query oligomeric interfaces</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>A mapping of the following metrics for the requested structural region -
{'center_indices',
 'total_indices',
 'nanohedra_score',
 'nanohedra_score_center',
 'nanohedra_score_normalized',
 'nanohedra_score_center_normalized',
 'number_residues_fragment_total',
 'number_residues_fragment_center',
 'multiple_fragment_ratio',
 'number_fragments_interface'
 'percent_fragment_helix'
 'percent_fragment_strand'
 'percent_fragment_coil'
 }</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>Will include a single mapping if total_interface, a mapping for each interface if by_interface, and a</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, <span title="typing.Any">Any</span>]</code>
        
        <div class="doc-md-description">
          <p>mapping for each Entity if by_entity</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8187</span>
<span class="normal">8188</span>
<span class="normal">8189</span>
<span class="normal">8190</span>
<span class="normal">8191</span>
<span class="normal">8192</span>
<span class="normal">8193</span>
<span class="normal">8194</span>
<span class="normal">8195</span>
<span class="normal">8196</span>
<span class="normal">8197</span>
<span class="normal">8198</span>
<span class="normal">8199</span>
<span class="normal">8200</span>
<span class="normal">8201</span>
<span class="normal">8202</span>
<span class="normal">8203</span>
<span class="normal">8204</span>
<span class="normal">8205</span>
<span class="normal">8206</span>
<span class="normal">8207</span>
<span class="normal">8208</span>
<span class="normal">8209</span>
<span class="normal">8210</span>
<span class="normal">8211</span>
<span class="normal">8212</span>
<span class="normal">8213</span>
<span class="normal">8214</span>
<span class="normal">8215</span>
<span class="normal">8216</span>
<span class="normal">8217</span>
<span class="normal">8218</span>
<span class="normal">8219</span>
<span class="normal">8220</span>
<span class="normal">8221</span>
<span class="normal">8222</span>
<span class="normal">8223</span>
<span class="normal">8224</span>
<span class="normal">8225</span>
<span class="normal">8226</span>
<span class="normal">8227</span>
<span class="normal">8228</span>
<span class="normal">8229</span>
<span class="normal">8230</span>
<span class="normal">8231</span>
<span class="normal">8232</span>
<span class="normal">8233</span>
<span class="normal">8234</span>
<span class="normal">8235</span>
<span class="normal">8236</span>
<span class="normal">8237</span>
<span class="normal">8238</span>
<span class="normal">8239</span>
<span class="normal">8240</span>
<span class="normal">8241</span>
<span class="normal">8242</span>
<span class="normal">8243</span>
<span class="normal">8244</span>
<span class="normal">8245</span>
<span class="normal">8246</span>
<span class="normal">8247</span>
<span class="normal">8248</span>
<span class="normal">8249</span>
<span class="normal">8250</span>
<span class="normal">8251</span>
<span class="normal">8252</span>
<span class="normal">8253</span>
<span class="normal">8254</span>
<span class="normal">8255</span>
<span class="normal">8256</span>
<span class="normal">8257</span>
<span class="normal">8258</span>
<span class="normal">8259</span>
<span class="normal">8260</span>
<span class="normal">8261</span>
<span class="normal">8262</span>
<span class="normal">8263</span>
<span class="normal">8264</span>
<span class="normal">8265</span>
<span class="normal">8266</span>
<span class="normal">8267</span>
<span class="normal">8268</span>
<span class="normal">8269</span>
<span class="normal">8270</span>
<span class="normal">8271</span>
<span class="normal">8272</span>
<span class="normal">8273</span>
<span class="normal">8274</span>
<span class="normal">8275</span>
<span class="normal">8276</span>
<span class="normal">8277</span>
<span class="normal">8278</span>
<span class="normal">8279</span>
<span class="normal">8280</span>
<span class="normal">8281</span>
<span class="normal">8282</span>
<span class="normal">8283</span>
<span class="normal">8284</span>
<span class="normal">8285</span>
<span class="normal">8286</span>
<span class="normal">8287</span>
<span class="normal">8288</span>
<span class="normal">8289</span>
<span class="normal">8290</span>
<span class="normal">8291</span>
<span class="normal">8292</span>
<span class="normal">8293</span>
<span class="normal">8294</span>
<span class="normal">8295</span>
<span class="normal">8296</span>
<span class="normal">8297</span>
<span class="normal">8298</span>
<span class="normal">8299</span>
<span class="normal">8300</span>
<span class="normal">8301</span>
<span class="normal">8302</span>
<span class="normal">8303</span>
<span class="normal">8304</span>
<span class="normal">8305</span>
<span class="normal">8306</span>
<span class="normal">8307</span>
<span class="normal">8308</span>
<span class="normal">8309</span>
<span class="normal">8310</span>
<span class="normal">8311</span>
<span class="normal">8312</span>
<span class="normal">8313</span>
<span class="normal">8314</span>
<span class="normal">8315</span>
<span class="normal">8316</span>
<span class="normal">8317</span>
<span class="normal">8318</span>
<span class="normal">8319</span>
<span class="normal">8320</span>
<span class="normal">8321</span>
<span class="normal">8322</span>
<span class="normal">8323</span>
<span class="normal">8324</span>
<span class="normal">8325</span>
<span class="normal">8326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fragment_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fragments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FragmentInfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">total_interface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">by_interface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">by_entity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">entity1</span><span class="p">:</span> <span class="n">Entity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">entity2</span><span class="p">:</span> <span class="n">Entity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return fragment metrics from the Pose. Returns the entire Pose unless by_interface or by_entity is True</span>

<span class="sd">    Uses data from self.fragment_queries unless fragments are passed</span>

<span class="sd">    Args:</span>
<span class="sd">        fragments: A list of fragment observations</span>
<span class="sd">        total_interface: Return all fragment metrics for every interface found in the Pose</span>
<span class="sd">        by_interface: Return fragment metrics for each particular interface between Chain instances in the Pose</span>
<span class="sd">        by_entity: Return fragment metrics for each Entity found in the Pose</span>
<span class="sd">        entity1: The first Entity object to identify the interface if per_interface=True</span>
<span class="sd">        entity2: The second Entity object to identify the interface if per_interface=True</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        distance: float = 8. - The distance to measure Residues across an interface</span>
<span class="sd">        oligomeric_interfaces: bool = False - Whether to query oligomeric interfaces</span>

<span class="sd">    Returns:</span>
<span class="sd">        A mapping of the following metrics for the requested structural region -</span>
<span class="sd">            {&#39;center_indices&#39;,</span>
<span class="sd">             &#39;total_indices&#39;,</span>
<span class="sd">             &#39;nanohedra_score&#39;,</span>
<span class="sd">             &#39;nanohedra_score_center&#39;,</span>
<span class="sd">             &#39;nanohedra_score_normalized&#39;,</span>
<span class="sd">             &#39;nanohedra_score_center_normalized&#39;,</span>
<span class="sd">             &#39;number_residues_fragment_total&#39;,</span>
<span class="sd">             &#39;number_residues_fragment_center&#39;,</span>
<span class="sd">             &#39;multiple_fragment_ratio&#39;,</span>
<span class="sd">             &#39;number_fragments_interface&#39;</span>
<span class="sd">             &#39;percent_fragment_helix&#39;</span>
<span class="sd">             &#39;percent_fragment_strand&#39;</span>
<span class="sd">             &#39;percent_fragment_coil&#39;</span>
<span class="sd">             }</span>
<span class="sd">        Will include a single mapping if total_interface, a mapping for each interface if by_interface, and a</span>
<span class="sd">        mapping for each Entity if by_entity</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fragments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fragment_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_db</span>
        <span class="k">return</span> <span class="n">fragment_db</span><span class="o">.</span><span class="n">format_fragment_metrics</span><span class="p">(</span><span class="n">fragment_db</span><span class="o">.</span><span class="n">calculate_match_metrics</span><span class="p">(</span><span class="n">fragments</span><span class="p">))</span>

    <span class="n">fragment_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_metrics_by_entity_pair</span>

    <span class="k">if</span> <span class="n">by_interface</span><span class="p">:</span>
        <span class="n">fragment_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_info_by_entity_pair</span>
        <span class="c1"># Check for either orientation as the final interface score will be the same</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fragment_info</span> <span class="ow">or</span> <span class="p">(</span><span class="n">entity2</span><span class="p">,</span> <span class="n">entity1</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fragment_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">query_entity_pair_for_fragments</span><span class="p">(</span><span class="n">entity1</span><span class="o">=</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="o">=</span><span class="n">entity2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">metric_d</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fragment_metric_template</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">query_pair</span><span class="p">,</span> <span class="n">_metrics</span> <span class="ow">in</span> <span class="n">fragment_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Check either orientation as the function query could vary from self.fragment_metrics</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">query_pair</span> <span class="ow">or</span> <span class="p">(</span><span class="n">entity2</span><span class="p">,</span> <span class="n">entity1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">query_pair</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_metrics</span><span class="p">:</span>
                    <span class="n">metric_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_db</span><span class="o">.</span><span class="n">format_fragment_metrics</span><span class="p">(</span><span class="n">_metrics</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t locate query metrics for Entity pair </span><span class="si">{</span><span class="n">entity1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">entity2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">by_entity</span><span class="p">:</span>
        <span class="n">metric_d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">query_pair</span><span class="p">,</span> <span class="n">_metrics</span> <span class="ow">in</span> <span class="n">fragment_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_metrics</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">align_type</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">alignment_types</span><span class="p">,</span> <span class="n">query_pair</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">entity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_d</span><span class="p">:</span>
                    <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fragment_metric_template</span><span class="p">)</span>

                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;center_indices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">])</span>
                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;total_indices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">])</span>
                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;nanohedra_score&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;nanohedra_score_center&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;multiple_fragment_ratio&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;multiple_ratio&#39;</span><span class="p">]</span>
                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;number_fragments_interface&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;observations&#39;</span><span class="p">]</span>
                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;percent_fragment_helix&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;percent_fragment_strand&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">metric_d</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s1">&#39;percent_fragment_coil&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> \
                    <span class="o">+</span> <span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">_metrics</span><span class="p">[</span><span class="n">align_type</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

        <span class="c1"># Finally, tabulate based on the total for each Entity</span>
        <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">_metrics</span> <span class="ow">in</span> <span class="n">metric_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;number_residues_fragment_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total_indices&#39;</span><span class="p">])</span>
            <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;number_residues_fragment_center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;center_indices&#39;</span><span class="p">])</span>
            <span class="n">number_fragments_interface</span> <span class="o">=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;number_fragments_interface&#39;</span><span class="p">]</span>
            <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;percent_fragment_helix&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">number_fragments_interface</span>
            <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;percent_fragment_strand&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">number_fragments_interface</span>
            <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;percent_fragment_coil&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">number_fragments_interface</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;nanohedra_score&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;number_residues_fragment_total&#39;</span><span class="p">]</span>
                <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_center_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_center&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;number_residues_fragment_center&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">: No interface residues were found. Is there an interface in your &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;design?&#39;</span><span class="p">)</span>
                <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_center_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="k">elif</span> <span class="n">total_interface</span><span class="p">:</span>  <span class="c1"># For the entire interface</span>
        <span class="n">metric_d</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fragment_metric_template</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">query_pair</span><span class="p">,</span> <span class="n">_metrics</span> <span class="ow">in</span> <span class="n">fragment_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_metrics</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;center_indices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;mapped&#39;</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;paired&#39;</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]))</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;total_indices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;mapped&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;paired&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]))</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;nanohedra_score&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_center&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;multiple_fragment_ratio&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;multiple_ratio&#39;</span><span class="p">]</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;number_fragments_interface&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;observations&#39;</span><span class="p">]</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_helix&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_strand&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_coil&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> \
                <span class="o">+</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">_metrics</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;index_count&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

        <span class="c1"># Finally, tabulate based on the total</span>
        <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;number_residues_fragment_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;total_indices&#39;</span><span class="p">])</span>
        <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;number_residues_fragment_center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;center_indices&#39;</span><span class="p">])</span>
        <span class="n">total_observations</span> <span class="o">=</span> <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;number_fragments_interface&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># 2x observations in [&#39;total&#39;][&#39;index_count&#39;]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_helix&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total_observations</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_strand&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total_observations</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_coil&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total_observations</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_helix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_strand&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;percent_fragment_coil&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;nanohedra_score&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;number_residues_fragment_total&#39;</span><span class="p">]</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_center_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_center&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;number_residues_fragment_center&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">: No fragment residues were found&#39;</span><span class="p">)</span>
            <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_d</span><span class="p">[</span><span class="s1">&#39;nanohedra_score_center_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># For the entire Pose?</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;There isn&#39;t a mechanism to return fragments for the mode specified&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">metric_d</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.residue_processing" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">residue_processing</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">residue_processing</span><span class="p">(</span><span class="n">design_scores</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">float</span> <span class="o">|</span> <span class="n">str</span><span class="p">]],</span> <span class="n">columns</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">float</span> <span class="o">|</span> <span class="n">list</span><span class="p">]]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Process Residue Metrics from Rosetta score dictionary (One-indexed residues)</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>design_scores</code></b>
            (<code>dict[str, dict[str, float | str]]</code>)
        
        <div class="doc-md-description">
          <p>{'001': {'buns': 2.0, 'res_energy_complex_15A': -2.71, ...,
            'yhh_planarity':0.885, 'hbonds_res_selection_complex': '15A,21A,26A,35A,...'}, ...}</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>columns</code></b>
            (<code>list[str]</code>)
        
        <div class="doc-md-description">
          <p>['per_res_energy_complex_5', 'per_res_energy_1_unbound_5', ...]</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, dict[int, dict[str, float | list]]]</code>
        
        <div class="doc-md-description">
          <p>{'001': {15: {'type': 'T', 'energy': {'complex': -2.71, 'unbound': [-1.9, 0]}, 'fsp': 0., 'cst': 0.}, ...},
...}</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8328</span>
<span class="normal">8329</span>
<span class="normal">8330</span>
<span class="normal">8331</span>
<span class="normal">8332</span>
<span class="normal">8333</span>
<span class="normal">8334</span>
<span class="normal">8335</span>
<span class="normal">8336</span>
<span class="normal">8337</span>
<span class="normal">8338</span>
<span class="normal">8339</span>
<span class="normal">8340</span>
<span class="normal">8341</span>
<span class="normal">8342</span>
<span class="normal">8343</span>
<span class="normal">8344</span>
<span class="normal">8345</span>
<span class="normal">8346</span>
<span class="normal">8347</span>
<span class="normal">8348</span>
<span class="normal">8349</span>
<span class="normal">8350</span>
<span class="normal">8351</span>
<span class="normal">8352</span>
<span class="normal">8353</span>
<span class="normal">8354</span>
<span class="normal">8355</span>
<span class="normal">8356</span>
<span class="normal">8357</span>
<span class="normal">8358</span>
<span class="normal">8359</span>
<span class="normal">8360</span>
<span class="normal">8361</span>
<span class="normal">8362</span>
<span class="normal">8363</span>
<span class="normal">8364</span>
<span class="normal">8365</span>
<span class="normal">8366</span>
<span class="normal">8367</span>
<span class="normal">8368</span>
<span class="normal">8369</span>
<span class="normal">8370</span>
<span class="normal">8371</span>
<span class="normal">8372</span>
<span class="normal">8373</span>
<span class="normal">8374</span>
<span class="normal">8375</span>
<span class="normal">8376</span>
<span class="normal">8377</span>
<span class="normal">8378</span>
<span class="normal">8379</span>
<span class="normal">8380</span>
<span class="normal">8381</span>
<span class="normal">8382</span>
<span class="normal">8383</span>
<span class="normal">8384</span>
<span class="normal">8385</span>
<span class="normal">8386</span>
<span class="normal">8387</span>
<span class="normal">8388</span>
<span class="normal">8389</span>
<span class="normal">8390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">residue_processing</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">design_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process Residue Metrics from Rosetta score dictionary (One-indexed residues)</span>

<span class="sd">    Args:</span>
<span class="sd">        design_scores: {&#39;001&#39;: {&#39;buns&#39;: 2.0, &#39;res_energy_complex_15A&#39;: -2.71, ...,</span>
<span class="sd">                        &#39;yhh_planarity&#39;:0.885, &#39;hbonds_res_selection_complex&#39;: &#39;15A,21A,26A,35A,...&#39;}, ...}</span>
<span class="sd">        columns: [&#39;per_res_energy_complex_5&#39;, &#39;per_res_energy_1_unbound_5&#39;, ...]</span>

<span class="sd">    Returns:</span>
<span class="sd">        {&#39;001&#39;: {15: {&#39;type&#39;: &#39;T&#39;, &#39;energy&#39;: {&#39;complex&#39;: -2.71, &#39;unbound&#39;: [-1.9, 0]}, &#39;fsp&#39;: 0., &#39;cst&#39;: 0.}, ...},</span>
<span class="sd">         ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># energy_template = {&#39;complex&#39;: 0., &#39;unbound&#39;: 0., &#39;fsp&#39;: 0., &#39;cst&#39;: 0.}</span>
    <span class="n">residue_template</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;complex&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;unbound&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">],</span> <span class="s1">&#39;fsp&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;cst&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">}}</span>
    <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="c1"># adjust the energy based on pose specifics</span>
    <span class="n">pose_energy_multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>  <span class="c1"># Will be 1 if not self.is_symmetric()</span>
    <span class="n">entity_energy_multiplier</span> <span class="o">=</span> <span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">]</span>

    <span class="n">warn</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">parsed_design_residues</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">design</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">design_scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">residue_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="c1"># remove chain_id in rosetta_numbering=&quot;False&quot;</span>
            <span class="c1"># if we have enough chains, weird chain characters appear &quot;per_res_energy_complex_19_&quot; which mess up</span>
            <span class="c1"># split. Also numbers appear, &quot;per_res_energy_complex_1161&quot; which may indicate chain &quot;1&quot; or residue 1161</span>
            <span class="n">residue_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">keep_digit_table</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">residue_number</span> <span class="o">&gt;</span> <span class="n">pose_length</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">warn</span><span class="p">:</span>
                    <span class="n">warn</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s1">&#39;Encountered </span><span class="si">%s</span><span class="s1"> which has residue number &gt; the pose length (</span><span class="si">%d</span><span class="s1">). If this system is &#39;</span>
                        <span class="s1">&#39;NOT a large symmetric system and output_as_pdb_nums=&quot;true&quot; was used in Rosetta &#39;</span>
                        <span class="s1">&#39;PerResidue SimpleMetrics, there is an error in processing that requires your &#39;</span>
                        <span class="s1">&#39;debugging. Otherwise, this is likely a numerical chain and will be treated under &#39;</span>
                        <span class="s1">&#39;that assumption. Always ensure that output_as_pdb_nums=&quot;true&quot; is set&#39;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">pose_length</span><span class="p">))</span>
                <span class="n">residue_number</span> <span class="o">=</span> <span class="n">residue_number</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">residue_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">residue_data</span><span class="p">:</span>
                <span class="n">residue_data</span><span class="p">[</span><span class="n">residue_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">residue_template</span><span class="p">)</span>  <span class="c1"># deepcopy(energy_template)</span>

            <span class="n">metric</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># energy [or sasa]</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="o">!=</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">pose_state</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># unbound or complex [or fsp (favor_sequence_profile) or cst (constraint)]</span>
            <span class="n">entity_or_complex</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># 1,2,3,... or complex</span>

            <span class="c1"># use += because instances of symmetric residues from symmetry related chains are summed</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># to convert to int. Will succeed if we have an entity value, ex: 1,2,3,...</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entity_or_complex</span><span class="p">)</span> <span class="o">-</span> <span class="n">ZERO_OFFSET</span>
                <span class="n">residue_data</span><span class="p">[</span><span class="n">residue_number</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">pose_state</span><span class="p">][</span><span class="n">entity</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">entity_energy_multiplier</span><span class="p">[</span><span class="n">entity</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># complex is the value, use the pose state</span>
                <span class="n">residue_data</span><span class="p">[</span><span class="n">residue_number</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">pose_state</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">pose_energy_multiplier</span><span class="p">)</span>
        <span class="n">parsed_design_residues</span><span class="p">[</span><span class="n">design</span><span class="p">]</span> <span class="o">=</span> <span class="n">residue_data</span>

    <span class="k">return</span> <span class="n">parsed_design_residues</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.process_rosetta_residue_scores" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">process_rosetta_residue_scores</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">process_rosetta_residue_scores</span><span class="p">(</span><span class="n">design_scores</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">float</span> <span class="o">|</span> <span class="n">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">float</span> <span class="o">|</span> <span class="n">list</span><span class="p">]]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Process Residue Metrics from Rosetta score dictionary (One-indexed residues) accounting for symmetric energy</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>design_scores</code></b>
            (<code>dict[str, dict[str, float | str]]</code>)
        
        <div class="doc-md-description">
          <p>{'001': {'buns': 2.0, 'res_energy_complex_15A': -2.71, ...,
            'yhh_planarity':0.885, 'hbonds_res_selection_complex': '15A,21A,26A,35A,...'}, ...}</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, dict[int, dict[str, float | list]]]</code>
        
        <div class="doc-md-description">
          <p>The parsed design information where the outer key is the design alias, and the next key is the Residue.index</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, dict[int, dict[str, float | list]]]</code>
        
        <div class="doc-md-description">
          <p>where the corresponding information belongs. Only returns Residue metrics for those positions where metrics</p>
      </div>
      </li>
      <li class="field-body">
            <code>dict[str, dict[int, dict[str, float | list]]]</code>
        
        <div class="doc-md-description">
          <p>were taken. Example:
{'001':
    {15: {'complex': -2.71, 'bound': [-1.9, 0], 'unbound': [-1.9, 0],
          'solv_complex': -2.71, 'solv_bound': [-1.9, 0], 'solv_unbound': [-1.9, 0],
          'fsp': 0., 'cst': 0.},
     ...},
 ...}</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8392</span>
<span class="normal">8393</span>
<span class="normal">8394</span>
<span class="normal">8395</span>
<span class="normal">8396</span>
<span class="normal">8397</span>
<span class="normal">8398</span>
<span class="normal">8399</span>
<span class="normal">8400</span>
<span class="normal">8401</span>
<span class="normal">8402</span>
<span class="normal">8403</span>
<span class="normal">8404</span>
<span class="normal">8405</span>
<span class="normal">8406</span>
<span class="normal">8407</span>
<span class="normal">8408</span>
<span class="normal">8409</span>
<span class="normal">8410</span>
<span class="normal">8411</span>
<span class="normal">8412</span>
<span class="normal">8413</span>
<span class="normal">8414</span>
<span class="normal">8415</span>
<span class="normal">8416</span>
<span class="normal">8417</span>
<span class="normal">8418</span>
<span class="normal">8419</span>
<span class="normal">8420</span>
<span class="normal">8421</span>
<span class="normal">8422</span>
<span class="normal">8423</span>
<span class="normal">8424</span>
<span class="normal">8425</span>
<span class="normal">8426</span>
<span class="normal">8427</span>
<span class="normal">8428</span>
<span class="normal">8429</span>
<span class="normal">8430</span>
<span class="normal">8431</span>
<span class="normal">8432</span>
<span class="normal">8433</span>
<span class="normal">8434</span>
<span class="normal">8435</span>
<span class="normal">8436</span>
<span class="normal">8437</span>
<span class="normal">8438</span>
<span class="normal">8439</span>
<span class="normal">8440</span>
<span class="normal">8441</span>
<span class="normal">8442</span>
<span class="normal">8443</span>
<span class="normal">8444</span>
<span class="normal">8445</span>
<span class="normal">8446</span>
<span class="normal">8447</span>
<span class="normal">8448</span>
<span class="normal">8449</span>
<span class="normal">8450</span>
<span class="normal">8451</span>
<span class="normal">8452</span>
<span class="normal">8453</span>
<span class="normal">8454</span>
<span class="normal">8455</span>
<span class="normal">8456</span>
<span class="normal">8457</span>
<span class="normal">8458</span>
<span class="normal">8459</span>
<span class="normal">8460</span>
<span class="normal">8461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_rosetta_residue_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">design_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> \
        <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process Residue Metrics from Rosetta score dictionary (One-indexed residues) accounting for symmetric energy</span>

<span class="sd">    Args:</span>
<span class="sd">        design_scores: {&#39;001&#39;: {&#39;buns&#39;: 2.0, &#39;res_energy_complex_15A&#39;: -2.71, ...,</span>
<span class="sd">                        &#39;yhh_planarity&#39;:0.885, &#39;hbonds_res_selection_complex&#39;: &#39;15A,21A,26A,35A,...&#39;}, ...}</span>

<span class="sd">    Returns:</span>
<span class="sd">        The parsed design information where the outer key is the design alias, and the next key is the Residue.index</span>
<span class="sd">        where the corresponding information belongs. Only returns Residue metrics for those positions where metrics</span>
<span class="sd">        were taken. Example:</span>
<span class="sd">            {&#39;001&#39;:</span>
<span class="sd">                {15: {&#39;complex&#39;: -2.71, &#39;bound&#39;: [-1.9, 0], &#39;unbound&#39;: [-1.9, 0],</span>
<span class="sd">                      &#39;solv_complex&#39;: -2.71, &#39;solv_bound&#39;: [-1.9, 0], &#39;solv_unbound&#39;: [-1.9, 0],</span>
<span class="sd">                      &#39;fsp&#39;: 0., &#39;cst&#39;: 0.},</span>
<span class="sd">                 ...},</span>
<span class="sd">             ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="c1"># Adjust the energy based on pose specifics</span>
    <span class="n">pose_energy_multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span>  <span class="c1"># Will be 1 if not self.is_symmetric()</span>
    <span class="n">entity_energy_multiplier</span> <span class="o">=</span> <span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">number_of_symmetry_mates</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_template</span><span class="p">():</span> <span class="k">return</span> <span class="n">deepcopy</span><span class="p">({</span>
        <span class="s1">&#39;complex&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;bound&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">],</span> <span class="s1">&#39;unbound&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">],</span>
        <span class="s1">&#39;solv_complex&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;solv_bound&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">],</span>
        <span class="s1">&#39;solv_unbound&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">],</span> <span class="s1">&#39;fsp&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;cst&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">})</span>

    <span class="n">warn_additional</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">parsed_design_residues</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">design</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">design_scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">residue_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">get_template</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="n">res_slice</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;res_&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># key contains: &#39;per_res_energysolv_complex_15W&#39; or &#39;per_res_energysolv_2_bound_415B&#39;</span>
            <span class="n">res</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">entity_or_complex</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="c1"># metadata[1] is energy [or sasa]</span>
            <span class="c1"># metadata[2] is entity designation or complex such as &#39;1&#39;,&#39;2&#39;,&#39;3&#39;,... or &#39;complex&#39;</span>

            <span class="c1"># Take the &quot;possibly&quot; symmetric Rosetta residue index (one-indexed) and convert to python,</span>
            <span class="c1"># then take the modulus for the pose numbering</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">residue_index</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">pose_length</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># This is a residual metric</span>
            <span class="c1"># remove chain_id in rosetta_numbering=&quot;False&quot;</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;energysolv&#39;</span><span class="p">:</span>
                <span class="n">metric_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;solv_</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># pose_state - unbound, bound, complex</span>
            <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                <span class="n">metric_str</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># pose_state - unbound, bound, complex</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Other residual such as sasa or something else old/new</span>
                <span class="k">if</span> <span class="n">warn_additional</span><span class="p">:</span>
                    <span class="n">warn_additional</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found additional metrics that aren&#39;t being processed. Ex </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Use += because instances of symmetric residues from symmetry related chains are summed</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># To convert to int. Will succeed if we have an entity as a string integer, ex: 1,2,3,...</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entity_or_complex</span><span class="p">)</span> <span class="o">-</span> <span class="n">ZERO_OFFSET</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># &#39;complex&#39; is the value, use the pose state</span>
                <span class="n">residue_data</span><span class="p">[</span><span class="n">residue_index</span><span class="p">][</span><span class="n">metric_str</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="n">pose_energy_multiplier</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">residue_data</span><span class="p">[</span><span class="n">residue_index</span><span class="p">][</span><span class="n">metric_str</span><span class="p">][</span><span class="n">entity</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="n">entity_energy_multiplier</span><span class="p">[</span><span class="n">entity</span><span class="p">])</span>

        <span class="n">parsed_design_residues</span><span class="p">[</span><span class="n">design</span><span class="p">]</span> <span class="o">=</span> <span class="n">residue_data</span>

    <span class="k">return</span> <span class="n">parsed_design_residues</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.rosetta_hbond_processing" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">rosetta_hbond_processing</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">rosetta_hbond_processing</span><span class="p">(</span><span class="n">design_scores</span><span class="p">:</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n">set</span><span class="p">[</span><span class="n">int</span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Process Hydrogen bond Metrics from Rosetta score dictionary</p>
<p>if rosetta_numbering="true" in .xml then use offset, otherwise, hbonds are PDB numbering</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>design_scores</code></b>
            (<code>dict[str, dict]</code>)
        
        <div class="doc-md-description">
          <p>{'001': {'buns': 2.0, 'per_res_energy_complex_15A': -2.71, ...,
                    'yhh_planarity':0.885, 'hbonds_res_selection_complex': '15A,21A,26A,35A,...',
                    'hbonds_res_selection_1_bound': '26A'}, ...}</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>dict[str, set[int]]</code>
        
        <div class="doc-md-description">
          <p>{'001': {34, 54, 67, 68, 106, 178}, ...}</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8463</span>
<span class="normal">8464</span>
<span class="normal">8465</span>
<span class="normal">8466</span>
<span class="normal">8467</span>
<span class="normal">8468</span>
<span class="normal">8469</span>
<span class="normal">8470</span>
<span class="normal">8471</span>
<span class="normal">8472</span>
<span class="normal">8473</span>
<span class="normal">8474</span>
<span class="normal">8475</span>
<span class="normal">8476</span>
<span class="normal">8477</span>
<span class="normal">8478</span>
<span class="normal">8479</span>
<span class="normal">8480</span>
<span class="normal">8481</span>
<span class="normal">8482</span>
<span class="normal">8483</span>
<span class="normal">8484</span>
<span class="normal">8485</span>
<span class="normal">8486</span>
<span class="normal">8487</span>
<span class="normal">8488</span>
<span class="normal">8489</span>
<span class="normal">8490</span>
<span class="normal">8491</span>
<span class="normal">8492</span>
<span class="normal">8493</span>
<span class="normal">8494</span>
<span class="normal">8495</span>
<span class="normal">8496</span>
<span class="normal">8497</span>
<span class="normal">8498</span>
<span class="normal">8499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rosetta_hbond_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">design_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process Hydrogen bond Metrics from Rosetta score dictionary</span>

<span class="sd">    if rosetta_numbering=&quot;true&quot; in .xml then use offset, otherwise, hbonds are PDB numbering</span>

<span class="sd">    Args:</span>
<span class="sd">        design_scores: {&#39;001&#39;: {&#39;buns&#39;: 2.0, &#39;per_res_energy_complex_15A&#39;: -2.71, ...,</span>
<span class="sd">                                &#39;yhh_planarity&#39;:0.885, &#39;hbonds_res_selection_complex&#39;: &#39;15A,21A,26A,35A,...&#39;,</span>
<span class="sd">                                &#39;hbonds_res_selection_1_bound&#39;: &#39;26A&#39;}, ...}</span>

<span class="sd">    Returns:</span>
<span class="sd">        {&#39;001&#39;: {34, 54, 67, 68, 106, 178}, ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pose_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_residues</span>
    <span class="n">hbonds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">design</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">design_scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">unbound_bonds</span><span class="p">,</span> <span class="n">complex_bonds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;hbonds_res_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>  <span class="c1"># if not column.startswith(&#39;hbonds_res_selection&#39;):</span>
                <span class="k">continue</span>
            <span class="n">meta_data</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>  <span class="c1"># [&#39;hbonds&#39;, &#39;res&#39;, &#39;selection&#39;, &#39;complex/interface_number&#39;, &#39;[unbound]&#39;]</span>
            <span class="c1"># Offset rosetta numbering to python index and make asu index using the modulus</span>
            <span class="n">parsed_hbond_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">hbond</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">pose_length</span>
                                       <span class="k">for</span> <span class="n">hbond</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">hbond</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># &#39;&#39; in case no hbonds</span>
            <span class="c1"># if meta_data[-1] == &#39;bound&#39; and offset:  # find offset according to chain</span>
            <span class="c1">#     res_offset = offset[meta_data[-2]]</span>
            <span class="c1">#     parsed_hbonds = set(residue + res_offset for residue in parsed_hbonds)</span>
            <span class="k">if</span> <span class="n">meta_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span>
                <span class="n">complex_bonds</span> <span class="o">=</span> <span class="n">parsed_hbond_indices</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># From another state</span>
                <span class="n">unbound_bonds</span> <span class="o">=</span> <span class="n">unbound_bonds</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">parsed_hbond_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">complex_bonds</span><span class="p">:</span>  <span class="c1"># &#39;complex&#39;, &#39;1&#39;, &#39;2&#39;</span>
            <span class="n">hbonds</span><span class="p">[</span><span class="n">design</span><span class="p">]</span> <span class="o">=</span> <span class="n">complex_bonds</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">unbound_bonds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># No hbonds were found in the complex</span>
            <span class="n">hbonds</span><span class="p">[</span><span class="n">design</span><span class="p">]</span> <span class="o">=</span> <span class="n">complex_bonds</span>

    <span class="k">return</span> <span class="n">hbonds</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.generate_interface_fragments" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">generate_interface_fragments</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">generate_interface_fragments</span><span class="p">(</span><span class="n">oligomeric_interfaces</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Generate fragments between the Pose interface(s). Finds interface(s) if not already available</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>oligomeric_interfaces</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to query oligomeric interfaces</p>
        </div>
      </li>
  </ul>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>by_distance</code></b>
        
        <div class="doc-md-description">
          <p>bool = False - Whether interface Residue instances should be found by inter-residue Cb distance</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8. - The distance to measure Residues across an interface</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8501</span>
<span class="normal">8502</span>
<span class="normal">8503</span>
<span class="normal">8504</span>
<span class="normal">8505</span>
<span class="normal">8506</span>
<span class="normal">8507</span>
<span class="normal">8508</span>
<span class="normal">8509</span>
<span class="normal">8510</span>
<span class="normal">8511</span>
<span class="normal">8512</span>
<span class="normal">8513</span>
<span class="normal">8514</span>
<span class="normal">8515</span>
<span class="normal">8516</span>
<span class="normal">8517</span>
<span class="normal">8518</span>
<span class="normal">8519</span>
<span class="normal">8520</span>
<span class="normal">8521</span>
<span class="normal">8522</span>
<span class="normal">8523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_interface_fragments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oligomeric_interfaces</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate fragments between the Pose interface(s). Finds interface(s) if not already available</span>

<span class="sd">    Args:</span>
<span class="sd">        oligomeric_interfaces: Whether to query oligomeric interfaces</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        by_distance: bool = False - Whether interface Residue instances should be found by inter-residue Cb distance</span>
<span class="sd">        distance: float = 8. - The distance to measure Residues across an interface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interface_residue_indices_by_interface</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_and_split_interface</span><span class="p">(</span><span class="n">oligomeric_interfaces</span><span class="o">=</span><span class="n">oligomeric_interfaces</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
        <span class="n">entity_combinations</span> <span class="o">=</span> <span class="n">combinations_with_replacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_entities</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">entity_combinations</span> <span class="o">=</span> <span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_entities</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">entity_pair</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Entity</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">entity_pair</span> <span class="ow">in</span> <span class="n">entity_combinations</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Querying Entity pair: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">entity_pair</span><span class="p">)</span><span class="si">}</span><span class="s1"> &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;for interface fragments&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_entity_pair_for_fragments</span><span class="p">(</span><span class="o">*</span><span class="n">entity_pair</span><span class="p">,</span> <span class="n">oligomeric_interfaces</span><span class="o">=</span><span class="n">oligomeric_interfaces</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.generate_fragments" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">generate_fragments</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">generate_fragments</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Generate fragments pairs between every possible Residue instance in the Pose</p>



  <p>Other Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>distance</code></b>
        
        <div class="doc-md-description">
          <p>float = 8. - The distance to query for neighboring fragments</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8525</span>
<span class="normal">8526</span>
<span class="normal">8527</span>
<span class="normal">8528</span>
<span class="normal">8529</span>
<span class="normal">8530</span>
<span class="normal">8531</span>
<span class="normal">8532</span>
<span class="normal">8533</span>
<span class="normal">8534</span>
<span class="normal">8535</span>
<span class="normal">8536</span>
<span class="normal">8537</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_fragments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate fragments pairs between every possible Residue instance in the Pose</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        distance: float = 8. - The distance to query for neighboring fragments</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_entities</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Querying Entity: </span><span class="si">{</span><span class="n">entity</span><span class="si">}</span><span class="s1"> for internal fragments&#39;</span><span class="p">)</span>
        <span class="n">search_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ghostfrag_surfacefrag_pairs</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">find_fragments</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Internal fragment search took </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">search_start_time</span><span class="si">:</span><span class="s1">8f</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fragment_info_by_entity_pair</span><span class="p">[(</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> \
            <span class="n">create_fragment_info_from_pairs</span><span class="p">(</span><span class="n">ghostfrag_surfacefrag_pairs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.write_fragment_pairs" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">write_fragment_pairs</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">write_fragment_pairs</span><span class="p">(</span><span class="n">out_path</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">multimodel</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Write the fragments associated with the pose to disk</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>out_path</code></b>
            (<code><span title="typing.AnyStr">AnyStr</span></code>, default:
                <code><span title="os.getcwd">getcwd</span>()</code>
)
        
        <div class="doc-md-description">
          <p>The path to the directory to output files to</p>
        </div>
      </li>
      <li class="field-body">
        <b><code>multimodel</code></b>
            (<code>bool</code>, default:
                <code>False</code>
)
        
        <div class="doc-md-description">
          <p>Whether to write all fragments as a multimodel file. File written to "'out_path'/all_frags.pdb"</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="typing.AnyStr">AnyStr</span> | None</code>
        
        <div class="doc-md-description">
          <p>The path to the written file if one was written</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8539</span>
<span class="normal">8540</span>
<span class="normal">8541</span>
<span class="normal">8542</span>
<span class="normal">8543</span>
<span class="normal">8544</span>
<span class="normal">8545</span>
<span class="normal">8546</span>
<span class="normal">8547</span>
<span class="normal">8548</span>
<span class="normal">8549</span>
<span class="normal">8550</span>
<span class="normal">8551</span>
<span class="normal">8552</span>
<span class="normal">8553</span>
<span class="normal">8554</span>
<span class="normal">8555</span>
<span class="normal">8556</span>
<span class="normal">8557</span>
<span class="normal">8558</span>
<span class="normal">8559</span>
<span class="normal">8560</span>
<span class="normal">8561</span>
<span class="normal">8562</span>
<span class="normal">8563</span>
<span class="normal">8564</span>
<span class="normal">8565</span>
<span class="normal">8566</span>
<span class="normal">8567</span>
<span class="normal">8568</span>
<span class="normal">8569</span>
<span class="normal">8570</span>
<span class="normal">8571</span>
<span class="normal">8572</span>
<span class="normal">8573</span>
<span class="normal">8574</span>
<span class="normal">8575</span>
<span class="normal">8576</span>
<span class="normal">8577</span>
<span class="normal">8578</span>
<span class="normal">8579</span>
<span class="normal">8580</span>
<span class="normal">8581</span>
<span class="normal">8582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_fragment_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">AnyStr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">multimodel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the fragments associated with the pose to disk</span>

<span class="sd">    Args:</span>
<span class="sd">        out_path: The path to the directory to output files to</span>
<span class="sd">        multimodel: Whether to write all fragments as a multimodel file. File written to &quot;&#39;out_path&#39;/all_frags.pdb&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        The path to the written file if one was written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span>
    <span class="n">ghost_frags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity_pair</span><span class="p">,</span> <span class="n">fragment_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_info_by_entity_pair</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">fragment_info</span><span class="p">:</span>
            <span class="n">ijk</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">cluster</span>
            <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ijk</span><span class="p">)</span>
            <span class="c1"># match_score = info.match</span>
            <span class="n">aligned_residue</span> <span class="o">=</span> <span class="n">residues</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">mapped</span><span class="p">]</span>
            <span class="n">ghost_frag</span> <span class="o">=</span> <span class="n">aligned_residue</span><span class="o">.</span><span class="n">ghost_fragments</span><span class="p">[</span><span class="n">ijk</span><span class="p">]</span>
            <span class="n">ghost_frags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ghost_frag</span><span class="p">)</span>

    <span class="n">putils</span><span class="o">.</span><span class="n">make_path</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">multimodel</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s1">&#39;all_frags.pdb&#39;</span><span class="p">)</span>
        <span class="n">write_fragments_as_multimodel</span><span class="p">(</span><span class="n">ghost_frags</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">match_count</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ghost_frag</span><span class="p">,</span> <span class="n">ijk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ghost_frags</span><span class="p">,</span> <span class="n">clusters</span><span class="p">):</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">out_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_fragment_match_</span><span class="si">{}</span><span class="s1">.pdb&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ijk</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">match_count</span><span class="p">)))</span>
            <span class="n">ghost_frag</span><span class="o">.</span><span class="n">representative</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>

    <span class="c1"># frag_file = Path(out_path, putils.frag_text_file)</span>
    <span class="c1"># frag_file.unlink(missing_ok=True)  # Ensure old file is removed before new write</span>
    <span class="c1"># for match_count, (ghost_frag, surface_frag, match_score) in enumerate(ghost_mono_frag_pairs, 1):</span>
    <span class="c1">#     ijk = ghost_frag.ijk</span>
    <span class="c1">#     fragment_pdb, _ = ghost_frag.fragment_db.paired_frags[ijk]</span>
    <span class="c1">#     trnsfmd_fragment = fragment_pdb.get_transformed_copy(*ghost_frag.transformation)</span>
    <span class="c1"># write_frag_match_info_file(ghost_frag=ghost_frag, matched_frag=surface_frag,</span>
    <span class="c1">#                                     overlap_error=z_value_from_match_score(match_score),</span>
    <span class="c1">#                                     match_number=match_count, out_path=out_path)</span>
    <span class="k">return</span> <span class="n">file_path</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="structure.model.Pose.debug_pose" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">debug_pose</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">debug_pose</span><span class="p">(</span><span class="n">out_dir</span><span class="p">:</span> <span class="n"><span title="typing.AnyStr">AnyStr</span></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">tag</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Write out all Structure objects for the Pose PDB</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8584</span>
<span class="normal">8585</span>
<span class="normal">8586</span>
<span class="normal">8587</span>
<span class="normal">8588</span>
<span class="normal">8589</span>
<span class="normal">8590</span>
<span class="normal">8591</span>
<span class="normal">8592</span>
<span class="normal">8593</span>
<span class="normal">8594</span>
<span class="normal">8595</span>
<span class="normal">8596</span>
<span class="normal">8597</span>
<span class="normal">8598</span>
<span class="normal">8599</span>
<span class="normal">8600</span>
<span class="normal">8601</span>
<span class="normal">8602</span>
<span class="normal">8603</span>
<span class="normal">8604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">debug_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">:</span> <span class="n">AnyStr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write out all Structure objects for the Pose PDB&quot;&quot;&quot;</span>
    <span class="n">entity_debug_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s1">POSE_DEBUG_Entities_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.pdb&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">entity_debug_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">available_chain_ids</span> <span class="o">=</span> <span class="n">chain_id_generator</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entity_idx</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># f.write(f&#39;REMARK 999   Entity {entity_idx} - ID {entity.name}\n&#39;)</span>
            <span class="c1"># entity.write(file_handle=f, chain_id=next(available_chain_ids))</span>
            <span class="k">for</span> <span class="n">chain_idx</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">chains</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;REMARK 999   Entity </span><span class="si">{</span><span class="n">entity_idx</span><span class="si">}</span><span class="s1"> - ID </span><span class="si">{</span><span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">   &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;Chain </span><span class="si">{</span><span class="n">chain_idx</span><span class="si">}</span><span class="s1"> - ID </span><span class="si">{</span><span class="n">chain</span><span class="o">.</span><span class="n">chain_id</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">chain</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_handle</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">chain_id</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">available_chain_ids</span><span class="p">))</span>

    <span class="n">debug_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s1">POSE_DEBUG_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.pdb&#39;</span><span class="p">)</span>
    <span class="n">assembly_debug_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s1">POSE_DEBUG_Assembly_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.pdb&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrote debugging Pose Entities to: </span><span class="si">{</span><span class="n">entity_debug_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="o">=</span><span class="n">debug_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrote debugging Pose to: </span><span class="si">{</span><span class="n">debug_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">assembly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">assembly_debug_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrote debugging Pose assembly to: </span><span class="si">{</span><span class="n">assembly_debug_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h2 id="structure.model.softmax" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">softmax</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">softmax</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="numpy.ndarray">ndarray</span></span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Take the softmax operation from an input array</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>x</code></b>
            (<code><span title="numpy.ndarray">ndarray</span></code>)
        
        <div class="doc-md-description">
          <p>The array to calculate softmax on. Uses the axis=-1</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="numpy.ndarray">ndarray</span></code>
        
        <div class="doc-md-description">
          <p>The array with a softmax performed</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Take the softmax operation from an input array</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The array to calculate softmax on. Uses the axis=-1</span>

<span class="sd">    Returns:</span>
<span class="sd">        The array with a softmax performed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">input_exp</span> <span class="o">/</span> <span class="n">input_exp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="structure.model.split_residue_pairs" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">split_residue_pairs</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">split_residue_pairs</span><span class="p">(</span><span class="n">interface_pairs</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">tuple</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">tuple</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">],</span> <span class="n">list</span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="structure.base.Residue" href="../base/#structure.base.Residue">Residue</a></span><span class="p">]]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Used to split Residue pairs, take the set, then sort by Residue.number, and return pairs separated by index</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_residue_pairs</span><span class="p">(</span><span class="n">interface_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Residue</span><span class="p">,</span> <span class="n">Residue</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Residue</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Residue</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used to split Residue pairs, take the set, then sort by Residue.number, and return pairs separated by index&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">interface_pairs</span><span class="p">:</span>
        <span class="n">residues1</span><span class="p">,</span> <span class="n">residues2</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">interface_pairs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">residues1</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">residue</span><span class="p">:</span> <span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> \
            <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">residues2</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">residue</span><span class="p">:</span> <span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="structure.model.split_number_pairs_and_sort" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">split_number_pairs_and_sort</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">split_number_pairs_and_sort</span><span class="p">(</span><span class="n">pairs</span><span class="p">:</span> <span class="n">list</span><span class="p">[</span><span class="n">tuple</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">tuple</span><span class="p">[</span><span class="n">list</span><span class="p">,</span> <span class="n">list</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Used to split integer pairs and sort, and return pairs separated by index</p>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_number_pairs_and_sort</span><span class="p">(</span><span class="n">pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used to split integer pairs and sort, and return pairs separated by index&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pairs</span><span class="p">:</span>
        <span class="n">numbers1</span><span class="p">,</span> <span class="n">numbers2</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">pairs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">numbers1</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">numbers2</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="structure.model.parse_cryst_record" class="doc doc-heading">
          <span class="doc doc-object-name doc-function-name">parse_cryst_record</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">parse_cryst_record</span><span class="p">(</span><span class="n">cryst_record</span><span class="p">:</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tuple</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">float</span><span class="p">],</span> <span class="n">str</span><span class="p">]</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Get the unit cell length, height, width, and angles alpha, beta, gamma and the space group</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b><code>cryst_record</code></b>
            (<code>str</code>)
        
        <div class="doc-md-description">
          <p>The CRYST1 record as found in .pdb file format</p>
        </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>symdesign/structure/model.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_cryst_record</span><span class="p">(</span><span class="n">cryst_record</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the unit cell length, height, width, and angles alpha, beta, gamma and the space group</span>

<span class="sd">    Args:</span>
<span class="sd">        cryst_record: The CRYST1 record as found in .pdb file format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cryst</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">ang_a</span><span class="p">,</span> <span class="n">ang_b</span><span class="p">,</span> <span class="n">ang_c</span><span class="p">,</span> <span class="o">*</span><span class="n">space_group</span> <span class="o">=</span> <span class="n">cryst_record</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c1"># a = [6:15], b = [15:24], c = [24:33], ang_a = [33:40], ang_b = [40:47], ang_c = [47:54]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># split() or unpacking went wrong</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="n">ang_a</span> <span class="o">=</span> <span class="n">ang_b</span> <span class="o">=</span> <span class="n">ang_c</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">ang_a</span><span class="p">,</span> <span class="n">ang_b</span><span class="p">,</span> <span class="n">ang_c</span><span class="p">])),</span> <span class="n">cryst_record</span><span class="p">[</span><span class="mi">55</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../fragment/visuals/" class="md-footer__link md-footer__link--prev" aria-label="Previous: visuals">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                visuals
              </div>
            </div>
          </a>
        
        
          
          <a href="../sequence/" class="md-footer__link md-footer__link--next" aria-label="Next: sequence">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                sequence
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Kyle Meador
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/kylemeador" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.instant", "navigation.path", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "toc.follow", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>