<ROSETTASCRIPTS>

	<SCOREFXNS>
		<ScoreFunction name="2015" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
		</ScoreFunction>
		<ScoreFunction name="2015_soft" weights="ref2015_soft">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
		</ScoreFunction>
	</SCOREFXNS>

	<RESIDUE_SELECTORS>
		# used for selecting residues on one side of the interface from chain "A". all resnums are listed 23,54,65,90,etc... in the %%interface1%% variable
		<Index name="interface1" resnums="%%interface1%%" error_on_out_of_bounds_index="1" reverse="0"/>
		# same, but for residues from chain "B"
		<Index name="B_interface" resnums="%%interface2%%" error_on_out_of_bounds_index="1" reverse="0"/>
		# combined group of all identified interface residues
		<Or name="tot_interface" selectors="interface1,B_interface"/>
		# the negation of all interface residues
		<Not name="not_interface" selector="tot_interface"/>
		# select all residues lower than energy 10 invloved in sidechain hydrogen bonding
		<!-- <HBond name="hbond_residues" residue_selector="tot_interface" include_bb_bb="false" hbond_energy_cutoff="10" scorefxn="2015_nano"/> -->
	</RESIDUE_SELECTORS>

	<TASKOPERATIONS>
		# only use residues around specified resnums for design and repacking. The shell indicates a distance at which the mover searches for resnum neighbors to operate on
		<DesignAround name="des_around1" design_shell="0.1" resnums="%%interface1%%" repack_shell="8.0"/>
		<DesignAround name="des_around2" design_shell="0.1" resnums="%%interface2%%" repack_shell="8.0"/>
	</TASKOPERATIONS>

	<SIMPLE_METRICS>
		# find the per residue energy of residues in a residue_selector
		<PerResidueSasaMetric name="M_sasa_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" mode="all_sasa"/>
		<PerResidueSasaMetric name="M_sasa_hydrophobic_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" mode="hydrophobic_sasa"/>
		<PerResidueSasaMetric name="M_sasa_polar_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" mode="polar_sasa"/>
		# summarize the energy metrics from above
		# calculate the interaction energy metric between residues in two selections. I believe this in only the two body components to understand the interface component of energy
		<!-- <InteractionEnergyMetric name="M_int_energy" custom_type="" force_rescore="false" residue_selector="interface1" residue_selector2="B_interface" scorefxn="2015_nano"/> #used to specify certain score terms to calculate on. include_rama_prepro_and_proclose="false". JD2 reports options invalid "scoretypes_only="" scoretypes_skip=""" -->
	</SIMPLE_METRICS>

	<MOVERS>
		# move two folds on different sides of a jump. this instance has the jump between chain A and B and moves them apart the distance on the specified axis (not sure how the axis are defined)
		<RigidBodyTransMover name="translate_asu" jump="1" distance="100.0" x="0.0" y="0.0" z="0.0"/>
		# process mertics that are defined in the SimpleMetrics header above
			<!-- <RunSimpleMetrics name="run_metrics_asu" metrics="M_int_energy_asu_per_res,M_int_energy_total_asu" prefix="" suffix="_asu" override="false"/> -->
			<!-- <RunSimpleMetrics name="run_metrics_unbound_asu" metrics="M_int_energy_unbound_per_res,M_int_energy_total_unbound" prefix="" suffix="_unbound" override="false"/>  -->
	</MOVERS>

	<FILTERS>
		# find the score of the residues in residue_selector. not sure how this is different from the metric InteractionGraph. the values output are different though and may have different score terms
		<ScorePoseSegmentFromResidueSelectorFilter name="int_energy_context_asu" in_context="1" residue_selector="tot_interface" scorefxn="2015" confidence="1.0"/>
		<ScorePoseSegmentFromResidueSelectorFilter name="int_energy_context_unbound" in_context="1" residue_selector="tot_interface" scorefxn="2015" confidence="1.0"/>
		## Interface Metric Filters
		# find the average degree of connectivity to residues surrounding specified residues
		<AverageDegree name="int_connectivity1" threshold="0" distance_threshold="10.0" task_operations="des_around1"/>
		<AverageDegree name="int_connectivity2" threshold="0" distance_threshold="10.0" task_operations="des_around2"/>
		# find the solvent accessable surface area across an interface specified by a chain-chain jump. can be hydrophobic, polar or if not specified, the total SASA
		<Sasa name="int_area_asu_hydrophobic" threshold="100" hydrophobic="1" polar="0" jump="1"/>
		<Sasa name="int_area_asu_polar" threshold="100" hydrophobic="0" polar="1" jump="1"/>
		# find the total number of unstaisfied hydrogen honds in the specified interface. will be called at specific poses to determine BUNS at different locations in interface
		<BuriedUnsatHbonds name="buns_asu" residue_selector="tot_interface" scorefxn="2015" use_ddG_style="true" report_all_unsats="true" confidence="1.0" ignore_surface_res="true" jump_number="1"/> print_out_info_to_pdb="true" 
		<BuriedUnsatHbonds name="buns_asu_hpol" residue_selector="tot_interface" scorefxn="2015" use_ddG_style="true" report_nonheavy_unsats="true" confidence="1.0" ignore_surface_res="true" jump_number="1"/>
		# find the difference in the Ca position of all residues in the asu versus a reference pose specified by -in:file:native on the command line
		<Rmsd name="rmsd" symmetry="0" chains="AB" threshold="1.0" confidence="1.0"/>
		## Reporters: access filters that change upon Pose manipulation. Must be run in specified Pose environment!! Afterwards, the value will be output to score location
		<Report name="R_buns_asu" 						filter="buns_asu"/>
		<Report name="R_buns_asu_hpol" 					filter="buns_asu_hpol"/>
		<Report name="R_int_energy_context_asu"			filter="int_energy_context_asu"/>
		<Report name="R_int_energy_context_unbound"		filter="int_energy_context_unbound"/>
		<Report name="R_rmsd" 							filter="rmsd"/>
		<Report name="R_int_connectivity1" 				filter="int_connectivity1"/>
		<Report name="R_int_connectivity2" 				filter="int_connectivity2"/>
		<Report name="R_int_area_asu_hydrophobic" 		filter="int_area_asu_hydrophobic"/>
		<Report name="R_int_area_asu_polar" 			filter="int_area_asu_polar"/>
	</FILTERS>

	<PROTOCOLS>
			<!-- <Add filter_name="asu_int_total" report_at_end="false"/> -->
		<Add filter_name="R_int_area_asu_hydrophobic"/>
		<Add filter_name="R_int_area_asu_polar"/>
		<Add filter_name="R_buns_asu"/>
		<Add filter_name="R_buns_asu_hpol"/>
		<Add filter_name="R_int_energy_context_asu"/>
		<Add filter_name="R_rmsd"/>
		<Add mover_name="translate_asu"/>
		<Add filter_name="R_int_energy_context_unbound"/>
		<Add filter_name="R_int_connectivity1"/>
		<Add filter_name="R_int_connectivity2"/>
	</PROTOCOLS>

</ROSETTASCRIPTS>
