<ROSETTASCRIPTS>

	<SCOREFXNS>
		<ScoreFunction name="2015" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
		</ScoreFunction>
	</SCOREFXNS>

	<RESIDUE_SELECTORS>
		# used for selecting residues on one side of the interface
		# when using residue numbering all resnums are listed 23A,54A,64A,90A,etc...
		<Index name="A_interface" resnums="%%interface1%%" error_on_out_of_bounds_index="0" reverse="0"/>
		<Index name="B_interface" resnums="%%interface2%%" error_on_out_of_bounds_index="0" reverse="0"/>
		# combined group of all identified interface residues
		<Or name="tot_interface" selectors="A_interface,B_interface,C_interface"/>
		# select all residues lower than energy 10 invloved in sidechain hydrogen bonding
		<HBond name="hbond_residues" residue_selector="B_interface" include_bb_bb="false" hbond_energy_cutoff="10" scorefxn="2015"/>
		# all residues
		<True name="full_pose"/>
	</RESIDUE_SELECTORS>
	<TASK_OPERATIONS>
		<DesignAround name="des_around1" design_shell="0.1" resnums="%%interface1%%" repack_shell="8.0"/>
		<DesignAround name="des_around2" design_shell="0.1" resnums="%%interface2%%" repack_shell="8.0"/>
	</TASK_OPERATIONS>

	<SIMPLE_METRICS>
		# gather the residues involved in a residue selector
		<SelectedResiduesMetric name="M_int_hbonds_res_selector" custom_type="hbonds_res" rosetta_numbering="false" residue_selector="hbond_residues"/>
		# gather the per residue SASA of a residue selection
		<PerResidueSasaMetric name="M_sasa_hydrophobic_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="B_interface" mode="hydrophobic_sasa"/>
		<PerResidueSasaMetric name="M_sasa_polar_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="B_interface" mode="polar_sasa"/>
		<PerResidueSasaMetric name="M_sasa_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="B_interface" mode="all_sasa"/>
		# find the per residue energy of residues in a residue_selector 
		<PerResidueEnergyMetric name="M_int_energy_oligomer_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="B_interface" use_native="false" scoretype="total_score" scorefxn="2015"/>
			<!-- <PerResidueEnergyMetric name="M_int_energy_unbound_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" use_native="false" scoretype="total_score" scorefxn="2015"/> -->
		# summarize the energy metrics from above
		<ResidueSummaryMetric name="M_int_energy_total_asu" custom_type="int_energy" metric="M_int_energy_oligomer_per_res" action="sum"/>
			<!-- <ResidueSummaryMetric name="M_int_energy_total_unbound" custom_type="int_energy" metric="M_int_energy_unbound_per_res" action="sum"/> -->
		# calculate the interaction energy metric between residues in two selections. I believe this in only the two body components to understand the interface component of energy
		<InteractionEnergyMetric name="M_interaction_energy" custom_type="" force_rescore="false" residue_selector="B_interface" residue_selector2="full_pose" scorefxn="2015"/> #used to specify certain score terms to calculate on. include_rama_prepro_and_proclose="false". JD2 reports options invalid "scoretypes_only="" scoretypes_skip="""
	</SIMPLE_METRICS>

	<MOVERS>
		# generates symmetry for the system in question using %%sdf%% or %%dist%%
		<SetupForSymmetry name="make_point_groupA" definition="%%sdfA%%" set_global_symmetry_at_parsetime="0"/>
		<SetupForSymmetry name="make_point_groupB" definition="%%sdfB%%" set_global_symmetry_at_parsetime="0"/>
		<DeleteChainsMover name="remove_chainA" chains="A" detect_bonds="false" detect_pseudobonds="false"/>
		<DeleteChainsMover name="remove_chainB" chains="B" detect_bonds="false" detect_pseudobonds="false"/>
		# saves a intermediate pdb to disk in the directory where Rosetta was initiated
		<!-- <DumpPdb name="dump_pdb_single" fname="single.pdb" scorefxn="2015" tag_time="0"/> -->
		<!-- <DumpPdb name="dump_pdb" fname="sym.pdb" scorefxn="2015" tag_time="0"/> -->
		<AddConstraints name="add_csts">
			<CoordinateConstraintGenerator name="coord_cst_gen" residue_selector="full_pose" sd="0.5" bounded="false" sidechain="false" ca_only="false" ambiguous_hnq="false" native="false" align_reference="false"/> # bounded_width="0" no native pose as this isn't refined, sidechain="false" to constrain backbone heavy atoms, could try ca_only as well. bounded="false" makes constraint type harmonic
		</AddConstraints>
		# Pull subroutines in from other files
		<Subroutine name="metrics_interface_design" xml_fname="%%scripts%%/metrics_scripts/metrics_interface_design.xml"/>
		# Switch reporting to identify which design type or symmetry was selected
		<SwitchMover name="oligomer_switch" movers="interface1,interface2" selected="oligomer%%interface%%"/>
		<ParsedProtocol name="oligomerA">
			<Add mover_name="remove_chainB"/>
			<Add mover_name="make_point_groupA"/>
		</ParsedProtocol>
		<ParsedProtocol name="oligomerB">
			<Add mover_name="remove_chainA"/>
			<Add mover_name="make_point_groupB"/>
		</ParsedProtocol>
	</MOVERS>

	<PROTOCOLS>
		<Add mover_name="add_csts"/>
		<Add mover_name="oligomer_switch"/>
		<!-- <Add mover_name="dump_pdb"/> -->
		<!-- <Add filter_name="full_stability"/> -->
		<Add mover_name="run_metrics_hydrophobic_sasa_oligomer"/>
		<Add mover_name="run_metrics_polar_sasa_oligomer"/>
		<Add mover_name="run_metrics_sasa_oligomer"/>
		<Add mover_name="run_metrics_oligomer"/>
		<!-- <Add mover_name="translate_asu"/> -->
		<!-- <Add mover_name="run_metrics_hydrophobic_sasa_unbound"/> -->
		<!-- <Add mover_name="run_metrics_polar_sasa_unbound"/> -->
		<!-- <Add mover_name="run_metrics_sasa_unbound"/> -->
		<!-- <Add mover_name="run_metrics_unbound"/> -->
	</PROTOCOLS>

</ROSETTASCRIPTS>
