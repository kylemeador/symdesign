<ROSETTASCRIPTS>

	<SCOREFXNS>
		# patched version of 2015, reduces weights by 0.5 as the symmetric score function created with MakeLatticeMover and MakeLayerMover arbitrarily doubles monomeric energy
		<ScoreFunction name="2015_nano_cst" weights="ref2015_cst" patch="%%scripts%%/%%sym_score_patch%%"/>
		<ScoreFunction name="2015_cst" weights="ref2015_cst"/>
	</SCOREFXNS>

	<FILTERS>
		<ReadPoseExtraScoreFilter name="read_sym" term_name="sym_status" threshold="-1"/>
		<Time name="time"/>
	</FILTERS>

	<MOVERS>
		<AddJobPairData name="job_info" key="protocol" value="refine" value_type="string"/>
		# Generates symmetry for the system in question using %%sdf%% or %%dist%%
		<SetupForSymmetry name="point_group" definition="%%sdf%%" set_global_symmetry_at_parsetime="0"/>
		<MakeLayerMover name="layer" contact_dist="%%dist%%"/>
		<MakeLatticeMover name="lattice" contact_dist="%%dist%%"/>
		<FastRelax name="sym_refine" disable_design="true" scorefxn="2015_nano_cst" relaxscript="MonomerRelax2019" repeats="5" ramp_down_constraints="false"/>
		<FastRelax name="asymmetric_refine" disable_design="true" scorefxn="2015_cst" relaxscript="MonomerRelax2019" repeats="5" ramp_down_constraints="false"/>
		# Symmetry selector and switch reporting
		<FilterReportAsPoseExtraScoresMover name="asymmetric" report_as="sym_status" filter_name="false_filter"/>
		<FilterReportAsPoseExtraScoresMover name="sym_true" report_as="sym_status" filter_name="true_filter"/>
		<ParsedProtocol name="make_point_group">
			<Add mover_name="sym_true"/>
			<Add mover_name="point_group"/>
		</ParsedProtocol>
		<ParsedProtocol name="make_layer">
			<Add mover_name="sym_true"/>
			<Add mover_name="layer"/>
		</ParsedProtocol>
		<ParsedProtocol name="make_lattice">
			<Add mover_name="sym_true"/>
			<Add mover_name="lattice"/>
		</ParsedProtocol>
<!--		<ParsedProtocol name="asymmetric">-->
<!--		<Add mover_name="asymmetric"/>-->
<!--		</ParsedProtocol>-->
		<SwitchMover name="symmetry_switch" movers="make_point_group,make_layer,make_lattice,asymmetric" selected="%%symmetry%%"/>
		<If name="refine" filter_name="read_sym" true_mover_name="sym_refine" false_mover_name="asymmetric_refine" />
	</MOVERS>

	<PROTOCOLS>
		<Add filter_name="time" report_at_end="false"/>
		<Add mover_name="symmetry_switch"/>
		<Add mover_name="refine"/>
		<Add mover_name="job_info"/>
		<Add filter_name="time"/>
	</PROTOCOLS>

</ROSETTASCRIPTS>
