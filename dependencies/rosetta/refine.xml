<ROSETTASCRIPTS>

	<SCOREFXNS>
		# patched version of 2015, reduces weights by 0.5 as the symmetric score function created with MakeLatticeMover and MakeLayerMover arbitrarily doubles monomeric energy
		<ScoreFunction name="2015_nano" weights="ref2015" patch="%%sym_score_patch%%">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value_sym%%"/>
		</ScoreFunction>
	</SCOREFXNS>

	<RESIDUE_SELECTORS>
		# used for selecting residues on one side of the interface from chain "A". all resnums are listed 23,54,65,90,etc... in the %%interface1%% variable
		<Index name="A_interface" resnums="%%interfaceA%%" error_on_out_of_bounds_index="1" reverse="0"/> # %%interface1%%
		# same, but for residues from chain "B"
		<Index name="B_interface" resnums="%%interfaceB%%" error_on_out_of_bounds_index="1" reverse="0"/> # %%interface2%%
		# combined group of all identified interface residues
		<Or name="tot_interface" selectors="A_interface,B_interface"/>
		# the negation of all interface residues
		<Not name="not_interface" selector="tot_interface"/>
		# all residues
		<True name="full_pose"/>
	</RESIDUE_SELECTORS>

	<MOVERS>
		# Generates symmetry for the system in question using %%sdf%% or %%dist%%
		<SetupForSymmetry name="make_point_group" definition="%%sdf%%"/>
		<MakeLayerMover name="make_layer" contact_dist="%%dist%%"/>
		<MakeLatticeMover name="make_lattice" contact_dist="%%dist%%"/>
		<FastRelax name="refine" disable_design="true" scorefxn="2015_nano" relaxscript="InterfaceRelax2019" repeats="5" ramp_down_constraints="false"/>
		<FastRelax name="consensus" disable_design="true" scorefxn="2015_nano" relaxscript="InterfaceRelax2019" repeats="5" ramp_down_constraints="false"/>
		# Pull subroutines in from other files
		<Subroutine name="metrics_interface_design" xml_fname="%%scripts%%/metrics_scripts/metrics_interface_design.xml"/>
		# Symmetry selector
		<SwitchMover name="symmetry_switch" movers="make_point_group,make_layer,make_lattice" selected="%%symmetry%%" />
		<SwitchMover name="relax_switch" movers="refine,consensus" selected="%%switch%%" />
	</MOVERS>

	<FILTERS>
		<Time name="time"/>
	</FILTERS>

	<PROTOCOLS>
		<Add filter_name="time" report_at_end="false"/>
		<Add mover_name="symmetry_switch"/>
		<Add mover_name="relax_switch"/>
		<Add mover_name="metrics_interface_design"/>
		<Add filter_name="time"/>
	</PROTOCOLS>

</ROSETTASCRIPTS>
