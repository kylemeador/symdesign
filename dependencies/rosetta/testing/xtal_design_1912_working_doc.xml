<ROSETTASCRIPTS>
        <SCOREFXNS>
		<ScoreFunction name="2015" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
			<Reweight scoretype="res_type_constraint" weight="1"/>
			#Reweight scoretype="dump_trajectory"/> weight="1" dump_trajectory_prefix="TRAJ_" dump_trajectory_gz="false" dump_trajectory_stride="5"/>
			# Sets the output format to gzipped PDB.  "False" by default
			# Sets the scorefunction to dump a structure on every SECOND scoring attempt
			# Default is 1 (dumps on EVERY step in minimization or packing trajectory)
		</ScoreFunction>
		<ScoreFunction name="2015_soft" weights="ref2015_soft">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
			<Reweight scoretype="res_type_constraint" weight="1"/>
		</ScoreFunction>
		<ScoreFunction name="2015_no_pssm" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
		</ScoreFunction>
		<ScoreFunction name="2015_pure" weights="ref2015"/>
	</SCOREFXNS>
	<RESIDUE_SELECTORS>
		#Task name="rtinterface_min" fixed="0" packable="1" designable="1" task_operations="rtinterface"/>
		<Index name="8A_interface" resnums="%%interface%%" error_on_out_of_bounds_index="1" reverse="0"/>
		<Not name="not_interface" selector="8A_interface"/>
	</RESIDUE_SELECTORS>
	<TASKOPERATIONS>
		<InitializeFromCommandline name="init"/>
		<RestrictIdentities name="vrt" identities="XXX" prevent_repacking="1"/>
		<RestrictToRepacking name="rtr"/>
		#ReadResfile name="int" selector="8A_interface"/> No instruction on how to use resnums
		<DesignRestrictions name="interface_start">
			<Action residue_selector="8A_interface" aas="G"/>   
		</DesignRestrictions>
		<OperateOnResidueSubset name="non_int_res_no_repack" selector="not_interface">		
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		<OperateOnResidueSubset name="non_int_res_rtr" selector="not_interface">		
			<RestrictToRepackingRLT/>
		</OperateOnResidueSubset>
		<OperateOnResidueSubset name="int_no_repack" selector="8A_interface">		
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		<PreventResiduesFromRepacking name="fix_res" reference_pdb_id="%%pdb_reference%%" residues="%%fix_res%%"/> #integrate with design to include important residue sites (active, allostery, interface?)
		<SeqprofConsensus name="pssm_cutoff" filename="%%pssm_file%%" min_aa_probability="0" convert_scores_to_probabilities="0" probability_larger_than_current="0" keep_native="1"/>
		<DesignAround name="des_around" design_shell="0.1" resnums="%%interface%%" repack_shell="8.0"/>
		#RestrictToInterface name="rtinterface" jump="%%interface_separator%%" distance="8"/>
		#ProteinInterfaceDesign name="PID" repack_chain1="1" repack_chain2="1" design_chain1="1" design_chain2="1" allow_all_aas="1" design_all_aas="1" jump="100" interface_distance_cutoff="8.0" modify_before_jump="1" modify_after_jump="1"/>
		#DesignRestrictions name="interface">
			#Action residue_selector="8A_interface" residue_level_operations="init, vrt"/>
		#/DesignRestrictions>
	</TASKOPERATIONS>
	<MOVERS>
		<MakeLatticeMover name="make_lattice" contact_dist="%%dist%%"/>
		<ExtractAsymmetricUnit name="extract_asu" keep_virtual="0" keep_unknown_aas="0"/>
		<DumpPdb name="dump_pdb" fname="%%pdb_reference%%design_lattice.pdb" scorefxn="2015" tag_time="0"/>
		<PDBTrajectoryRecorder name="record" stride="10" filename="traj.pdb" cumulate_jobs="0" cumulate_replicas="0"/>
                <SymPackRotamersMover name="start_int" scorefxn="2015_soft" task_operations="init,vrt,interface_start,non_int_res_no_repack"/> # set all interface residues to GLY, leave everything else untouched
		<SymPackRotamersMover name="soft_design_int" scorefxn="2015_soft" task_operations="init,vrt,pssm_cutoff,des_around"/> # repack shell around a design residue
		<SymPackRotamersMover name="hard_design_int" scorefxn="2015" task_operations="init,vrt,pssm_cutoff,des_around"/> # repack shell around a design residue fix_res,read_resfile
                <MinMover name="soft_min" scorefxn="2015_soft" chi="1" bb="0" jump="0"/>
			#MoveMap>
        			#ResidueSelector selector="rtinterface_min" chi="1" bb="1" bondangle="0" bondlength="0"/>
			#/MoveMap>
		#/MinMover>
		<MinMover name="hard_min" scorefxn="2015" chi="1" bb="0" jump="0"/>
			#MoveMap>
        			#ResidueSelector selector="rtinterface_min" chi="1" bb="1" bondangle="0" bondlength="0"/>
			#/MoveMap>
		#/MinMover>
		<TaskAwareSymMinMover name="soft_min_design_int" scorefxn="2015_soft" bb="1" chi="1" task_operations="init,vrt,non_int_res_rtr"/> # minimize backbones/sc at interface (design), minimize sc elsewhere (packing)
		<TaskAwareSymMinMover name="hard_min_design_int" scorefxn="2015" bb="1" chi="1" task_operations="init,vrt,non_int_res_rtr"/> # minimize backbones/sc at interface, minimize sc elsewhere
		<SymRotamerTrialsMover name="RTmin" scorefxn="2015" task_operations="init,rtr"/> #fix_res
                #ConstraintSetMover name="add_CA_cst" cst_file="%%cst_path%%"/>
		<AtomCoordinateCstMover name="add_coord_cst" coord_dev="1" bounded="0" native="0" task_operations="init,vrt,non_int_res_rtr,int_no_repack"/> # add coordinate constraint to only outside of interface residues
		#VirtualRoot name="vrt_rrot" removable="0" remove="0"/> #may want to add later as the frame can move
		<FavorSequenceProfile name="fsp" pssm="%%pssm_file%%" scaling="none" scorefxns="2015,2015_soft" weight="1"/> 
		<ParsedProtocol name="design_block">
			<Add mover_name="soft_design_int"/>
			#include a repack around interface in each iteration?
			<Add mover_name="soft_min_design_int"/>
			<Add mover_name="soft_design_int"/>
			<Add mover_name="hard_min_design_int"/>
			<Add mover_name="hard_design_int"/>
			<Add mover_name="hard_min_design_int"/>
			<Add mover_name="hard_design_int"/>
			<Add mover_name="RTmin"/>
			<Add mover_name="RTmin"/>
			<Add mover_name="hard_min"/> may replace with _design_int?
		</ParsedProtocol>
                <LoopOver iterations="4" mover_name="design_block" name="loop_4"/>
	</MOVERS>
	<FILTERS>
		<Time name="timer"/>
		<ScoreType confidence="0" name="stability_score_full" score_type="total_score" scorefxn="2015" threshold="0"/>
		<ScoreType confidence="0" name="stability_without_pssm" score_type="total_score" scorefxn="2015_no_pssm" threshold="0"/>
		<ScoreType confidence="0" name="stability_pure" score_type="total_score" scorefxn="2015_pure" threshold="0"/>
		#OligomericAverageDegree name=avg_deg threshold=0 distance_threshold=10.0 verbose=1 write2pdb=1 task_operations=full_int sym_dof_names=%%symdof1%%,%%symdof2%% multicomp=1 confidence=0 />
		#InterfacePacking name=packing lower_cutoff=-5 upper_cutoff=5 distance_cutoff=9.0 sym_dof_names=%%symdof1%%,%%symdof2%% multicomp=1 confidence=0 />
		#AtomicContactCount name=acc partition=none taskA=full_int,no_pack_hydrophilics taskB=repack_only  distance=4.5 confidence=0 />
		#AtomicContactCount name=nacc partition=none taskA=full_int,no_pack_hydrophilics taskB=repack_only   distance=4.5 normalize_by_carbon_count=1 confidence=0/>
		#MoveBeforeFilter name=unbound_acc mover=gen_unbound_pose filter=acc confidence=0 />
		#MoveBeforeFilter name=unbound_nacc mover=gen_unbound_pose filter=nacc confidence=0 />
		#CalculatorFilter name=delta_acc threshold=0 equation="X - Y" confidence=0 >
      		#VAR name=X filter=acc />
      		#VAR name=Y filter=unbound_acc />
		#RotamerBoltzmannWeight name=rotboltz_nolimitaro task_operations=init,ic,vrt,allaa_resfile,repack_only,aromatics radius=6.0 sym_dof_names="%%symdof1%%,%%symdof2%%" unbound=1 scorefxn=sfx_hard_symm temperature=0.8 repack=1 skip_ala_scan=1 write2pdb=1 />
		#ShapeComplementarity name=sc2 multicomp=1 verbose=0 min_sc=0.60 sym_dof_name="%%symdof2%%" confidence=0 />
		#TwoWayNeighborCount name=twnc threshold=0.000 distance_threshold=8.9 verbose=1 write2pdb=1 task_operations=full_int sym_dof_names=%%symdof1%%,%%symdof2%% multicomp=1 mode=fraction A_min=4 B_min=5 confidence=0 />
	</FILTERS>
	<PROTOCOLS>
                <Add filter_name="timer"/>
		<Add mover_name="add_coord_cst"/>
		#Add mover_name="record"/>
		<Add mover_name="fsp"/>
		<Add mover_name="make_lattice"/>
		<Add mover_name="start_int"/>
		#Add mover_name="design_block"/>
		<Add mover_name="loop_4"/>
		<Add filter_name="stability_score_full"/>
                <Add filter_name="stability_without_pssm"/>
                <Add filter_name="stability_pure"/>
		#Add mover_name="dump_pdb"/>
		<Add mover_name="extract_asu"/>
		<Add filter_name="timer"/>
	</PROTOCOLS>
</ROSETTASCRIPTS>
