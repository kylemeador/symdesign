<ROSETTASCRIPTS>
        <SCOREFXNS>
		<ScoreFunction name="2015" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
			<Reweight scoretype="res_type_constraint" weight="1"/>
		</ScoreFunction>
		<ScoreFunction name="2015_soft" weights="ref2015_soft">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
			<Reweight scoretype="res_type_constraint" weight="1"/>
		</ScoreFunction>
		<ScoreFunction name="2015_no_pssm" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
		</ScoreFunction>
		<ScoreFunction name="2015_pure" weights="ref2015"/>
	</SCOREFXNS>
	<RESIDUE_SELECTORS>
		<Index name="8A_interface" resnums="%%interface%%" error_on_out_of_bounds_index="1" reverse="0"/>
		<Not name="not_interface" selector="8A_interface"/>
	</RESIDUE_SELECTORS>
	<TASKOPERATIONS>
		<InitializeFromCommandline name="init"/>
		<RestrictIdentities name="vrt" identities="XXX" prevent_repacking="1"/>
		<RestrictToRepacking name="rtr"/>
		<DesignRestrictions name="interface_start">
			<Action residue_selector="8A_interface" aas="G"/>   
		</DesignRestrictions>
		<OperateOnResidueSubset name="non_int_res_no_repack" selector="not_interface">		
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		<OperateOnResidueSubset name="non_int_res_rtr" selector="not_interface">		
			<RestrictToRepackingRLT/>
		</OperateOnResidueSubset>
		<OperateOnResidueSubset name="int_no_repack" selector="8A_interface">		
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		<OperateOnResidueSubset name="int_rtr" selector="8A_interface">		
			<RestrictToRepackingRLT/>
		</OperateOnResidueSubset>
		<PreventResiduesFromRepacking name="fix_res" reference_pdb_id="%%pdb_reference%%" residues="%%fix_res%%"/> #integrate with design to include important residue sites (active, allostery, interface?)
		<SeqprofConsensus name="pssm_cutoff" filename="%%pssm_file%%" min_aa_probability="0" convert_scores_to_probabilities="0" probability_larger_than_current="0" keep_native="1"/>
		<DesignAround name="des_around" design_shell="0.1" resnums="%%interface%%" repack_shell="8.0"/>
	</TASKOPERATIONS>
	<MOVERS>
		<MakeLatticeMover name="make_lattice" contact_dist="%%dist%%"/>
		<ExtractAsymmetricUnit name="extract_asu" keep_virtual="0" keep_unknown_aas="0"/>
		<DumpPdb name="dump_pdb" fname="%%pdb_reference%%design_lattice.pdb" scorefxn="2015" tag_time="0"/>
		<PDBTrajectoryRecorder name="record" stride="10" filename="traj.pdb" cumulate_jobs="0" cumulate_replicas="0"/>
                <SymPackRotamersMover name="start_int" scorefxn="2015_soft" task_operations="init,vrt,interface_start,non_int_res_no_repack"/> # set all interface residues to GLY, leave everything else untouched
		<SymPackRotamersMover name="soft_design_int" scorefxn="2015_soft" task_operations="init,vrt,pssm_cutoff,des_around"/> # repack shell around a design residue
		<SymPackRotamersMover name="hard_design_int" scorefxn="2015" task_operations="init,vrt,pssm_cutoff,des_around"/> # repack shell around a design residue fix_res,read_resfile
                <MinMover name="soft_min" scorefxn="2015_soft" chi="1" bb="0" jump="0"/>
		<MinMover name="hard_min" scorefxn="2015" chi="1" bb="0" jump="0"/>
		<TaskAwareSymMinMover name="soft_min_design_int" scorefxn="2015_soft" bb="1" chi="1" task_operations="init,vrt,non_int_res_rtr"/> # minimize backbones/sc at interface (design), minimize sc elsewhere (packing)
		<TaskAwareSymMinMover name="hard_min_design_int" scorefxn="2015" bb="1" chi="1" task_operations="init,vrt,non_int_res_rtr"/> # minimize backbones/sc at interface, minimize sc elsewhere
		<SymRotamerTrialsMover name="RTmin" scorefxn="2015" task_operations="init,rtr"/> #fix_res
		<AtomCoordinateCstMover name="add_coord_cst" coord_dev="1" bounded="0" native="0" task_operations="init,vrt,non_int_res_rtr,int_no_repack"/> # add coordinate constraint to only outside of interface residues
		<FavorSequenceProfile name="fsp" pssm="%%pssm_file%%" scaling="none" scorefxns="2015,2015_soft" weight="1"/> 
		<ParsedProtocol name="design_block">
			<Add mover_name="soft_design_int"/>
			<Add mover_name="soft_min_design_int"/>
			<Add mover_name="soft_design_int"/>
			<Add mover_name="hard_min_design_int"/>
			<Add mover_name="hard_design_int"/>
			<Add mover_name="hard_min_design_int"/>
			<Add mover_name="hard_design_int"/>
			<Add mover_name="RTmin"/>
			<Add mover_name="RTmin"/>
			<Add mover_name="hard_min"/>
		</ParsedProtocol>
                <LoopOver iterations="1" mover_name="design_block" name="loop_4"/>
	</MOVERS>
	<FILTERS>
		<Time name="timer"/>
		<ScoreType confidence="0" name="stability_score_full" score_type="total_score" scorefxn="2015" threshold="0"/>
		<ScoreType confidence="0" name="stability_without_pssm" score_type="total_score" scorefxn="2015_no_pssm" threshold="0"/>
		<ScoreType confidence="0" name="stability_pure" score_type="total_score" scorefxn="2015_pure" threshold="0"/>
		<AverageDegree name="average_degree" threshold="0" distance_threshold="10.0" task_operations="des_around"/>
		<AtomicContactCount name="acc" partition="none" task_operations="int_no_repack,vrt" distance="5"/>
		<RotamerBoltzmannWeight name="interface_rotamer_quality" task_operations="non_int_res_no_repack,vrt" radius="8.0" jump="1" unbound="1" ddG_threshold="0" scorefxn="2015" temperature="1" energy_reduction_factor="0" repack="0" skip_ala_scan="1" skip_report="1" no_modified_ddG="0"/> # skip_report=1 should produce values to the scorefile. where are they?
		<ShapeComplementarity name="int_sc" min_sc="0" min_interface="0" quick="0" residues1="%%interface1%%" residues2="%%interface2%%" write_int_area="1" write_median_dist="1"/>  # jump="%%interface_separator%%"
		<Sasa name="total_sasa" threshold="200" hydrophobic="0" polar="0" jump="1"/>
		<Sasa name="sasa_hydrophobic_filter" threshold="200" hydrophobic="1" polar="0" jump="1"/>
		<Sasa name="sasa_polar_filter" threshold="100" hydrophobic="0" polar="1" jump="1"/>
		<Rmsd name="rmsd" symmetry="0" chains="AB" superimpose_on_all="0" superimpose="1" threshold="5" rms_residues_from_pose_cache="0" confidence="1.0"/>  #reference_name="%%pdb_reference%%"
		#InterfaceHoles name="hole_finder" jump="%%interface_separator%%" threshold="200"/>
		ExposedHydrophobics name="sasa_hydrophobics" sasa_cutoff="20" threshold="-1"/>
	</FILTERS>
	<PROTOCOLS>
                <Add filter_name="timer"/>
		<Add mover_name="add_coord_cst"/>
		#Add mover_name="fsp"/>
		<Add mover_name="make_lattice"/>
		#Add mover_name="start_int"/>
		#Add mover_name="loop_4"/>
		<Add filter_name="stability_score_full"/>
                <Add filter_name="stability_without_pssm"/>
                <Add filter_name="stability_pure"/>
                <Add filter_name="int_sc"/>
                <Add filter_name="average_degree"/>
                <Add filter_name="acc"/>
                <Add filter_name="interface_rotamer_quality"/> problem with protocols.geometry.RB_geometry: [ ERROR ] critical error: upstream_atoms was zero; could not divide!
*** Error in `/joule2/programs/rosetta/rosetta_src_2019.35.60890_bundle/main/source/bin/rosetta_scripts.python.linuxgccrelease': double free or corruption (out): 0x0000000007b7be60 ***
                #Add filter_name="total_sasa"/>
                <Add filter_name="sasa_hydrophobic_filter"/>
                <Add filter_name="sasa_polar_filter"/>
		<Add mover_name="extract_asu"/>
                <Add filter_name="rmsd"/>
		<Add filter_name="timer"/>
	</PROTOCOLS>
</ROSETTASCRIPTS>
