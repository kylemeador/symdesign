<ROSETTASCRIPTS>

	<SCOREFXNS>
		<ScoreFunction name="2015" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
		</ScoreFunction>
		<ScoreFunction name="2015_soft" weights="ref2015_soft">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
		</ScoreFunction>
	</SCOREFXNS>

	<RESIDUE_SELECTORS>
		# used for selecting residues on one side of the interface from chain "A". all resnums are listed 23,54,65,90,etc... in the %%interface1%% variable
		<Index name="A_interface" resnums="%%interface1%%" error_on_out_of_bounds_index="1" reverse="0"/>
		# same, but for residues from chain "B"
		<Index name="B_interface" resnums="%%interface2%%" error_on_out_of_bounds_index="1" reverse="0"/>
		# combined group of all identified interface residues
		<Or name="tot_interface" selectors="A_interface,B_interface"/>
		# the negation of all interface residues
		<Not name="not_interface" selector="tot_interface"/>
	</RESIDUE_SELECTORS>

	<TASKOPERATIONS>
		<InitializeFromCommandline name="init"/>
		# restrict movement of any virtual residues made during symmetry protocol. don't think these are allowed to move unless degrees of freedom are modified, but safe option nonetheless
		<RestrictIdentities name="vrt" identities="XXX" prevent_repacking="1"/>
		# standard operation to restrict all residues to repacking
		<RestrictToRepacking name="rtr"/>
		# disable repacking of the interface only
		<OperateOnResidueSubset name="int_no_repack" selector="tot_interface"> <PreventRepackingRLT/> </OperateOnResidueSubset>
		# restrict all non-interface residues to repacking only, no design
		<OperateOnResidueSubset name="non_int_rtr" selector="not_interface"> <RestrictToRepackingRLT/> </OperateOnResidueSubset>
		# only use residues included in a %%pssm_file%%. options specify how to treat the pssm and which rotamers to include for design
		<SeqprofConsensus name="pssm_cutoff" filename="%%pssm_file%%" min_aa_probability="0" convert_scores_to_probabilities="0" probability_larger_than_current="0" keep_native="1"/>
	</TASKOPERATIONS>

	<SIMPLE_METRICS>
		# gather the per residue SASA of a residue selection
		<PerResidueSasaMetric name="M_sasa_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" mode="all_sasa"/>
		<PerResidueSasaMetric name="M_sasa_hydrophobic_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" mode="hydrophobic_sasa"/>
		<PerResidueSasaMetric name="M_sasa_polar_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" mode="polar_sasa"/>
		# summarize the metric from a PerResidueMetric. This is for the total SASA from above
<!-- 		<ResidueSummaryMetric name="M_sasa_summary_total" custom_type="int_sasa_total" metric="M_sasa_per_res" action="sum"/> cache_prefix="" cache_suffix="" fail_on_missing_cache="true"
		<ResidueSummaryMetric name="M_sasa_summary_hydrophobic" custom_type="int_sasa_hydrophbic" metric="M_sasa_hydrophobic_per_res" action="sum"/> #Redundant with filter below
		<ResidueSummaryMetric name="M_sasa_summary_polar" custom_type="int_sasa_polar" metric="M_sasa_polar_per_res" action="sum"/> #Redundant with filter below -->
		# find the per residue energy of residues in a residue_selector 
		<PerResidueEnergyMetric name="M_int_energy_asu_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" use_native="false" scoretype="total_score" scorefxn="2015"/>
		<PerResidueEnergyMetric name="M_int_energy_unbound_per_res" custom_type="per" output_as_pdb_nums="false" residue_selector="tot_interface" use_native="false" scoretype="total_score" scorefxn="2015"/>
		# summarize the energy metrics from above
		<ResidueSummaryMetric name="M_int_energy_total_asu" custom_type="int_energy" metric="M_int_energy_asu_per_res" action="sum"/>
		<ResidueSummaryMetric name="M_int_energy_total_unbound" custom_type="int_energy" metric="M_int_energy_unbound_per_res" action="sum"/>
		# calculate the interaction energy metric between residues in two selections. I believe this in only the two body components to understand the interface component of energy
		<InteractionEnergyMetric name="M_int_energy" custom_type="" force_rescore="false" residue_selector="A_interface" residue_selector2="B_interface" scorefxn="2015"/> #used to specify certain score terms to calculate on. include_rama_prepro_and_proclose="false". JD2 reports options invalid "scoretypes_only="" scoretypes_skip="""
	</SIMPLE_METRICS>

	<MOVERS>
		<AtomCoordinateCstMover name="add_coord_cst" coord_dev="1" bounded="0" native="0" task_operations="init,vrt,non_int_rtr,int_no_repack"/> 
		# move two folds on different sides of a jump. this instance has the jump between chain A and B and moves them apart the distance on the specified axis (not sure how the axis are defined)
		<RigidBodyTransMover name="translate_asu" jump="1" distance="1000.0" x="0.0" y="0.0" z="0.0"/>
		# process mertics that are defined in the SimpleMetrics header above
		<RunSimpleMetrics name="run_metrics_hydrophobic_sasa_asu" metrics="M_sasa_hydrophobic_per_res" prefix="" suffix="_hydrophobic_asu" override="false"/> M_sasa_per_res,
		<RunSimpleMetrics name="run_metrics_hydrophobic_sasa_unbound" metrics="M_sasa_hydrophobic_per_res" prefix="" suffix="_hydrophobic_unbound" override="false"/> 
		<RunSimpleMetrics name="run_metrics_polar_sasa_asu" metrics="M_sasa_polar_per_res" prefix="" suffix="_polar_asu" override="false"/> 
		<RunSimpleMetrics name="run_metrics_polar_sasa_unbound" metrics="M_sasa_polar_per_res" prefix="" suffix="_polar_unbound" override="false"/> 
		<RunSimpleMetrics name="run_metrics_sasa_asu" metrics="M_sasa_per_res" prefix="" suffix="_total_asu" override="false"/> 
		<RunSimpleMetrics name="run_metrics_sasa_unbound" metrics="M_sasa_per_res" prefix="" suffix="_total_unbound" override="false"/> 
		<RunSimpleMetrics name="run_metrics_asu" metrics="M_int_energy_asu_per_res,M_int_energy_total_asu,M_int_energy" prefix="" suffix="_asu" override="false"/>
		<RunSimpleMetrics name="run_metrics_unbound" metrics="M_int_energy_unbound_per_res,M_int_energy_total_unbound,M_int_energy" prefix="" suffix="_unbound" override="false"/> 
	</MOVERS>

	<PROTOCOLS>
		<Add mover_name="add_coord_cst"/>
		<Add mover_name="run_metrics_hydrophobic_sasa_asu"/>
		<Add mover_name="run_metrics_polar_sasa_asu"/>
		<Add mover_name="run_metrics_sasa_asu"/>
		<Add mover_name="run_metrics_asu"/>
		<Add mover_name="translate_asu"/>
		<Add mover_name="run_metrics_hydrophobic_sasa_unbound"/>
		<Add mover_name="run_metrics_polar_sasa_unbound"/>
		<Add mover_name="run_metrics_sasa_unbound"/>
		<Add mover_name="run_metrics_unbound"/>
	</PROTOCOLS>

</ROSETTASCRIPTS>
