<ROSETTASCRIPTS>

	<SCOREFXNS>
		<!-- <ScoreFunction name="2015" weights="ref2015"> -->
			<!-- <Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/> -->
				<!-- <Reweight scoretype="res_type_constraint" weight="1"/> -->
		<!-- </ScoreFunction> -->
		<!-- <ScoreFunction name="2015_soft" weights="ref2015_soft"> -->
			<!-- <Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/> -->
				<!-- <Reweight scoretype="res_type_constraint" weight="1"/> -->
		<!-- </ScoreFunction> -->
		# patched version of above, reduces weights by 0.5 as the symmetric score function created with MakeLatticeMover and MakeLayerMover arbitrarily doubles monomeric energy
		<ScoreFunction name="2015_nano" weights="ref2015" patch="%%sym_score_patch%%">
			<!-- <Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/> -->
		</ScoreFunction>
		<ScoreFunction name="2015_nano_soft" weights="ref2015_soft" patch="%%sym_score_patch%%">
			<!-- <Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/> -->
		</ScoreFunction>
	</SCOREFXNS>

	<RESIDUE_SELECTORS>
		# used for selecting residues on one side of the interface from chain "A". all resnums are listed 23,54,65,90,etc... in the %%interface1%% variable
		<Index name="A_interface" resnums="%%interface1%%" error_on_out_of_bounds_index="1" reverse="0"/>
		# same, but for residues from chain "B"
		<Index name="B_interface" resnums="%%interface2%%" error_on_out_of_bounds_index="1" reverse="0"/>
		# combined group of all identified interface residues
		<Or name="tot_interface" selectors="A_interface,B_interface"/>
		# the negation of all interface residues
		<Not name="not_interface" selector="tot_interface"/>
		# select all residues lower than energy 10 invloved in sidechain hydrogen bonding
		<!-- <HBond name="hbond_residues" residue_selector="tot_interface" include_bb_bb="false" hbond_energy_cutoff="10" scorefxn="2015_nano"/> -->
	</RESIDUE_SELECTORS>

	<TASKOPERATIONS>
		<RestrictIdentities name="vrt" identities="XXX" prevent_repacking="1"/>
		<DesignAround name="des_around" design_shell="0.1" resnums="%%interface%%" repack_shell="8.0"/>
		<OperateOnResidueSubset name="int_no_repack" selector="tot_interface">		
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
	</TASKOPERATIONS>

	<MOVERS>
		<MakeLatticeMover name="make_lattice" contact_dist="%%dist%%"/>
		<ExtractAsymmetricUnit name="extract_asu" keep_virtual="0"/>
		<SavePoseMover name="save_nanohedra" restore_pose="0" reference_name="nanohedra"/>
		<SavePoseMover name="restore_nanohedra" restore_pose="1" reference_name="nanohedra"/> 
		<FastRelax name="relax" scorefxn="2015_nano" relaxscript="default"/>
	</MOVERS>

	<FILTERS>
		<Time name="time"/>
		<ScoreType name="full_stability" scorefxn="2015_nano" threshold="10000" confidence="1.0"/>
		<!-- <AverageDegree name="int_connectivity" threshold="0" distance_threshold="10.0" task_operations="des_around"/> -->
		<!-- <AtomicContactCount name="contact_count" partition="none" task_operations="int_no_repack,vrt" distance="5.0"/> -->
		<!-- <ShapeComplementarity name="int_sc" min_sc="0.2" min_interface="0" residues1="%%interface1%%" residues2="%%interface2%%" write_int_area="1" write_median_dist="1" max_median_dist="0"/> -->
		<!-- <BuriedSurfaceArea name="bsa_total" filter_out_low="1" cutoff_buried_surface_area="100" atom_mode="all_atoms" residue_selector="tot_interface"/> -->
		<!-- <BuriedSurfaceArea name="bsa_hydrophobic" filter_out_low="1" cutoff_buried_surface_area="100" atom_mode="hydrophobic_atoms" residue_selector="tot_interface"/> -->
		<!-- <BuriedSurfaceArea name="bsa_polar" filter_out_low="1" cutoff_buried_surface_area="100" atom_mode="polar_atoms" residue_selector="tot_interface"/> -->
		<!-- <BuriedUnsatHbonds name="buried_unsat_int" residue_selector="tot_interface" scorefxn="2015" use_ddG_style="true" use_reporter_behavior="true" report_all_heavy_atom_unsats="true" only_interface="false" confidence="1.0"/> #use_hbnet_behavior="true" -->
		<Rmsd name="rmsd" symmetry="0" chains="AB" threshold="1.0" confidence="1.0"/>
		# For reporting above filters that change upon ASU extraction
		<Report name="R_rmsd" filter="rmsd"/>
	</FILTERS>

	<PROTOCOLS>
		<Add filter_name="time"/>
		<Add mover_name="make_lattice"/>
		<Add mover_name="relax"/>
        <Add filter_name="full_stability"/>
        <Add mover_name="save_nanohedra"/>
        <!-- <Add filter_name="int_sc"/> -->
        <!-- <Add filter_name="int_connectivity"/> -->
        <!-- <Add filter_name="contact_count"/> -->
        <!-- <Add filter_name="bsa_total"/> -->
        <!-- <Add filter_name="bsa_hydrophobic"/> -->
		<!-- <Add filter_name="bsa_polar"/> -->
		<!-- <Add filter_name="buried_unsat_int" report_at_end="false"/> -->
		<!-- <Add filter_name="R_buried_unsat_int"/> -->
		<Add mover_name="extract_asu"/>
		<Add filter_name="R_rmsd"/>
		<Add mover_name="restore_nanohedra"/>
		<Add filter_name="time"/>
	</PROTOCOLS>

</ROSETTASCRIPTS>
