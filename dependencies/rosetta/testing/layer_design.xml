<ROSETTASCRIPTS>
        <SCOREFXNS>
		<ScoreFunction name="2015" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
			<Reweight scoretype="res_type_constraint" weight="0.4"/>
		</ScoreFunction>
		<ScoreFunction name="2015_soft" weights="ref2015_soft">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
			<Reweight scoretype="res_type_constraint" weight="0.4"/>
		</ScoreFunction>
		<ScoreFunction name="2015_no_pssm" weights="ref2015">
			<Reweight scoretype="coordinate_constraint" weight="%%cst_value%%"/>
		</ScoreFunction>
		<ScoreFunction name="2015_pure" weights="ref2015"/>
	</SCOREFXNS>
	<TASKOPERATIONS>
		<InitializeFromCommandline name="init"/>
		<RestrictIdentities name="vrt" identities="XXX" prevent_repacking="1" />
		<RestrictToRepacking name="rtr"/>
		<PreventResiduesFromRepacking name="fix_res" reference_pdb_id="%%pdb_reference%%" residues="%%res_to_fix%%"/> #integrate with design to include important residue sites (active, allostery, interface?)
		<SeqprofConsensus name="pssm_cutoff" filename="%%pssm_file%%" min_aa_probability="0"  convert_scores_to_probabilities="0" probability_larger_than_current="0" keep_native="1"/>
		<RestrictToInterface name="rtinterface" jump="%%interface_separator%%" distance="10"/> 
	</TASKOPERATIONS>
	<MOVERS>
		#SetupForSymmetry name="add_symm" definition="%%sym%%"/>
		<MakeLayerMover name="make_layer" contact_dist="%%dist%%"/>
		<DumpPdb name="dump_pdb" fname="%%pdb_reference%%design_lattice.pdb" scorefxn="2015" tag_time="0"/>
		<ExtractAsymmetricUnit name="extract_asu" keep_virtual="0" keep_unknown_aas="0"/>
                <SymPackRotamersMover name="soft_design_int" scorefxn="2015_soft" task_operations="init,vrt,rtinterface,pssm_cutoff"/> #fix_res,read_resfile
		<SymPackRotamersMover name="hard_design_int" scorefxn="2015" task_operations="init,vrt,rtinterface,pssm_cutoff"/> #fix_res,read_resfile
                #SymMinMover name="soft_min" scorefxn="2015_soft" chi="1" bb="0" jump="0"/>
		<SymMinMover name="hard_min" scorefxn="2015" chi="1" bb="0" jump="0"/>
		<TaskAwareSymMinMover name='soft_min_design_int' scorefxn='2015_soft' bb='1' chi='1' rb='0' task_operations='init,vrt,rtinterface'/>
		<TaskAwareSymMinMover name='hard_min_design_int' scorefxn='2015' bb='1' chi='1' rb='0' task_operations='init,vrt,rtinterface'/>
		<SymRotamerTrialsMover name="RTmin" scorefxn="2015" task_operations="init,rtr"/> #fix_res
                <ConstraintSetMover name="add_CA_cst" cst_file="%%cst_full_path%%"/>
		<FavorSequenceProfile name="fsp" pssm="%%pssm_file%%" scaling="none" scorefxns="2015,2015_soft" weight="1"/>
 		<ParsedProtocol name="design_block">
			<Add mover_name="soft_design_int"/>
			#include a repack around interface in each iteration?
			<Add mover_name="soft_min_design_int"/>
			<Add mover_name="soft_design_int"/>
			<Add mover_name="hard_min_design_int"/>
			<Add mover_name="hard_design_int"/>
			<Add mover_name="hard_min_design_int"/>
			<Add mover_name="hard_design_int"/>
			<Add mover_name="RTmin"/>
			<Add mover_name="RTmin"/>
			<Add mover_name="hard_min"/>
		</ParsedProtocol>
                <LoopOver iterations="4" mover_name="design_block" name="iter4"/>
	</MOVERS>
	<FILTERS>
		<ScoreType confidence="0" name="stability_score_full" score_type="total_score" scorefxn="2015" threshold="0"/>
		<ScoreType confidence="0" name="stability_without_pssm" score_type="total_score" scorefxn="2015_no_pssm" threshold="0"/>
		<ScoreType confidence="0" name="stability_pure" score_type="total_score" scorefxn="2015_pure" threshold="0"/>
		<Rmsd confidence="0" name="rmsd"/>
		<Time name="timer"/>
	</FILTERS>
	<PROTOCOLS>
                <Add filter_name="timer"/>
		#Add mover_name="add_symm"/>
		#Add mover_name="add_CA_cst"/>
		<Add mover_name="fsp"/>
		<Add mover_name="make_layer"/>
		<Add mover_name="design_block"/>
		#Add mover_name="iter4"/>
		#Add mover_name="soft_design"/>
		#Add mover_name="soft_min"/>
		<Add filter_name="stability_score_full"/>
                <Add filter_name="stability_without_pssm"/>
                <Add filter_name="stability_pure"/>
		#Add filter_name="rmsd"/>
		<Add mover_name="dump_pdb"/>
		<Add mover_name="extract_asu"/>
		<Add filter_name="timer"/>
	</PROTOCOLS>
</ROSETTASCRIPTS>
